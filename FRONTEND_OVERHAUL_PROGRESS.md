
 ▐▛███▜▌   Claude Code v2.1.19
▝▜█████▛▘  Opus 4.5 · Claude Pro
  ▘▘ ▝▝    ~\workspace\budi_chat_truenas

❯ Implement the following plan:                                             
                                                                            
  # Frontend Redesign Plan: AI Chat Hub                                     
                                                                            
  ## Design Direction                                                       
                                                                            
  **From:** Cyan/purple "AI slop" with excessive glows, gradients, and      
  glass effects                                                             
  **To:** Refined minimal dark theme with warm amber/gold accents, elegant  
  restraint                                                                 
                                                                            
  **Inspirations:** Linear, Raycast - premium software with intentional     
  design                                                                    
                                                                            
  ---                                                                       
                                                                            
  ## Design Specifications                                                  
                                                                            
  | Aspect | Decision |                                                     
  |--------|----------|                                                     
  | **Aesthetic** | Refined Minimal |                                       
  | **Primary Color** | Amber/Gold (#f59e0b) |                              
  | **Secondary Color** | Copper/Warm Orange (#fb923c) |                    
  | **Typography** | Source Sans 3 (humanist sans) |                        
  | **Glassmorphism** | Selective - modals/dropdowns only |                 
  | **Chat Layout** | Centered narrow column (max-w-2xl) |                  
  | **Messages** | Subtle background tint, no bubbles |                     
  | **Background** | Subtle static gradient, no animation |                 
                                                                            
  ---                                                                       
                                                                            
  ## Implementation Phases                                                  
                                                                            
  ### Phase 1: Foundation                                                   
                                                                            
  **1. tailwind.config.js** - Replace color palette:                        
  ```javascript                                                             
  // Primary: Amber                                                         
  primary: {                                                                
  400: '#fbbf24',                                                           
  500: '#f59e0b',  // Main                                                  
  600: '#d97706',                                                           
  }                                                                         
                                                                            
  // Accent: Copper                                                         
  accent: {                                                                 
  400: '#fb923c',                                                           
  500: '#f97316',                                                           
  }                                                                         
                                                                            
  // Dark: Refined charcoal (keep scale, adjust values)                     
  dark: {                                                                   
  700: '#3f3f46',                                                           
  800: '#27272a',  // Cards                                                 
  850: '#1f1f23',  // Sidebar                                               
  900: '#18181b',  // Main bg                                               
  950: '#09090b',  // Deepest                                               
  }                                                                         
  ```                                                                       
                                                                            
  **2. index.html** - Add font:                                             
  ```html                                                                   
  <link href="https://fonts.googleapis.com/css2?family=Source+Sans+3:wght@4 
  00;500;600;700&display=swap" rel="stylesheet">                            
  ```                                                                       
                                                                            
  **3. index.css** - Major overhaul:                                        
                                                                            
  *Remove entirely:*                                                        
  - `.bg-mesh-animated` and `@keyframes float`                              
  - `.glow`, `.glow-accent`, `.glow-lg`, `.text-glow`                       
  - `.shine` effect                                                         
  - `.pulse-subtle`                                                         
  - `.gradient-text`                                                        
  - `.avatar-ring` gradient                                                 
                                                                            
  *Simplify:*                                                               
  - `.bg-mesh` → static subtle gradient                                     
  - `.glass` → simple `bg-dark-800/80 border-dark-700/50` (no blur)         
  - `.glass-card` → `bg-dark-800 border-dark-700/50`                        
  - `.glass-sidebar` → solid `bg-dark-850`                                  
                                                                            
  *Keep glass blur only for:*                                               
  - `.glass-modal` - modals with `backdrop-blur-xl`                         
  - `.glass-dropdown` - dropdowns/tooltips with `backdrop-blur-lg`          
                                                                            
  *Update colors in:*                                                       
  - Markdown styles (cyan → amber)                                          
  - Range slider thumb (gradient → solid amber)                             
  - Checkbox checked (gradient → solid amber)                               
  - Focus states (cyan → amber)                                             
                                                                            
  ---                                                                       
                                                                            
  ### Phase 2: Chat Interface (Chat.jsx)                                    
                                                                            
  **Sidebar:**                                                              
  - Logo: solid `bg-primary-500` (remove gradient)                          
  - Brand text: `text-primary-400` (remove gradient-text)                   
  - New Chat button: solid amber, remove shine                              
  - Chat items: `hover:bg-dark-700/50`, selected: `bg-dark-700 border-l-2   
  border-primary-500`                                                       
  - Remove all glow effects                                                 
                                                                            
  **Header:**                                                               
  - Solid `bg-dark-850 border-b border-dark-700/50` (remove glass)          
  - Agent mode badge: `bg-primary-500/10 text-primary-400` (no gradient)    
                                                                            
  **Messages:**                                                             
  - Container: `max-w-2xl` (narrow, focused reading)                        
  - User messages: `bg-dark-800 border-l-2 border-primary-500/50`           
  - AI messages: `bg-dark-850/50` (very subtle)                             
  - Full-width layout (remove bubble corners)                               
  - Simplify action buttons                                                 
                                                                            
  **Input:**                                                                
  - Send button: solid amber                                                
  - Remove shine effect                                                     
                                                                            
  **Settings Panel:**                                                       
  - Solid `bg-dark-850` (remove glass)                                      
  - Clean temperature slider                                                
  - Monospace system prompt textarea                                        
                                                                            
  ---                                                                       
                                                                            
  ### Phase 3: ModelSelector.jsx                                            
                                                                            
  - Apply `glass-dropdown` (selective blur)                                 
  - Group models by provider (Anthropic, OpenAI, Google...)                 
  - Add price tier indicators ($, $$, $$$)                                  
  - Solid amber hover highlight                                             
  - Remove gradient checkmark                                               
  - Reduce width to 380px                                                   
                                                                            
  ---                                                                       
                                                                            
  ### Phase 4: Auth Pages (Login.jsx, Register.jsx)                         
                                                                            
  - Static gradient background (remove mesh animation)                      
  - Solid amber buttons                                                     
  - Remove glow from logo                                                   
  - Clean input focus states                                                
                                                                            
  ---                                                                       
                                                                            
  ### Phase 5: Profile & Secondary Pages                                    
                                                                            
  **Profile.jsx:**                                                          
  - Solid `bg-dark-800` sidebar                                             
  - Clean tab selection                                                     
                                                                            
  **StatsTab.jsx:**                                                         
  - Solid amber for active calendar days                                    
  - Cleaner progress bars                                                   
                                                                            
  **Memories.jsx:**                                                         
  - Remove gradient from icons                                              
  - Simplify card hovers                                                    
                                                                            
  ---                                                                       
                                                                            
  ## Files to Modify                                                        
                                                                            
  | File | Scope |                                                          
  |------|-------|                                                          
  | `client/index.html` | Add Google Font |                                 
  | `client/tailwind.config.js` | New color palette, font family |          
  | `client/src/index.css` | Remove ~150 lines, modify ~100 lines |         
  | `client/src/pages/Chat.jsx` | ~50 class changes, message layout |       
  | `client/src/components/ModelSelector.jsx` | Dropdown styling, grouping  
  |                                                                         
  | `client/src/pages/Login.jsx` | ~15 class simplifications |              
  | `client/src/pages/Register.jsx` | Same as Login |                       
  | `client/src/pages/Profile.jsx` | ~10 class updates |                    
  | `client/src/components/StatsTab.jsx` | ~20 color changes |              
  | `client/src/components/SettingsTab.jsx` | Modal simplification |        
  | `client/src/pages/Memories.jsx` | ~20 class simplifications |           
                                                                            
  ---                                                                       
                                                                            
  ## Design Tokens Quick Reference                                          
                                                                            
  **Backgrounds:**                                                          
  - Page: `bg-dark-900`                                                     
  - Sidebar: `bg-dark-850`                                                  
  - Cards: `bg-dark-800`                                                    
  - Hover: `bg-dark-700/50`                                                 
                                                                            
  **Text:**                                                                 
  - Primary: `text-dark-100`                                                
  - Secondary: `text-dark-400`                                              
  - Muted: `text-dark-500`                                                  
  - Accent: `text-primary-400`                                              
                                                                            
  **Borders:**                                                              
  - Default: `border-dark-700/50`                                           
  - Hover: `border-dark-600`                                                
  - Active: `border-primary-500/50`                                         
                                                                            
  **Interactive:**                                                          
  - Button: `bg-primary-500 hover:bg-primary-600`                           
  - Selected: `bg-dark-700 border-l-2 border-primary-500`                   
  - Focus: `ring-1 ring-primary-500/30`                                     
                                                                            
  ---                                                                       
                                                                            
  ## Verification                                                           
                                                                            
  1. **Visual check:** Run `npm run dev` in client/, verify:                
  - Amber/gold accent appears throughout                                    
  - No cyan/purple remnants                                                 
  - Glass blur only on modals/dropdowns                                     
  - Static background (no floating orbs)                                    
                                                                            
  2. **Functionality check:**                                               
  - Send a message, verify streaming works                                  
  - Open model selector, test search                                        
  - Toggle settings panel                                                   
  - Fork a chat                                                             
  - Test login/logout flow                                                  
                                                                            
  3. **Responsive check:**                                                  
  - Collapse sidebar                                                        
  - Test on narrow viewport                                                 
                                                                            
                                                                            
  If you need specific details from before exiting plan mode (like exact    
  code snippets, error messages, or content you generated), read the full   
  transcript at: C:\Users\Jaxx\.claude\projects\C--Users-Jaxx-workspace-bud 
  i-chat-truenas\560fba45-bfc2-4bc0-a47c-94c2592d7dcf.jsonl                 

● I'll implement this frontend redesign systematically. Let me start by reading
  the current files to understand what needs to change.

● Read(client\index.html)
  ⎿  Read 13 lines

● Read(client\tailwind.config.js)
  ⎿  Read 69 lines

● Read(client\src\index.css)
  ⎿  Read 506 lines

● Now let me read the main component files.

● Read(client\src\pages\Chat.jsx)
  ⎿  Read 1521 lines

● Read(client\src\components\ModelSelector.jsx)
  ⎿  Read 389 lines

● Read(client\src\pages\Login.jsx)
  ⎿  Read 130 lines

● Let me read the remaining files.

● Read(client\src\pages\Register.jsx)
  ⎿  Read 150 lines

● Read(client\src\pages\Profile.jsx)
  ⎿  Read 73 lines

● Read(client\src\components\StatsTab.jsx)
  ⎿  Read 374 lines

● Read(client\src\pages\Memories.jsx)
  ⎿  Read 298 lines

● I have all the files. Let me create tasks to track this redesign and then
  start implementing.
✔ Task #1 created: Update tailwind.config.js with new color palette
✔ Task #2 created: Add Source Sans 3 font to index.html
✔ Task #3 created: Overhaul index.css - remove effects and update colors
✔ Task #4 created: Update Chat.jsx with new design system
✔ Task #5 created: Update ModelSelector.jsx styling
✔ Task #6 created: Update Login.jsx and Register.jsx
✔ Task #7 created: Update Profile.jsx, StatsTab.jsx, Memories.jsx

● Now let me start implementing. I'll begin with Phase 1: Foundation.
✔ Task #1 updated: status → in progress

● Write(client\tailwind.config.js)
  ⎿  Added 64 lines, removed 68 lines
       1 -/** @type {import('tailwindcss').Config} */                   
       2 -export default {                                              
       3 -  content: [                                                  
       4 -    "./index.html",                                           
       5 -    "./src/**/*.{js,ts,jsx,tsx}",                             
       6 -  ],                                                          
       7 -  theme: {                                                    
       8 -    extend: {                                                 
       9 -      colors: {                                               
      10 -        // Dark theme base colors                             
      11 -        dark: {                                               
      12 -          50: '#f8fafc',                                      
      13 -          100: '#f1f5f9',                                     
      14 -          200: '#e2e8f0',                                     
      15 -          300: '#cbd5e1',                                     
      16 -          400: '#94a3b8',                                     
      17 -          500: '#64748b',                                     
      18 -          600: '#475569',                                     
      19 -          700: '#334155',                                     
      20 -          800: '#1e293b',                                     
      21 -          850: '#172033',                                     
      22 -          900: '#0f172a',                                     
      23 -          950: '#0a0f1a',                                     
      24 -        },                                                    
      25 -        // Primary accent - vibrant cyan/teal                 
      26 -        primary: {                                            
      27 -          50: '#ecfeff',                                      
      28 -          100: '#cffafe',                                     
      29 -          200: '#a5f3fc',                                     
      30 -          300: '#67e8f9',                                     
      31 -          400: '#22d3ee',                                     
      32 -          500: '#06b6d4',                                     
      33 -          600: '#0891b2',                                     
      34 -          700: '#0e7490',                                     
      35 -          800: '#155e75',                                     
      36 -          900: '#164e63',                                     
      37 -        },                                                    
      38 -        // Secondary accent - vibrant purple/violet           
      39 -        accent: {                                             
      40 -          50: '#faf5ff',                                      
      41 -          100: '#f3e8ff',                                     
      42 -          200: '#e9d5ff',                                     
      43 -          300: '#d8b4fe',                                     
      44 -          400: '#c084fc',                                     
      45 -          500: '#a855f7',                                     
      46 -          600: '#9333ea',                                     
      47 -          700: '#7c3aed',                                     
      48 -          800: '#6b21a8',                                     
      49 -          900: '#581c87',                                     
      50 -        },                                                    
      51 -      },                                                      
      52 -      backgroundImage: {                                      
      53 -        'gradient-radial': 'radial-gradient(var(--tw-gradient-s
         -tops))',                                                      
      54 -        'gradient-mesh': 'linear-gradient(135deg, var(--tw-grad
         -ient-stops))',                                                
      55 -      },                                                      
      56 -      backdropBlur: {                                         
      57 -        xs: '2px',                                            
      58 -      },                                                      
      59 -      boxShadow: {                                            
      60 -        'glow': '0 0 20px rgba(6, 182, 212, 0.3)',            
      61 -        'glow-accent': '0 0 20px rgba(168, 85, 247, 0.3)',    
      62 -        'glow-lg': '0 0 40px rgba(6, 182, 212, 0.4)',         
      63 -        'inner-glow': 'inset 0 0 20px rgba(6, 182, 212, 0.1)',
      64 -      },                                                      
      65 -    },                                                        
      66 -  },                                                          
      67 -  plugins: [],                                                
      68 -};                                                            
       1 +/** @type {import('tailwindcss').Config} */                    
       2 +export default {                                               
       3 +  content: [                                                   
       4 +    "./index.html",                                            
       5 +    "./src/**/*.{js,ts,jsx,tsx}",                              
       6 +  ],                                                           
       7 +  theme: {                                                     
       8 +    extend: {                                                  
       9 +      fontFamily: {                                            
      10 +        sans: ['"Source Sans 3"', 'system-ui', 'sans-serif'],  
      11 +      },                                                       
      12 +      colors: {                                                
      13 +        // Dark theme base colors - refined charcoal           
      14 +        dark: {                                                
      15 +          50: '#fafafa',                                       
      16 +          100: '#f4f4f5',                                      
      17 +          200: '#e4e4e7',                                      
      18 +          300: '#d4d4d8',                                      
      19 +          400: '#a1a1aa',                                      
      20 +          500: '#71717a',                                      
      21 +          600: '#52525b',                                      
      22 +          700: '#3f3f46',                                      
      23 +          800: '#27272a',                                      
      24 +          850: '#1f1f23',                                      
      25 +          900: '#18181b',                                      
      26 +          950: '#09090b',                                      
      27 +        },                                                     
      28 +        // Primary accent - amber/gold                         
      29 +        primary: {                                             
      30 +          50: '#fffbeb',                                       
      31 +          100: '#fef3c7',                                      
      32 +          200: '#fde68a',                                      
      33 +          300: '#fcd34d',                                      
      34 +          400: '#fbbf24',                                      
      35 +          500: '#f59e0b',                                      
      36 +          600: '#d97706',                                      
      37 +          700: '#b45309',                                      
      38 +          800: '#92400e',                                      
      39 +          900: '#78350f',                                      
      40 +        },                                                     
      41 +        // Secondary accent - copper/warm orange               
      42 +        accent: {                                              
      43 +          50: '#fff7ed',                                       
      44 +          100: '#ffedd5',                                      
      45 +          200: '#fed7aa',                                      
      46 +          300: '#fdba74',                                      
      47 +          400: '#fb923c',                                      
      48 +          500: '#f97316',                                      
      49 +          600: '#ea580c',                                      
      50 +          700: '#c2410c',                                      
      51 +          800: '#9a3412',                                      
      52 +          900: '#7c2d12',                                      
      53 +        },                                                     
      54 +      },                                                       
      55 +      backgroundImage: {                                       
      56 +        'gradient-radial': 'radial-gradient(var(--tw-gradient-s
         +tops))',                                                       
      57 +      },                                                       
      58 +      backdropBlur: {                                          
      59 +        xs: '2px',                                             
      60 +      },                                                       
      61 +    },                                                         
      62 +  },                                                           
      63 +  plugins: [],                                                 
      64 +};                                                             
✔ Task #1 updated: status → completed
✔ Task #2 updated: status → in progress

● Write(client\index.html)
  ⎿  Added 15 lines, removed 12 lines
       1 -<!DOCTYPE html>                                               
       2 -<html lang="en">                                              
       3 -  <head>                                                      
       4 -    <meta charset="UTF-8" />                                  
       5 -    <meta name="viewport" content="width=device-width, initial-
         -scale=1.0" />                                                 
       6 -    <title>Budi Chat</title>                                  
       7 -  </head>                                                     
       8 -  <body>                                                      
       9 -    <div id="root"></div>                                     
      10 -    <script type="module" src="/src/main.jsx"></script>       
      11 -  </body>                                                     
      12 -</html>                                                       
       1 +<!DOCTYPE html>                                                
       2 +<html lang="en">                                               
       3 +  <head>                                                       
       4 +    <meta charset="UTF-8" />                                   
       5 +    <meta name="viewport" content="width=device-width, initial-
         +scale=1.0" />                                                  
       6 +    <link rel="preconnect" href="https://fonts.googleapis.com">
       7 +    <link rel="preconnect" href="https://fonts.gstatic.com" cro
         +ssorigin>                                                      
       8 +    <link href="https://fonts.googleapis.com/css2?family=Source
         ++Sans+3:wght@400;500;600;700&display=swap" rel="stylesheet">   
       9 +    <title>AI Chat Hub</title>                                 
      10 +  </head>                                                      
      11 +  <body>                                                       
      12 +    <div id="root"></div>                                      
      13 +    <script type="module" src="/src/main.jsx"></script>        
      14 +  </body>                                                      
      15 +</html>                                                        
✔ Task #2 updated: status → completed
✔ Task #3 updated: status → in progress

● Now let me overhaul index.css with the major changes.

● Write(client\src\index.css)
  ⎿  Added 340 lines, removed 505 lines
        1 -@tailwind base;                                              
        2 -@tailwind components;                                        
        3 -@tailwind utilities;                                         
        4 -                                                             
        5 -@layer base {                                                
        6 -  * {                                                        
        7 -    @apply scrollbar-thin scrollbar-thumb-dark-600 scrollbar-t
          -rack-transparent;                                            
        8 -  }                                                          
        9 -                                                             
       10 -  body {                                                     
       11 -    @apply bg-dark-950 text-dark-100 antialiased;            
       12 -    font-feature-settings: "cv02", "cv03", "cv04", "cv11";   
       13 -  }                                                          
       14 -                                                             
       15 -  /* Smoother font rendering */                              
       16 -  html {                                                     
       17 -    -webkit-font-smoothing: antialiased;                     
       18 -    -moz-osx-font-smoothing: grayscale;                      
       19 -    text-rendering: optimizeLegibility;                      
       20 -  }                                                          
       21 -}                                                            
       22 -                                                             
       23 -@layer utilities {                                           
       24 -  /* Custom scrollbar */                                     
       25 -  .scrollbar-thin::-webkit-scrollbar {                       
       26 -    width: 6px;                                              
       27 -    height: 6px;                                             
       28 -  }                                                          
       29 -                                                             
       30 -  .scrollbar-thumb-dark-600::-webkit-scrollbar-thumb {       
       31 -    @apply bg-dark-600/60 rounded-full;                      
       32 -    transition: background-color 0.2s;                       
       33 -  }                                                          
       34 -                                                             
       35 -  .scrollbar-thumb-dark-600::-webkit-scrollbar-thumb:hover { 
       36 -    @apply bg-dark-500/80;                                   
       37 -  }                                                          
       38 -                                                             
       39 -  .scrollbar-track-transparent::-webkit-scrollbar-track {    
       40 -    @apply bg-transparent;                                   
       41 -  }                                                          
       42 -                                                             
       43 -  /* Primary gradient */                                     
       44 -  .gradient-primary {                                        
       45 -    @apply bg-gradient-to-r from-primary-500 via-primary-400 t
          -o-accent-500;                                                
       46 -  }                                                          
       47 -                                                             
       48 -  /* Subtle gradient */                                      
       49 -  .gradient-subtle {                                         
       50 -    @apply bg-gradient-to-r from-primary-500/10 to-accent-500/
          -10;                                                          
       51 -  }                                                          
       52 -                                                             
       53 -  /* Gradient text */                                        
       54 -  .gradient-text {                                           
       55 -    @apply bg-gradient-to-r from-primary-400 via-cyan-300 to-a
          -ccent-400 bg-clip-text text-transparent;                     
       56 -  }                                                          
       57 -                                                             
       58 -  /* Glass effect utilities - enhanced */                    
       59 -  .glass {                                                   
       60 -    @apply bg-dark-900/50 backdrop-blur-xl border border-white
          -/[0.08];                                                     
       61 -    background: linear-gradient(                             
       62 -      135deg,                                                
       63 -      rgba(30, 41, 59, 0.5) 0%,                              
       64 -      rgba(15, 23, 42, 0.6) 100%                             
       65 -    );                                                       
       66 -  }                                                          
       67 -                                                             
       68 -  .glass-light {                                             
       69 -    @apply bg-dark-800/30 backdrop-blur-lg border border-white
          -/[0.06];                                                     
       70 -  }                                                          
       71 -                                                             
       72 -  .glass-card {                                              
       73 -    @apply backdrop-blur-xl shadow-2xl;                      
       74 -    background: linear-gradient(                             
       75 -      145deg,                                                
       76 -      rgba(30, 41, 59, 0.6) 0%,                              
       77 -      rgba(15, 23, 42, 0.7) 100%                             
       78 -    );                                                       
       79 -    border: 1px solid rgba(255, 255, 255, 0.08);             
       80 -    box-shadow:                                              
       81 -      0 4px 6px -1px rgba(0, 0, 0, 0.2),                     
       82 -      0 2px 4px -2px rgba(0, 0, 0, 0.1),                     
       83 -      inset 0 1px 0 rgba(255, 255, 255, 0.05);               
       84 -  }                                                          
       85 -                                                             
       86 -  .glass-card-hover {                                        
       87 -    @apply glass-card transition-all duration-300;           
       88 -  }                                                          
       89 -                                                             
       90 -  .glass-card-hover:hover {                                  
       91 -    border-color: rgba(255, 255, 255, 0.12);                 
       92 -    box-shadow:                                              
       93 -      0 8px 25px -5px rgba(0, 0, 0, 0.3),                    
       94 -      0 4px 10px -6px rgba(0, 0, 0, 0.2),                    
       95 -      inset 0 1px 0 rgba(255, 255, 255, 0.08);               
       96 -    transform: translateY(-1px);                             
       97 -  }                                                          
       98 -                                                             
       99 -  .glass-sidebar {                                           
      100 -    @apply backdrop-blur-2xl;                                
      101 -    background: linear-gradient(                             
      102 -      180deg,                                                
      103 -      rgba(15, 23, 42, 0.95) 0%,                             
      104 -      rgba(15, 23, 42, 0.85) 100%                            
      105 -    );                                                       
      106 -    border-right: 1px solid rgba(255, 255, 255, 0.06);       
      107 -  }                                                          
      108 -                                                             
      109 -  .glass-input {                                             
      110 -    @apply bg-dark-800/40 backdrop-blur-sm border border-white
          -/[0.08]                                                      
      111 -           focus:border-primary-500/50 focus:ring-2 focus:ring
          --primary-500/20                                              
      112 -           transition-all duration-200;                      
      113 -  }                                                          
      114 -                                                             
      115 -  .glass-input:hover:not(:focus) {                           
      116 -    border-color: rgba(255, 255, 255, 0.12);                 
      117 -  }                                                          
      118 -                                                             
      119 -  .glass-button {                                            
      120 -    @apply bg-dark-700/40 backdrop-blur-sm border border-white
          -/[0.08]                                                      
      121 -           hover:bg-dark-600/50 hover:border-white/[0.12]    
      122 -           active:scale-[0.98] transition-all duration-200;  
      123 -  }                                                          
      124 -                                                             
      125 -  /* Animated gradient background - enhanced */              
      126 -  .bg-mesh {                                                 
      127 -    background:                                              
      128 -      radial-gradient(ellipse 80% 50% at 20% 40%, rgba(6, 182,
          - 212, 0.12) 0%, transparent 50%),                            
      129 -      radial-gradient(ellipse 60% 50% at 80% 60%, rgba(168, 85
          -, 247, 0.12) 0%, transparent 50%),                           
      130 -      radial-gradient(ellipse 40% 40% at 50% 90%, rgba(6, 182,
          - 212, 0.08) 0%, transparent 50%),                            
      131 -      linear-gradient(180deg, rgba(15, 23, 42, 1) 0%, rgba(10,
          - 15, 26, 1) 100%);                                           
      132 -    background-attachment: fixed;                            
      133 -  }                                                          
      134 -                                                             
      135 -  /* Animated gradient orbs */                               
      136 -  .bg-mesh-animated {                                        
      137 -    position: relative;                                      
      138 -    overflow: hidden;                                        
      139 -  }                                                          
      140 -                                                             
      141 -  .bg-mesh-animated::before,                                 
      142 -  .bg-mesh-animated::after {                                 
      143 -    content: '';                                             
      144 -    position: absolute;                                      
      145 -    border-radius: 50%;                                      
      146 -    filter: blur(80px);                                      
      147 -    opacity: 0.5;                                            
      148 -    animation: float 20s ease-in-out infinite;               
      149 -  }                                                          
      150 -                                                             
      151 -  .bg-mesh-animated::before {                                
      152 -    width: 500px;                                            
      153 -    height: 500px;                                           
      154 -    background: radial-gradient(circle, rgba(6, 182, 212, 0.3)
          - 0%, transparent 70%);                                       
      155 -    top: -200px;                                             
      156 -    left: -100px;                                            
      157 -  }                                                          
      158 -                                                             
      159 -  .bg-mesh-animated::after {                                 
      160 -    width: 400px;                                            
      161 -    height: 400px;                                           
      162 -    background: radial-gradient(circle, rgba(168, 85, 247, 0.2
          -5) 0%, transparent 70%);                                     
      163 -    bottom: -150px;                                          
      164 -    right: -100px;                                           
      165 -    animation-delay: -10s;                                   
      166 -  }                                                          
      167 -                                                             
      168 -  @keyframes float {                                         
      169 -    0%, 100% { transform: translate(0, 0) scale(1); }        
      170 -    33% { transform: translate(30px, -30px) scale(1.05); }   
      171 -    66% { transform: translate(-20px, 20px) scale(0.95); }   
      172 -  }                                                          
      173 -                                                             
      174 -  /* Glow effects - enhanced */                              
      175 -  .glow {                                                    
      176 -    box-shadow:                                              
      177 -      0 0 15px rgba(6, 182, 212, 0.3),                       
      178 -      0 0 30px rgba(6, 182, 212, 0.15);                      
      179 -  }                                                          
      180 -                                                             
      181 -  .glow-accent {                                             
      182 -    box-shadow:                                              
      183 -      0 0 15px rgba(168, 85, 247, 0.3),                      
      184 -      0 0 30px rgba(168, 85, 247, 0.15);                     
      185 -  }                                                          
      186 -                                                             
      187 -  .glow-lg {                                                 
      188 -    box-shadow:                                              
      189 -      0 0 20px rgba(6, 182, 212, 0.4),                       
      190 -      0 0 40px rgba(6, 182, 212, 0.2),                       
      191 -      0 0 60px rgba(168, 85, 247, 0.1);                      
      192 -  }                                                          
      193 -                                                             
      194 -  /* Text glow */                                            
      195 -  .text-glow {                                               
      196 -    text-shadow: 0 0 20px rgba(6, 182, 212, 0.5);            
      197 -  }                                                          
      198 -                                                             
      199 -  /* Shine effect for buttons */                             
      200 -  .shine {                                                   
      201 -    position: relative;                                      
      202 -    overflow: hidden;                                        
      203 -  }                                                          
      204 -                                                             
      205 -  .shine::before {                                           
      206 -    content: '';                                             
      207 -    position: absolute;                                      
      208 -    top: 0;                                                  
      209 -    left: -100%;                                             
      210 -    width: 100%;                                             
      211 -    height: 100%;                                            
      212 -    background: linear-gradient(                             
      213 -      90deg,                                                 
      214 -      transparent,                                           
      215 -      rgba(255, 255, 255, 0.1),                              
      216 -      transparent                                            
      217 -    );                                                       
      218 -    transition: left 0.5s ease;                              
      219 -  }                                                          
      220 -                                                             
      221 -  .shine:hover::before {                                     
      222 -    left: 100%;                                              
      223 -  }                                                          
      224 -                                                             
      225 -  /* Pulse animation */                                      
      226 -  .pulse-subtle {                                            
      227 -    animation: pulse-subtle 3s ease-in-out infinite;         
      228 -  }                                                          
      229 -                                                             
      230 -  @keyframes pulse-subtle {                                  
      231 -    0%, 100% { opacity: 1; }                                 
      232 -    50% { opacity: 0.8; }                                    
      233 -  }                                                          
      234 -                                                             
      235 -  /* Fade in animation */                                    
      236 -  .fade-in {                                                 
      237 -    animation: fadeIn 0.3s ease-out;                         
      238 -  }                                                          
      239 -                                                             
      240 -  @keyframes fadeIn {                                        
      241 -    from { opacity: 0; transform: translateY(10px); }        
      242 -    to { opacity: 1; transform: translateY(0); }             
      243 -  }                                                          
      244 -                                                             
      245 -  /* Slide in animation */                                   
      246 -  .slide-in-left {                                           
      247 -    animation: slideInLeft 0.3s ease-out;                    
      248 -  }                                                          
      249 -                                                             
      250 -  @keyframes slideInLeft {                                   
      251 -    from { opacity: 0; transform: translateX(-20px); }       
      252 -    to { opacity: 1; transform: translateX(0); }             
      253 -  }                                                          
      254 -                                                             
      255 -  /* Scale in animation */                                   
      256 -  .scale-in {                                                
      257 -    animation: scaleIn 0.2s ease-out;                        
      258 -  }                                                          
      259 -                                                             
      260 -  @keyframes scaleIn {                                       
      261 -    from { opacity: 0; transform: scale(0.95); }             
      262 -    to { opacity: 1; transform: scale(1); }                  
      263 -  }                                                          
      264 -}                                                            
      265 -                                                             
      266 -/* Markdown styles for dark theme - enhanced */              
      267 -.markdown-content {                                          
      268 -  @apply max-w-none text-sm leading-relaxed text-dark-200;   
      269 -}                                                            
      270 -                                                             
      271 -.markdown-content > *:first-child {                          
      272 -  margin-top: 0;                                             
      273 -}                                                            
      274 -                                                             
      275 -.markdown-content > *:last-child {                           
      276 -  margin-bottom: 0;                                          
      277 -}                                                            
      278 -                                                             
      279 -.markdown-content pre {                                      
      280 -  @apply rounded-xl p-4 overflow-x-auto my-4;                
      281 -  background: linear-gradient(145deg, rgba(15, 23, 42, 0.8) 0%
          -, rgba(10, 15, 26, 0.9) 100%);                               
      282 -  border: 1px solid rgba(255, 255, 255, 0.06);               
      283 -  box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);            
      284 -}                                                            
      285 -                                                             
      286 -.markdown-content code {                                     
      287 -  @apply bg-primary-500/10 text-primary-300 px-1.5 py-0.5 roun
          -ded-md text-[13px] font-mono;                                
      288 -  border: 1px solid rgba(6, 182, 212, 0.15);                 
      289 -}                                                            
      290 -                                                             
      291 -.markdown-content pre code {                                 
      292 -  @apply bg-transparent text-dark-100 p-0 border-0;          
      293 -}                                                            
      294 -                                                             
      295 -.markdown-content h1 {                                       
      296 -  @apply text-xl font-bold mt-6 mb-4 text-dark-50 tracking-tig
          -ht;                                                          
      297 -}                                                            
      298 -                                                             
      299 -.markdown-content h2 {                                       
      300 -  @apply text-lg font-bold mt-5 mb-3 text-dark-50 tracking-tig
          -ht;                                                          
      301 -}                                                            
      302 -                                                             
      303 -.markdown-content h3 {                                       
      304 -  @apply text-base font-semibold mt-4 mb-2 text-dark-100;    
      305 -}                                                            
      306 -                                                             
      307 -.markdown-content p {                                        
      308 -  @apply my-3;                                               
      309 -}                                                            
      310 -                                                             
      311 -.markdown-content ul,                                        
      312 -.markdown-content ol {                                       
      313 -  @apply my-3 pl-5;                                          
      314 -}                                                            
      315 -                                                             
      316 -.markdown-content ul {                                       
      317 -  list-style-type: disc;                                     
      318 -}                                                            
      319 -                                                             
      320 -.markdown-content ol {                                       
      321 -  list-style-type: decimal;                                  
      322 -}                                                            
      323 -                                                             
      324 -.markdown-content li {                                       
      325 -  @apply my-1.5;                                             
      326 -}                                                            
      327 -                                                             
      328 -.markdown-content li::marker {                               
      329 -  @apply text-primary-400/60;                                
      330 -}                                                            
      331 -                                                             
      332 -.markdown-content a {                                        
      333 -  @apply text-primary-400 hover:text-primary-300 underline dec
          -oration-primary-400/30                                       
      334 -         hover:decoration-primary-300/50 underline-offset-2 tr
          -ansition-colors;                                             
      335 -}                                                            
      336 -                                                             
      337 -.markdown-content blockquote {                               
      338 -  @apply border-l-2 border-primary-500/50 pl-4 my-4 text-dark-
          -300 italic;                                                  
      339 -  background: linear-gradient(90deg, rgba(6, 182, 212, 0.05) 0
          -%, transparent 100%);                                        
      340 -  padding: 0.75rem 1rem 0.75rem 1rem;                        
      341 -  border-radius: 0 0.5rem 0.5rem 0;                          
      342 -}                                                            
      343 -                                                             
      344 -.markdown-content table {                                    
      345 -  @apply w-full my-4 border-collapse;                        
      346 -}                                                            
      347 -                                                             
      348 -.markdown-content th,                                        
      349 -.markdown-content td {                                       
      350 -  @apply border border-dark-700/50 px-3 py-2 text-sm;        
      351 -}                                                            
      352 -                                                             
      353 -.markdown-content th {                                       
      354 -  @apply bg-dark-800/50 font-semibold text-dark-100 text-left;
          -                                                              
      355 -}                                                            
      356 -                                                             
      357 -.markdown-content tr:hover td {                              
      358 -  @apply bg-dark-800/20;                                     
      359 -}                                                            
      360 -                                                             
      361 -.markdown-content hr {                                       
      362 -  @apply my-6 border-dark-700/50;                            
      363 -}                                                            
      364 -                                                             
      365 -.markdown-content img {                                      
      366 -  @apply rounded-lg my-4 max-w-full;                         
      367 -}                                                            
      368 -                                                             
      369 -/* Custom range slider for dark theme - enhanced */          
      370 -input[type="range"] {                                        
      371 -  @apply w-full h-1.5 rounded-full appearance-none cursor-poin
          -ter;                                                         
      372 -  background: linear-gradient(90deg, rgba(30, 41, 59, 0.8) 0%,
          - rgba(51, 65, 85, 0.6) 100%);                                
      373 -}                                                            
      374 -                                                             
      375 -input[type="range"]::-webkit-slider-thumb {                  
      376 -  @apply appearance-none w-4 h-4 rounded-full cursor-pointer s
          -hadow-lg;                                                    
      377 -  background: linear-gradient(135deg, #06b6d4 0%, #a855f7 100%
          -);                                                           
      378 -  box-shadow: 0 0 10px rgba(6, 182, 212, 0.4);               
      379 -  transition: transform 0.15s ease, box-shadow 0.15s ease;   
      380 -}                                                            
      381 -                                                             
      382 -input[type="range"]::-webkit-slider-thumb:hover {            
      383 -  transform: scale(1.1);                                     
      384 -  box-shadow: 0 0 15px rgba(6, 182, 212, 0.6);               
      385 -}                                                            
      386 -                                                             
      387 -input[type="range"]::-moz-range-thumb {                      
      388 -  @apply w-4 h-4 rounded-full cursor-pointer border-0;       
      389 -  background: linear-gradient(135deg, #06b6d4 0%, #a855f7 100%
          -);                                                           
      390 -  box-shadow: 0 0 10px rgba(6, 182, 212, 0.4);               
      391 -}                                                            
      392 -                                                             
      393 -/* Checkbox styling - enhanced */                            
      394 -input[type="checkbox"] {                                     
      395 -  @apply w-4 h-4 rounded cursor-pointer appearance-none;     
      396 -  background: linear-gradient(145deg, rgba(30, 41, 59, 0.8) 0%
          -, rgba(15, 23, 42, 0.9) 100%);                               
      397 -  border: 1px solid rgba(255, 255, 255, 0.1);                
      398 -  transition: all 0.2s ease;                                 
      399 -}                                                            
      400 -                                                             
      401 -input[type="checkbox"]:hover {                               
      402 -  border-color: rgba(6, 182, 212, 0.3);                      
      403 -}                                                            
      404 -                                                             
      405 -input[type="checkbox"]:checked {                             
      406 -  background: linear-gradient(135deg, #06b6d4 0%, #a855f7 100%
          -);                                                           
      407 -  border-color: transparent;                                 
      408 -  background-image: url("data:image/svg+xml,%3csvg viewBox='0 
          -0 16 16' fill='white' xmlns='http://www.w3.org/2000/svg'%3e%3c
          -path d='M12.207 4.793a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0l-2
          --2a1 1 0 011.414-1.414L6.5 9.086l4.293-4.293a1 1 0 011.414 0z'
          -/%3e%3c/svg%3e");                                            
      409 -  background-size: 100% 100%;                                
      410 -  background-position: center;                               
      411 -  background-repeat: no-repeat;                              
      412 -}                                                            
      413 -                                                             
      414 -input[type="checkbox"]:focus {                               
      415 -  @apply ring-2 ring-primary-500/30 outline-none;            
      416 -}                                                            
      417 -                                                             
      418 -/* Selection styling */                                      
      419 -::selection {                                                
      420 -  @apply bg-primary-500/30 text-white;                       
      421 -}                                                            
      422 -                                                             
      423 -/* Focus visible styling */                                  
      424 -:focus-visible {                                             
      425 -  @apply outline-none ring-2 ring-primary-500/50 ring-offset-2
          - ring-offset-dark-900;                                       
      426 -}                                                            
      427 -                                                             
      428 -/* Button press effect */                                    
      429 -.btn-press {                                                 
      430 -  transition: transform 0.1s ease;                           
      431 -}                                                            
      432 -                                                             
      433 -.btn-press:active {                                          
      434 -  transform: scale(0.97);                                    
      435 -}                                                            
      436 -                                                             
      437 -/* Tooltip styling */                                        
      438 -.tooltip {                                                   
      439 -  @apply relative;                                           
      440 -}                                                            
      441 -                                                             
      442 -.tooltip::after {                                            
      443 -  @apply absolute bottom-full left-1/2 -translate-x-1/2 mb-2 p
          -x-2 py-1                                                     
      444 -         text-xs text-white rounded-md opacity-0 pointer-event
          -s-none                                                       
      445 -         transition-opacity duration-200 whitespace-nowrap;  
      446 -  content: attr(data-tooltip);                               
      447 -  background: linear-gradient(145deg, rgba(30, 41, 59, 0.95) 0
          -%, rgba(15, 23, 42, 0.98) 100%);                             
      448 -  border: 1px solid rgba(255, 255, 255, 0.1);                
      449 -}                                                            
      450 -                                                             
      451 -.tooltip:hover::after {                                      
      452 -  @apply opacity-100;                                        
      453 -}                                                            
      454 -                                                             
      455 -/* Loading shimmer */                                        
      456 -.shimmer {                                                   
      457 -  background: linear-gradient(                               
      458 -    90deg,                                                   
      459 -    rgba(255, 255, 255, 0) 0%,                               
      460 -    rgba(255, 255, 255, 0.05) 50%,                           
      461 -    rgba(255, 255, 255, 0) 100%                              
      462 -  );                                                         
      463 -  background-size: 200% 100%;                                
      464 -  animation: shimmer 2s infinite;                            
      465 -}                                                            
      466 -                                                             
      467 -@keyframes shimmer {                                         
      468 -  0% { background-position: -200% 0; }                       
      469 -  100% { background-position: 200% 0; }                      
      470 -}                                                            
      471 -                                                             
      472 -/* Avatar ring */                                            
      473 -.avatar-ring {                                               
      474 -  @apply relative;                                           
      475 -}                                                            
      476 -                                                             
      477 -.avatar-ring::before {                                       
      478 -  content: '';                                               
      479 -  @apply absolute inset-0 rounded-full;                      
      480 -  background: linear-gradient(135deg, #06b6d4 0%, #a855f7 100%
          -);                                                           
      481 -  padding: 2px;                                              
      482 -  -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-
          -gradient(#fff 0 0);                                          
      483 -  mask: linear-gradient(#fff 0 0) content-box, linear-gradient
          -(#fff 0 0);                                                  
      484 -  -webkit-mask-composite: xor;                               
      485 -  mask-composite: exclude;                                   
      486 -}                                                            
      487 -                                                             
      488 -/* Divider with gradient */                                  
      489 -.divider-gradient {                                          
      490 -  @apply h-px;                                               
      491 -  background: linear-gradient(90deg, transparent 0%, rgba(255,
          - 255, 255, 0.1) 50%, transparent 100%);                      
      492 -}                                                            
      493 -                                                             
      494 -/* Badge */                                                  
      495 -.badge {                                                     
      496 -  @apply inline-flex items-center px-2 py-0.5 rounded-full tex
          -t-xs font-medium;                                            
      497 -}                                                            
      498 -                                                             
      499 -.badge-primary {                                             
      500 -  @apply bg-primary-500/20 text-primary-300 border border-prim
          -ary-500/30;                                                  
      501 -}                                                            
      502 -                                                             
      503 -.badge-accent {                                              
      504 -  @apply bg-accent-500/20 text-accent-300 border border-accent
          --500/30;                                                     
      505 -}                                                            
        1 +@tailwind base;                                               
        2 +@tailwind components;                                         
        3 +@tailwind utilities;                                          
        4 +                                                              
        5 +@layer base {                                                 
        6 +  * {                                                         
        7 +    @apply scrollbar-thin scrollbar-thumb-dark-600 scrollbar-t
          +rack-transparent;                                             
        8 +  }                                                           
        9 +                                                              
       10 +  body {                                                      
       11 +    @apply bg-dark-950 text-dark-100 antialiased;             
       12 +    font-feature-settings: "cv02", "cv03", "cv04", "cv11";    
       13 +  }                                                           
       14 +                                                              
       15 +  /* Smoother font rendering */                               
       16 +  html {                                                      
       17 +    -webkit-font-smoothing: antialiased;                      
       18 +    -moz-osx-font-smoothing: grayscale;                       
       19 +    text-rendering: optimizeLegibility;                       
       20 +  }                                                           
       21 +}                                                             
       22 +                                                              
       23 +@layer utilities {                                            
       24 +  /* Custom scrollbar */                                      
       25 +  .scrollbar-thin::-webkit-scrollbar {                        
       26 +    width: 6px;                                               
       27 +    height: 6px;                                              
       28 +  }                                                           
       29 +                                                              
       30 +  .scrollbar-thumb-dark-600::-webkit-scrollbar-thumb {        
       31 +    @apply bg-dark-600/60 rounded-full;                       
       32 +    transition: background-color 0.2s;                        
       33 +  }                                                           
       34 +                                                              
       35 +  .scrollbar-thumb-dark-600::-webkit-scrollbar-thumb:hover {  
       36 +    @apply bg-dark-500/80;                                    
       37 +  }                                                           
       38 +                                                              
       39 +  .scrollbar-track-transparent::-webkit-scrollbar-track {     
       40 +    @apply bg-transparent;                                    
       41 +  }                                                           
       42 +                                                              
       43 +  /* Static gradient background */                            
       44 +  .bg-mesh {                                                  
       45 +    background:                                               
       46 +      radial-gradient(ellipse 80% 50% at 20% 40%, rgba(245, 15
          +8, 11, 0.06) 0%, transparent 50%),                            
       47 +      radial-gradient(ellipse 60% 50% at 80% 60%, rgba(251, 14
          +6, 60, 0.05) 0%, transparent 50%),                            
       48 +      linear-gradient(180deg, #18181b 0%, #09090b 100%);      
       49 +    background-attachment: fixed;                             
       50 +  }                                                           
       51 +                                                              
       52 +  /* Simplified glass effects */                              
       53 +  .glass {                                                    
       54 +    @apply bg-dark-800/80 border border-dark-700/50;          
       55 +  }                                                           
       56 +                                                              
       57 +  .glass-light {                                              
       58 +    @apply bg-dark-800/40 border border-dark-700/40;          
       59 +  }                                                           
       60 +                                                              
       61 +  .glass-card {                                               
       62 +    @apply bg-dark-800 border border-dark-700/50;             
       63 +  }                                                           
       64 +                                                              
       65 +  .glass-card-hover {                                         
       66 +    @apply glass-card transition-all duration-200;            
       67 +  }                                                           
       68 +                                                              
       69 +  .glass-card-hover:hover {                                   
       70 +    @apply border-dark-600;                                   
       71 +  }                                                           
       72 +                                                              
       73 +  .glass-sidebar {                                            
       74 +    @apply bg-dark-850 border-r border-dark-700/50;           
       75 +  }                                                           
       76 +                                                              
       77 +  /* Glass with blur - only for modals and dropdowns */       
       78 +  .glass-modal {                                              
       79 +    @apply bg-dark-900/95 backdrop-blur-xl border border-dark-
          +700/50;                                                       
       80 +  }                                                           
       81 +                                                              
       82 +  .glass-dropdown {                                           
       83 +    @apply bg-dark-900/95 backdrop-blur-lg border border-dark-
          +700/50;                                                       
       84 +  }                                                           
       85 +                                                              
       86 +  .glass-input {                                              
       87 +    @apply bg-dark-800/60 border border-dark-700/50           
       88 +           focus:border-primary-500/50 focus:ring-1 focus:ring
          +-primary-500/20                                               
       89 +           transition-all duration-200;                       
       90 +  }                                                           
       91 +                                                              
       92 +  .glass-input:hover:not(:focus) {                            
       93 +    @apply border-dark-600;                                   
       94 +  }                                                           
       95 +                                                              
       96 +  .glass-button {                                             
       97 +    @apply bg-dark-700/50 border border-dark-700/50           
       98 +           hover:bg-dark-600/50 hover:border-dark-600         
       99 +           active:scale-[0.98] transition-all duration-200;   
      100 +  }                                                           
      101 +                                                              
      102 +  /* Fade in animation */                                     
      103 +  .fade-in {                                                  
      104 +    animation: fadeIn 0.3s ease-out;                          
      105 +  }                                                           
      106 +                                                              
      107 +  @keyframes fadeIn {                                         
      108 +    from { opacity: 0; transform: translateY(10px); }         
      109 +    to { opacity: 1; transform: translateY(0); }              
      110 +  }                                                           
      111 +                                                              
      112 +  /* Slide in animation */                                    
      113 +  .slide-in-left {                                            
      114 +    animation: slideInLeft 0.3s ease-out;                     
      115 +  }                                                           
      116 +                                                              
      117 +  @keyframes slideInLeft {                                    
      118 +    from { opacity: 0; transform: translateX(-20px); }        
      119 +    to { opacity: 1; transform: translateX(0); }              
      120 +  }                                                           
      121 +                                                              
      122 +  /* Scale in animation */                                    
      123 +  .scale-in {                                                 
      124 +    animation: scaleIn 0.2s ease-out;                         
      125 +  }                                                           
      126 +                                                              
      127 +  @keyframes scaleIn {                                        
      128 +    from { opacity: 0; transform: scale(0.95); }              
      129 +    to { opacity: 1; transform: scale(1); }                   
      130 +  }                                                           
      131 +}                                                             
      132 +                                                              
      133 +/* Markdown styles for dark theme */                          
      134 +.markdown-content {                                           
      135 +  @apply max-w-none text-sm leading-relaxed text-dark-200;    
      136 +}                                                             
      137 +                                                              
      138 +.markdown-content > *:first-child {                           
      139 +  margin-top: 0;                                              
      140 +}                                                             
      141 +                                                              
      142 +.markdown-content > *:last-child {                            
      143 +  margin-bottom: 0;                                           
      144 +}                                                             
      145 +                                                              
      146 +.markdown-content pre {                                       
      147 +  @apply rounded-xl p-4 overflow-x-auto my-4 bg-dark-900 borde
          +r border-dark-700/50;                                         
      148 +}                                                             
      149 +                                                              
      150 +.markdown-content code {                                      
      151 +  @apply bg-primary-500/10 text-primary-400 px-1.5 py-0.5 roun
          +ded-md text-[13px] font-mono;                                 
      152 +  border: 1px solid rgba(245, 158, 11, 0.15);                 
      153 +}                                                             
      154 +                                                              
      155 +.markdown-content pre code {                                  
      156 +  @apply bg-transparent text-dark-100 p-0 border-0;           
      157 +}                                                             
      158 +                                                              
      159 +.markdown-content h1 {                                        
      160 +  @apply text-xl font-bold mt-6 mb-4 text-dark-50 tracking-tig
          +ht;                                                           
      161 +}                                                             
      162 +                                                              
      163 +.markdown-content h2 {                                        
      164 +  @apply text-lg font-bold mt-5 mb-3 text-dark-50 tracking-tig
          +ht;                                                           
      165 +}                                                             
      166 +                                                              
      167 +.markdown-content h3 {                                        
      168 +  @apply text-base font-semibold mt-4 mb-2 text-dark-100;     
      169 +}                                                             
      170 +                                                              
      171 +.markdown-content p {                                         
      172 +  @apply my-3;                                                
      173 +}                                                             
      174 +                                                              
      175 +.markdown-content ul,                                         
      176 +.markdown-content ol {                                        
      177 +  @apply my-3 pl-5;                                           
      178 +}                                                             
      179 +                                                              
      180 +.markdown-content ul {                                        
      181 +  list-style-type: disc;                                      
      182 +}                                                             
      183 +                                                              
      184 +.markdown-content ol {                                        
      185 +  list-style-type: decimal;                                   
      186 +}                                                             
      187 +                                                              
      188 +.markdown-content li {                                        
      189 +  @apply my-1.5;                                              
      190 +}                                                             
      191 +                                                              
      192 +.markdown-content li::marker {                                
      193 +  @apply text-primary-400/60;                                 
      194 +}                                                             
      195 +                                                              
      196 +.markdown-content a {                                         
      197 +  @apply text-primary-400 hover:text-primary-300 underline dec
          +oration-primary-400/30                                        
      198 +         hover:decoration-primary-300/50 underline-offset-2 tr
          +ansition-colors;                                              
      199 +}                                                             
      200 +                                                              
      201 +.markdown-content blockquote {                                
      202 +  @apply border-l-2 border-primary-500/50 pl-4 my-4 text-dark-
          +300 italic bg-primary-500/5;                                  
      203 +  padding: 0.75rem 1rem 0.75rem 1rem;                         
      204 +  border-radius: 0 0.5rem 0.5rem 0;                           
      205 +}                                                             
      206 +                                                              
      207 +.markdown-content table {                                     
      208 +  @apply w-full my-4 border-collapse;                         
      209 +}                                                             
      210 +                                                              
      211 +.markdown-content th,                                         
      212 +.markdown-content td {                                        
      213 +  @apply border border-dark-700/50 px-3 py-2 text-sm;         
      214 +}                                                             
      215 +                                                              
      216 +.markdown-content th {                                        
      217 +  @apply bg-dark-800/50 font-semibold text-dark-100 text-left;
      218 +}                                                             
      219 +                                                              
      220 +.markdown-content tr:hover td {                               
      221 +  @apply bg-dark-800/20;                                      
      222 +}                                                             
      223 +                                                              
      224 +.markdown-content hr {                                        
      225 +  @apply my-6 border-dark-700/50;                             
      226 +}                                                             
      227 +                                                              
      228 +.markdown-content img {                                       
      229 +  @apply rounded-lg my-4 max-w-full;                          
      230 +}                                                             
      231 +                                                              
      232 +/* Custom range slider for dark theme */                      
      233 +input[type="range"] {                                         
      234 +  @apply w-full h-1.5 rounded-full appearance-none cursor-poin
          +ter bg-dark-700;                                              
      235 +}                                                             
      236 +                                                              
      237 +input[type="range"]::-webkit-slider-thumb {                   
      238 +  @apply appearance-none w-4 h-4 rounded-full cursor-pointer b
          +g-primary-500;                                                
      239 +  transition: transform 0.15s ease;                           
      240 +}                                                             
      241 +                                                              
      242 +input[type="range"]::-webkit-slider-thumb:hover {             
      243 +  transform: scale(1.1);                                      
      244 +}                                                             
      245 +                                                              
      246 +input[type="range"]::-moz-range-thumb {                       
      247 +  @apply w-4 h-4 rounded-full cursor-pointer border-0 bg-prima
          +ry-500;                                                       
      248 +}                                                             
      249 +                                                              
      250 +/* Checkbox styling */                                        
      251 +input[type="checkbox"] {                                      
      252 +  @apply w-4 h-4 rounded cursor-pointer appearance-none bg-dar
          +k-700 border border-dark-600;                                 
      253 +  transition: all 0.2s ease;                                  
      254 +}                                                             
      255 +                                                              
      256 +input[type="checkbox"]:hover {                                
      257 +  @apply border-primary-500/50;                               
      258 +}                                                             
      259 +                                                              
      260 +input[type="checkbox"]:checked {                              
      261 +  @apply bg-primary-500 border-primary-500;                   
      262 +  background-image: url("data:image/svg+xml,%3csvg viewBox='0 
          +0 16 16' fill='white' xmlns='http://www.w3.org/2000/svg'%3e%3c
          +path d='M12.207 4.793a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0l-2
          +-2a1 1 0 011.414-1.414L6.5 9.086l4.293-4.293a1 1 0 011.414 0z'
          +/%3e%3c/svg%3e");                                             
      263 +  background-size: 100% 100%;                                 
      264 +  background-position: center;                                
      265 +  background-repeat: no-repeat;                               
      266 +}                                                             
      267 +                                                              
      268 +input[type="checkbox"]:focus {                                
      269 +  @apply ring-1 ring-primary-500/30 outline-none;             
      270 +}                                                             
      271 +                                                              
      272 +/* Selection styling */                                       
      273 +::selection {                                                 
      274 +  @apply bg-primary-500/30 text-white;                        
      275 +}                                                             
      276 +                                                              
      277 +/* Focus visible styling */                                   
      278 +:focus-visible {                                              
      279 +  @apply outline-none ring-1 ring-primary-500/50 ring-offset-2
          + ring-offset-dark-900;                                        
      280 +}                                                             
      281 +                                                              
      282 +/* Button press effect */                                     
      283 +.btn-press {                                                  
      284 +  transition: transform 0.1s ease;                            
      285 +}                                                             
      286 +                                                              
      287 +.btn-press:active {                                           
      288 +  transform: scale(0.97);                                     
      289 +}                                                             
      290 +                                                              
      291 +/* Tooltip styling */                                         
      292 +.tooltip {                                                    
      293 +  @apply relative;                                            
      294 +}                                                             
      295 +                                                              
      296 +.tooltip::after {                                             
      297 +  @apply absolute bottom-full left-1/2 -translate-x-1/2 mb-2 p
          +x-2 py-1                                                      
      298 +         text-xs text-white rounded-md opacity-0 pointer-event
          +s-none                                                        
      299 +         transition-opacity duration-200 whitespace-nowrap bg-
          +dark-800 border border-dark-700;                              
      300 +  content: attr(data-tooltip);                                
      301 +}                                                             
      302 +                                                              
      303 +.tooltip:hover::after {                                       
      304 +  @apply opacity-100;                                         
      305 +}                                                             
      306 +                                                              
      307 +/* Loading shimmer */                                         
      308 +.shimmer {                                                    
      309 +  background: linear-gradient(                                
      310 +    90deg,                                                    
      311 +    rgba(255, 255, 255, 0) 0%,                                
      312 +    rgba(255, 255, 255, 0.03) 50%,                            
      313 +    rgba(255, 255, 255, 0) 100%                               
      314 +  );                                                          
      315 +  background-size: 200% 100%;                                 
      316 +  animation: shimmer 2s infinite;                             
      317 +}                                                             
      318 +                                                              
      319 +@keyframes shimmer {                                          
      320 +  0% { background-position: -200% 0; }                        
      321 +  100% { background-position: 200% 0; }                       
      322 +}                                                             
      323 +                                                              
      324 +/* Divider */                                                 
      325 +.divider-gradient {                                           
      326 +  @apply h-px bg-dark-700/50;                                 
      327 +}                                                             
      328 +                                                              
      329 +/* Badge */                                                   
      330 +.badge {                                                      
      331 +  @apply inline-flex items-center px-2 py-0.5 rounded-full tex
          +t-xs font-medium;                                             
      332 +}                                                             
      333 +                                                              
      334 +.badge-primary {                                              
      335 +  @apply bg-primary-500/10 text-primary-400 border border-prim
          +ary-500/20;                                                   
      336 +}                                                             
      337 +                                                              
      338 +.badge-accent {                                               
      339 +  @apply bg-accent-500/10 text-accent-400 border border-accent
          +-500/20;                                                      
      340 +}                                                             
✔ Task #3 updated: status → completed
✔ Task #4 updated: status → in progress

● Now let me update Chat.jsx with the new design system. This is a large file
  with many changes.

● Write(client\src\pages\Chat.jsx)
  ⎿  Added 1517 lines, removed 1520 lines
         1 -import React, { useState, useEffect, useContext, useRef, memo
           -, useCallback, useMemo } from 'react';                      
         2 -import { useNavigate } from 'react-router-dom';             
         3 -import {                                                    
         4 -  MessageSquare, Plus, Settings as SettingsIcon, LogOut, Brai
           -n,                                                          
         5 -  Send, Trash2, GitBranch, Bot, User as UserIcon,           
         6 -  Sparkles, Zap, Menu, X, ChevronDown, ChevronRight, Square,
         7 -  Check, Trash, Copy, Pencil, Info, DollarSign, Hash        
         8 -} from 'lucide-react';                                      
         9 -import { AuthContext } from '../contexts/AuthContext';      
        10 -import { marked } from 'marked';                            
        11 -import DOMPurify from 'dompurify';                          
        12 -import ModelSelector, { DEFAULT_MODEL, RECENT_MODELS_KEY, MOD
           -ELS_CACHE_KEY } from '../components/ModelSelector';         
        13 -                                                            
        14 -marked.setOptions({                                         
        15 -  breaks: true,                                             
        16 -  gfm: true                                                 
        17 -});                                                         
        18 -                                                            
        19 -const LAST_MODEL_KEY = 'budi_chat_last_model';              
        20 -                                                            
        21 -// Format time as seconds or minutes:seconds (integer display
           -)                                                           
        22 -const formatThinkingTime = (seconds) => {                   
        23 -  const s = Math.floor(seconds);                            
        24 -  if (s < 60) {                                             
        25 -    return `${s}s`;                                         
        26 -  }                                                         
        27 -  const mins = Math.floor(s / 60);                          
        28 -  const secs = s % 60;                                      
        29 -  return `${mins}m ${secs.toString().padStart(2, '0')}s`;   
        30 -};                                                          
        31 -                                                            
        32 -// Get model data from OpenRouter cache                     
        33 -const getModelFromCache = (modelId) => {                    
        34 -  try {                                                     
        35 -    const cached = localStorage.getItem(MODELS_CACHE_KEY);  
        36 -    if (cached) {                                           
        37 -      const { models } = JSON.parse(cached);                
        38 -      return models.find(m => m.id === modelId);            
        39 -    }                                                       
        40 -  } catch (e) {                                             
        41 -    console.error('Failed to get model from cache:', e);    
        42 -  }                                                         
        43 -  return null;                                              
        44 -};                                                          
        45 -                                                            
        46 -// Get context window size for a model (from cache or fallbac
           -k)                                                          
        47 -const getModelContext = (modelId) => {                      
        48 -  const model = getModelFromCache(modelId);                 
        49 -  return model?.contextLength || 128000; // fallback to 128k
        50 -};                                                          
        51 -                                                            
        52 -// Calculate cost using cached pricing data                 
        53 -const calculateCost = (promptTokens, completionTokens, modelI
           -d) => {                                                     
        54 -  const model = getModelFromCache(modelId);                 
        55 -  if (model?.pricing) {                                     
        56 -    const inputCost = promptTokens * parseFloat(model.pricing
           -.prompt);                                                   
        57 -    const outputCost = completionTokens * parseFloat(model.pr
           -icing.completion);                                          
        58 -    return inputCost + outputCost;                          
        59 -  }                                                         
        60 -  // Fallback: rough estimate                               
        61 -  return (promptTokens + completionTokens) * 0.000001;      
        62 -};                                                          
        63 -                                                            
        64 -// Memoized ThinkingSection component to prevent re-renders d
           -uring streaming                                             
        65 -const ThinkingSection = memo(({ reasoning, isExpanded, onTogg
           -le, isStreaming, elapsedTime, stats }) => {                 
        66 -  const contentRef = useRef(null);                          
        67 -  const shouldAutoScrollRef = useRef(true);                 
        68 -                                                            
        69 -  useEffect(() => {                                         
        70 -    if (isExpanded && isStreaming && shouldAutoScrollRef.curr
           -ent) {                                                      
        71 -      const scroll = () => {                                
        72 -        if (contentRef.current) {                           
        73 -          contentRef.current.scrollTop = contentRef.current.s
           -crollHeight;                                                
        74 -        }                                                   
        75 -      };                                                    
        76 -      requestAnimationFrame(scroll);                        
        77 -    }                                                       
        78 -  }, [reasoning, isExpanded, isStreaming]);                 
        79 -                                                            
        80 -  const handleScroll = (e) => {                             
        81 -    const { scrollTop, scrollHeight, clientHeight } = e.targe
           -t;                                                          
        82 -    // If user is within 50px of bottom, enable auto-scroll, 
           -otherwise disable                                           
        83 -    const isAtBottom = scrollHeight - scrollTop - clientHeigh
           -t < 50;                                                     
        84 -    shouldAutoScrollRef.current = isAtBottom;               
        85 -  };                                                        
        86 -                                                            
        87 -  if (!reasoning && !isStreaming) return null;              
        88 -                                                            
        89 -  const hasStats = stats && (stats.totalTokens > 0 || stats.d
           -uration > 0);                                               
        90 -  const cost = hasStats ? (stats.cost || (stats.promptTokens 
           -|| 0) > 0 ? calculateCost(stats.promptTokens || 0, stats.comp
           -letionTokens || 0, stats.model) : 0) : 0;                   
        91 -                                                            
        92 -  return (                                                  
        93 -    <div className="mb-4">                                  
        94 -      <div className="flex items-center justify-between">   
        95 -        <button                                             
        96 -          type="button"                                     
        97 -          onMouseDown={(e) => {                             
        98 -            e.preventDefault();                             
        99 -            onToggle();                                     
       100 -          }}                                                
       101 -          className="flex items-center gap-2 text-sm font-med
           -ium text-dark-400 hover:text-dark-300 transition-colors px-3 
           -py-1.5 rounded-lg hover:bg-white/[0.03] select-none"        
       102 -        >                                                   
       103 -          <Brain className="w-4 h-4 text-accent-400" />     
       104 -          <span>                                            
       105 -            {isStreaming ? (                                
       106 -              <>Thinking... <span className="text-accent-400 
           -font-mono text-xs ml-1">{formatThinkingTime(elapsedTime || 0)
           -}</span></>                                                 
       107 -            ) : (                                           
       108 -              'Thought Process'                             
       109 -            )}                                              
       110 -          </span>                                           
       111 -          <ChevronDown className={`w-4 h-4 transition-transfo
           -rm duration-200 ${isExpanded ? 'rotate-180' : ''}`} />      
       112 -        </button>                                           
       113 -                                                            
       114 -        {/* Details on hover - bottom right */}             
       115 -        {!isStreaming && hasStats && (                      
       116 -          <div className="group relative">                  
       117 -            <span className="text-[10px] text-dark-500 cursor
           --default">details</span>                                    
       118 -            <div className="absolute bottom-full right-0 mb-1
           - hidden group-hover:block z-10">                            
       119 -              <div className="bg-dark-800 border border-dark-
           -600 rounded-lg px-3 py-2 text-xs whitespace-nowrap shadow-xl"
           ->                                                           
       120 -                <div className="space-y-1">                 
       121 -                  {stats.duration > 0 && (                  
       122 -                    <div className="flex justify-between gap-
           -4">                                                         
       123 -                      <span className="text-dark-400">Time:</
           -span>                                                       
       124 -                      <span className="text-dark-200 font-mon
           -o">{formatThinkingTime(stats.duration)}</span>              
       125 -                    </div>                                  
       126 -                  )}                                        
       127 -                  {stats.totalTokens > 0 && (               
       128 -                    <div className="flex justify-between gap-
           -4">                                                         
       129 -                      <span className="text-dark-400">Tokens:
           -</span>                                                     
       130 -                      <span className="text-dark-200 font-mon
           -o">{stats.totalTokens.toLocaleString()} tks</span>          
       131 -                    </div>                                  
       132 -                  )}                                        
       133 -                  {cost > 0 && (                            
       134 -                    <div className="flex justify-between gap-
           -4">                                                         
       135 -                      <span className="text-dark-400">Cost:</
           -span>                                                       
       136 -                      <span className="text-accent-400 font-m
           -ono">${cost < 0.01 ? cost.toFixed(4) : cost.toFixed(3)}</span
           ->                                                           
       137 -                    </div>                                  
       138 -                  )}                                        
       139 -                </div>                                      
       140 -              </div>                                        
       141 -            </div>                                          
       142 -          </div>                                            
       143 -        )}                                                  
       144 -      </div>                                                
       145 -      {isExpanded && (                                      
       146 -        <div                                                
       147 -          ref={contentRef}                                  
       148 -          onScroll={handleScroll}                           
       149 -          className="mt-2 px-4 py-3 text-sm text-dark-300 rou
           -nded-xl border border-white/[0.06] italic bg-dark-900/40 text
           --left max-h-[300px] overflow-y-auto prose prose-invert prose-
           -sm max-w-none"                                              
       150 -          dangerouslySetInnerHTML={{                        
       151 -            __html: DOMPurify.sanitize(marked.parse(reasoning
           - || 'Thinking...'))                                         
       152 -          }}                                                
       153 -        />                                                  
       154 -      )}                                                    
       155 -    </div>                                                  
       156 -  );                                                        
       157 -});                                                         
       158 -                                                            
       159 -function Chat() {                                           
       160 -  const { user, logout } = useContext(AuthContext);         
       161 -  const navigate = useNavigate();                           
       162 -  const [chats, setChats] = useState([]);                   
       163 -  const [currentChat, setCurrentChat] = useState(() => ({   
       164 -    title: 'New Chat',                                      
       165 -    model: localStorage.getItem(LAST_MODEL_KEY) || DEFAULT_MO
           -DEL,                                                        
       166 -    temperature: 0.7,                                       
       167 -    system_prompt: '',                                      
       168 -    agent_mode: false                                       
       169 -  }));                                                      
       170 -  const [messages, setMessages] = useState([]);             
       171 -  const [inputMessage, setInputMessage] = useState('');     
       172 -  const [loading, setLoading] = useState(false);            
       173 -  const [streaming, setStreaming] = useState(false);        
       174 -  const [streamingMessage, setStreamingMessage] = useState(''
           -);                                                          
       175 -  const [streamingReasoning, setStreamingReasoning] = useStat
           -e('');                                                      
       176 -  const [showSettings, setShowSettings] = useState(false);  
       177 -  const [showSidebar, setShowSidebar] = useState(true);     
       178 -  const [showForkModal, setShowForkModal] = useState(false);
       179 -  const [deletingChatId, setDeletingChatId] = useState(null);
           -                                                             
       180 -  const [forkMessageId, setForkMessageId] = useState(null); 
       181 -  const [forkModel, setForkModel] = useState(DEFAULT_MODEL);
       182 -  const messagesEndRef = useRef(null);                      
       183 -  const messagesContainerRef = useRef(null);                
       184 -  const abortControllerRef = useRef(null);                  
       185 -  const isCreatingChatRef = useRef(false);                  
       186 -  const userHasScrolledUp = useRef(false);                  
       187 -  const statsPopupRef = useRef(null);                       
       188 -  const textareaRef = useRef(null);                         
       189 -  const [expandedThinkingSections, setExpandedThinkingSection
           -s] = useState(new Set());                                   
       190 -  const [copiedMessageId, setCopiedMessageId] = useState(null
           -);                                                          
       191 -  const [editingMessageId, setEditingMessageId] = useState(nu
           -ll);                                                        
       192 -  const [editContent, setEditContent] = useState('');       
       193 -  const [showInfoModal, setShowInfoModal] = useState(false);
       194 -  const [usageStats, setUsageStats] = useState(null);       
       195 -  const [thinkingStartTime, setThinkingStartTime] = useState(
           -null);                                                      
       196 -  const [thinkingElapsedTime, setThinkingElapsedTime] = useSt
           -ate(0);                                                     
       197 -  const [lastThinkingStats, setLastThinkingStats] = useState(
           -null);                                                      
       198 -                                                            
       199 -  const [chatSettings, setChatSettings] = useState(() => ({ 
       200 -    model: localStorage.getItem(LAST_MODEL_KEY) || DEFAULT_MO
           -DEL,                                                        
       201 -    temperature: 0.7,                                       
       202 -    system_prompt: '',                                      
       203 -    agent_mode: false                                       
       204 -  }));                                                      
       205 -                                                            
       206 -  // Calculate chat totals from persisted message data      
       207 -  const chatTotals = useMemo(() => {                        
       208 -    const assistantMsgs = messages.filter(m => m.role === 'as
           -sistant');                                                  
       209 -    return {                                                
       210 -      totalPromptTokens: assistantMsgs.reduce((sum, m) => sum
           - + (m.prompt_tokens || 0), 0),                              
       211 -      totalCompletionTokens: assistantMsgs.reduce((sum, m) =>
           - sum + (m.completion_tokens || 0), 0),                      
       212 -      totalTokens: assistantMsgs.reduce((sum, m) => sum + (m.
           -prompt_tokens || 0) + (m.completion_tokens || 0), 0),       
       213 -      totalTimeMs: assistantMsgs.reduce((sum, m) => sum + (m.
           -response_time_ms || 0), 0),                                 
       214 -      totalCost: assistantMsgs.reduce((sum, m) => sum + (m.co
           -st || 0), 0),                                               
       215 -    };                                                      
       216 -  }, [messages]);                                           
       217 -                                                            
       218 -  useEffect(() => {                                         
       219 -    loadChats();                                            
       220 -  }, []);                                                   
       221 -                                                            
       222 -  useEffect(() => {                                         
       223 -    // Skip clearing/aborting if we're in the middle of creat
           -ing a new chat                                              
       224 -    if (isCreatingChatRef.current) {                        
       225 -      return;                                               
       226 -    }                                                       
       227 -                                                            
       228 -    // Clear state immediately when switching chats or if no 
           -chat is selected                                            
       229 -    setStreamingMessage('');                                
       230 -    setStreamingReasoning('');                              
       231 -    setStreaming(false);                                    
       232 -    setUsageStats(null);                                    
       233 -                                                            
       234 -    if (abortControllerRef.current) {                       
       235 -      abortControllerRef.current.abort();                   
       236 -    }                                                       
       237 -                                                            
       238 -    if (currentChat?.id) {                                  
       239 -      loadMessages(currentChat.id);                         
       240 -    }                                                       
       241 -  }, [currentChat?.id]);                                    
       242 -                                                            
       243 -  useEffect(() => {                                         
       244 -    // Only auto-scroll if user hasn't manually scrolled up 
       245 -    if (!userHasScrolledUp.current) {                       
       246 -      scrollToBottom();                                     
       247 -    }                                                       
       248 -  }, [messages, streamingMessage]);                         
       249 -                                                            
       250 -  // Reset scroll flag when streaming ends                  
       251 -  useEffect(() => {                                         
       252 -    if (!streaming) {                                       
       253 -      userHasScrolledUp.current = false;                    
       254 -    }                                                       
       255 -  }, [streaming]);                                          
       256 -                                                            
       257 -  // Timer for thinking section                             
       258 -  useEffect(() => {                                         
       259 -    let interval;                                           
       260 -    if (streaming && thinkingStartTime) {                   
       261 -      interval = setInterval(() => {                        
       262 -        setThinkingElapsedTime((Date.now() - thinkingStartTim
           -e) / 1000);                                                 
       263 -      }, 100);                                              
       264 -    }                                                       
       265 -    return () => clearInterval(interval);                   
       266 -  }, [streaming, thinkingStartTime]);                       
       267 -                                                            
       268 -  // Reset thinking timer when streaming starts             
       269 -  useEffect(() => {                                         
       270 -    if (streaming) {                                        
       271 -      setThinkingStartTime(Date.now());                     
       272 -      setThinkingElapsedTime(0);                            
       273 -      setLastThinkingStats(null);                           
       274 -    }                                                       
       275 -  }, [streaming]);                                          
       276 -                                                            
       277 -  // Close stats popup when clicking outside                
       278 -  useEffect(() => {                                         
       279 -    const handleClickOutside = (event) => {                 
       280 -      if (statsPopupRef.current && !statsPopupRef.current.con
           -tains(event.target)) {                                      
       281 -        setShowInfoModal(false);                            
       282 -      }                                                     
       283 -    };                                                      
       284 -    if (showInfoModal) {                                    
       285 -      document.addEventListener('mousedown', handleClickOutsi
           -de);                                                        
       286 -      return () => document.removeEventListener('mousedown', 
           -handleClickOutside);                                        
       287 -    }                                                       
       288 -  }, [showInfoModal]);                                      
       289 -                                                            
       290 -  const scrollToBottom = () => {                            
       291 -    messagesEndRef.current?.scrollIntoView({ behavior: 'smoot
           -h' });                                                      
       292 -  };                                                        
       293 -                                                            
       294 -  const handleMessagesScroll = (e) => {                     
       295 -    const container = e.target;                             
       296 -    const threshold = 100; // pixels from bottom            
       297 -    const isNearBottom = container.scrollHeight - container.s
           -crollTop - container.clientHeight < threshold;              
       298 -    userHasScrolledUp.current = !isNearBottom;              
       299 -  };                                                        
       300 -                                                            
       301 -  const toggleThinkingSection = useCallback((messageId) => {
       302 -    setExpandedThinkingSections(prev => {                   
       303 -      const newSet = new Set(prev);                         
       304 -      if (newSet.has(messageId)) {                          
       305 -        newSet.delete(messageId);                           
       306 -      } else {                                              
       307 -        newSet.add(messageId);                              
       308 -      }                                                     
       309 -      return newSet;                                        
       310 -    });                                                     
       311 -  }, []);                                                   
       312 -                                                            
       313 -  const loadChats = async () => {                           
       314 -    try {                                                   
       315 -      const res = await fetch('/api/chats', {               
       316 -        headers: { 'Authorization': `Bearer ${localStorage.ge
           -tItem('token')}` }                                          
       317 -      });                                                   
       318 -      const data = await res.json();                        
       319 -      setChats(data);                                       
       320 -    } catch (error) {                                       
       321 -      console.error('Failed to load chats:', error);        
       322 -    }                                                       
       323 -  };                                                        
       324 -                                                            
       325 -  const loadMessages = async (chatId) => {                  
       326 -    try {                                                   
       327 -      const res = await fetch(`/api/chats/${chatId}`, {     
       328 -        headers: { 'Authorization': `Bearer ${localStorage.ge
           -tItem('token')}` }                                          
       329 -      });                                                   
       330 -      const data = await res.json();                        
       331 -      setMessages(data.messages || []);                     
       332 -      setChatSettings({                                     
       333 -        model: data.model,                                  
       334 -        temperature: data.temperature,                      
       335 -        system_prompt: data.system_prompt || '',            
       336 -        agent_mode: !!data.agent_mode                       
       337 -      });                                                   
       338 -      // Update currentChat with latest data (including updat
           -ed title)                                                   
       339 -      const { messages: _, ...chatData } = data;            
       340 -      setCurrentChat(prev => ({ ...prev, ...chatData }));   
       341 -    } catch (error) {                                       
       342 -      console.error('Failed to load messages:', error);     
       343 -    }                                                       
       344 -  };                                                        
       345 -                                                            
       346 -  const createNewChat = () => {                             
       347 -    const modelToUse = localStorage.getItem(LAST_MODEL_KEY) |
           -| DEFAULT_MODEL;                                            
       348 -    // Create a temporary chat object without an ID         
       349 -    // The actual chat will be created when the first message
           - is sent                                                    
       350 -    setCurrentChat({                                        
       351 -      title: 'New Chat',                                    
       352 -      model: modelToUse,                                    
       353 -      temperature: 0.7,                                     
       354 -      system_prompt: '',                                    
       355 -      agent_mode: false                                     
       356 -    });                                                     
       357 -    setChatSettings({                                       
       358 -      model: modelToUse,                                    
       359 -      temperature: 0.7,                                     
       360 -      system_prompt: '',                                    
       361 -      agent_mode: false                                     
       362 -    });                                                     
       363 -  };                                                        
       364 -                                                            
       365 -  const updateChatSettings = async () => {                  
       366 -    if (!currentChat) return;                               
       367 -                                                            
       368 -    // If it's a new chat without an ID, just update local st
           -ate                                                         
       369 -    if (!currentChat.id) {                                  
       370 -      setCurrentChat({ ...currentChat, ...chatSettings });  
       371 -      setShowSettings(false);                               
       372 -      return;                                               
       373 -    }                                                       
       374 -                                                            
       375 -    try {                                                   
       376 -      await fetch(`/api/chats/${currentChat.id}`, {         
       377 -        method: 'PUT',                                      
       378 -        headers: {                                          
       379 -          'Content-Type': 'application/json',               
       380 -          'Authorization': `Bearer ${localStorage.getItem('to
           -ken')}`                                                     
       381 -        },                                                  
       382 -        body: JSON.stringify(chatSettings)                  
       383 -      });                                                   
       384 -      setShowSettings(false);                               
       385 -    } catch (error) {                                       
       386 -      console.error('Failed to update chat:', error);       
       387 -    }                                                       
       388 -  };                                                        
       389 -                                                            
       390 -  const handleModelChange = async (modelId) => {            
       391 -    // Save as last used model                              
       392 -    localStorage.setItem(LAST_MODEL_KEY, modelId);          
       393 -                                                            
       394 -    setChatSettings(prev => ({ ...prev, model: modelId })); 
       395 -                                                            
       396 -    // If we have a current chat with an ID, update it immedi
           -ately                                                       
       397 -    if (currentChat && currentChat.id) {                    
       398 -      try {                                                 
       399 -        await fetch(`/api/chats/${currentChat.id}`, {       
       400 -          method: 'PUT',                                    
       401 -          headers: {                                        
       402 -            'Content-Type': 'application/json',             
       403 -            'Authorization': `Bearer ${localStorage.getItem('
           -token')}`                                                   
       404 -          },                                                
       405 -          body: JSON.stringify({ ...chatSettings, model: mode
           -lId })                                                      
       406 -        });                                                 
       407 -      } catch (error) {                                     
       408 -        console.error('Failed to update chat model:', error);
           -                                                             
       409 -      }                                                     
       410 -    } else if (currentChat && !currentChat.id) {            
       411 -      // If it's a new chat without an ID, just update local 
           -state                                                       
       412 -      setCurrentChat({ ...currentChat, model: modelId });   
       413 -    }                                                       
       414 -  };                                                        
       415 -                                                            
       416 -  const deleteChat = async (chatId) => {                    
       417 -    try {                                                   
       418 -      await fetch(`/api/chats/${chatId}`, {                 
       419 -        method: 'DELETE',                                   
       420 -        headers: { 'Authorization': `Bearer ${localStorage.ge
           -tItem('token')}` }                                          
       421 -      });                                                   
       422 -      setChats(chats.filter(c => c.id !== chatId));         
       423 -      if (currentChat?.id === chatId) {                     
       424 -        // Automatically open a new chat instead of leaving b
           -lank                                                        
       425 -        setMessages([]);                                    
       426 -        createNewChat();                                    
       427 -      }                                                     
       428 -      setDeletingChatId(null);                              
       429 -    } catch (error) {                                       
       430 -      console.error('Failed to delete chat:', error);       
       431 -    }                                                       
       432 -  };                                                        
       433 -                                                            
       434 -  const openForkModal = (messageId) => {                    
       435 -    setForkMessageId(messageId);                            
       436 -    setForkModel(chatSettings.model);                       
       437 -    setShowForkModal(true);                                 
       438 -  };                                                        
       439 -                                                            
       440 -  const forkChat = async () => {                            
       441 -    if (!currentChat || !forkMessageId) return;             
       442 -                                                            
       443 -    try {                                                   
       444 -      const res = await fetch(`/api/chats/${currentChat.id}/f
           -ork`, {                                                     
       445 -        method: 'POST',                                     
       446 -        headers: {                                          
       447 -          'Content-Type': 'application/json',               
       448 -          'Authorization': `Bearer ${localStorage.getItem('to
           -ken')}`                                                     
       449 -        },                                                  
       450 -        body: JSON.stringify({                              
       451 -          message_id: forkMessageId,                        
       452 -          model: forkModel                                  
       453 -        })                                                  
       454 -      });                                                   
       455 -      const data = await res.json();                        
       456 -      setChats([data, ...chats]);                           
       457 -      setCurrentChat(data);                                 
       458 -      setShowForkModal(false);                              
       459 -      setForkMessageId(null);                               
       460 -                                                            
       461 -      // Save the fork model as last used                   
       462 -      localStorage.setItem(LAST_MODEL_KEY, forkModel);      
       463 -    } catch (error) {                                       
       464 -      console.error('Failed to fork chat:', error);         
       465 -    }                                                       
       466 -  };                                                        
       467 -                                                            
       468 -  const stopGeneration = () => {                            
       469 -    if (abortControllerRef.current) {                       
       470 -      abortControllerRef.current.abort();                   
       471 -      setStreaming(false);                                  
       472 -    }                                                       
       473 -  };                                                        
       474 -                                                            
       475 -  const sendMessage = async (e) => {                        
       476 -    e.preventDefault();                                     
       477 -    if (!inputMessage.trim() || !currentChat || streaming) re
           -turn;                                                       
       478 -                                                            
       479 -    const userMessage = inputMessage.trim();                
       480 -    setInputMessage('');                                    
       481 -    // Reset textarea height                                
       482 -    if (textareaRef.current) {                              
       483 -      textareaRef.current.style.height = '52px';            
       484 -    }                                                       
       485 -    setStreaming(true);                                     
       486 -    setStreamingMessage('');                                
       487 -    setStreamingReasoning('');                              
       488 -                                                            
       489 -    abortControllerRef.current = new AbortController();     
       490 -                                                            
       491 -    // Add user message to UI immediately                   
       492 -    const tempUserMessage = {                               
       493 -      id: Date.now(),                                       
       494 -      role: 'user',                                         
       495 -      content: userMessage,                                 
       496 -      created_at: new Date().toISOString()                  
       497 -    };                                                      
       498 -    setMessages(prev => [...prev, tempUserMessage]);        
       499 -                                                            
       500 -    try {                                                   
       501 -      // If this is a new chat without an ID, create it first
           -                                                             
       502 -      let chatId = currentChat.id;                          
       503 -      if (!chatId) {                                        
       504 -        isCreatingChatRef.current = true;                   
       505 -        const createRes = await fetch('/api/chats', {       
       506 -          method: 'POST',                                   
       507 -          headers: {                                        
       508 -            'Content-Type': 'application/json',             
       509 -            'Authorization': `Bearer ${localStorage.getItem('
           -token')}`                                                   
       510 -          },                                                
       511 -          body: JSON.stringify({                            
       512 -            title: 'New Chat',                              
       513 -            model: chatSettings.model,                      
       514 -            temperature: chatSettings.temperature,          
       515 -            system_prompt: chatSettings.system_prompt,      
       516 -            agent_mode: chatSettings.agent_mode             
       517 -          })                                                
       518 -        });                                                 
       519 -        const newChat = await createRes.json();             
       520 -        chatId = newChat.id;                                
       521 -        setCurrentChat(newChat);                            
       522 -        setChats(prev => [newChat, ...prev]);               
       523 -      }                                                     
       524 -                                                            
       525 -      const res = await fetch(`/api/messages/${chatId}`, {  
       526 -        method: 'POST',                                     
       527 -        headers: {                                          
       528 -          'Content-Type': 'application/json',               
       529 -          'Authorization': `Bearer ${localStorage.getItem('to
           -ken')}`                                                     
       530 -        },                                                  
       531 -        body: JSON.stringify({ content: userMessage }),     
       532 -        signal: abortControllerRef.current.signal           
       533 -      });                                                   
       534 -                                                            
       535 -      if (!res.ok) {                                        
       536 -        const errorData = await res.json();                 
       537 -        throw new Error(errorData.error || 'Failed to send me
           -ssage');                                                    
       538 -      }                                                     
       539 -                                                            
       540 -      const reader = res.body.getReader();                  
       541 -      const decoder = new TextDecoder();                    
       542 -      let buffer = '';                                      
       543 -                                                            
       544 -      while (true) {                                        
       545 -        const { done, value } = await reader.read();        
       546 -        if (done) break;                                    
       547 -                                                            
       548 -        buffer += decoder.decode(value, { stream: true });  
       549 -        const lines = buffer.split('\n');                   
       550 -        buffer = lines.pop();                               
       551 -                                                            
       552 -        for (const line of lines) {                         
       553 -          if (line.startsWith('data: ')) {                  
       554 -            try {                                           
       555 -              const data = JSON.parse(line.slice(6));       
       556 -                                                            
       557 -              if (data.type === 'reasoning') {              
       558 -                setStreamingReasoning(prev => prev + data.con
           -tent);                                                      
       559 -              } else if (data.type === 'content') {         
       560 -                setStreamingMessage(prev => prev + data.conte
           -nt);                                                        
       561 -              } else if (data.type === 'done') {            
       562 -                // Calculate thinking duration              
       563 -                const thinkingDuration = thinkingStartTime ? 
           -(Date.now() - thinkingStartTime) / 1000 : 0;                
       564 -                                                            
       565 -                // Capture usage data if provided           
       566 -                if (data.usage) {                           
       567 -                  const stats = {                           
       568 -                    promptTokens: data.usage.prompt_tokens ||
           - 0,                                                         
       569 -                    completionTokens: data.usage.completion_t
           -okens || 0,                                                 
       570 -                    totalTokens: data.usage.total_tokens || 0
           -,                                                           
       571 -                    model: data.model,                      
       572 -                    duration: thinkingDuration,             
       573 -                    cost: data.cost || 0                    
       574 -                  };                                        
       575 -                  setLastThinkingStats(stats);              
       576 -                  setUsageStats(prev => ({                  
       577 -                    ...prev,                                
       578 -                    lastMessage: stats,                     
       579 -                    totalPromptTokens: (prev?.totalPromptToke
           -ns || 0) + (data.usage.prompt_tokens || 0),                 
       580 -                    totalCompletionTokens: (prev?.totalComple
           -tionTokens || 0) + (data.usage.completion_tokens || 0),     
       581 -                    totalTokens: (prev?.totalTokens || 0) + (
           -data.usage.total_tokens || 0),                              
       582 -                    messageCount: (prev?.messageCount || 0) +
           - 1                                                          
       583 -                  }));                                      
       584 -                } else {                                    
       585 -                  // No usage data, but we still have duratio
           -n                                                           
       586 -                  setLastThinkingStats({ duration: thinkingDu
           -ration, totalTokens: 0 });                                  
       587 -                }                                           
       588 -                // Don't clear streaming states immediately -
           - let loadMessages handle it                                 
       589 -                // This prevents the thinking section from di
           -sappearing before the message is added                      
       590 -                loadMessages(chatId);                       
       591 -                loadChats();                                
       592 -                // Clear streaming states after a short delay
           - to ensure smooth transition                                
       593 -                setTimeout(() => {                          
       594 -                  setStreamingMessage('');                  
       595 -                  setStreamingReasoning('');                
       596 -                }, 100);                                    
       597 -              } else if (data.type === 'error') {           
       598 -                alert('Error: ' + data.error);              
       599 -              }                                             
       600 -            } catch (e) {                                   
       601 -              console.error('Failed to parse SSE data:', e);
       602 -            }                                               
       603 -          }                                                 
       604 -        }                                                   
       605 -      }                                                     
       606 -    } catch (error) {                                       
       607 -      if (error.name === 'AbortError') {                    
       608 -        console.log('Generation aborted');                  
       609 -      } else {                                              
       610 -        console.error('Failed to send message:', error);    
       611 -        alert(error.message || 'Failed to send message. Pleas
           -e check your API key configuration.');                      
       612 -      }                                                     
       613 -    } finally {                                             
       614 -      setStreaming(false);                                  
       615 -      abortControllerRef.current = null;                    
       616 -      isCreatingChatRef.current = false;                    
       617 -    }                                                       
       618 -  };                                                        
       619 -                                                            
       620 -  const renderMessage = (content) => {                      
       621 -    const html = DOMPurify.sanitize(marked(content || '')); 
       622 -    return <div className="markdown-content" dangerouslySetIn
           -nerHTML={{ __html: html }} />;                              
       623 -  };                                                        
       624 -                                                            
       625 -  const stripMarkdown = (text) => {                         
       626 -    if (!text) return '';                                   
       627 -    return text                                             
       628 -      .replace(/#{1,6}\s?/g, '')           // headers       
       629 -      .replace(/\*\*(.+?)\*\*/g, '$1')     // bold          
       630 -      .replace(/\*(.+?)\*/g, '$1')         // italic        
       631 -      .replace(/__(.+?)__/g, '$1')         // bold alt      
       632 -      .replace(/_(.+?)_/g, '$1')           // italic alt    
       633 -      .replace(/`{3}[\s\S]*?`{3}/g, '')    // code blocks   
       634 -      .replace(/`(.+?)`/g, '$1')           // inline code   
       635 -      .replace(/\[(.+?)\]\(.+?\)/g, '$1')  // links         
       636 -      .replace(/!\[.*?\]\(.+?\)/g, '')     // images        
       637 -      .replace(/^\s*[-*+]\s/gm, '')        // unordered lists
           -                                                             
       638 -      .replace(/^\s*\d+\.\s/gm, '')        // ordered lists 
       639 -      .replace(/>\s?/g, '')                // blockquotes   
       640 -      .replace(/---/g, '')                 // horizontal rule
           -s                                                           
       641 -      .trim();                                              
       642 -  };                                                        
       643 -                                                            
       644 -  const handleCopy = async (messageId, content, type) => {  
       645 -    const textToCopy = type === 'raw' ? stripMarkdown(content
           -) : content;                                                
       646 -    await navigator.clipboard.writeText(textToCopy);        
       647 -    setCopiedMessageId(`${messageId}-${type}`);             
       648 -    setTimeout(() => setCopiedMessageId(null), 2000);       
       649 -  };                                                        
       650 -                                                            
       651 -  const handleEditStart = (message) => {                    
       652 -    setEditingMessageId(message.id);                        
       653 -    setEditContent(message.content);                        
       654 -  };                                                        
       655 -                                                            
       656 -  const handleEditCancel = () => {                          
       657 -    setEditingMessageId(null);                              
       658 -    setEditContent('');                                     
       659 -  };                                                        
       660 -                                                            
       661 -  const handleEditSave = async (messageId) => {             
       662 -    if (!editContent.trim() || !currentChat) return;        
       663 -                                                            
       664 -    try {                                                   
       665 -      // 1. Delete branch from this message onward          
       666 -      const res = await fetch(`/api/messages/${messageId}/bra
           -nch`, {                                                     
       667 -        method: 'DELETE',                                   
       668 -        headers: {                                          
       669 -          'Authorization': `Bearer ${localStorage.getItem('to
           -ken')}`                                                     
       670 -        }                                                   
       671 -      });                                                   
       672 -                                                            
       673 -      if (!res.ok) throw new Error('Failed to delete message 
           -branch');                                                   
       674 -                                                            
       675 -      // 2. Trigger new message with edited content         
       676 -      // We manually call sendMessage implementation        
       677 -      const userMessage = editContent.trim();               
       678 -      setEditingMessageId(null);                            
       679 -      setEditContent('');                                   
       680 -      setStreaming(true);                                   
       681 -      setStreamingMessage('');                              
       682 -      setStreamingReasoning('');                            
       683 -      abortControllerRef.current = new AbortController();   
       684 -                                                            
       685 -      // Update UI: load messages again to show the deletion
       686 -      await loadMessages(currentChat.id);                   
       687 -                                                            
       688 -      // Add temporary user message to UI for responsiveness
       689 -      const tempUserMessage = {                             
       690 -        id: Date.now(),                                     
       691 -        role: 'user',                                       
       692 -        content: userMessage,                               
       693 -        created_at: new Date().toISOString()                
       694 -      };                                                    
       695 -      setMessages(prev => [...prev, tempUserMessage]);      
       696 -                                                            
       697 -      // Trigger the API call to start regeneration         
       698 -      const sendRes = await fetch(`/api/messages/${currentCha
           -t.id}`, {                                                   
       699 -        method: 'POST',                                     
       700 -        headers: {                                          
       701 -          'Content-Type': 'application/json',               
       702 -          'Authorization': `Bearer ${localStorage.getItem('to
           -ken')}`                                                     
       703 -        },                                                  
       704 -        body: JSON.stringify({ content: userMessage }),     
       705 -        signal: abortControllerRef.current.signal           
       706 -      });                                                   
       707 -                                                            
       708 -      if (!sendRes.ok) {                                    
       709 -        const errorData = await sendRes.json();             
       710 -        throw new Error(errorData.error || 'Failed to send me
           -ssage');                                                    
       711 -      }                                                     
       712 -                                                            
       713 -      const reader = sendRes.body.getReader();              
       714 -      const decoder = new TextDecoder();                    
       715 -      let buffer = '';                                      
       716 -                                                            
       717 -      while (true) {                                        
       718 -        const { done, value } = await reader.read();        
       719 -        if (done) break;                                    
       720 -                                                            
       721 -        buffer += decoder.decode(value, { stream: true });  
       722 -        const lines = buffer.split('\n');                   
       723 -        buffer = lines.pop();                               
       724 -                                                            
       725 -        for (const line of lines) {                         
       726 -          if (line.startsWith('data: ')) {                  
       727 -            try {                                           
       728 -              const data = JSON.parse(line.slice(6));       
       729 -              if (data.type === 'reasoning') {              
       730 -                setStreamingReasoning(prev => prev + data.con
           -tent);                                                      
       731 -              } else if (data.type === 'content') {         
       732 -                setStreamingMessage(prev => prev + data.conte
           -nt);                                                        
       733 -              } else if (data.type === 'done') {            
       734 -                // Calculate thinking duration              
       735 -                const thinkingDuration = thinkingStartTime ? 
           -(Date.now() - thinkingStartTime) / 1000 : 0;                
       736 -                                                            
       737 -                if (data.usage) {                           
       738 -                  const stats = {                           
       739 -                    promptTokens: data.usage.prompt_tokens ||
           - 0,                                                         
       740 -                    completionTokens: data.usage.completion_t
           -okens || 0,                                                 
       741 -                    totalTokens: data.usage.total_tokens || 0
           -,                                                           
       742 -                    model: data.model,                      
       743 -                    duration: thinkingDuration,             
       744 -                    cost: data.cost || 0                    
       745 -                  };                                        
       746 -                  setLastThinkingStats(stats);              
       747 -                  setUsageStats(prev => ({                  
       748 -                    ...prev,                                
       749 -                    lastMessage: stats,                     
       750 -                    totalPromptTokens: (prev?.totalPromptToke
           -ns || 0) + (data.usage.prompt_tokens || 0),                 
       751 -                    totalCompletionTokens: (prev?.totalComple
           -tionTokens || 0) + (data.usage.completion_tokens || 0),     
       752 -                    totalTokens: (prev?.totalTokens || 0) + (
           -data.usage.total_tokens || 0),                              
       753 -                    messageCount: (prev?.messageCount || 0) +
           - 1                                                          
       754 -                  }));                                      
       755 -                } else {                                    
       756 -                  setLastThinkingStats({ duration: thinkingDu
           -ration, totalTokens: 0 });                                  
       757 -                }                                           
       758 -                loadMessages(currentChat.id);               
       759 -                loadChats();                                
       760 -                setTimeout(() => {                          
       761 -                  setStreamingMessage('');                  
       762 -                  setStreamingReasoning('');                
       763 -                }, 100);                                    
       764 -              } else if (data.type === 'error') {           
       765 -                alert('Error: ' + data.error);              
       766 -              }                                             
       767 -            } catch (e) {                                   
       768 -              console.error('Failed to parse SSE data:', e);
       769 -            }                                               
       770 -          }                                                 
       771 -        }                                                   
       772 -      }                                                     
       773 -    } catch (error) {                                       
       774 -      if (error.name === 'AbortError') {                    
       775 -        console.log('Generation aborted');                  
       776 -      } else {                                              
       777 -        console.error('Failed to edit message:', error);    
       778 -        alert('Failed to edit message: ' + error.message);  
       779 -      }                                                     
       780 -      setStreaming(false);                                  
       781 -    }                                                       
       782 -  };                                                        
       783 -                                                            
       784 -  return (                                                  
       785 -    <div className="flex h-screen bg-dark-950 bg-mesh">     
       786 -      {/* Sidebar */}                                       
       787 -      <div className={`${showSidebar ? 'w-80' : 'w-16'} trans
           -ition-all duration-300 ease-out glass-sidebar flex flex-col o
           -verflow-hidden`}>                                           
       788 -        <div className={`${showSidebar ? 'p-5' : 'p-2'} borde
           -r-b border-white/[0.06]`}>                                  
       789 -          <div className={`flex items-center ${showSidebar ? 
           -'justify-between mb-5' : 'justify-center mb-2'}`}>          
       790 -            {showSidebar ? (                                
       791 -              <>                                            
       792 -                <div className="flex items-center gap-3">   
       793 -                  <div className="relative">                
       794 -                    <div className="w-11 h-11 rounded-2xl gra
           -dient-primary flex items-center justify-center shadow-lg glow
           -">                                                          
       795 -                      <MessageSquare className="w-5 h-5 text-
           -white" />                                                   
       796 -                    </div>                                  
       797 -                    <div className="absolute -bottom-0.5 -rig
           -ht-0.5 w-3 h-3 bg-green-500 rounded-full border-2 border-dark
           --900"></div>                                                
       798 -                  </div>                                    
       799 -                  <div>                                     
       800 -                    <h1 className="font-bold text-lg gradient
           --text tracking-tight">Budi Chat</h1>                        
       801 -                    <p className="text-xs text-dark-400 font-
           -medium">{user?.name}</p>                                    
       802 -                  </div>                                    
       803 -                </div>                                      
       804 -                <button                                     
       805 -                  onClick={() => setShowSidebar(false)}     
       806 -                  className="p-2 hover:bg-white/[0.05] rounde
           -d-xl transition-all duration-200"                           
       807 -                  title="Collapse sidebar"                  
       808 -                >                                           
       809 -                  <ChevronRight className="w-5 h-5 text-dark-
           -400" />                                                     
       810 -                </button>                                   
       811 -              </>                                           
       812 -            ) : (                                           
       813 -              <button                                       
       814 -                onClick={() => setShowSidebar(true)}        
       815 -                className="p-2 hover:bg-white/[0.05] rounded-
           -xl transition-all duration-200"                             
       816 -                title="Expand sidebar"                      
       817 -              >                                             
       818 -                <Menu className="w-5 h-5 text-dark-400" />  
       819 -              </button>                                     
       820 -            )}                                              
       821 -          </div>                                            
       822 -                                                            
       823 -          <button                                           
       824 -            onClick={createNewChat}                         
       825 -            className={`${showSidebar ? 'w-full py-3 gap-2' :
           - 'w-10 h-10 mx-auto'} gradient-primary text-white rounded-xl 
           -font-semibold hover:shadow-glow transition-all duration-200 f
           -lex items-center justify-center shine active:scale-[0.98]`} 
       826 -            title={showSidebar ? undefined : "New Chat"}    
       827 -          >                                                 
       828 -            <Plus className="w-4 h-4" />                    
       829 -            {showSidebar && "New Chat"}                     
       830 -          </button>                                         
       831 -        </div>                                              
       832 -                                                            
       833 -        <div className={`flex-1 overflow-y-auto ${showSidebar
           - ? 'p-3 space-y-1.5' : 'p-2 space-y-1'}`}>                  
       834 -          {chats.length === 0 && showSidebar && (           
       835 -            <div className="text-center py-8 px-4">         
       836 -              <div className="w-12 h-12 rounded-xl bg-dark-80
           -0/50 flex items-center justify-center mx-auto mb-3">        
       837 -                <MessageSquare className="w-6 h-6 text-dark-5
           -00" />                                                      
       838 -              </div>                                        
       839 -              <p className="text-sm text-dark-400">No chats y
           -et</p>                                                      
       840 -              <p className="text-xs text-dark-500 mt-1">Creat
           -e a new chat to get started</p>                             
       841 -            </div>                                          
       842 -          )}                                                
       843 -          {chats.map(chat => (                              
       844 -            <div                                            
       845 -              key={chat.id}                                 
       846 -              className={`group ${showSidebar ? 'p-3' : 'p-2'
           -} rounded-xl cursor-pointer transition-all duration-200 ${cur
           -rentChat?.id === chat.id                                    
       847 -                ? 'glass-card border-primary-500/20 shadow-lg
           -'                                                           
       848 -                : 'hover:bg-white/[0.03] border border-transp
           -arent hover:border-white/[0.06]'                            
       849 -                }`}                                         
       850 -              onClick={() => setCurrentChat(chat)}          
       851 -              title={showSidebar ? undefined : chat.title}  
       852 -            >                                               
       853 -              {showSidebar ? (                              
       854 -                <div className="flex items-start justify-betw
           -een gap-2">                                                 
       855 -                  <div className="flex-1 min-w-0">          
       856 -                    <p className={`font-medium text-sm trunca
           -te ${currentChat?.id === chat.id ? 'text-dark-50' : 'text-dar
           -k-200'}`}>{chat.title}</p>                                  
       857 -                    <div className="flex items-center gap-2 m
           -t-1.5">                                                     
       858 -                      <span className="text-xs text-dark-500"
           ->{chat.message_count} messages</span>                       
       859 -                      {chat.agent_mode === 1 && (           
       860 -                        <span className="inline-flex items-ce
           -nter gap-1 px-1.5 py-0.5 rounded-md bg-accent-500/10 text-acc
           -ent-400 text-[10px] font-medium">                           
       861 -                          <Zap className="w-2.5 h-2.5" />   
       862 -                          Agent                             
       863 -                        </span>                             
       864 -                      )}                                    
       865 -                    </div>                                  
       866 -                  </div>                                    
       867 -                                                            
       868 -                  <div className="flex items-center gap-1"> 
       869 -                    {deletingChatId === chat.id ? (         
       870 -                      <>                                    
       871 -                        <button                             
       872 -                          onClick={(e) => {                 
       873 -                            e.stopPropagation();            
       874 -                            deleteChat(chat.id);            
       875 -                          }}                                
       876 -                          className="p-1.5 bg-green-500/10 ho
           -ver:bg-green-500/20 rounded-lg transition-all"              
       877 -                          title="Confirm Delete"            
       878 -                        >                                   
       879 -                          <Check className="w-3.5 h-3.5 text-
           -green-400" />                                               
       880 -                        </button>                           
       881 -                        <button                             
       882 -                          onClick={(e) => {                 
       883 -                            e.stopPropagation();            
       884 -                            setDeletingChatId(null);        
       885 -                          }}                                
       886 -                          className="p-1.5 bg-red-500/10 hove
           -r:bg-red-500/20 rounded-lg transition-all"                  
       887 -                          title="Cancel"                    
       888 -                        >                                   
       889 -                          <X className="w-3.5 h-3.5 text-red-
           -400" />                                                     
       890 -                        </button>                           
       891 -                      </>                                   
       892 -                    ) : (                                   
       893 -                      <button                               
       894 -                        onClick={(e) => {                   
       895 -                          e.stopPropagation();              
       896 -                          setDeletingChatId(chat.id);       
       897 -                        }}                                  
       898 -                        className="opacity-0 group-hover:opac
           -ity-100 p-1.5 hover:bg-red-500/10 rounded-lg transition-all"
       899 -                        title="Delete Chat"                 
       900 -                      >                                     
       901 -                        <Trash2 className="w-3.5 h-3.5 text-d
           -ark-400 hover:text-red-400" />                              
       902 -                      </button>                             
       903 -                    )}                                      
       904 -                  </div>                                    
       905 -                </div>                                      
       906 -              ) : (                                         
       907 -                <div className="flex justify-center">       
       908 -                  <MessageSquare className={`w-5 h-5 ${curren
           -tChat?.id === chat.id ? 'text-primary-400' : 'text-dark-400'}
           -`} />                                                       
       909 -                </div>                                      
       910 -              )}                                            
       911 -            </div>                                          
       912 -          ))}                                               
       913 -        </div>                                              
       914 -                                                            
       915 -        <div className={`${showSidebar ? 'p-3' : 'p-2'} borde
           -r-t border-white/[0.06] space-y-1`}>                        
       916 -          <button                                           
       917 -            onClick={() => navigate('/memories')}           
       918 -            className={`${showSidebar ? 'w-full px-4 gap-3' :
           - 'w-10 h-10 mx-auto'} flex items-center justify-center py-2.5
           - rounded-xl glass-button transition-all text-sm font-medium t
           -ext-dark-300 hover:text-dark-100`}                          
       919 -            title={showSidebar ? undefined : "Memories"}    
       920 -          >                                                 
       921 -            <Brain className="w-4 h-4 text-accent-400" />   
       922 -            {showSidebar && "Memories"}                     
       923 -          </button>                                         
       924 -          <button                                           
       925 -            onClick={() => navigate('/settings')}           
       926 -            className={`${showSidebar ? 'w-full px-4 gap-3' :
           - 'w-10 h-10 mx-auto'} flex items-center justify-center py-2.5
           - rounded-xl glass-button transition-all text-sm font-medium t
           -ext-dark-300 hover:text-dark-100`}                          
       927 -            title={showSidebar ? undefined : "Settings"}    
       928 -          >                                                 
       929 -            <SettingsIcon className="w-4 h-4 text-dark-400" /
           ->                                                           
       930 -            {showSidebar && "Settings"}                     
       931 -          </button>                                         
       932 -          {user?.is_admin && (                              
       933 -            <button                                         
       934 -              onClick={() => navigate('/admin')}            
       935 -              className={`${showSidebar ? 'w-full px-4 gap-3'
           - : 'w-10 h-10 mx-auto'} flex items-center justify-center py-2
           -.5 rounded-xl glass-button transition-all text-sm font-medium
           - text-accent-400 hover:text-accent-300`}                    
       936 -              title={showSidebar ? undefined : "Admin Panel"}
           -                                                             
       937 -            >                                               
       938 -              <Sparkles className="w-4 h-4" />              
       939 -              {showSidebar && "Admin Panel"}                
       940 -            </button>                                       
       941 -          )}                                                
       942 -          {showSidebar && <div className="divider-gradient my
           --2"></div>}                                                 
       943 -          <button                                           
       944 -            onClick={logout}                                
       945 -            className={`${showSidebar ? 'w-full px-4 gap-3' :
           - 'w-10 h-10 mx-auto'} flex items-center justify-center py-2.5
           - rounded-xl hover:bg-red-500/10 transition-all text-sm font-m
           -edium text-dark-400 hover:text-red-400`}                    
       946 -            title={showSidebar ? undefined : "Logout"}      
       947 -          >                                                 
       948 -            <LogOut className="w-4 h-4" />                  
       949 -            {showSidebar && "Logout"}                       
       950 -          </button>                                         
       951 -        </div>                                              
       952 -      </div>                                                
       953 -                                                            
       954 -      {/* Main Chat Area */}                                
       955 -      <div className="flex-1 flex flex-col min-w-0">        
       956 -        {/* Header */}                                      
       957 -        <div className="glass border-b border-white/[0.06] px
           --4 py-3 flex items-center justify-between relative z-50 overf
           -low-visible">                                               
       958 -          <div className="flex items-center gap-3">         
       959 -            {/* Chat Title and Model Selector */}           
       960 -            {currentChat ? (                                
       961 -              <>                                            
       962 -                <h2 className="text-base font-semibold text-d
           -ark-100">{currentChat.title}</h2>                           
       963 -                <div className="h-4 w-px bg-white/[0.06]"></d
           -iv>                                                         
       964 -                <ModelSelector                              
       965 -                  selectedModel={chatSettings.model}        
       966 -                  onModelChange={handleModelChange}         
       967 -                  isDropdown={true}                         
       968 -                />                                          
       969 -                {chatSettings.agent_mode && (               
       970 -                  <span className="flex items-center gap-1.5 
           -px-3 py-1.5 bg-accent-500/10 text-accent-400 rounded-lg text-
           -xs font-semibold border border-accent-500/20">              
       971 -                    <Zap className="w-3 h-3" />             
       972 -                    Agent Mode                              
       973 -                  </span>                                   
       974 -                )}                                          
       975 -              </>                                           
       976 -            ) : (                                           
       977 -              <p className="text-dark-500 text-sm">Select a c
           -hat or create a new one</p>                                 
       978 -            )}                                              
       979 -          </div>                                            
       980 -                                                            
       981 -          {currentChat && (                                 
       982 -            <div className="flex items-center gap-2 overflow-
           -visible">                                                   
       983 -              <div className="relative overflow-visible" ref=
           -{statsPopupRef}>                                            
       984 -                <button                                     
       985 -                  onClick={() => setShowInfoModal(!showInfoMo
           -dal)}                                                       
       986 -                  className={`p-2 rounded-xl transition-all d
           -uration-200 ${showInfoModal                                 
       987 -                    ? 'bg-accent-500/10 text-accent-400 borde
           -r border-accent-500/20'                                     
       988 -                    : 'glass-button text-dark-400 hover:text-
           -dark-200'                                                   
       989 -                    }`}                                     
       990 -                  title="Usage Stats"                       
       991 -                >                                           
       992 -                  <Info className="w-4 h-4" />              
       993 -                </button>                                   
       994 -                                                            
       995 -                {/* Usage Stats Panel */}                   
       996 -                {showInfoModal && (                         
       997 -                  <div className="fixed top-14 right-4 w-80 b
           -g-dark-900 border border-dark-700 rounded-xl z-[100] shadow-2
           -xl scale-in">                                               
       998 -                    <div className="p-3 border-b border-dark-
           -700">                                                       
       999 -                      <h4 className="text-sm font-semibold te
           -xt-dark-200 flex items-center gap-2">                       
      1000 -                        <Hash className="w-3.5 h-3.5 text-acc
           -ent-400" />                                                 
      1001 -                        Chat Stats                          
      1002 -                      </h4>                                 
      1003 -                    </div>                                  
      1004 -                                                            
      1005 -                    <div className="p-3 space-y-3">         
      1006 -                      {/* Current Model */}                 
      1007 -                      <div className="p-2 rounded-lg bg-dark-
           -800">                                                       
      1008 -                        <p className="text-dark-500 text-xs m
           -b-1">Current Model</p>                                      
      1009 -                        <p className="text-sm font-medium tex
           -t-dark-200 truncate">{chatSettings.model}</p>               
      1010 -                      </div>                                
      1011 -                                                            
      1012 -                      {/* Conversation Stats */}            
      1013 -                      <div className="grid grid-cols-2 gap-2 
           -text-xs">                                                   
      1014 -                        <div className="p-2 rounded-lg bg-dar
           -k-800">                                                     
      1015 -                          <p className="text-dark-500">Messag
           -es</p>                                                      
      1016 -                          <p className="text-sm font-semibold
           - text-dark-200">{messages.length}</p>                       
      1017 -                        </div>                              
      1018 -                        <div className="p-2 rounded-lg bg-dar
           -k-800">                                                     
      1019 -                          <p className="text-dark-500">AI Res
           -ponses</p>                                                  
      1020 -                          <p className="text-sm font-semibold
           - text-accent-400">{messages.filter(m => m.role === 'assistant
           -').length}</p>                                              
      1021 -                        </div>                              
      1022 -                      </div>                                
      1023 -                                                            
      1024 -                      {/* Token Usage - from persisted data *
           -/}                                                          
      1025 -                      {chatTotals.totalTokens > 0 && (      
      1026 -                        <div className="border-t border-dark-
           -700 pt-3">                                                  
      1027 -                          <p className="text-dark-500 text-xs
           - mb-2">Chat Token Usage</p>                                 
      1028 -                          <div className="space-y-1.5 text-xs
           -">                                                          
      1029 -                            <div className="flex justify-betw
           -een">                                                       
      1030 -                              <span className="text-dark-400"
           ->Total Cost</span>                                          
      1031 -                              <span className="font-semibold 
           -text-accent-400">                                           
      1032 -                                ${chatTotals.totalCost.toFixe
           -d(2)}                                                       
      1033 -                              </span>                       
      1034 -                            </div>                          
      1035 -                          </div>                            
      1036 -                                                            
      1037 -                          {/* Token Bar with USED/CONTEXT lab
           -el */}                                                      
      1038 -                          {(() => {                         
      1039 -                            const contextLimit = getModelCont
           -ext(chatSettings.model);                                    
      1040 -                            const inputPercent = (chatTotals.
           -totalPromptTokens / contextLimit) * 100;                    
      1041 -                            const outputPercent = (chatTotals
           -.totalCompletionTokens / contextLimit) * 100;               
      1042 -                            const freePercent = Math.max(0, 1
           -00 - inputPercent - outputPercent);                         
      1043 -                            return (                        
      1044 -                              <>                            
      1045 -                                <div className="flex justify-
           -between mt-3 mb-1 text-xs">                                 
      1046 -                                  <span className="text-dark-
           -400">Tokens Used</span>                                     
      1047 -                                  <span className="font-mediu
           -m text-dark-200">                                           
      1048 -                                    {chatTotals.totalTokens.t
           -oLocaleString()}                                            
      1049 -                                    <span className="text-dar
           -k-500"> / {contextLimit.toLocaleString()}</span>            
      1050 -                                  </span>                   
      1051 -                                </div>                      
      1052 -                                <div className="h-2 bg-dark-6
           -00 rounded-full overflow-hidden flex">                      
      1053 -                                  <div                      
      1054 -                                    className="h-full bg-cyan
           --500"                                                       
      1055 -                                    style={{ width: `${inputP
           -ercent}%` }}                                                
      1056 -                                    title={`Input: ${chatTota
           -ls.totalPromptTokens.toLocaleString()}`}                    
      1057 -                                  />                        
      1058 -                                  <div                      
      1059 -                                    className="h-full bg-acce
           -nt-500"                                                     
      1060 -                                    style={{ width: `${output
           -Percent}%` }}                                               
      1061 -                                    title={`Output: ${chatTot
           -als.totalCompletionTokens.toLocaleString()}`}               
      1062 -                                  />                        
      1063 -                                  <div                      
      1064 -                                    className="h-full bg-dark
           --700"                                                       
      1065 -                                    style={{ width: `${freePe
           -rcent}%` }}                                                 
      1066 -                                    title={`Free: ${(contextL
           -imit - chatTotals.totalTokens).toLocaleString()}`}          
      1067 -                                  />                        
      1068 -                                </div>                      
      1069 -                                <div className="flex justify-
           -between mt-1 text-[10px] text-dark-500">                    
      1070 -                                  <div className="flex items-
           -center gap-2">                                              
      1071 -                                    <span className="flex ite
           -ms-center gap-1">                                           
      1072 -                                      <span className="w-2 h-
           -2 rounded-full bg-cyan-500"></span>                         
      1073 -                                      Input ({chatTotals.tota
           -lPromptTokens.toLocaleString()})                            
      1074 -                                    </span>                 
      1075 -                                    <span className="flex ite
           -ms-center gap-1">                                           
      1076 -                                      <span className="w-2 h-
           -2 rounded-full bg-accent-500"></span>                       
      1077 -                                      Output ({chatTotals.tot
           -alCompletionTokens.toLocaleString()})                       
      1078 -                                    </span>                 
      1079 -                                  </div>                    
      1080 -                                  <span className="flex items
           --center gap-1">                                             
      1081 -                                    <span className="w-2 h-2 
           -rounded-full bg-dark-700"></span>                           
      1082 -                                    Free                    
      1083 -                                  </span>                   
      1084 -                                </div>                      
      1085 -                              </>                           
      1086 -                            );                              
      1087 -                          })()}                             
      1088 -                        </div>                              
      1089 -                      )}                                    
      1090 -                                                            
      1091 -                      {/* No token data message - only show i
           -f no persisted data */}                                     
      1092 -                      {chatTotals.totalTokens === 0 && messag
           -es.length > 0 && (                                          
      1093 -                        <p className="text-[10px] text-dark-5
           -00 text-center pt-2 border-t border-dark-700">              
      1094 -                          Token usage will appear after sendi
           -ng messages                                                 
      1095 -                        </p>                                
      1096 -                      )}                                    
      1097 -                    </div>                                  
      1098 -                  </div>                                    
      1099 -                )}                                          
      1100 -              </div>                                        
      1101 -              <button                                       
      1102 -                onClick={() => setShowSettings(!showSettings)
           -}                                                           
      1103 -                className={`px-4 py-2 flex items-center gap-2
           - rounded-xl transition-all duration-200 text-sm font-medium $
           -{showSettings                                               
      1104 -                  ? 'bg-primary-500/10 text-primary-400 borde
           -r border-primary-500/20'                                    
      1105 -                  : 'glass-button text-dark-300 hover:text-da
           -rk-100'                                                     
      1106 -                  }`}                                       
      1107 -              >                                             
      1108 -                <SettingsIcon className="w-4 h-4" />        
      1109 -                Settings                                    
      1110 -              </button>                                     
      1111 -            </div>                                          
      1112 -          )}                                                
      1113 -        </div>                                              
      1114 -                                                            
      1115 -        {/* Settings Panel */}                              
      1116 -        {showSettings && currentChat && (                   
      1117 -          <div className="glass border-b border-white/[0.06] 
           -p-6 scale-in">                                              
      1118 -            <div className="max-w-4xl mx-auto space-y-5">   
      1119 -              <div className="grid grid-cols-1 md:grid-cols-2
           - gap-5">                                                    
      1120 -                <div>                                       
      1121 -                  <label className="block text-sm font-medium
           - text-dark-300 mb-2">                                       
      1122 -                    Model                                   
      1123 -                  </label>                                  
      1124 -                  <ModelSelector                            
      1125 -                    selectedModel={chatSettings.model}      
      1126 -                    onModelChange={handleModelChange}       
      1127 -                    isDropdown={true}                       
      1128 -                  />                                        
      1129 -                </div>                                      
      1130 -                                                            
      1131 -                <div>                                       
      1132 -                  <label className="block text-sm font-medium
           - text-dark-300 mb-2">                                       
      1133 -                    Temperature                             
      1134 -                    <span className="ml-2 px-2 py-0.5 bg-dark
           --800/50 rounded-md text-xs text-primary-400 font-mono">     
      1135 -                      {chatSettings.temperature}            
      1136 -                    </span>                                 
      1137 -                  </label>                                  
      1138 -                  <div className="pt-2">                    
      1139 -                    <input                                  
      1140 -                      type="range"                          
      1141 -                      min="0"                               
      1142 -                      max="2"                               
      1143 -                      step="0.1"                            
      1144 -                      value={chatSettings.temperature}      
      1145 -                      onChange={(e) => setChatSettings({ ...c
           -hatSettings, temperature: parseFloat(e.target.value) })}    
      1146 -                      className="w-full"                    
      1147 -                    />                                      
      1148 -                    <div className="flex justify-between text
           --xs text-dark-500 mt-1">                                    
      1149 -                      <span>Precise</span>                  
      1150 -                      <span>Creative</span>                 
      1151 -                    </div>                                  
      1152 -                  </div>                                    
      1153 -                </div>                                      
      1154 -              </div>                                        
      1155 -                                                            
      1156 -              <div>                                         
      1157 -                <label className="block text-sm font-medium t
           -ext-dark-300 mb-2">                                         
      1158 -                  System Prompt                             
      1159 -                </label>                                    
      1160 -                <textarea                                   
      1161 -                  value={chatSettings.system_prompt}        
      1162 -                  onChange={(e) => setChatSettings({ ...chatS
           -ettings, system_prompt: e.target.value })}                  
      1163 -                  className="w-full px-4 py-3 rounded-xl glas
           -s-input outline-none resize-none text-dark-100 placeholder-da
           -rk-500 text-sm"                                             
      1164 -                  rows="3"                                  
      1165 -                  placeholder="Set a custom system prompt for
           - this chat..."                                              
      1166 -                />                                          
      1167 -              </div>                                        
      1168 -                                                            
      1169 -              <div className="flex items-center justify-betwe
           -en pt-2">                                                   
      1170 -                <label className="flex items-center gap-3 cur
           -sor-pointer group">                                         
      1171 -                  <input                                    
      1172 -                    type="checkbox"                         
      1173 -                    checked={chatSettings.agent_mode}       
      1174 -                    onChange={(e) => setChatSettings({ ...cha
           -tSettings, agent_mode: e.target.checked })}                 
      1175 -                    className="w-5 h-5 rounded-md"          
      1176 -                  />                                        
      1177 -                  <span className="text-sm font-medium text-d
           -ark-300 flex items-center gap-2 group-hover:text-dark-200 tra
           -nsition-colors">                                            
      1178 -                    <Zap className="w-4 h-4 text-accent-400" 
           -/>                                                          
      1179 -                    Enable Agent Mode                       
      1180 -                    <span className="text-xs text-dark-500">(
           -with tools)</span>                                          
      1181 -                  </span>                                   
      1182 -                </label>                                    
      1183 -                                                            
      1184 -                <button                                     
      1185 -                  onClick={updateChatSettings}              
      1186 -                  className="px-5 py-2.5 gradient-primary tex
           -t-white rounded-xl font-semibold hover:shadow-glow transition
           --all duration-200 active:scale-[0.98]"                      
      1187 -                >                                           
      1188 -                  Save Settings                             
      1189 -                </button>                                   
      1190 -              </div>                                        
      1191 -            </div>                                          
      1192 -          </div>                                            
      1193 -        )}                                                  
      1194 -                                                            
      1195 -        {/* Messages */}                                    
      1196 -        <div                                                
      1197 -          ref={messagesContainerRef}                        
      1198 -          onScroll={handleMessagesScroll}                   
      1199 -          className="flex-1 overflow-y-auto p-6 relative z-0"
           -                                                             
      1200 -        >                                                   
      1201 -          {currentChat && (                                 
      1202 -            <div className="max-w-4xl mx-auto space-y-6">   
      1203 -              {messages.length === 0 && !streaming && (     
      1204 -                <div className="text-center py-16 fade-in"> 
      1205 -                  <div className="relative inline-block mb-6"
           ->                                                           
      1206 -                    <div className="w-20 h-20 rounded-2xl gra
           -dient-primary flex items-center justify-center shadow-lg glow
           --lg">                                                       
      1207 -                      <Bot className="w-10 h-10 text-white" /
           ->                                                           
      1208 -                    </div>                                  
      1209 -                    <div className="absolute -top-1 -right-1 
           -w-6 h-6 rounded-full gradient-primary flex items-center justi
           -fy-center shadow-lg">                                       
      1210 -                      <Sparkles className="w-3 h-3 text-white
           -" />                                                        
      1211 -                    </div>                                  
      1212 -                  </div>                                    
      1213 -                  <h3 className="text-2xl font-bold text-dark
           --100 mb-3 tracking-tight">Start a conversation</h3>         
      1214 -                  <p className="text-dark-400 max-w-sm mx-aut
           -o">Type a message below to begin chatting with AI. I'm here t
           -o help with anything you need.</p>                          
      1215 -                </div>                                      
      1216 -              )}                                            
      1217 -                                                            
      1218 -              {messages.map((message, index) => (           
      1219 -                <div                                        
      1220 -                  key={message.id}                          
      1221 -                  className={`flex gap-4 ${message.role === '
           -user' ? 'flex-row-reverse' : ''}`}                          
      1222 -                >                                           
      1223 -                  <div className={`flex-shrink-0 w-8 h-8 roun
           -ded-full flex items-center justify-center ${message.role === 
           -'user'                                                      
      1224 -                    ? 'gradient-primary shadow-glow'        
      1225 -                    : 'glass-card'                          
      1226 -                    }`}>                                    
      1227 -                    {message.role === 'user' ? (            
      1228 -                      <UserIcon className="w-4 h-4 text-white
           -" />                                                        
      1229 -                    ) : (                                   
      1230 -                      <Bot className="w-4 h-4 text-primary-40
           -0" />                                                       
      1231 -                    )}                                      
      1232 -                  </div>                                    
      1233 -                                                            
      1234 -                  <div className={`flex-1 ${message.role === 
           -'user' ? 'text-right' : ''}`}>                              
      1235 -                    {message.role === 'assistant' && message.
           -reasoning_content && (                                      
      1236 -                      <div className="text-left">           
      1237 -                        <ThinkingSection                    
      1238 -                          reasoning={message.reasoning_conten
           -t}                                                          
      1239 -                          isExpanded={expandedThinkingSection
           -s.has(message.id)}                                          
      1240 -                          onToggle={() => toggleThinkingSecti
           -on(message.id)}                                             
      1241 -                          isStreaming={false}               
      1242 -                          elapsedTime={0}                   
      1243 -                          stats={null}                      
      1244 -                        />                                  
      1245 -                      </div>                                
      1246 -                    )}                                      
      1247 -                    <div className={`inline-block max-w-[80%]
           - ${message.role === 'user'                                  
      1248 -                      ? 'bg-dark-700/80 border border-dark-60
           -0 text-dark-100 rounded-2xl rounded-tr-sm px-4 py-3'        
      1249 -                      : 'bg-gradient-to-br from-dark-800 to-d
           -ark-900 border border-dark-600/50 rounded-2xl rounded-tl-sm p
           -x-4 py-3 text-left shadow-lg'                               
      1250 -                      }`}>                                  
      1251 -                      {message.role === 'user' ? (          
      1252 -                        editingMessageId === message.id ? ( 
      1253 -                          <div className="space-y-2 text-left
           -">                                                          
      1254 -                            <textarea                       
      1255 -                              value={editContent}           
      1256 -                              onChange={(e) => setEditContent
           -(e.target.value)}                                           
      1257 -                              className="w-full min-w-[300px]
           - bg-dark-800/50 border border-dark-600 rounded-lg p-2 text-wh
           -ite resize-none focus:outline-none focus:border-primary-400"
      1258 -                              rows={3}                      
      1259 -                              autoFocus                     
      1260 -                            />                              
      1261 -                            <div className="flex gap-2 justif
           -y-end">                                                     
      1262 -                              <button                       
      1263 -                                onClick={handleEditCancel}  
      1264 -                                className="px-3 py-1 text-xs 
           -rounded-lg bg-dark-700 hover:bg-dark-600 transition-colors" 
      1265 -                              >                             
      1266 -                                Cancel                      
      1267 -                              </button>                     
      1268 -                              <button                       
      1269 -                                onClick={() => handleEditSave
           -(message.id)}                                               
      1270 -                                className="px-3 py-1 text-xs 
           -rounded-lg bg-primary-500 hover:bg-primary-400 transition-col
           -ors"                                                        
      1271 -                              >                             
      1272 -                                Save & Regenerate           
      1273 -                              </button>                     
      1274 -                            </div>                          
      1275 -                          </div>                            
      1276 -                        ) : (                               
      1277 -                          renderMessage(message.content)    
      1278 -                        )                                   
      1279 -                      ) : (                                 
      1280 -                        renderMessage(message.content)      
      1281 -                      )}                                    
      1282 -                    </div>                                  
      1283 -                                                            
      1284 -                    {message.role === 'user' && editingMessag
           -eId !== message.id && (                                     
      1285 -                      <div className="mt-2 flex gap-2 justify
           --end">                                                      
      1286 -                        <button                             
      1287 -                          onClick={() => handleCopy(message.i
           -d, message.content, 'raw')}                                 
      1288 -                          className="text-xs text-dark-400 ho
           -ver:text-primary-400 flex items-center gap-1 transition-color
           -s"                                                          
      1289 -                        >                                   
      1290 -                          {copiedMessageId === `${message.id}
           --raw` ? <Check className="w-3 h-3" /> : <Copy className="w-3 
           -h-3" />}                                                    
      1291 -                          {copiedMessageId === `${message.id}
           --raw` ? 'Copied!' : 'Copy'}                                 
      1292 -                        </button>                           
      1293 -                        <button                             
      1294 -                          onClick={() => handleEditStart(mess
           -age)}                                                       
      1295 -                          className="text-xs text-dark-400 ho
           -ver:text-primary-400 flex items-center gap-1 transition-color
           -s"                                                          
      1296 -                        >                                   
      1297 -                          <Pencil className="w-3 h-3" />    
      1298 -                          Edit                              
      1299 -                        </button>                           
      1300 -                      </div>                                
      1301 -                    )}                                      
      1302 -                                                            
      1303 -                    {message.role === 'assistant' && (      
      1304 -                      <div className="mt-2 flex gap-2 items-c
           -enter">                                                     
      1305 -                        <button                             
      1306 -                          onClick={() => handleCopy(message.i
           -d, message.content, 'raw')}                                 
      1307 -                          className="text-xs text-dark-400 ho
           -ver:text-primary-400 flex items-center gap-1 transition-color
           -s"                                                          
      1308 -                        >                                   
      1309 -                          {copiedMessageId === `${message.id}
           --raw` ? <Check className="w-3 h-3" /> : <Copy className="w-3 
           -h-3" />}                                                    
      1310 -                          {copiedMessageId === `${message.id}
           --raw` ? 'Copied!' : 'Copy Raw'}                             
      1311 -                        </button>                           
      1312 -                        <button                             
      1313 -                          onClick={() => handleCopy(message.i
           -d, message.content, 'markdown')}                            
      1314 -                          className="text-xs text-dark-400 ho
           -ver:text-primary-400 flex items-center gap-1 transition-color
           -s"                                                          
      1315 -                        >                                   
      1316 -                          {copiedMessageId === `${message.id}
           --markdown` ? <Check className="w-3 h-3" /> : <Copy className=
           -"w-3 h-3" />}                                               
      1317 -                          {copiedMessageId === `${message.id}
           --markdown` ? 'Copied!' : 'Copy Markdown'}                   
      1318 -                        </button>                           
      1319 -                        <button                             
      1320 -                          onClick={() => openForkModal(messag
           -e.id)}                                                      
      1321 -                          className="text-xs text-dark-400 ho
           -ver:text-primary-400 flex items-center gap-1 transition-color
           -s"                                                          
      1322 -                        >                                   
      1323 -                          <GitBranch className="w-3 h-3" /> 
      1324 -                          Fork from here                    
      1325 -                        </button>                           
      1326 -                                                            
      1327 -                        {/* Details hover - show if message h
           -as stats */}                                                
      1328 -                        {(message.prompt_tokens || message.re
           -sponse_time_ms || message.cost > 0) && (                    
      1329 -                          <div className="group relative">  
      1330 -                            <button className="text-xs text-d
           -ark-400 hover:text-primary-400 flex items-center gap-1 transi
           -tion-colors">                                               
      1331 -                              <Info className="w-3 h-3" />  
      1332 -                            </button>                       
      1333 -                            <div className="absolute bottom-f
           -ull left-0 mb-1 hidden group-hover:block z-10">             
      1334 -                              <div className="bg-dark-800 bor
           -der border-dark-600 rounded-lg px-3 py-2 text-xs whitespace-n
           -owrap shadow-xl">                                           
      1335 -                                <div className="space-y-1"> 
      1336 -                                  {message.response_time_ms >
           - 0 && (                                                     
      1337 -                                    <div className="flex just
           -ify-between gap-4">                                         
      1338 -                                      <span className="text-d
           -ark-400">Time:</span>                                       
      1339 -                                      <span className="text-d
           -ark-200 font-mono">{formatThinkingTime(message.response_time_
           -ms / 1000)}</span>                                          
      1340 -                                    </div>                  
      1341 -                                  )}                        
      1342 -                                  {(message.prompt_tokens || 
           -message.completion_tokens) && (                             
      1343 -                                    <div className="flex just
           -ify-between gap-4">                                         
      1344 -                                      <span className="text-d
           -ark-400">Tokens:</span>                                     
      1345 -                                      <span className="text-d
           -ark-200 font-mono">{((message.prompt_tokens || 0) + (message.
           -completion_tokens || 0)).toLocaleString()} tks</span>       
      1346 -                                    </div>                  
      1347 -                                  )}                        
      1348 -                                  {message.cost > 0 && (    
      1349 -                                    <div className="flex just
           -ify-between gap-4">                                         
      1350 -                                      <span className="text-d
           -ark-400">Cost:</span>                                       
      1351 -                                      <span className="text-a
           -ccent-400 font-mono">                                       
      1352 -                                        ${message.cost.toFixe
           -d(2)}                                                       
      1353 -                                      </span>               
      1354 -                                    </div>                  
      1355 -                                  )}                        
      1356 -                                </div>                      
      1357 -                              </div>                        
      1358 -                            </div>                          
      1359 -                          </div>                            
      1360 -                        )}                                  
      1361 -                      </div>                                
      1362 -                    )}                                      
      1363 -                                                            
      1364 -                  </div>                                    
      1365 -                </div>                                      
      1366 -              ))}                                           
      1367 -                                                            
      1368 -              {(streaming || streamingMessage || streamingRea
           -soning) && (                                                
      1369 -                <div className="flex gap-4">                
      1370 -                  <div className="flex-shrink-0 w-8 h-8 round
           -ed-full glass-card flex items-center justify-center">       
      1371 -                    <Bot className="w-4 h-4 text-primary-400"
           - />                                                         
      1372 -                  </div>                                    
      1373 -                  <div className="flex-1">                  
      1374 -                    {(streamingReasoning || (streaming && !st
           -reamingMessage)) && (                                       
      1375 -                      <ThinkingSection                      
      1376 -                        reasoning={streamingReasoning}      
      1377 -                        isExpanded={expandedThinkingSections.
           -has('streaming')}                                           
      1378 -                        onToggle={() => toggleThinkingSection
           -('streaming')}                                              
      1379 -                        isStreaming={!streamingMessage || (st
           -reamingReasoning && streaming)}                             
      1380 -                        elapsedTime={thinkingElapsedTime}   
      1381 -                        stats={lastThinkingStats}           
      1382 -                      />                                    
      1383 -                    )}                                      
      1384 -                                                            
      1385 -                    {streamingMessage && (                  
      1386 -                      <div className="inline-block max-w-[80%
           -] glass-card rounded-2xl rounded-tl-sm px-4 py-3">          
      1387 -                        {renderMessage(streamingMessage)}   
      1388 -                      </div>                                
      1389 -                    )}                                      
      1390 -                                                            
      1391 -                    {streaming && !streamingMessage && !strea
           -mingReasoning && (                                          
      1392 -                      <div className="inline-block glass-card
           - rounded-2xl rounded-tl-sm px-4 py-3">                      
      1393 -                        <div className="flex gap-1">        
      1394 -                          <div className="w-2 h-2 bg-primary-
           -400 rounded-full animate-bounce" style={{ animationDelay: '0m
           -s' }}></div>                                                
      1395 -                          <div className="w-2 h-2 bg-primary-
           -400 rounded-full animate-bounce" style={{ animationDelay: '15
           -0ms' }}></div>                                              
      1396 -                          <div className="w-2 h-2 bg-primary-
           -400 rounded-full animate-bounce" style={{ animationDelay: '30
           -0ms' }}></div>                                              
      1397 -                        </div>                              
      1398 -                      </div>                                
      1399 -                    )}                                      
      1400 -                  </div>                                    
      1401 -                </div>                                      
      1402 -              )}                                            
      1403 -                                                            
      1404 -              <div ref={messagesEndRef} />                  
      1405 -            </div>                                          
      1406 -          )}                                                
      1407 -        </div>                                              
      1408 -                                                            
      1409 -        {/* Input */}                                       
      1410 -        {currentChat && (                                   
      1411 -          <div className="border-t border-white/[0.06] glass 
           -p-4">                                                       
      1412 -            <div className="max-w-4xl mx-auto">             
      1413 -              {streaming && (                               
      1414 -                <div className="flex justify-center mb-4">  
      1415 -                  <button                                   
      1416 -                    onClick={stopGeneration}                
      1417 -                    className="flex items-center gap-2 px-5 p
           -y-2.5 bg-red-500/10 text-red-400 border border-red-500/20 rou
           -nded-xl text-sm font-semibold hover:bg-red-500/20 transition-
           -all duration-200 active:scale-[0.98]"                       
      1418 -                  >                                         
      1419 -                    <Square className="w-3 h-3 fill-current" 
           -/>                                                          
      1420 -                    Stop Generating                         
      1421 -                  </button>                                 
      1422 -                </div>                                      
      1423 -              )}                                            
      1424 -              <form onSubmit={sendMessage} className="flex ga
           -p-3">                                                       
      1425 -                <div className="flex-1 relative">           
      1426 -                  <textarea                                 
      1427 -                    ref={textareaRef}                       
      1428 -                    value={inputMessage}                    
      1429 -                    onChange={(e) => setInputMessage(e.target
           -.value)}                                                    
      1430 -                    onKeyDown={(e) => {                     
      1431 -                      if (e.key === 'Enter' && !e.shiftKey) {
           -                                                             
      1432 -                        e.preventDefault();                 
      1433 -                        if (inputMessage.trim() && !streaming
           -) {                                                         
      1434 -                          sendMessage(e);                   
      1435 -                        }                                   
      1436 -                      }                                     
      1437 -                    }}                                      
      1438 -                    placeholder={streaming ? "AI is respondin
           -g..." : "Type your message... (Shift+Enter for new line)"}  
      1439 -                    className="w-full px-5 py-3.5 rounded-2xl
           - glass-input outline-none text-dark-100 placeholder-dark-500 
           -text-sm pr-4 resize-none overflow-y-auto"                   
      1440 -                    style={{ minHeight: '52px', maxHeight: '1
           -40px' }}                                                    
      1441 -                    rows={1}                                
      1442 -                    disabled={streaming}                    
      1443 -                    onInput={(e) => {                       
      1444 -                      e.target.style.height = 'auto';       
      1445 -                      e.target.style.height = Math.min(e.targ
           -et.scrollHeight, 140) + 'px';                               
      1446 -                    }}                                      
      1447 -                  />                                        
      1448 -                </div>                                      
      1449 -                <button                                     
      1450 -                  type="submit"                             
      1451 -                  disabled={!inputMessage.trim() || streaming
           -}                                                           
      1452 -                  className="px-6 py-3.5 gradient-primary tex
           -t-white rounded-2xl font-semibold hover:shadow-glow transitio
           -n-all duration-200 disabled:opacity-40 disabled:cursor-not-al
           -lowed disabled:hover:shadow-none flex items-center gap-2 acti
           -ve:scale-[0.98] shine"                                      
      1453 -                >                                           
      1454 -                  <Send className="w-4 h-4" />              
      1455 -                  <span className="hidden sm:inline">Send</sp
           -an>                                                         
      1456 -                </button>                                   
      1457 -              </form>                                       
      1458 -            </div>                                          
      1459 -          </div>                                            
      1460 -        )}                                                  
      1461 -      </div>                                                
      1462 -                                                            
      1463 -      {/* Fork Modal */}                                    
      1464 -      {showForkModal && (                                   
      1465 -        <div className="fixed inset-0 bg-dark-950/80 backdrop
           --blur-md flex items-center justify-center z-50 scale-in">   
      1466 -          <div className="glass-card rounded-2xl p-6 w-full m
           -ax-w-md mx-4 shadow-2xl">                                   
      1467 -            <div className="flex items-center justify-between
           - mb-5">                                                     
      1468 -              <h3 className="text-lg font-bold text-dark-100 
           -flex items-center gap-2.5">                                 
      1469 -                <div className="w-8 h-8 rounded-lg gradient-p
           -rimary flex items-center justify-center shadow-lg">         
      1470 -                  <GitBranch className="w-4 h-4 text-white" /
           ->                                                           
      1471 -                </div>                                      
      1472 -                Fork Chat                                   
      1473 -              </h3>                                         
      1474 -              <button                                       
      1475 -                onClick={() => setShowForkModal(false)}     
      1476 -                className="p-2 hover:bg-white/[0.05] rounded-
           -xl transition-all duration-200"                             
      1477 -              >                                             
      1478 -                <X className="w-5 h-5 text-dark-400" />     
      1479 -              </button>                                     
      1480 -            </div>                                          
      1481 -                                                            
      1482 -            <p className="text-dark-400 text-sm mb-5 leading-
           -relaxed">                                                   
      1483 -              Create a new chat branch from this point. You c
           -an choose a different model for the forked chat.            
      1484 -            </p>                                            
      1485 -                                                            
      1486 -            <div className="mb-6">                          
      1487 -              <label className="block text-sm font-medium tex
           -t-dark-300 mb-2">                                           
      1488 -                Model for forked chat                       
      1489 -              </label>                                      
      1490 -              <ModelSelector                                
      1491 -                selectedModel={forkModel}                   
      1492 -                onModelChange={setForkModel}                
      1493 -                isDropdown={true}                           
      1494 -              />                                            
      1495 -            </div>                                          
      1496 -                                                            
      1497 -            <div className="flex gap-3">                    
      1498 -              <button                                       
      1499 -                onClick={() => setShowForkModal(false)}     
      1500 -                className="flex-1 px-4 py-3 rounded-xl glass-
           -button text-dark-300 font-semibold transition-all duration-20
           -0 hover:text-dark-100"                                      
      1501 -              >                                             
      1502 -                Cancel                                      
      1503 -              </button>                                     
      1504 -              <button                                       
      1505 -                onClick={forkChat}                          
      1506 -                className="flex-1 px-4 py-3 rounded-xl gradie
           -nt-primary text-white font-semibold hover:shadow-glow transit
           -ion-all duration-200 flex items-center justify-center gap-2 a
           -ctive:scale-[0.98] shine"                                   
      1507 -              >                                             
      1508 -                <GitBranch className="w-4 h-4" />           
      1509 -                Fork Chat                                   
      1510 -              </button>                                     
      1511 -            </div>                                          
      1512 -          </div>                                            
      1513 -        </div>                                              
      1514 -      )}                                                    
      1515 -                                                            
      1516 -    </div>                                                  
      1517 -  );                                                        
      1518 -}                                                           
      1519 -                                                            
      1520 -export default Chat;                                        
         1 +import React, { useState, useEffect, useContext, useRef, memo
           +, useCallback, useMemo } from 'react';                       
         2 +import { useNavigate } from 'react-router-dom';              
         3 +import {                                                     
         4 +  MessageSquare, Plus, Settings as SettingsIcon, LogOut, Brai
           +n,                                                           
         5 +  Send, Trash2, GitBranch, Bot, User as UserIcon,            
         6 +  Sparkles, Zap, Menu, X, ChevronDown, ChevronRight, Square, 
         7 +  Check, Trash, Copy, Pencil, Info, DollarSign, Hash         
         8 +} from 'lucide-react';                                       
         9 +import { AuthContext } from '../contexts/AuthContext';       
        10 +import { marked } from 'marked';                             
        11 +import DOMPurify from 'dompurify';                           
        12 +import ModelSelector, { DEFAULT_MODEL, RECENT_MODELS_KEY, MOD
           +ELS_CACHE_KEY } from '../components/ModelSelector';          
        13 +                                                             
        14 +marked.setOptions({                                          
        15 +  breaks: true,                                              
        16 +  gfm: true                                                  
        17 +});                                                          
        18 +                                                             
        19 +const LAST_MODEL_KEY = 'budi_chat_last_model';               
        20 +                                                             
        21 +// Format time as seconds or minutes:seconds (integer display
           +)                                                            
        22 +const formatThinkingTime = (seconds) => {                    
        23 +  const s = Math.floor(seconds);                             
        24 +  if (s < 60) {                                              
        25 +    return `${s}s`;                                          
        26 +  }                                                          
        27 +  const mins = Math.floor(s / 60);                           
        28 +  const secs = s % 60;                                       
        29 +  return `${mins}m ${secs.toString().padStart(2, '0')}s`;    
        30 +};                                                           
        31 +                                                             
        32 +// Get model data from OpenRouter cache                      
        33 +const getModelFromCache = (modelId) => {                     
        34 +  try {                                                      
        35 +    const cached = localStorage.getItem(MODELS_CACHE_KEY);   
        36 +    if (cached) {                                            
        37 +      const { models } = JSON.parse(cached);                 
        38 +      return models.find(m => m.id === modelId);             
        39 +    }                                                        
        40 +  } catch (e) {                                              
        41 +    console.error('Failed to get model from cache:', e);     
        42 +  }                                                          
        43 +  return null;                                               
        44 +};                                                           
        45 +                                                             
        46 +// Get context window size for a model (from cache or fallbac
           +k)                                                           
        47 +const getModelContext = (modelId) => {                       
        48 +  const model = getModelFromCache(modelId);                  
        49 +  return model?.contextLength || 128000; // fallback to 128k 
        50 +};                                                           
        51 +                                                             
        52 +// Calculate cost using cached pricing data                  
        53 +const calculateCost = (promptTokens, completionTokens, modelI
           +d) => {                                                      
        54 +  const model = getModelFromCache(modelId);                  
        55 +  if (model?.pricing) {                                      
        56 +    const inputCost = promptTokens * parseFloat(model.pricing
           +.prompt);                                                    
        57 +    const outputCost = completionTokens * parseFloat(model.pr
           +icing.completion);                                           
        58 +    return inputCost + outputCost;                           
        59 +  }                                                          
        60 +  // Fallback: rough estimate                                
        61 +  return (promptTokens + completionTokens) * 0.000001;       
        62 +};                                                           
        63 +                                                             
        64 +// Memoized ThinkingSection component to prevent re-renders d
           +uring streaming                                              
        65 +const ThinkingSection = memo(({ reasoning, isExpanded, onTogg
           +le, isStreaming, elapsedTime, stats }) => {                  
        66 +  const contentRef = useRef(null);                           
        67 +  const shouldAutoScrollRef = useRef(true);                  
        68 +                                                             
        69 +  useEffect(() => {                                          
        70 +    if (isExpanded && isStreaming && shouldAutoScrollRef.curr
           +ent) {                                                       
        71 +      const scroll = () => {                                 
        72 +        if (contentRef.current) {                            
        73 +          contentRef.current.scrollTop = contentRef.current.s
           +crollHeight;                                                 
        74 +        }                                                    
        75 +      };                                                     
        76 +      requestAnimationFrame(scroll);                         
        77 +    }                                                        
        78 +  }, [reasoning, isExpanded, isStreaming]);                  
        79 +                                                             
        80 +  const handleScroll = (e) => {                              
        81 +    const { scrollTop, scrollHeight, clientHeight } = e.targe
           +t;                                                           
        82 +    // If user is within 50px of bottom, enable auto-scroll, 
           +otherwise disable                                            
        83 +    const isAtBottom = scrollHeight - scrollTop - clientHeigh
           +t < 50;                                                      
        84 +    shouldAutoScrollRef.current = isAtBottom;                
        85 +  };                                                         
        86 +                                                             
        87 +  if (!reasoning && !isStreaming) return null;               
        88 +                                                             
        89 +  const hasStats = stats && (stats.totalTokens > 0 || stats.d
           +uration > 0);                                                
        90 +  const cost = hasStats ? (stats.cost || (stats.promptTokens 
           +|| 0) > 0 ? calculateCost(stats.promptTokens || 0, stats.comp
           +letionTokens || 0, stats.model) : 0) : 0;                    
        91 +                                                             
        92 +  return (                                                   
        93 +    <div className="mb-4">                                   
        94 +      <div className="flex items-center justify-between">    
        95 +        <button                                              
        96 +          type="button"                                      
        97 +          onMouseDown={(e) => {                              
        98 +            e.preventDefault();                              
        99 +            onToggle();                                      
       100 +          }}                                                 
       101 +          className="flex items-center gap-2 text-sm font-med
           +ium text-dark-400 hover:text-dark-300 transition-colors px-3 
           +py-1.5 rounded-lg hover:bg-dark-700/50 select-none"          
       102 +        >                                                    
       103 +          <Brain className="w-4 h-4 text-accent-400" />      
       104 +          <span>                                             
       105 +            {isStreaming ? (                                 
       106 +              <>Thinking... <span className="text-accent-400 
           +font-mono text-xs ml-1">{formatThinkingTime(elapsedTime || 0)
           +}</span></>                                                  
       107 +            ) : (                                            
       108 +              'Thought Process'                              
       109 +            )}                                               
       110 +          </span>                                            
       111 +          <ChevronDown className={`w-4 h-4 transition-transfo
           +rm duration-200 ${isExpanded ? 'rotate-180' : ''}`} />       
       112 +        </button>                                            
       113 +                                                             
       114 +        {/* Details on hover - bottom right */}              
       115 +        {!isStreaming && hasStats && (                       
       116 +          <div className="group relative">                   
       117 +            <span className="text-[10px] text-dark-500 cursor
           +-default">details</span>                                     
       118 +            <div className="absolute bottom-full right-0 mb-1
           + hidden group-hover:block z-10">                             
       119 +              <div className="bg-dark-800 border border-dark-
           +700 rounded-lg px-3 py-2 text-xs whitespace-nowrap shadow-xl"
           +>                                                            
       120 +                <div className="space-y-1">                  
       121 +                  {stats.duration > 0 && (                   
       122 +                    <div className="flex justify-between gap-
           +4">                                                          
       123 +                      <span className="text-dark-400">Time:</
           +span>                                                        
       124 +                      <span className="text-dark-200 font-mon
           +o">{formatThinkingTime(stats.duration)}</span>               
       125 +                    </div>                                   
       126 +                  )}                                         
       127 +                  {stats.totalTokens > 0 && (                
       128 +                    <div className="flex justify-between gap-
           +4">                                                          
       129 +                      <span className="text-dark-400">Tokens:
           +</span>                                                      
       130 +                      <span className="text-dark-200 font-mon
           +o">{stats.totalTokens.toLocaleString()} tks</span>           
       131 +                    </div>                                   
       132 +                  )}                                         
       133 +                  {cost > 0 && (                             
       134 +                    <div className="flex justify-between gap-
           +4">                                                          
       135 +                      <span className="text-dark-400">Cost:</
           +span>                                                        
       136 +                      <span className="text-primary-400 font-
           +mono">${cost < 0.01 ? cost.toFixed(4) : cost.toFixed(3)}</spa
           +n>                                                           
       137 +                    </div>                                   
       138 +                  )}                                         
       139 +                </div>                                       
       140 +              </div>                                         
       141 +            </div>                                           
       142 +          </div>                                             
       143 +        )}                                                   
       144 +      </div>                                                 
       145 +      {isExpanded && (                                       
       146 +        <div                                                 
       147 +          ref={contentRef}                                   
       148 +          onScroll={handleScroll}                            
       149 +          className="mt-2 px-4 py-3 text-sm text-dark-300 rou
           +nded-xl border border-dark-700/50 italic bg-dark-900/50 text-
           +left max-h-[300px] overflow-y-auto prose prose-invert prose-s
           +m max-w-none"                                                
       150 +          dangerouslySetInnerHTML={{                         
       151 +            __html: DOMPurify.sanitize(marked.parse(reasoning
           + || 'Thinking...'))                                          
       152 +          }}                                                 
       153 +        />                                                   
       154 +      )}                                                     
       155 +    </div>                                                   
       156 +  );                                                         
       157 +});                                                          
       158 +                                                             
       159 +function Chat() {                                            
       160 +  const { user, logout } = useContext(AuthContext);          
       161 +  const navigate = useNavigate();                            
       162 +  const [chats, setChats] = useState([]);                    
       163 +  const [currentChat, setCurrentChat] = useState(() => ({    
       164 +    title: 'New Chat',                                       
       165 +    model: localStorage.getItem(LAST_MODEL_KEY) || DEFAULT_MO
           +DEL,                                                         
       166 +    temperature: 0.7,                                        
       167 +    system_prompt: '',                                       
       168 +    agent_mode: false                                        
       169 +  }));                                                       
       170 +  const [messages, setMessages] = useState([]);              
       171 +  const [inputMessage, setInputMessage] = useState('');      
       172 +  const [loading, setLoading] = useState(false);             
       173 +  const [streaming, setStreaming] = useState(false);         
       174 +  const [streamingMessage, setStreamingMessage] = useState(''
           +);                                                           
       175 +  const [streamingReasoning, setStreamingReasoning] = useStat
           +e('');                                                       
       176 +  const [showSettings, setShowSettings] = useState(false);   
       177 +  const [showSidebar, setShowSidebar] = useState(true);      
       178 +  const [showForkModal, setShowForkModal] = useState(false); 
       179 +  const [deletingChatId, setDeletingChatId] = useState(null);
       180 +  const [forkMessageId, setForkMessageId] = useState(null);  
       181 +  const [forkModel, setForkModel] = useState(DEFAULT_MODEL); 
       182 +  const messagesEndRef = useRef(null);                       
       183 +  const messagesContainerRef = useRef(null);                 
       184 +  const abortControllerRef = useRef(null);                   
       185 +  const isCreatingChatRef = useRef(false);                   
       186 +  const userHasScrolledUp = useRef(false);                   
       187 +  const statsPopupRef = useRef(null);                        
       188 +  const textareaRef = useRef(null);                          
       189 +  const [expandedThinkingSections, setExpandedThinkingSection
           +s] = useState(new Set());                                    
       190 +  const [copiedMessageId, setCopiedMessageId] = useState(null
           +);                                                           
       191 +  const [editingMessageId, setEditingMessageId] = useState(nu
           +ll);                                                         
       192 +  const [editContent, setEditContent] = useState('');        
       193 +  const [showInfoModal, setShowInfoModal] = useState(false); 
       194 +  const [usageStats, setUsageStats] = useState(null);        
       195 +  const [thinkingStartTime, setThinkingStartTime] = useState(
           +null);                                                       
       196 +  const [thinkingElapsedTime, setThinkingElapsedTime] = useSt
           +ate(0);                                                      
       197 +  const [lastThinkingStats, setLastThinkingStats] = useState(
           +null);                                                       
       198 +                                                             
       199 +  const [chatSettings, setChatSettings] = useState(() => ({  
       200 +    model: localStorage.getItem(LAST_MODEL_KEY) || DEFAULT_MO
           +DEL,                                                         
       201 +    temperature: 0.7,                                        
       202 +    system_prompt: '',                                       
       203 +    agent_mode: false                                        
       204 +  }));                                                       
       205 +                                                             
       206 +  // Calculate chat totals from persisted message data       
       207 +  const chatTotals = useMemo(() => {                         
       208 +    const assistantMsgs = messages.filter(m => m.role === 'as
           +sistant');                                                   
       209 +    return {                                                 
       210 +      totalPromptTokens: assistantMsgs.reduce((sum, m) => sum
           + + (m.prompt_tokens || 0), 0),                               
       211 +      totalCompletionTokens: assistantMsgs.reduce((sum, m) =>
           + sum + (m.completion_tokens || 0), 0),                       
       212 +      totalTokens: assistantMsgs.reduce((sum, m) => sum + (m.
           +prompt_tokens || 0) + (m.completion_tokens || 0), 0),        
       213 +      totalTimeMs: assistantMsgs.reduce((sum, m) => sum + (m.
           +response_time_ms || 0), 0),                                  
       214 +      totalCost: assistantMsgs.reduce((sum, m) => sum + (m.co
           +st || 0), 0),                                                
       215 +    };                                                       
       216 +  }, [messages]);                                            
       217 +                                                             
       218 +  useEffect(() => {                                          
       219 +    loadChats();                                             
       220 +  }, []);                                                    
       221 +                                                             
       222 +  useEffect(() => {                                          
       223 +    // Skip clearing/aborting if we're in the middle of creat
           +ing a new chat                                               
       224 +    if (isCreatingChatRef.current) {                         
       225 +      return;                                                
       226 +    }                                                        
       227 +                                                             
       228 +    // Clear state immediately when switching chats or if no 
           +chat is selected                                             
       229 +    setStreamingMessage('');                                 
       230 +    setStreamingReasoning('');                               
       231 +    setStreaming(false);                                     
       232 +    setUsageStats(null);                                     
       233 +                                                             
       234 +    if (abortControllerRef.current) {                        
       235 +      abortControllerRef.current.abort();                    
       236 +    }                                                        
       237 +                                                             
       238 +    if (currentChat?.id) {                                   
       239 +      loadMessages(currentChat.id);                          
       240 +    }                                                        
       241 +  }, [currentChat?.id]);                                     
       242 +                                                             
       243 +  useEffect(() => {                                          
       244 +    // Only auto-scroll if user hasn't manually scrolled up  
       245 +    if (!userHasScrolledUp.current) {                        
       246 +      scrollToBottom();                                      
       247 +    }                                                        
       248 +  }, [messages, streamingMessage]);                          
       249 +                                                             
       250 +  // Reset scroll flag when streaming ends                   
       251 +  useEffect(() => {                                          
       252 +    if (!streaming) {                                        
       253 +      userHasScrolledUp.current = false;                     
       254 +    }                                                        
       255 +  }, [streaming]);                                           
       256 +                                                             
       257 +  // Timer for thinking section                              
       258 +  useEffect(() => {                                          
       259 +    let interval;                                            
       260 +    if (streaming && thinkingStartTime) {                    
       261 +      interval = setInterval(() => {                         
       262 +        setThinkingElapsedTime((Date.now() - thinkingStartTim
           +e) / 1000);                                                  
       263 +      }, 100);                                               
       264 +    }                                                        
       265 +    return () => clearInterval(interval);                    
       266 +  }, [streaming, thinkingStartTime]);                        
       267 +                                                             
       268 +  // Reset thinking timer when streaming starts              
       269 +  useEffect(() => {                                          
       270 +    if (streaming) {                                         
       271 +      setThinkingStartTime(Date.now());                      
       272 +      setThinkingElapsedTime(0);                             
       273 +      setLastThinkingStats(null);                            
       274 +    }                                                        
       275 +  }, [streaming]);                                           
       276 +                                                             
       277 +  // Close stats popup when clicking outside                 
       278 +  useEffect(() => {                                          
       279 +    const handleClickOutside = (event) => {                  
       280 +      if (statsPopupRef.current && !statsPopupRef.current.con
           +tains(event.target)) {                                       
       281 +        setShowInfoModal(false);                             
       282 +      }                                                      
       283 +    };                                                       
       284 +    if (showInfoModal) {                                     
       285 +      document.addEventListener('mousedown', handleClickOutsi
           +de);                                                         
       286 +      return () => document.removeEventListener('mousedown', 
           +handleClickOutside);                                         
       287 +    }                                                        
       288 +  }, [showInfoModal]);                                       
       289 +                                                             
       290 +  const scrollToBottom = () => {                             
       291 +    messagesEndRef.current?.scrollIntoView({ behavior: 'smoot
           +h' });                                                       
       292 +  };                                                         
       293 +                                                             
       294 +  const handleMessagesScroll = (e) => {                      
       295 +    const container = e.target;                              
       296 +    const threshold = 100; // pixels from bottom             
       297 +    const isNearBottom = container.scrollHeight - container.s
           +crollTop - container.clientHeight < threshold;               
       298 +    userHasScrolledUp.current = !isNearBottom;               
       299 +  };                                                         
       300 +                                                             
       301 +  const toggleThinkingSection = useCallback((messageId) => { 
       302 +    setExpandedThinkingSections(prev => {                    
       303 +      const newSet = new Set(prev);                          
       304 +      if (newSet.has(messageId)) {                           
       305 +        newSet.delete(messageId);                            
       306 +      } else {                                               
       307 +        newSet.add(messageId);                               
       308 +      }                                                      
       309 +      return newSet;                                         
       310 +    });                                                      
       311 +  }, []);                                                    
       312 +                                                             
       313 +  const loadChats = async () => {                            
       314 +    try {                                                    
       315 +      const res = await fetch('/api/chats', {                
       316 +        headers: { 'Authorization': `Bearer ${localStorage.ge
           +tItem('token')}` }                                           
       317 +      });                                                    
       318 +      const data = await res.json();                         
       319 +      setChats(data);                                        
       320 +    } catch (error) {                                        
       321 +      console.error('Failed to load chats:', error);         
       322 +    }                                                        
       323 +  };                                                         
       324 +                                                             
       325 +  const loadMessages = async (chatId) => {                   
       326 +    try {                                                    
       327 +      const res = await fetch(`/api/chats/${chatId}`, {      
       328 +        headers: { 'Authorization': `Bearer ${localStorage.ge
           +tItem('token')}` }                                           
       329 +      });                                                    
       330 +      const data = await res.json();                         
       331 +      setMessages(data.messages || []);                      
       332 +      setChatSettings({                                      
       333 +        model: data.model,                                   
       334 +        temperature: data.temperature,                       
       335 +        system_prompt: data.system_prompt || '',             
       336 +        agent_mode: !!data.agent_mode                        
       337 +      });                                                    
       338 +      // Update currentChat with latest data (including updat
           +ed title)                                                    
       339 +      const { messages: _, ...chatData } = data;             
       340 +      setCurrentChat(prev => ({ ...prev, ...chatData }));    
       341 +    } catch (error) {                                        
       342 +      console.error('Failed to load messages:', error);      
       343 +    }                                                        
       344 +  };                                                         
       345 +                                                             
       346 +  const createNewChat = () => {                              
       347 +    const modelToUse = localStorage.getItem(LAST_MODEL_KEY) |
           +| DEFAULT_MODEL;                                             
       348 +    // Create a temporary chat object without an ID          
       349 +    // The actual chat will be created when the first message
           + is sent                                                     
       350 +    setCurrentChat({                                         
       351 +      title: 'New Chat',                                     
       352 +      model: modelToUse,                                     
       353 +      temperature: 0.7,                                      
       354 +      system_prompt: '',                                     
       355 +      agent_mode: false                                      
       356 +    });                                                      
       357 +    setChatSettings({                                        
       358 +      model: modelToUse,                                     
       359 +      temperature: 0.7,                                      
       360 +      system_prompt: '',                                     
       361 +      agent_mode: false                                      
       362 +    });                                                      
       363 +  };                                                         
       364 +                                                             
       365 +  const updateChatSettings = async () => {                   
       366 +    if (!currentChat) return;                                
       367 +                                                             
       368 +    // If it's a new chat without an ID, just update local st
           +ate                                                          
       369 +    if (!currentChat.id) {                                   
       370 +      setCurrentChat({ ...currentChat, ...chatSettings });   
       371 +      setShowSettings(false);                                
       372 +      return;                                                
       373 +    }                                                        
       374 +                                                             
       375 +    try {                                                    
       376 +      await fetch(`/api/chats/${currentChat.id}`, {          
       377 +        method: 'PUT',                                       
       378 +        headers: {                                           
       379 +          'Content-Type': 'application/json',                
       380 +          'Authorization': `Bearer ${localStorage.getItem('to
           +ken')}`                                                      
       381 +        },                                                   
       382 +        body: JSON.stringify(chatSettings)                   
       383 +      });                                                    
       384 +      setShowSettings(false);                                
       385 +    } catch (error) {                                        
       386 +      console.error('Failed to update chat:', error);        
       387 +    }                                                        
       388 +  };                                                         
       389 +                                                             
       390 +  const handleModelChange = async (modelId) => {             
       391 +    // Save as last used model                               
       392 +    localStorage.setItem(LAST_MODEL_KEY, modelId);           
       393 +                                                             
       394 +    setChatSettings(prev => ({ ...prev, model: modelId }));  
       395 +                                                             
       396 +    // If we have a current chat with an ID, update it immedi
           +ately                                                        
       397 +    if (currentChat && currentChat.id) {                     
       398 +      try {                                                  
       399 +        await fetch(`/api/chats/${currentChat.id}`, {        
       400 +          method: 'PUT',                                     
       401 +          headers: {                                         
       402 +            'Content-Type': 'application/json',              
       403 +            'Authorization': `Bearer ${localStorage.getItem('
           +token')}`                                                    
       404 +          },                                                 
       405 +          body: JSON.stringify({ ...chatSettings, model: mode
           +lId })                                                       
       406 +        });                                                  
       407 +      } catch (error) {                                      
       408 +        console.error('Failed to update chat model:', error);
       409 +      }                                                      
       410 +    } else if (currentChat && !currentChat.id) {             
       411 +      // If it's a new chat without an ID, just update local 
           +state                                                        
       412 +      setCurrentChat({ ...currentChat, model: modelId });    
       413 +    }                                                        
       414 +  };                                                         
       415 +                                                             
       416 +  const deleteChat = async (chatId) => {                     
       417 +    try {                                                    
       418 +      await fetch(`/api/chats/${chatId}`, {                  
       419 +        method: 'DELETE',                                    
       420 +        headers: { 'Authorization': `Bearer ${localStorage.ge
           +tItem('token')}` }                                           
       421 +      });                                                    
       422 +      setChats(chats.filter(c => c.id !== chatId));          
       423 +      if (currentChat?.id === chatId) {                      
       424 +        // Automatically open a new chat instead of leaving b
           +lank                                                         
       425 +        setMessages([]);                                     
       426 +        createNewChat();                                     
       427 +      }                                                      
       428 +      setDeletingChatId(null);                               
       429 +    } catch (error) {                                        
       430 +      console.error('Failed to delete chat:', error);        
       431 +    }                                                        
       432 +  };                                                         
       433 +                                                             
       434 +  const openForkModal = (messageId) => {                     
       435 +    setForkMessageId(messageId);                             
       436 +    setForkModel(chatSettings.model);                        
       437 +    setShowForkModal(true);                                  
       438 +  };                                                         
       439 +                                                             
       440 +  const forkChat = async () => {                             
       441 +    if (!currentChat || !forkMessageId) return;              
       442 +                                                             
       443 +    try {                                                    
       444 +      const res = await fetch(`/api/chats/${currentChat.id}/f
           +ork`, {                                                      
       445 +        method: 'POST',                                      
       446 +        headers: {                                           
       447 +          'Content-Type': 'application/json',                
       448 +          'Authorization': `Bearer ${localStorage.getItem('to
           +ken')}`                                                      
       449 +        },                                                   
       450 +        body: JSON.stringify({                               
       451 +          message_id: forkMessageId,                         
       452 +          model: forkModel                                   
       453 +        })                                                   
       454 +      });                                                    
       455 +      const data = await res.json();                         
       456 +      setChats([data, ...chats]);                            
       457 +      setCurrentChat(data);                                  
       458 +      setShowForkModal(false);                               
       459 +      setForkMessageId(null);                                
       460 +                                                             
       461 +      // Save the fork model as last used                    
       462 +      localStorage.setItem(LAST_MODEL_KEY, forkModel);       
       463 +    } catch (error) {                                        
       464 +      console.error('Failed to fork chat:', error);          
       465 +    }                                                        
       466 +  };                                                         
       467 +                                                             
       468 +  const stopGeneration = () => {                             
       469 +    if (abortControllerRef.current) {                        
       470 +      abortControllerRef.current.abort();                    
       471 +      setStreaming(false);                                   
       472 +    }                                                        
       473 +  };                                                         
       474 +                                                             
       475 +  const sendMessage = async (e) => {                         
       476 +    e.preventDefault();                                      
       477 +    if (!inputMessage.trim() || !currentChat || streaming) re
           +turn;                                                        
       478 +                                                             
       479 +    const userMessage = inputMessage.trim();                 
       480 +    setInputMessage('');                                     
       481 +    // Reset textarea height                                 
       482 +    if (textareaRef.current) {                               
       483 +      textareaRef.current.style.height = '52px';             
       484 +    }                                                        
       485 +    setStreaming(true);                                      
       486 +    setStreamingMessage('');                                 
       487 +    setStreamingReasoning('');                               
       488 +                                                             
       489 +    abortControllerRef.current = new AbortController();      
       490 +                                                             
       491 +    // Add user message to UI immediately                    
       492 +    const tempUserMessage = {                                
       493 +      id: Date.now(),                                        
       494 +      role: 'user',                                          
       495 +      content: userMessage,                                  
       496 +      created_at: new Date().toISOString()                   
       497 +    };                                                       
       498 +    setMessages(prev => [...prev, tempUserMessage]);         
       499 +                                                             
       500 +    try {                                                    
       501 +      // If this is a new chat without an ID, create it first
       502 +      let chatId = currentChat.id;                           
       503 +      if (!chatId) {                                         
       504 +        isCreatingChatRef.current = true;                    
       505 +        const createRes = await fetch('/api/chats', {        
       506 +          method: 'POST',                                    
       507 +          headers: {                                         
       508 +            'Content-Type': 'application/json',              
       509 +            'Authorization': `Bearer ${localStorage.getItem('
           +token')}`                                                    
       510 +          },                                                 
       511 +          body: JSON.stringify({                             
       512 +            title: 'New Chat',                               
       513 +            model: chatSettings.model,                       
       514 +            temperature: chatSettings.temperature,           
       515 +            system_prompt: chatSettings.system_prompt,       
       516 +            agent_mode: chatSettings.agent_mode              
       517 +          })                                                 
       518 +        });                                                  
       519 +        const newChat = await createRes.json();              
       520 +        chatId = newChat.id;                                 
       521 +        setCurrentChat(newChat);                             
       522 +        setChats(prev => [newChat, ...prev]);                
       523 +      }                                                      
       524 +                                                             
       525 +      const res = await fetch(`/api/messages/${chatId}`, {   
       526 +        method: 'POST',                                      
       527 +        headers: {                                           
       528 +          'Content-Type': 'application/json',                
       529 +          'Authorization': `Bearer ${localStorage.getItem('to
           +ken')}`                                                      
       530 +        },                                                   
       531 +        body: JSON.stringify({ content: userMessage }),      
       532 +        signal: abortControllerRef.current.signal            
       533 +      });                                                    
       534 +                                                             
       535 +      if (!res.ok) {                                         
       536 +        const errorData = await res.json();                  
       537 +        throw new Error(errorData.error || 'Failed to send me
           +ssage');                                                     
       538 +      }                                                      
       539 +                                                             
       540 +      const reader = res.body.getReader();                   
       541 +      const decoder = new TextDecoder();                     
       542 +      let buffer = '';                                       
       543 +                                                             
       544 +      while (true) {                                         
       545 +        const { done, value } = await reader.read();         
       546 +        if (done) break;                                     
       547 +                                                             
       548 +        buffer += decoder.decode(value, { stream: true });   
       549 +        const lines = buffer.split('\n');                    
       550 +        buffer = lines.pop();                                
       551 +                                                             
       552 +        for (const line of lines) {                          
       553 +          if (line.startsWith('data: ')) {                   
       554 +            try {                                            
       555 +              const data = JSON.parse(line.slice(6));        
       556 +                                                             
       557 +              if (data.type === 'reasoning') {               
       558 +                setStreamingReasoning(prev => prev + data.con
           +tent);                                                       
       559 +              } else if (data.type === 'content') {          
       560 +                setStreamingMessage(prev => prev + data.conte
           +nt);                                                         
       561 +              } else if (data.type === 'done') {             
       562 +                // Calculate thinking duration               
       563 +                const thinkingDuration = thinkingStartTime ? 
           +(Date.now() - thinkingStartTime) / 1000 : 0;                 
       564 +                                                             
       565 +                // Capture usage data if provided            
       566 +                if (data.usage) {                            
       567 +                  const stats = {                            
       568 +                    promptTokens: data.usage.prompt_tokens ||
           + 0,                                                          
       569 +                    completionTokens: data.usage.completion_t
           +okens || 0,                                                  
       570 +                    totalTokens: data.usage.total_tokens || 0
           +,                                                            
       571 +                    model: data.model,                       
       572 +                    duration: thinkingDuration,              
       573 +                    cost: data.cost || 0                     
       574 +                  };                                         
       575 +                  setLastThinkingStats(stats);               
       576 +                  setUsageStats(prev => ({                   
       577 +                    ...prev,                                 
       578 +                    lastMessage: stats,                      
       579 +                    totalPromptTokens: (prev?.totalPromptToke
           +ns || 0) + (data.usage.prompt_tokens || 0),                  
       580 +                    totalCompletionTokens: (prev?.totalComple
           +tionTokens || 0) + (data.usage.completion_tokens || 0),      
       581 +                    totalTokens: (prev?.totalTokens || 0) + (
           +data.usage.total_tokens || 0),                               
       582 +                    messageCount: (prev?.messageCount || 0) +
           + 1                                                           
       583 +                  }));                                       
       584 +                } else {                                     
       585 +                  // No usage data, but we still have duratio
           +n                                                            
       586 +                  setLastThinkingStats({ duration: thinkingDu
           +ration, totalTokens: 0 });                                   
       587 +                }                                            
       588 +                // Don't clear streaming states immediately -
           + let loadMessages handle it                                  
       589 +                // This prevents the thinking section from di
           +sappearing before the message is added                       
       590 +                loadMessages(chatId);                        
       591 +                loadChats();                                 
       592 +                // Clear streaming states after a short delay
           + to ensure smooth transition                                 
       593 +                setTimeout(() => {                           
       594 +                  setStreamingMessage('');                   
       595 +                  setStreamingReasoning('');                 
       596 +                }, 100);                                     
       597 +              } else if (data.type === 'error') {            
       598 +                alert('Error: ' + data.error);               
       599 +              }                                              
       600 +            } catch (e) {                                    
       601 +              console.error('Failed to parse SSE data:', e); 
       602 +            }                                                
       603 +          }                                                  
       604 +        }                                                    
       605 +      }                                                      
       606 +    } catch (error) {                                        
       607 +      if (error.name === 'AbortError') {                     
       608 +        console.log('Generation aborted');                   
       609 +      } else {                                               
       610 +        console.error('Failed to send message:', error);     
       611 +        alert(error.message || 'Failed to send message. Pleas
           +e check your API key configuration.');                       
       612 +      }                                                      
       613 +    } finally {                                              
       614 +      setStreaming(false);                                   
       615 +      abortControllerRef.current = null;                     
       616 +      isCreatingChatRef.current = false;                     
       617 +    }                                                        
       618 +  };                                                         
       619 +                                                             
       620 +  const renderMessage = (content) => {                       
       621 +    const html = DOMPurify.sanitize(marked(content || ''));  
       622 +    return <div className="markdown-content" dangerouslySetIn
           +nerHTML={{ __html: html }} />;                               
       623 +  };                                                         
       624 +                                                             
       625 +  const stripMarkdown = (text) => {                          
       626 +    if (!text) return '';                                    
       627 +    return text                                              
       628 +      .replace(/#{1,6}\s?/g, '')           // headers        
       629 +      .replace(/\*\*(.+?)\*\*/g, '$1')     // bold           
       630 +      .replace(/\*(.+?)\*/g, '$1')         // italic         
       631 +      .replace(/__(.+?)__/g, '$1')         // bold alt       
       632 +      .replace(/_(.+?)_/g, '$1')           // italic alt     
       633 +      .replace(/`{3}[\s\S]*?`{3}/g, '')    // code blocks    
       634 +      .replace(/`(.+?)`/g, '$1')           // inline code    
       635 +      .replace(/\[(.+?)\]\(.+?\)/g, '$1')  // links          
       636 +      .replace(/!\[.*?\]\(.+?\)/g, '')     // images         
       637 +      .replace(/^\s*[-*+]\s/gm, '')        // unordered lists
       638 +      .replace(/^\s*\d+\.\s/gm, '')        // ordered lists  
       639 +      .replace(/>\s?/g, '')                // blockquotes    
       640 +      .replace(/---/g, '')                 // horizontal rule
           +s                                                            
       641 +      .trim();                                               
       642 +  };                                                         
       643 +                                                             
       644 +  const handleCopy = async (messageId, content, type) => {   
       645 +    const textToCopy = type === 'raw' ? stripMarkdown(content
           +) : content;                                                 
       646 +    await navigator.clipboard.writeText(textToCopy);         
       647 +    setCopiedMessageId(`${messageId}-${type}`);              
       648 +    setTimeout(() => setCopiedMessageId(null), 2000);        
       649 +  };                                                         
       650 +                                                             
       651 +  const handleEditStart = (message) => {                     
       652 +    setEditingMessageId(message.id);                         
       653 +    setEditContent(message.content);                         
       654 +  };                                                         
       655 +                                                             
       656 +  const handleEditCancel = () => {                           
       657 +    setEditingMessageId(null);                               
       658 +    setEditContent('');                                      
       659 +  };                                                         
       660 +                                                             
       661 +  const handleEditSave = async (messageId) => {              
       662 +    if (!editContent.trim() || !currentChat) return;         
       663 +                                                             
       664 +    try {                                                    
       665 +      // 1. Delete branch from this message onward           
       666 +      const res = await fetch(`/api/messages/${messageId}/bra
           +nch`, {                                                      
       667 +        method: 'DELETE',                                    
       668 +        headers: {                                           
       669 +          'Authorization': `Bearer ${localStorage.getItem('to
           +ken')}`                                                      
       670 +        }                                                    
       671 +      });                                                    
       672 +                                                             
       673 +      if (!res.ok) throw new Error('Failed to delete message 
           +branch');                                                    
       674 +                                                             
       675 +      // 2. Trigger new message with edited content          
       676 +      // We manually call sendMessage implementation         
       677 +      const userMessage = editContent.trim();                
       678 +      setEditingMessageId(null);                             
       679 +      setEditContent('');                                    
       680 +      setStreaming(true);                                    
       681 +      setStreamingMessage('');                               
       682 +      setStreamingReasoning('');                             
       683 +      abortControllerRef.current = new AbortController();    
       684 +                                                             
       685 +      // Update UI: load messages again to show the deletion 
       686 +      await loadMessages(currentChat.id);                    
       687 +                                                             
       688 +      // Add temporary user message to UI for responsiveness 
       689 +      const tempUserMessage = {                              
       690 +        id: Date.now(),                                      
       691 +        role: 'user',                                        
       692 +        content: userMessage,                                
       693 +        created_at: new Date().toISOString()                 
       694 +      };                                                     
       695 +      setMessages(prev => [...prev, tempUserMessage]);       
       696 +                                                             
       697 +      // Trigger the API call to start regeneration          
       698 +      const sendRes = await fetch(`/api/messages/${currentCha
           +t.id}`, {                                                    
       699 +        method: 'POST',                                      
       700 +        headers: {                                           
       701 +          'Content-Type': 'application/json',                
       702 +          'Authorization': `Bearer ${localStorage.getItem('to
           +ken')}`                                                      
       703 +        },                                                   
       704 +        body: JSON.stringify({ content: userMessage }),      
       705 +        signal: abortControllerRef.current.signal            
       706 +      });                                                    
       707 +                                                             
       708 +      if (!sendRes.ok) {                                     
       709 +        const errorData = await sendRes.json();              
       710 +        throw new Error(errorData.error || 'Failed to send me
           +ssage');                                                     
       711 +      }                                                      
       712 +                                                             
       713 +      const reader = sendRes.body.getReader();               
       714 +      const decoder = new TextDecoder();                     
       715 +      let buffer = '';                                       
       716 +                                                             
       717 +      while (true) {                                         
       718 +        const { done, value } = await reader.read();         
       719 +        if (done) break;                                     
       720 +                                                             
       721 +        buffer += decoder.decode(value, { stream: true });   
       722 +        const lines = buffer.split('\n');                    
       723 +        buffer = lines.pop();                                
       724 +                                                             
       725 +        for (const line of lines) {                          
       726 +          if (line.startsWith('data: ')) {                   
       727 +            try {                                            
       728 +              const data = JSON.parse(line.slice(6));        
       729 +              if (data.type === 'reasoning') {               
       730 +                setStreamingReasoning(prev => prev + data.con
           +tent);                                                       
       731 +              } else if (data.type === 'content') {          
       732 +                setStreamingMessage(prev => prev + data.conte
           +nt);                                                         
       733 +              } else if (data.type === 'done') {             
       734 +                // Calculate thinking duration               
       735 +                const thinkingDuration = thinkingStartTime ? 
           +(Date.now() - thinkingStartTime) / 1000 : 0;                 
       736 +                                                             
       737 +                if (data.usage) {                            
       738 +                  const stats = {                            
       739 +                    promptTokens: data.usage.prompt_tokens ||
           + 0,                                                          
       740 +                    completionTokens: data.usage.completion_t
           +okens || 0,                                                  
       741 +                    totalTokens: data.usage.total_tokens || 0
           +,                                                            
       742 +                    model: data.model,                       
       743 +                    duration: thinkingDuration,              
       744 +                    cost: data.cost || 0                     
       745 +                  };                                         
       746 +                  setLastThinkingStats(stats);               
       747 +                  setUsageStats(prev => ({                   
       748 +                    ...prev,                                 
       749 +                    lastMessage: stats,                      
       750 +                    totalPromptTokens: (prev?.totalPromptToke
           +ns || 0) + (data.usage.prompt_tokens || 0),                  
       751 +                    totalCompletionTokens: (prev?.totalComple
           +tionTokens || 0) + (data.usage.completion_tokens || 0),      
       752 +                    totalTokens: (prev?.totalTokens || 0) + (
           +data.usage.total_tokens || 0),                               
       753 +                    messageCount: (prev?.messageCount || 0) +
           + 1                                                           
       754 +                  }));                                       
       755 +                } else {                                     
       756 +                  setLastThinkingStats({ duration: thinkingDu
           +ration, totalTokens: 0 });                                   
       757 +                }                                            
       758 +                loadMessages(currentChat.id);                
       759 +                loadChats();                                 
       760 +                setTimeout(() => {                           
       761 +                  setStreamingMessage('');                   
       762 +                  setStreamingReasoning('');                 
       763 +                }, 100);                                     
       764 +              } else if (data.type === 'error') {            
       765 +                alert('Error: ' + data.error);               
       766 +              }                                              
       767 +            } catch (e) {                                    
       768 +              console.error('Failed to parse SSE data:', e); 
       769 +            }                                                
       770 +          }                                                  
       771 +        }                                                    
       772 +      }                                                      
       773 +    } catch (error) {                                        
       774 +      if (error.name === 'AbortError') {                     
       775 +        console.log('Generation aborted');                   
       776 +      } else {                                               
       777 +        console.error('Failed to edit message:', error);     
       778 +        alert('Failed to edit message: ' + error.message);   
       779 +      }                                                      
       780 +      setStreaming(false);                                   
       781 +    }                                                        
       782 +  };                                                         
       783 +                                                             
       784 +  return (                                                   
       785 +    <div className="flex h-screen bg-dark-950 bg-mesh">      
       786 +      {/* Sidebar */}                                        
       787 +      <div className={`${showSidebar ? 'w-72' : 'w-16'} trans
           +ition-all duration-300 ease-out glass-sidebar flex flex-col o
           +verflow-hidden`}>                                            
       788 +        <div className={`${showSidebar ? 'p-5' : 'p-2'} borde
           +r-b border-dark-700/50`}>                                    
       789 +          <div className={`flex items-center ${showSidebar ? 
           +'justify-between mb-5' : 'justify-center mb-2'}`}>           
       790 +            {showSidebar ? (                                 
       791 +              <>                                             
       792 +                <div className="flex items-center gap-3">    
       793 +                  <div className="relative">                 
       794 +                    <div className="w-10 h-10 rounded-xl bg-p
           +rimary-500 flex items-center justify-center">                
       795 +                      <MessageSquare className="w-5 h-5 text-
           +white" />                                                    
       796 +                    </div>                                   
       797 +                    <div className="absolute -bottom-0.5 -rig
           +ht-0.5 w-3 h-3 bg-green-500 rounded-full border-2 border-dark
           +-850"></div>                                                 
       798 +                  </div>                                     
       799 +                  <div>                                      
       800 +                    <h1 className="font-bold text-lg text-pri
           +mary-400 tracking-tight">AI Chat Hub</h1>                    
       801 +                    <p className="text-xs text-dark-400 font-
           +medium">{user?.name}</p>                                     
       802 +                  </div>                                     
       803 +                </div>                                       
       804 +                <button                                      
       805 +                  onClick={() => setShowSidebar(false)}      
       806 +                  className="p-2 hover:bg-dark-700/50 rounded
           +-xl transition-all duration-200"                             
       807 +                  title="Collapse sidebar"                   
       808 +                >                                            
       809 +                  <ChevronRight className="w-5 h-5 text-dark-
           +400" />                                                      
       810 +                </button>                                    
       811 +              </>                                            
       812 +            ) : (                                            
       813 +              <button                                        
       814 +                onClick={() => setShowSidebar(true)}         
       815 +                className="p-2 hover:bg-dark-700/50 rounded-x
           +l transition-all duration-200"                               
       816 +                title="Expand sidebar"                       
       817 +              >                                              
       818 +                <Menu className="w-5 h-5 text-dark-400" />   
       819 +              </button>                                      
       820 +            )}                                               
       821 +          </div>                                             
       822 +                                                             
       823 +          <button                                            
       824 +            onClick={createNewChat}                          
       825 +            className={`${showSidebar ? 'w-full py-3 gap-2' :
           + 'w-10 h-10 mx-auto'} bg-primary-500 hover:bg-primary-600 tex
           +t-white rounded-xl font-semibold transition-all duration-200 
           +flex items-center justify-center active:scale-[0.98]`}       
       826 +            title={showSidebar ? undefined : "New Chat"}     
       827 +          >                                                  
       828 +            <Plus className="w-4 h-4" />                     
       829 +            {showSidebar && "New Chat"}                      
       830 +          </button>                                          
       831 +        </div>                                               
       832 +                                                             
       833 +        <div className={`flex-1 overflow-y-auto ${showSidebar
           + ? 'p-3 space-y-1' : 'p-2 space-y-1'}`}>                     
       834 +          {chats.length === 0 && showSidebar && (            
       835 +            <div className="text-center py-8 px-4">          
       836 +              <div className="w-12 h-12 rounded-xl bg-dark-80
           +0 flex items-center justify-center mx-auto mb-3">            
       837 +                <MessageSquare className="w-6 h-6 text-dark-5
           +00" />                                                       
       838 +              </div>                                         
       839 +              <p className="text-sm text-dark-400">No chats y
           +et</p>                                                       
       840 +              <p className="text-xs text-dark-500 mt-1">Creat
           +e a new chat to get started</p>                              
       841 +            </div>                                           
       842 +          )}                                                 
       843 +          {chats.map(chat => (                               
       844 +            <div                                             
       845 +              key={chat.id}                                  
       846 +              className={`group ${showSidebar ? 'p-3' : 'p-2'
           +} rounded-xl cursor-pointer transition-all duration-200 ${cur
           +rentChat?.id === chat.id                                     
       847 +                ? 'bg-dark-700 border-l-2 border-primary-500'
       848 +                : 'hover:bg-dark-700/50 border-l-2 border-tra
           +nsparent'                                                    
       849 +                }`}                                          
       850 +              onClick={() => setCurrentChat(chat)}           
       851 +              title={showSidebar ? undefined : chat.title}   
       852 +            >                                                
       853 +              {showSidebar ? (                               
       854 +                <div className="flex items-start justify-betw
           +een gap-2">                                                  
       855 +                  <div className="flex-1 min-w-0">           
       856 +                    <p className={`font-medium text-sm trunca
           +te ${currentChat?.id === chat.id ? 'text-dark-50' : 'text-dar
           +k-200'}`}>{chat.title}</p>                                   
       857 +                    <div className="flex items-center gap-2 m
           +t-1.5">                                                      
       858 +                      <span className="text-xs text-dark-500"
           +>{chat.message_count} messages</span>                        
       859 +                      {chat.agent_mode === 1 && (            
       860 +                        <span className="inline-flex items-ce
           +nter gap-1 px-1.5 py-0.5 rounded-md bg-primary-500/10 text-pr
           +imary-400 text-[10px] font-medium">                          
       861 +                          <Zap className="w-2.5 h-2.5" />    
       862 +                          Agent                              
       863 +                        </span>                              
       864 +                      )}                                     
       865 +                    </div>                                   
       866 +                  </div>                                     
       867 +                                                             
       868 +                  <div className="flex items-center gap-1">  
       869 +                    {deletingChatId === chat.id ? (          
       870 +                      <>                                     
       871 +                        <button                              
       872 +                          onClick={(e) => {                  
       873 +                            e.stopPropagation();             
       874 +                            deleteChat(chat.id);             
       875 +                          }}                                 
       876 +                          className="p-1.5 bg-green-500/10 ho
           +ver:bg-green-500/20 rounded-lg transition-all"               
       877 +                          title="Confirm Delete"             
       878 +                        >                                    
       879 +                          <Check className="w-3.5 h-3.5 text-
           +green-400" />                                                
       880 +                        </button>                            
       881 +                        <button                              
       882 +                          onClick={(e) => {                  
       883 +                            e.stopPropagation();             
       884 +                            setDeletingChatId(null);         
       885 +                          }}                                 
       886 +                          className="p-1.5 bg-red-500/10 hove
           +r:bg-red-500/20 rounded-lg transition-all"                   
       887 +                          title="Cancel"                     
       888 +                        >                                    
       889 +                          <X className="w-3.5 h-3.5 text-red-
           +400" />                                                      
       890 +                        </button>                            
       891 +                      </>                                    
       892 +                    ) : (                                    
       893 +                      <button                                
       894 +                        onClick={(e) => {                    
       895 +                          e.stopPropagation();               
       896 +                          setDeletingChatId(chat.id);        
       897 +                        }}                                   
       898 +                        className="opacity-0 group-hover:opac
           +ity-100 p-1.5 hover:bg-red-500/10 rounded-lg transition-all" 
       899 +                        title="Delete Chat"                  
       900 +                      >                                      
       901 +                        <Trash2 className="w-3.5 h-3.5 text-d
           +ark-400 hover:text-red-400" />                               
       902 +                      </button>                              
       903 +                    )}                                       
       904 +                  </div>                                     
       905 +                </div>                                       
       906 +              ) : (                                          
       907 +                <div className="flex justify-center">        
       908 +                  <MessageSquare className={`w-5 h-5 ${curren
           +tChat?.id === chat.id ? 'text-primary-400' : 'text-dark-400'}
           +`} />                                                        
       909 +                </div>                                       
       910 +              )}                                             
       911 +            </div>                                           
       912 +          ))}                                                
       913 +        </div>                                               
       914 +                                                             
       915 +        <div className={`${showSidebar ? 'p-3' : 'p-2'} borde
           +r-t border-dark-700/50 space-y-1`}>                          
       916 +          <button                                            
       917 +            onClick={() => navigate('/memories')}            
       918 +            className={`${showSidebar ? 'w-full px-4 gap-3' :
           + 'w-10 h-10 mx-auto'} flex items-center justify-center py-2.5
           + rounded-xl glass-button transition-all text-sm font-medium t
           +ext-dark-300 hover:text-dark-100`}                           
       919 +            title={showSidebar ? undefined : "Memories"}     
       920 +          >                                                  
       921 +            <Brain className="w-4 h-4 text-accent-400" />    
       922 +            {showSidebar && "Memories"}                      
       923 +          </button>                                          
       924 +          <button                                            
       925 +            onClick={() => navigate('/settings')}            
       926 +            className={`${showSidebar ? 'w-full px-4 gap-3' :
           + 'w-10 h-10 mx-auto'} flex items-center justify-center py-2.5
           + rounded-xl glass-button transition-all text-sm font-medium t
           +ext-dark-300 hover:text-dark-100`}                           
       927 +            title={showSidebar ? undefined : "Settings"}     
       928 +          >                                                  
       929 +            <SettingsIcon className="w-4 h-4 text-dark-400" /
           +>                                                            
       930 +            {showSidebar && "Settings"}                      
       931 +          </button>                                          
       932 +          {user?.is_admin && (                               
       933 +            <button                                          
       934 +              onClick={() => navigate('/admin')}             
       935 +              className={`${showSidebar ? 'w-full px-4 gap-3'
           + : 'w-10 h-10 mx-auto'} flex items-center justify-center py-2
           +.5 rounded-xl glass-button transition-all text-sm font-medium
           + text-primary-400 hover:text-primary-300`}                   
       936 +              title={showSidebar ? undefined : "Admin Panel"}
       937 +            >                                                
       938 +              <Sparkles className="w-4 h-4" />               
       939 +              {showSidebar && "Admin Panel"}                 
       940 +            </button>                                        
       941 +          )}                                                 
       942 +          {showSidebar && <div className="divider-gradient my
           +-2"></div>}                                                  
       943 +          <button                                            
       944 +            onClick={logout}                                 
       945 +            className={`${showSidebar ? 'w-full px-4 gap-3' :
           + 'w-10 h-10 mx-auto'} flex items-center justify-center py-2.5
           + rounded-xl hover:bg-red-500/10 transition-all text-sm font-m
           +edium text-dark-400 hover:text-red-400`}                     
       946 +            title={showSidebar ? undefined : "Logout"}       
       947 +          >                                                  
       948 +            <LogOut className="w-4 h-4" />                   
       949 +            {showSidebar && "Logout"}                        
       950 +          </button>                                          
       951 +        </div>                                               
       952 +      </div>                                                 
       953 +                                                             
       954 +      {/* Main Chat Area */}                                 
       955 +      <div className="flex-1 flex flex-col min-w-0">         
       956 +        {/* Header */}                                       
       957 +        <div className="bg-dark-850 border-b border-dark-700/
           +50 px-4 py-3 flex items-center justify-between relative z-50 
           +overflow-visible">                                           
       958 +          <div className="flex items-center gap-3">          
       959 +            {/* Chat Title and Model Selector */}            
       960 +            {currentChat ? (                                 
       961 +              <>                                             
       962 +                <h2 className="text-base font-semibold text-d
           +ark-100">{currentChat.title}</h2>                            
       963 +                <div className="h-4 w-px bg-dark-700"></div> 
       964 +                <ModelSelector                               
       965 +                  selectedModel={chatSettings.model}         
       966 +                  onModelChange={handleModelChange}          
       967 +                  isDropdown={true}                          
       968 +                />                                           
       969 +                {chatSettings.agent_mode && (                
       970 +                  <span className="flex items-center gap-1.5 
           +px-3 py-1.5 bg-primary-500/10 text-primary-400 rounded-lg tex
           +t-xs font-semibold border border-primary-500/20">            
       971 +                    <Zap className="w-3 h-3" />              
       972 +                    Agent Mode                               
       973 +                  </span>                                    
       974 +                )}                                           
       975 +              </>                                            
       976 +            ) : (                                            
       977 +              <p className="text-dark-500 text-sm">Select a c
           +hat or create a new one</p>                                  
       978 +            )}                                               
       979 +          </div>                                             
       980 +                                                             
       981 +          {currentChat && (                                  
       982 +            <div className="flex items-center gap-2 overflow-
           +visible">                                                    
       983 +              <div className="relative overflow-visible" ref=
           +{statsPopupRef}>                                             
       984 +                <button                                      
       985 +                  onClick={() => setShowInfoModal(!showInfoMo
           +dal)}                                                        
       986 +                  className={`p-2 rounded-xl transition-all d
           +uration-200 ${showInfoModal                                  
       987 +                    ? 'bg-primary-500/10 text-primary-400 bor
           +der border-primary-500/20'                                   
       988 +                    : 'glass-button text-dark-400 hover:text-
           +dark-200'                                                    
       989 +                    }`}                                      
       990 +                  title="Usage Stats"                        
       991 +                >                                            
       992 +                  <Info className="w-4 h-4" />               
       993 +                </button>                                    
       994 +                                                             
       995 +                {/* Usage Stats Panel */}                    
       996 +                {showInfoModal && (                          
       997 +                  <div className="fixed top-14 right-4 w-80 b
           +g-dark-900 border border-dark-700 rounded-xl z-[100] shadow-2
           +xl scale-in">                                                
       998 +                    <div className="p-3 border-b border-dark-
           +700">                                                        
       999 +                      <h4 className="text-sm font-semibold te
           +xt-dark-200 flex items-center gap-2">                        
      1000 +                        <Hash className="w-3.5 h-3.5 text-pri
           +mary-400" />                                                 
      1001 +                        Chat Stats                           
      1002 +                      </h4>                                  
      1003 +                    </div>                                   
      1004 +                                                             
      1005 +                    <div className="p-3 space-y-3">          
      1006 +                      {/* Current Model */}                  
      1007 +                      <div className="p-2 rounded-lg bg-dark-
           +800">                                                        
      1008 +                        <p className="text-dark-500 text-xs m
           +b-1">Current Model</p>                                       
      1009 +                        <p className="text-sm font-medium tex
           +t-dark-200 truncate">{chatSettings.model}</p>                
      1010 +                      </div>                                 
      1011 +                                                             
      1012 +                      {/* Conversation Stats */}             
      1013 +                      <div className="grid grid-cols-2 gap-2 
           +text-xs">                                                    
      1014 +                        <div className="p-2 rounded-lg bg-dar
           +k-800">                                                      
      1015 +                          <p className="text-dark-500">Messag
           +es</p>                                                       
      1016 +                          <p className="text-sm font-semibold
           + text-dark-200">{messages.length}</p>                        
      1017 +                        </div>                               
      1018 +                        <div className="p-2 rounded-lg bg-dar
           +k-800">                                                      
      1019 +                          <p className="text-dark-500">AI Res
           +ponses</p>                                                   
      1020 +                          <p className="text-sm font-semibold
           + text-primary-400">{messages.filter(m => m.role === 'assistan
           +t').length}</p>                                              
      1021 +                        </div>                               
      1022 +                      </div>                                 
      1023 +                                                             
      1024 +                      {/* Token Usage - from persisted data *
           +/}                                                           
      1025 +                      {chatTotals.totalTokens > 0 && (       
      1026 +                        <div className="border-t border-dark-
           +700 pt-3">                                                   
      1027 +                          <p className="text-dark-500 text-xs
           + mb-2">Chat Token Usage</p>                                  
      1028 +                          <div className="space-y-1.5 text-xs
           +">                                                           
      1029 +                            <div className="flex justify-betw
           +een">                                                        
      1030 +                              <span className="text-dark-400"
           +>Total Cost</span>                                           
      1031 +                              <span className="font-semibold 
           +text-primary-400">                                           
      1032 +                                ${chatTotals.totalCost.toFixe
           +d(2)}                                                        
      1033 +                              </span>                        
      1034 +                            </div>                           
      1035 +                          </div>                             
      1036 +                                                             
      1037 +                          {/* Token Bar with USED/CONTEXT lab
           +el */}                                                       
      1038 +                          {(() => {                          
      1039 +                            const contextLimit = getModelCont
           +ext(chatSettings.model);                                     
      1040 +                            const inputPercent = (chatTotals.
           +totalPromptTokens / contextLimit) * 100;                     
      1041 +                            const outputPercent = (chatTotals
           +.totalCompletionTokens / contextLimit) * 100;                
      1042 +                            const freePercent = Math.max(0, 1
           +00 - inputPercent - outputPercent);                          
      1043 +                            return (                         
      1044 +                              <>                             
      1045 +                                <div className="flex justify-
           +between mt-3 mb-1 text-xs">                                  
      1046 +                                  <span className="text-dark-
           +400">Tokens Used</span>                                      
      1047 +                                  <span className="font-mediu
           +m text-dark-200">                                            
      1048 +                                    {chatTotals.totalTokens.t
           +oLocaleString()}                                             
      1049 +                                    <span className="text-dar
           +k-500"> / {contextLimit.toLocaleString()}</span>             
      1050 +                                  </span>                    
      1051 +                                </div>                       
      1052 +                                <div className="h-2 bg-dark-7
           +00 rounded-full overflow-hidden flex">                       
      1053 +                                  <div                       
      1054 +                                    className="h-full bg-prim
           +ary-500"                                                     
      1055 +                                    style={{ width: `${inputP
           +ercent}%` }}                                                 
      1056 +                                    title={`Input: ${chatTota
           +ls.totalPromptTokens.toLocaleString()}`}                     
      1057 +                                  />                         
      1058 +                                  <div                       
      1059 +                                    className="h-full bg-acce
           +nt-500"                                                      
      1060 +                                    style={{ width: `${output
           +Percent}%` }}                                                
      1061 +                                    title={`Output: ${chatTot
           +als.totalCompletionTokens.toLocaleString()}`}                
      1062 +                                  />                         
      1063 +                                  <div                       
      1064 +                                    className="h-full bg-dark
           +-600"                                                        
      1065 +                                    style={{ width: `${freePe
           +rcent}%` }}                                                  
      1066 +                                    title={`Free: ${(contextL
           +imit - chatTotals.totalTokens).toLocaleString()}`}           
      1067 +                                  />                         
      1068 +                                </div>                       
      1069 +                                <div className="flex justify-
           +between mt-1 text-[10px] text-dark-500">                     
      1070 +                                  <div className="flex items-
           +center gap-2">                                               
      1071 +                                    <span className="flex ite
           +ms-center gap-1">                                            
      1072 +                                      <span className="w-2 h-
           +2 rounded-full bg-primary-500"></span>                       
      1073 +                                      Input ({chatTotals.tota
           +lPromptTokens.toLocaleString()})                             
      1074 +                                    </span>                  
      1075 +                                    <span className="flex ite
           +ms-center gap-1">                                            
      1076 +                                      <span className="w-2 h-
           +2 rounded-full bg-accent-500"></span>                        
      1077 +                                      Output ({chatTotals.tot
           +alCompletionTokens.toLocaleString()})                        
      1078 +                                    </span>                  
      1079 +                                  </div>                     
      1080 +                                  <span className="flex items
           +-center gap-1">                                              
      1081 +                                    <span className="w-2 h-2 
           +rounded-full bg-dark-600"></span>                            
      1082 +                                    Free                     
      1083 +                                  </span>                    
      1084 +                                </div>                       
      1085 +                              </>                            
      1086 +                            );                               
      1087 +                          })()}                              
      1088 +                        </div>                               
      1089 +                      )}                                     
      1090 +                                                             
      1091 +                      {/* No token data message - only show i
           +f no persisted data */}                                      
      1092 +                      {chatTotals.totalTokens === 0 && messag
           +es.length > 0 && (                                           
      1093 +                        <p className="text-[10px] text-dark-5
           +00 text-center pt-2 border-t border-dark-700">               
      1094 +                          Token usage will appear after sendi
           +ng messages                                                  
      1095 +                        </p>                                 
      1096 +                      )}                                     
      1097 +                    </div>                                   
      1098 +                  </div>                                     
      1099 +                )}                                           
      1100 +              </div>                                         
      1101 +              <button                                        
      1102 +                onClick={() => setShowSettings(!showSettings)
           +}                                                            
      1103 +                className={`px-4 py-2 flex items-center gap-2
           + rounded-xl transition-all duration-200 text-sm font-medium $
           +{showSettings                                                
      1104 +                  ? 'bg-primary-500/10 text-primary-400 borde
           +r border-primary-500/20'                                     
      1105 +                  : 'glass-button text-dark-300 hover:text-da
           +rk-100'                                                      
      1106 +                  }`}                                        
      1107 +              >                                              
      1108 +                <SettingsIcon className="w-4 h-4" />         
      1109 +                Settings                                     
      1110 +              </button>                                      
      1111 +            </div>                                           
      1112 +          )}                                                 
      1113 +        </div>                                               
      1114 +                                                             
      1115 +        {/* Settings Panel */}                               
      1116 +        {showSettings && currentChat && (                    
      1117 +          <div className="bg-dark-850 border-b border-dark-70
           +0/50 p-6 scale-in">                                          
      1118 +            <div className="max-w-2xl mx-auto space-y-5">    
      1119 +              <div className="grid grid-cols-1 md:grid-cols-2
           + gap-5">                                                     
      1120 +                <div>                                        
      1121 +                  <label className="block text-sm font-medium
           + text-dark-300 mb-2">                                        
      1122 +                    Model                                    
      1123 +                  </label>                                   
      1124 +                  <ModelSelector                             
      1125 +                    selectedModel={chatSettings.model}       
      1126 +                    onModelChange={handleModelChange}        
      1127 +                    isDropdown={true}                        
      1128 +                  />                                         
      1129 +                </div>                                       
      1130 +                                                             
      1131 +                <div>                                        
      1132 +                  <label className="block text-sm font-medium
           + text-dark-300 mb-2">                                        
      1133 +                    Temperature                              
      1134 +                    <span className="ml-2 px-2 py-0.5 bg-dark
           +-800 rounded-md text-xs text-primary-400 font-mono">         
      1135 +                      {chatSettings.temperature}             
      1136 +                    </span>                                  
      1137 +                  </label>                                   
      1138 +                  <div className="pt-2">                     
      1139 +                    <input                                   
      1140 +                      type="range"                           
      1141 +                      min="0"                                
      1142 +                      max="2"                                
      1143 +                      step="0.1"                             
      1144 +                      value={chatSettings.temperature}       
      1145 +                      onChange={(e) => setChatSettings({ ...c
           +hatSettings, temperature: parseFloat(e.target.value) })}     
      1146 +                      className="w-full"                     
      1147 +                    />                                       
      1148 +                    <div className="flex justify-between text
           +-xs text-dark-500 mt-1">                                     
      1149 +                      <span>Precise</span>                   
      1150 +                      <span>Creative</span>                  
      1151 +                    </div>                                   
      1152 +                  </div>                                     
      1153 +                </div>                                       
      1154 +              </div>                                         
      1155 +                                                             
      1156 +              <div>                                          
      1157 +                <label className="block text-sm font-medium t
           +ext-dark-300 mb-2">                                          
      1158 +                  System Prompt                              
      1159 +                </label>                                     
      1160 +                <textarea                                    
      1161 +                  value={chatSettings.system_prompt}         
      1162 +                  onChange={(e) => setChatSettings({ ...chatS
           +ettings, system_prompt: e.target.value })}                   
      1163 +                  className="w-full px-4 py-3 rounded-xl glas
           +s-input outline-none resize-none text-dark-100 placeholder-da
           +rk-500 text-sm font-mono"                                    
      1164 +                  rows="3"                                   
      1165 +                  placeholder="Set a custom system prompt for
           + this chat..."                                               
      1166 +                />                                           
      1167 +              </div>                                         
      1168 +                                                             
      1169 +              <div className="flex items-center justify-betwe
           +en pt-2">                                                    
      1170 +                <label className="flex items-center gap-3 cur
           +sor-pointer group">                                          
      1171 +                  <input                                     
      1172 +                    type="checkbox"                          
      1173 +                    checked={chatSettings.agent_mode}        
      1174 +                    onChange={(e) => setChatSettings({ ...cha
           +tSettings, agent_mode: e.target.checked })}                  
      1175 +                    className="w-5 h-5 rounded-md"           
      1176 +                  />                                         
      1177 +                  <span className="text-sm font-medium text-d
           +ark-300 flex items-center gap-2 group-hover:text-dark-200 tra
           +nsition-colors">                                             
      1178 +                    <Zap className="w-4 h-4 text-accent-400" 
           +/>                                                           
      1179 +                    Enable Agent Mode                        
      1180 +                    <span className="text-xs text-dark-500">(
           +with tools)</span>                                           
      1181 +                  </span>                                    
      1182 +                </label>                                     
      1183 +                                                             
      1184 +                <button                                      
      1185 +                  onClick={updateChatSettings}               
      1186 +                  className="px-5 py-2.5 bg-primary-500 hover
           +:bg-primary-600 text-white rounded-xl font-semibold transitio
           +n-all duration-200 active:scale-[0.98]"                      
      1187 +                >                                            
      1188 +                  Save Settings                              
      1189 +                </button>                                    
      1190 +              </div>                                         
      1191 +            </div>                                           
      1192 +          </div>                                             
      1193 +        )}                                                   
      1194 +                                                             
      1195 +        {/* Messages */}                                     
      1196 +        <div                                                 
      1197 +          ref={messagesContainerRef}                         
      1198 +          onScroll={handleMessagesScroll}                    
      1199 +          className="flex-1 overflow-y-auto p-6 relative z-0"
      1200 +        >                                                    
      1201 +          {currentChat && (                                  
      1202 +            <div className="max-w-2xl mx-auto space-y-6">    
      1203 +              {messages.length === 0 && !streaming && (      
      1204 +                <div className="text-center py-16 fade-in">  
      1205 +                  <div className="relative inline-block mb-6"
           +>                                                            
      1206 +                    <div className="w-16 h-16 rounded-2xl bg-
           +primary-500 flex items-center justify-center">               
      1207 +                      <Bot className="w-8 h-8 text-white" /> 
      1208 +                    </div>                                   
      1209 +                  </div>                                     
      1210 +                  <h3 className="text-2xl font-bold text-dark
           +-100 mb-3 tracking-tight">Start a conversation</h3>          
      1211 +                  <p className="text-dark-400 max-w-sm mx-aut
           +o">Type a message below to begin chatting with AI. I'm here t
           +o help with anything you need.</p>                           
      1212 +                </div>                                       
      1213 +              )}                                             
      1214 +                                                             
      1215 +              {messages.map((message, index) => (            
      1216 +                <div                                         
      1217 +                  key={message.id}                           
      1218 +                  className={`${message.role === 'user' ? 'pl
           +-8' : 'pr-8'}`}                                              
      1219 +                >                                            
      1220 +                  {message.role === 'assistant' && message.re
           +asoning_content && (                                         
      1221 +                    <ThinkingSection                         
      1222 +                      reasoning={message.reasoning_content}  
      1223 +                      isExpanded={expandedThinkingSections.ha
           +s(message.id)}                                               
      1224 +                      onToggle={() => toggleThinkingSection(m
           +essage.id)}                                                  
      1225 +                      isStreaming={false}                    
      1226 +                      elapsedTime={0}                        
      1227 +                      stats={null}                           
      1228 +                    />                                       
      1229 +                  )}                                         
      1230 +                  <div className={`${message.role === 'user' 
      1231 +                    ? 'bg-dark-800 border-l-2 border-primary-
           +500/50 rounded-lg px-4 py-3'                                 
      1232 +                    : 'bg-dark-850/50 rounded-lg px-4 py-3'  
      1233 +                    }`}>                                     
      1234 +                    <div className="flex items-center gap-2 m
           +b-2">                                                        
      1235 +                      {message.role === 'user' ? (           
      1236 +                        <>                                   
      1237 +                          <UserIcon className="w-4 h-4 text-p
           +rimary-400" />                                               
      1238 +                          <span className="text-xs font-mediu
           +m text-primary-400">You</span>                               
      1239 +                        </>                                  
      1240 +                      ) : (                                  
      1241 +                        <>                                   
      1242 +                          <Bot className="w-4 h-4 text-dark-4
           +00" />                                                       
      1243 +                          <span className="text-xs font-mediu
           +m text-dark-400">Assistant</span>                            
      1244 +                        </>                                  
      1245 +                      )}                                     
      1246 +                    </div>                                   
      1247 +                    {message.role === 'user' ? (             
      1248 +                      editingMessageId === message.id ? (    
      1249 +                        <div className="space-y-2">          
      1250 +                          <textarea                          
      1251 +                            value={editContent}              
      1252 +                            onChange={(e) => setEditContent(e
           +.target.value)}                                              
      1253 +                            className="w-full bg-dark-900 bor
           +der border-dark-700 rounded-lg p-2 text-white resize-none foc
           +us:outline-none focus:border-primary-500/50"                 
      1254 +                            rows={3}                         
      1255 +                            autoFocus                        
      1256 +                          />                                 
      1257 +                          <div className="flex gap-2 justify-
           +end">                                                        
      1258 +                            <button                          
      1259 +                              onClick={handleEditCancel}     
      1260 +                              className="px-3 py-1 text-xs ro
           +unded-lg bg-dark-700 hover:bg-dark-600 transition-colors"    
      1261 +                            >                                
      1262 +                              Cancel                         
      1263 +                            </button>                        
      1264 +                            <button                          
      1265 +                              onClick={() => handleEditSave(m
           +essage.id)}                                                  
      1266 +                              className="px-3 py-1 text-xs ro
           +unded-lg bg-primary-500 hover:bg-primary-600 transition-color
           +s"                                                           
      1267 +                            >                                
      1268 +                              Save & Regenerate              
      1269 +                            </button>                        
      1270 +                          </div>                             
      1271 +                        </div>                               
      1272 +                      ) : (                                  
      1273 +                        renderMessage(message.content)       
      1274 +                      )                                      
      1275 +                    ) : (                                    
      1276 +                      renderMessage(message.content)         
      1277 +                    )}                                       
      1278 +                  </div>                                     
      1279 +                                                             
      1280 +                  {message.role === 'user' && editingMessageI
           +d !== message.id && (                                        
      1281 +                    <div className="mt-2 flex gap-3 pl-4">   
      1282 +                      <button                                
      1283 +                        onClick={() => handleCopy(message.id,
           + message.content, 'raw')}                                    
      1284 +                        className="text-xs text-dark-500 hove
           +r:text-primary-400 flex items-center gap-1 transition-colors"
      1285 +                      >                                      
      1286 +                        {copiedMessageId === `${message.id}-r
           +aw` ? <Check className="w-3 h-3" /> : <Copy className="w-3 h-
           +3" />}                                                       
      1287 +                        {copiedMessageId === `${message.id}-r
           +aw` ? 'Copied' : 'Copy'}                                     
      1288 +                      </button>                              
      1289 +                      <button                                
      1290 +                        onClick={() => handleEditStart(messag
           +e)}                                                          
      1291 +                        className="text-xs text-dark-500 hove
           +r:text-primary-400 flex items-center gap-1 transition-colors"
      1292 +                      >                                      
      1293 +                        <Pencil className="w-3 h-3" />       
      1294 +                        Edit                                 
      1295 +                      </button>                              
      1296 +                    </div>                                   
      1297 +                  )}                                         
      1298 +                                                             
      1299 +                  {message.role === 'assistant' && (         
      1300 +                    <div className="mt-2 flex gap-3 pl-4 item
           +s-center">                                                   
      1301 +                      <button                                
      1302 +                        onClick={() => handleCopy(message.id,
           + message.content, 'raw')}                                    
      1303 +                        className="text-xs text-dark-500 hove
           +r:text-primary-400 flex items-center gap-1 transition-colors"
      1304 +                      >                                      
      1305 +                        {copiedMessageId === `${message.id}-r
           +aw` ? <Check className="w-3 h-3" /> : <Copy className="w-3 h-
           +3" />}                                                       
      1306 +                        {copiedMessageId === `${message.id}-r
           +aw` ? 'Copied' : 'Copy Raw'}                                 
      1307 +                      </button>                              
      1308 +                      <button                                
      1309 +                        onClick={() => handleCopy(message.id,
           + message.content, 'markdown')}                               
      1310 +                        className="text-xs text-dark-500 hove
           +r:text-primary-400 flex items-center gap-1 transition-colors"
      1311 +                      >                                      
      1312 +                        {copiedMessageId === `${message.id}-m
           +arkdown` ? <Check className="w-3 h-3" /> : <Copy className="w
           +-3 h-3" />}                                                  
      1313 +                        {copiedMessageId === `${message.id}-m
           +arkdown` ? 'Copied' : 'Copy MD'}                             
      1314 +                      </button>                              
      1315 +                      <button                                
      1316 +                        onClick={() => openForkModal(message.
           +id)}                                                         
      1317 +                        className="text-xs text-dark-500 hove
           +r:text-primary-400 flex items-center gap-1 transition-colors"
      1318 +                      >                                      
      1319 +                        <GitBranch className="w-3 h-3" />    
      1320 +                        Fork                                 
      1321 +                      </button>                              
      1322 +                                                             
      1323 +                      {/* Details hover - show if message has
           + stats */}                                                   
      1324 +                      {(message.prompt_tokens || message.resp
           +onse_time_ms || message.cost > 0) && (                       
      1325 +                        <div className="group relative">     
      1326 +                          <button className="text-xs text-dar
           +k-500 hover:text-primary-400 flex items-center gap-1 transiti
           +on-colors">                                                  
      1327 +                            <Info className="w-3 h-3" />     
      1328 +                          </button>                          
      1329 +                          <div className="absolute bottom-ful
           +l left-0 mb-1 hidden group-hover:block z-10">                
      1330 +                            <div className="bg-dark-800 borde
           +r border-dark-700 rounded-lg px-3 py-2 text-xs whitespace-now
           +rap shadow-xl">                                              
      1331 +                              <div className="space-y-1">    
      1332 +                                {message.response_time_ms > 0
           + && (                                                        
      1333 +                                  <div className="flex justif
           +y-between gap-4">                                            
      1334 +                                    <span className="text-dar
           +k-400">Time:</span>                                          
      1335 +                                    <span className="text-dar
           +k-200 font-mono">{formatThinkingTime(message.response_time_ms
           + / 1000)}</span>                                             
      1336 +                                  </div>                     
      1337 +                                )}                           
      1338 +                                {(message.prompt_tokens || me
           +ssage.completion_tokens) && (                                
      1339 +                                  <div className="flex justif
           +y-between gap-4">                                            
      1340 +                                    <span className="text-dar
           +k-400">Tokens:</span>                                        
      1341 +                                    <span className="text-dar
           +k-200 font-mono">{((message.prompt_tokens || 0) + (message.co
           +mpletion_tokens || 0)).toLocaleString()} tks</span>          
      1342 +                                  </div>                     
      1343 +                                )}                           
      1344 +                                {message.cost > 0 && (       
      1345 +                                  <div className="flex justif
           +y-between gap-4">                                            
      1346 +                                    <span className="text-dar
           +k-400">Cost:</span>                                          
      1347 +                                    <span className="text-pri
           +mary-400 font-mono">                                         
      1348 +                                      ${message.cost.toFixed(
           +2)}                                                          
      1349 +                                    </span>                  
      1350 +                                  </div>                     
      1351 +                                )}                           
      1352 +                              </div>                         
      1353 +                            </div>                           
      1354 +                          </div>                             
      1355 +                        </div>                               
      1356 +                      )}                                     
      1357 +                    </div>                                   
      1358 +                  )}                                         
      1359 +                </div>                                       
      1360 +              ))}                                            
      1361 +                                                             
      1362 +              {(streaming || streamingMessage || streamingRea
           +soning) && (                                                 
      1363 +                <div className="pr-8">                       
      1364 +                  {(streamingReasoning || (streaming && !stre
           +amingMessage)) && (                                          
      1365 +                    <ThinkingSection                         
      1366 +                      reasoning={streamingReasoning}         
      1367 +                      isExpanded={expandedThinkingSections.ha
           +s('streaming')}                                              
      1368 +                      onToggle={() => toggleThinkingSection('
           +streaming')}                                                 
      1369 +                      isStreaming={!streamingMessage || (stre
           +amingReasoning && streaming)}                                
      1370 +                      elapsedTime={thinkingElapsedTime}      
      1371 +                      stats={lastThinkingStats}              
      1372 +                    />                                       
      1373 +                  )}                                         
      1374 +                                                             
      1375 +                  {streamingMessage && (                     
      1376 +                    <div className="bg-dark-850/50 rounded-lg
           + px-4 py-3">                                                 
      1377 +                      <div className="flex items-center gap-2
           + mb-2">                                                      
      1378 +                        <Bot className="w-4 h-4 text-dark-400
           +" />                                                         
      1379 +                        <span className="text-xs font-medium 
           +text-dark-400">Assistant</span>                              
      1380 +                      </div>                                 
      1381 +                      {renderMessage(streamingMessage)}      
      1382 +                    </div>                                   
      1383 +                  )}                                         
      1384 +                                                             
      1385 +                  {streaming && !streamingMessage && !streami
           +ngReasoning && (                                             
      1386 +                    <div className="bg-dark-850/50 rounded-lg
           + px-4 py-3">                                                 
      1387 +                      <div className="flex items-center gap-2
           + mb-2">                                                      
      1388 +                        <Bot className="w-4 h-4 text-dark-400
           +" />                                                         
      1389 +                        <span className="text-xs font-medium 
           +text-dark-400">Assistant</span>                              
      1390 +                      </div>                                 
      1391 +                      <div className="flex gap-1">           
      1392 +                        <div className="w-2 h-2 bg-primary-40
           +0 rounded-full animate-bounce" style={{ animationDelay: '0ms'
           + }}></div>                                                   
      1393 +                        <div className="w-2 h-2 bg-primary-40
           +0 rounded-full animate-bounce" style={{ animationDelay: '150m
           +s' }}></div>                                                 
      1394 +                        <div className="w-2 h-2 bg-primary-40
           +0 rounded-full animate-bounce" style={{ animationDelay: '300m
           +s' }}></div>                                                 
      1395 +                      </div>                                 
      1396 +                    </div>                                   
      1397 +                  )}                                         
      1398 +                </div>                                       
      1399 +              )}                                             
      1400 +                                                             
      1401 +              <div ref={messagesEndRef} />                   
      1402 +            </div>                                           
      1403 +          )}                                                 
      1404 +        </div>                                               
      1405 +                                                             
      1406 +        {/* Input */}                                        
      1407 +        {currentChat && (                                    
      1408 +          <div className="border-t border-dark-700/50 bg-dark
           +-850 p-4">                                                   
      1409 +            <div className="max-w-2xl mx-auto">              
      1410 +              {streaming && (                                
      1411 +                <div className="flex justify-center mb-4">   
      1412 +                  <button                                    
      1413 +                    onClick={stopGeneration}                 
      1414 +                    className="flex items-center gap-2 px-5 p
           +y-2.5 bg-red-500/10 text-red-400 border border-red-500/20 rou
           +nded-xl text-sm font-semibold hover:bg-red-500/20 transition-
           +all duration-200 active:scale-[0.98]"                        
      1415 +                  >                                          
      1416 +                    <Square className="w-3 h-3 fill-current" 
           +/>                                                           
      1417 +                    Stop Generating                          
      1418 +                  </button>                                  
      1419 +                </div>                                       
      1420 +              )}                                             
      1421 +              <form onSubmit={sendMessage} className="flex ga
           +p-3">                                                        
      1422 +                <div className="flex-1 relative">            
      1423 +                  <textarea                                  
      1424 +                    ref={textareaRef}                        
      1425 +                    value={inputMessage}                     
      1426 +                    onChange={(e) => setInputMessage(e.target
           +.value)}                                                     
      1427 +                    onKeyDown={(e) => {                      
      1428 +                      if (e.key === 'Enter' && !e.shiftKey) {
      1429 +                        e.preventDefault();                  
      1430 +                        if (inputMessage.trim() && !streaming
           +) {                                                          
      1431 +                          sendMessage(e);                    
      1432 +                        }                                    
      1433 +                      }                                      
      1434 +                    }}                                       
      1435 +                    placeholder={streaming ? "AI is respondin
           +g..." : "Type your message... (Shift+Enter for new line)"}   
      1436 +                    className="w-full px-5 py-3.5 rounded-2xl
           + glass-input outline-none text-dark-100 placeholder-dark-500 
           +text-sm pr-4 resize-none overflow-y-auto"                    
      1437 +                    style={{ minHeight: '52px', maxHeight: '1
           +40px' }}                                                     
      1438 +                    rows={1}                                 
      1439 +                    disabled={streaming}                     
      1440 +                    onInput={(e) => {                        
      1441 +                      e.target.style.height = 'auto';        
      1442 +                      e.target.style.height = Math.min(e.targ
           +et.scrollHeight, 140) + 'px';                                
      1443 +                    }}                                       
      1444 +                  />                                         
      1445 +                </div>                                       
      1446 +                <button                                      
      1447 +                  type="submit"                              
      1448 +                  disabled={!inputMessage.trim() || streaming
           +}                                                            
      1449 +                  className="px-6 py-3.5 bg-primary-500 hover
           +:bg-primary-600 text-white rounded-2xl font-semibold transiti
           +on-all duration-200 disabled:opacity-40 disabled:cursor-not-a
           +llowed flex items-center gap-2 active:scale-[0.98]"          
      1450 +                >                                            
      1451 +                  <Send className="w-4 h-4" />               
      1452 +                  <span className="hidden sm:inline">Send</sp
           +an>                                                          
      1453 +                </button>                                    
      1454 +              </form>                                        
      1455 +            </div>                                           
      1456 +          </div>                                             
      1457 +        )}                                                   
      1458 +      </div>                                                 
      1459 +                                                             
      1460 +      {/* Fork Modal */}                                     
      1461 +      {showForkModal && (                                    
      1462 +        <div className="fixed inset-0 bg-dark-950/80 backdrop
           +-blur-md flex items-center justify-center z-50 scale-in">    
      1463 +          <div className="glass-modal rounded-2xl p-6 w-full 
           +max-w-md mx-4 shadow-2xl">                                   
      1464 +            <div className="flex items-center justify-between
           + mb-5">                                                      
      1465 +              <h3 className="text-lg font-bold text-dark-100 
           +flex items-center gap-2.5">                                  
      1466 +                <div className="w-8 h-8 rounded-lg bg-primary
           +-500 flex items-center justify-center">                      
      1467 +                  <GitBranch className="w-4 h-4 text-white" /
           +>                                                            
      1468 +                </div>                                       
      1469 +                Fork Chat                                    
      1470 +              </h3>                                          
      1471 +              <button                                        
      1472 +                onClick={() => setShowForkModal(false)}      
      1473 +                className="p-2 hover:bg-dark-700/50 rounded-x
           +l transition-all duration-200"                               
      1474 +              >                                              
      1475 +                <X className="w-5 h-5 text-dark-400" />      
      1476 +              </button>                                      
      1477 +            </div>                                           
      1478 +                                                             
      1479 +            <p className="text-dark-400 text-sm mb-5 leading-
           +relaxed">                                                    
      1480 +              Create a new chat branch from this point. You c
           +an choose a different model for the forked chat.             
      1481 +            </p>                                             
      1482 +                                                             
      1483 +            <div className="mb-6">                           
      1484 +              <label className="block text-sm font-medium tex
           +t-dark-300 mb-2">                                            
      1485 +                Model for forked chat                        
      1486 +              </label>                                       
      1487 +              <ModelSelector                                 
      1488 +                selectedModel={forkModel}                    
      1489 +                onModelChange={setForkModel}                 
      1490 +                isDropdown={true}                            
      1491 +              />                                             
      1492 +            </div>                                           
      1493 +                                                             
      1494 +            <div className="flex gap-3">                     
      1495 +              <button                                        
      1496 +                onClick={() => setShowForkModal(false)}      
      1497 +                className="flex-1 px-4 py-3 rounded-xl glass-
           +button text-dark-300 font-semibold transition-all duration-20
           +0 hover:text-dark-100"                                       
      1498 +              >                                              
      1499 +                Cancel                                       
      1500 +              </button>                                      
      1501 +              <button                                        
      1502 +                onClick={forkChat}                           
      1503 +                className="flex-1 px-4 py-3 rounded-xl bg-pri
           +mary-500 hover:bg-primary-600 text-white font-semibold transi
           +tion-all duration-200 flex items-center justify-center gap-2 
           +active:scale-[0.98]"                                         
      1504 +              >                                              
      1505 +                <GitBranch className="w-4 h-4" />            
      1506 +                Fork Chat                                    
      1507 +              </button>                                      
      1508 +            </div>                                           
      1509 +          </div>                                             
      1510 +        </div>                                               
      1511 +      )}                                                     
      1512 +                                                             
      1513 +    </div>                                                   
      1514 +  );                                                         
      1515 +}                                                            
      1516 +                                                             
      1517 +export default Chat;                                         
✔ Task #4 updated: status → completed
✔ Task #5 updated: status → in progress

● Write(client\src\components\ModelSelector.jsx)
  ⎿  Added 388 lines, removed 388 lines
        1 -import React, { useState, useEffect, useRef, useMemo } from 'r
          -eact';                                                       
        2 -import { Bot, ChevronDown, Check, Search, Clock, Loader2, X } 
          -from 'lucide-react';                                         
        3 -                                                             
        4 -const DEFAULT_MODEL = 'moonshotai/kimi-k2-thinking';         
        5 -const RECENT_MODELS_KEY = 'budi_chat_recent_models';         
        6 -const MODELS_CACHE_KEY = 'budi_chat_models_cache';           
        7 -const MODELS_CACHE_EXPIRY = 24 * 60 * 60 * 1000; // 24 hours 
        8 -const MAX_RECENT_MODELS = 5;                                 
        9 -                                                             
       10 -// Fallback models in case API fails                         
       11 -const FALLBACK_MODELS = [                                    
       12 -  { id: 'moonshotai/kimi-k2-thinking', name: 'Kimi K2 Thinking
          -', description: 'Moonshot AI reasoning model' },             
       13 -  { id: 'anthropic/claude-sonnet-4', name: 'Claude Sonnet 4', 
          -description: 'Anthropic Claude Sonnet 4' },                  
       14 -  { id: 'anthropic/claude-3.5-sonnet', name: 'Claude 3.5 Sonne
          -t', description: 'Anthropic Claude 3.5 Sonnet' },            
       15 -  { id: 'openai/gpt-4o', name: 'GPT-4o', description: 'OpenAI 
          -GPT-4o' },                                                   
       16 -  { id: 'openai/gpt-4-turbo', name: 'GPT-4 Turbo', description
          -: 'OpenAI GPT-4 Turbo' },                                    
       17 -  { id: 'google/gemini-2.5-pro-preview', name: 'Gemini 2.5 Pro
          -', description: 'Google Gemini 2.5 Pro' },                   
       18 -  { id: 'google/gemini-2.5-flash-preview', name: 'Gemini 2.5 F
          -lash', description: 'Google Gemini 2.5 Flash' },             
       19 -  { id: 'deepseek/deepseek-r1', name: 'DeepSeek R1', descripti
          -on: 'DeepSeek R1 reasoning model' },                         
       20 -  { id: 'deepseek/deepseek-chat', name: 'DeepSeek Chat', descr
          -iption: 'DeepSeek Chat model' },                             
       21 -  { id: 'meta-llama/llama-3.3-70b-instruct', name: 'Llama 3.3 
          -70B', description: 'Meta Llama 3.3 70B' },                   
       22 -  { id: 'qwen/qwen-2.5-72b-instruct', name: 'Qwen 2.5 72B', de
          -scription: 'Alibaba Qwen 2.5 72B' },                         
       23 -  { id: 'mistralai/mistral-large-2411', name: 'Mistral Large',
          - description: 'Mistral Large 2411' },                        
       24 -];                                                           
       25 -                                                             
       26 -function ModelSelector({ selectedModel, onModelChange, isDropd
          -own = true }) {                                              
       27 -  const [isOpen, setIsOpen] = useState(false);               
       28 -  const [models, setModels] = useState([]);                  
       29 -  const [loading, setLoading] = useState(true);              
       30 -  const [searchQuery, setSearchQuery] = useState('');        
       31 -  const [recentModels, setRecentModels] = useState([]);      
       32 -  const dropdownRef = useRef(null);                          
       33 -  const searchInputRef = useRef(null);                       
       34 -                                                             
       35 -  // Load recent models from localStorage                    
       36 -  useEffect(() => {                                          
       37 -    const stored = localStorage.getItem(RECENT_MODELS_KEY);  
       38 -    if (stored) {                                            
       39 -      try {                                                  
       40 -        setRecentModels(JSON.parse(stored));                 
       41 -      } catch (e) {                                          
       42 -        console.error('Failed to parse recent models:', e);  
       43 -      }                                                      
       44 -    }                                                        
       45 -  }, []);                                                    
       46 -                                                             
       47 -  // Fetch models from OpenRouter or cache                   
       48 -  useEffect(() => {                                          
       49 -    const fetchModels = async () => {                        
       50 -      // Check cache first                                   
       51 -      const cached = localStorage.getItem(MODELS_CACHE_KEY); 
       52 -      if (cached) {                                          
       53 -        try {                                                
       54 -          const { models: cachedModels, timestamp } = JSON.par
          -se(cached);                                                  
       55 -          if (Date.now() - timestamp < MODELS_CACHE_EXPIRY) {
       56 -            setModels(cachedModels);                         
       57 -            setLoading(false);                               
       58 -            return;                                          
       59 -          }                                                  
       60 -        } catch (e) {                                        
       61 -          console.error('Failed to parse cached models:', e);
       62 -        }                                                    
       63 -      }                                                      
       64 -                                                             
       65 -      // Fetch from OpenRouter                               
       66 -      try {                                                  
       67 -        const response = await fetch('https://openrouter.ai/ap
          -i/v1/models');                                               
       68 -        if (!response.ok) throw new Error('Failed to fetch mod
          -els');                                                       
       69 -                                                             
       70 -        const data = await response.json();                  
       71 -        const fetchedModels = data.data                      
       72 -          .filter(model => model.id && model.name)           
       73 -          .map(model => ({                                   
       74 -            id: model.id,                                    
       75 -            name: model.name,                                
       76 -            description: model.description || '',            
       77 -            contextLength: model.context_length,             
       78 -            pricing: model.pricing,                          
       79 -          }))                                                
       80 -          .sort((a, b) => a.name.localeCompare(b.name));     
       81 -                                                             
       82 -        setModels(fetchedModels);                            
       83 -                                                             
       84 -        // Cache the results                                 
       85 -        localStorage.setItem(MODELS_CACHE_KEY, JSON.stringify(
          -{                                                            
       86 -          models: fetchedModels,                             
       87 -          timestamp: Date.now()                              
       88 -        }));                                                 
       89 -      } catch (error) {                                      
       90 -        console.error('Failed to fetch models from OpenRouter:
          -', error);                                                   
       91 -        setModels(FALLBACK_MODELS);                          
       92 -      } finally {                                            
       93 -        setLoading(false);                                   
       94 -      }                                                      
       95 -    };                                                       
       96 -                                                             
       97 -    fetchModels();                                           
       98 -  }, []);                                                    
       99 -                                                             
      100 -  // Close dropdown when clicking outside                    
      101 -  useEffect(() => {                                          
      102 -    const handleClickOutside = (event) => {                  
      103 -      if (dropdownRef.current && !dropdownRef.current.contains
          -(event.target)) {                                            
      104 -        setIsOpen(false);                                    
      105 -        setSearchQuery('');                                  
      106 -      }                                                      
      107 -    };                                                       
      108 -    document.addEventListener('mousedown', handleClickOutside)
          -;                                                            
      109 -    return () => document.removeEventListener('mousedown', han
          -dleClickOutside);                                            
      110 -  }, []);                                                    
      111 -                                                             
      112 -  // Focus search input when dropdown opens                  
      113 -  useEffect(() => {                                          
      114 -    if (isOpen && searchInputRef.current) {                  
      115 -      setTimeout(() => searchInputRef.current?.focus(), 50); 
      116 -    }                                                        
      117 -  }, [isOpen]);                                              
      118 -                                                             
      119 -  // Add model to recent list                                
      120 -  const addToRecentModels = (modelId) => {                   
      121 -    const updated = [modelId, ...recentModels.filter(id => id 
          -!== modelId)].slice(0, MAX_RECENT_MODELS);                   
      122 -    setRecentModels(updated);                                
      123 -    localStorage.setItem(RECENT_MODELS_KEY, JSON.stringify(upd
          -ated));                                                      
      124 -  };                                                         
      125 -                                                             
      126 -  // Handle model selection                                  
      127 -  const handleSelect = (modelId) => {                        
      128 -    addToRecentModels(modelId);                              
      129 -    onModelChange(modelId);                                  
      130 -    setIsOpen(false);                                        
      131 -    setSearchQuery('');                                      
      132 -  };                                                         
      133 -                                                             
      134 -  // Filter and rank models based on search query            
      135 -  const filteredModels = useMemo(() => {                     
      136 -    if (!searchQuery.trim()) return models;                  
      137 -    const query = searchQuery.toLowerCase();                 
      138 -                                                             
      139 -    // Filter matching models                                
      140 -    const matches = models.filter(model =>                   
      141 -      model.id.toLowerCase().includes(query) ||              
      142 -      model.name.toLowerCase().includes(query) ||            
      143 -      (model.description && model.description.toLowerCase().in
          -cludes(query))                                               
      144 -    );                                                       
      145 -                                                             
      146 -    // Rank by relevance: name match > ID match > description 
          -match                                                        
      147 -    return matches.sort((a, b) => {                          
      148 -      const aName = a.name.toLowerCase();                    
      149 -      const bName = b.name.toLowerCase();                    
      150 -      const aId = a.id.toLowerCase();                        
      151 -      const bId = b.id.toLowerCase();                        
      152 -                                                             
      153 -      // Exact name starts with query                        
      154 -      const aNameStarts = aName.startsWith(query) ? 3 : (aName
          -.includes(query) ? 2 : 0);                                   
      155 -      const bNameStarts = bName.startsWith(query) ? 3 : (bName
          -.includes(query) ? 2 : 0);                                   
      156 -      if (aNameStarts !== bNameStarts) return bNameStarts - aN
          -ameStarts;                                                   
      157 -                                                             
      158 -      // ID contains query                                   
      159 -      const aIdMatch = aId.includes(query) ? 1 : 0;          
      160 -      const bIdMatch = bId.includes(query) ? 1 : 0;          
      161 -      if (aIdMatch !== bIdMatch) return bIdMatch - aIdMatch; 
      162 -                                                             
      163 -      // Alphabetical fallback                               
      164 -      return aName.localeCompare(bName);                     
      165 -    });                                                      
      166 -  }, [models, searchQuery]);                                 
      167 -                                                             
      168 -  // Get recent models data                                  
      169 -  const recentModelsData = useMemo(() => {                   
      170 -    return recentModels                                      
      171 -      .map(id => models.find(m => m.id === id))              
      172 -      .filter(Boolean);                                      
      173 -  }, [recentModels, models]);                                
      174 -                                                             
      175 -  // Get the display name for current model                  
      176 -  const getModelDisplayName = (modelId) => {                 
      177 -    const model = models.find(m => m.id === modelId);        
      178 -    if (model) return model.name;                            
      179 -    // Extract a readable name from the ID                   
      180 -    const parts = modelId.split('/');                        
      181 -    return parts[parts.length - 1].replace(/-/g, ' ').replace(
          -/\b\w/g, l => l.toUpperCase());                              
      182 -  };                                                         
      183 -                                                             
      184 -  // Get provider from model ID                              
      185 -  const getProvider = (modelId) => {                         
      186 -    const parts = modelId.split('/');                        
      187 -    if (parts.length > 1) {                                  
      188 -      return parts[0].replace(/-/g, ' ').replace(/\b\w/g, l =>
          - l.toUpperCase());                                           
      189 -    }                                                        
      190 -    return '';                                               
      191 -  };                                                         
      192 -                                                             
      193 -  if (!isDropdown) {                                         
      194 -    // Render as a regular select for settings panel         
      195 -    return (                                                 
      196 -      <select                                                
      197 -        value={selectedModel}                                
      198 -        onChange={(e) => {                                   
      199 -          addToRecentModels(e.target.value);                 
      200 -          onModelChange(e.target.value);                     
      201 -        }}                                                   
      202 -        className="w-full px-3 py-2 rounded-lg glass-input out
          -line-none text-dark-100 bg-dark-800"                         
      203 -        disabled={loading}                                   
      204 -      >                                                      
      205 -        {loading ? (                                         
      206 -          <option>Loading models...</option>                 
      207 -        ) : (                                                
      208 -          <>                                                 
      209 -            {recentModelsData.length > 0 && (                
      210 -              <optgroup label="Recently Used">               
      211 -                {recentModelsData.map(model => (             
      212 -                  <option key={`recent-${model.id}`} value={mo
          -del.id}>                                                     
      213 -                    {model.name}                             
      214 -                  </option>                                  
      215 -                ))}                                          
      216 -              </optgroup>                                    
      217 -            )}                                               
      218 -            <optgroup label="All Models">                    
      219 -              {models.map(model => (                         
      220 -                <option key={model.id} value={model.id}>     
      221 -                  {model.name} ({getProvider(model.id)})     
      222 -                </option>                                    
      223 -              ))}                                            
      224 -            </optgroup>                                      
      225 -          </>                                                
      226 -        )}                                                   
      227 -      </select>                                              
      228 -    );                                                       
      229 -  }                                                          
      230 -                                                             
      231 -  return (                                                   
      232 -    <div className="relative" ref={dropdownRef}>             
      233 -      <button                                                
      234 -        onClick={() => setIsOpen(!isOpen)}                   
      235 -        className={`flex items-center gap-2.5 px-4 py-2.5 roun
          -ded-xl transition-all duration-200 text-sm ${isOpen          
      236 -          ? 'bg-primary-500/10 border border-primary-500/20 sh
          -adow-lg'                                                     
      237 -          : 'glass-button'                                   
      238 -          }`}                                                
      239 -      >                                                      
      240 -        <div className="w-6 h-6 rounded-lg gradient-primary fl
          -ex items-center justify-center flex-shrink-0">               
      241 -          <Bot className="w-3.5 h-3.5 text-white" />         
      242 -        </div>                                               
      243 -        <span className="text-dark-200 font-medium max-w-[180p
          -x] truncate">                                                
      244 -          {getModelDisplayName(selectedModel)}               
      245 -        </span>                                              
      246 -        <ChevronDown className={`w-4 h-4 text-dark-400 transit
          -ion-transform duration-200 ${isOpen ? 'rotate-180' : ''}`} />
      247 -      </button>                                              
      248 -                                                             
      249 -      {isOpen && (                                           
      250 -        <div className="absolute top-full left-0 mt-2 w-[420px
          -] bg-dark-900 border border-dark-700 rounded-2xl z-[100] overf
          -low-hidden shadow-2xl scale-in">                             
      251 -          {/* Search Bar */}                                 
      252 -          <div className="p-3 border-b border-dark-700 bg-dark
          --800">                                                       
      253 -            <div className="relative">                       
      254 -              <Search className="absolute left-3.5 top-1/2 -tr
          -anslate-y-1/2 w-4 h-4 text-dark-400" />                      
      255 -              <input                                         
      256 -                ref={searchInputRef}                         
      257 -                type="text"                                  
      258 -                value={searchQuery}                          
      259 -                onChange={(e) => setSearchQuery(e.target.value
          -)}                                                           
      260 -                placeholder="Search models..."               
      261 -                className="w-full pl-10 pr-9 py-2.5 rounded-xl
          - bg-dark-800 border border-dark-600 outline-none text-dark-100
          - placeholder-dark-500 text-sm focus:border-primary-500/50"   
      262 -              />                                             
      263 -              {searchQuery && (                              
      264 -                <button                                      
      265 -                  onClick={() => setSearchQuery('')}         
      266 -                  className="absolute right-2.5 top-1/2 -trans
          -late-y-1/2 p-1 hover:bg-white/[0.05] rounded-lg transition-col
          -ors"                                                         
      267 -                >                                            
      268 -                  <X className="w-3.5 h-3.5 text-dark-400" />
      269 -                </button>                                    
      270 -              )}                                             
      271 -            </div>                                           
      272 -          </div>                                             
      273 -                                                             
      274 -          <div className="max-h-[400px] overflow-y-auto bg-dar
          -k-900">                                                      
      275 -            {loading ? (                                     
      276 -              <div className="flex items-center justify-center
          - py-12">                                                     
      277 -                <Loader2 className="w-6 h-6 text-primary-400 a
          -nimate-spin" />                                              
      278 -                <span className="ml-3 text-dark-400 text-sm">L
          -oading models...</span>                                      
      279 -              </div>                                         
      280 -            ) : (                                            
      281 -              <>                                             
      282 -                {/* Recently Used Section */}                
      283 -                {!searchQuery && recentModelsData.length > 0 &
          -& (                                                          
      284 -                  <div className="p-2 border-b border-dark-700
          - bg-dark-900">                                               
      285 -                    <div className="flex items-center gap-2 px
          --3 py-2 text-[11px] font-semibold text-dark-500 uppercase trac
          -king-wider">                                                 
      286 -                      <Clock className="w-3 h-3" />          
      287 -                      Recently Used                          
      288 -                    </div>                                   
      289 -                    {recentModelsData.map(model => (         
      290 -                      <button                                
      291 -                        key={`recent-${model.id}`}           
      292 -                        onClick={() => handleSelect(model.id)}
          -                                                              
      293 -                        className={`w-full flex items-center j
          -ustify-between px-3 py-2.5 rounded-xl transition-all duration-
          -150 text-left group ${selectedModel === model.id             
      294 -                          ? 'bg-primary-500/15 border border-p
          -rimary-500/25'                                               
      295 -                          : 'hover:bg-white/[0.03] border bord
          -er-transparent'                                              
      296 -                          }`}                                
      297 -                      >                                      
      298 -                        <div className="flex-1 min-w-0">     
      299 -                          <p className={`text-sm font-medium t
          -runcate ${selectedModel === model.id ? 'text-dark-50' : 'text-
          -dark-200 group-hover:text-dark-100'}`}>{model.name}</p>      
      300 -                          <p className="text-xs text-dark-500 
          -truncate">                                                   
      301 -                            {getProvider(model.id)}          
      302 -                            {model.contextLength && (        
      303 -                              <span className="ml-1.5 text-dar
          -k-600">• {Math.round(model.contextLength / 1000)}k</span>    
      304 -                            )}                               
      305 -                            {model.pricing && (              
      306 -                              <span className="ml-1.5 text-gre
          -en-500/80">                                                  
      307 -                                • ${(parseFloat(model.pricing.
          -prompt) * 1000000).toFixed(2)} / ${(parseFloat(model.pricing.c
          -ompletion) * 1000000).toFixed(2)}                            
      308 -                              </span>                        
      309 -                            )}                               
      310 -                          </p>                               
      311 -                        </div>                               
      312 -                        {selectedModel === model.id && (     
      313 -                          <div className="w-5 h-5 rounded-md g
          -radient-primary flex items-center justify-center flex-shrink-0
          - ml-2">                                                      
      314 -                            <Check className="w-3 h-3 text-whi
          -te" />                                                       
      315 -                          </div>                             
      316 -                        )}                                   
      317 -                      </button>                              
      318 -                    ))}                                      
      319 -                  </div>                                     
      320 -                )}                                           
      321 -                                                             
      322 -                {/* All Models Section */}                   
      323 -                <div className="p-2 bg-dark-900">            
      324 -                  {!searchQuery && (                         
      325 -                    <div className="px-3 py-2 text-[11px] font
          --semibold text-dark-500 uppercase tracking-wider">           
      326 -                      All Models <span className="text-dark-60
          -0">({filteredModels.length})</span>                          
      327 -                    </div>                                   
      328 -                  )}                                         
      329 -                  {searchQuery && (                          
      330 -                    <div className="px-3 py-2 text-xs text-dar
          -k-400">                                                      
      331 -                      {filteredModels.length} result{filteredM
          -odels.length !== 1 ? 's' : ''} for "<span className="text-prim
          -ary-400">{searchQuery}</span>"                               
      332 -                    </div>                                   
      333 -                  )}                                         
      334 -                                                             
      335 -                  {filteredModels.length === 0 ? (           
      336 -                    <div className="py-12 text-center">      
      337 -                      <div className="w-12 h-12 rounded-xl bg-
          -dark-800/50 flex items-center justify-center mx-auto mb-3">  
      338 -                        <Search className="w-6 h-6 text-dark-5
          -00" />                                                       
      339 -                      </div>                                 
      340 -                      <p className="text-dark-400 font-medium"
          ->No models found</p>                                         
      341 -                      <p className="text-xs text-dark-500 mt-1
          -">Try a different search term</p>                            
      342 -                    </div>                                   
      343 -                  ) : (                                      
      344 -                    <div className="space-y-0.5">            
      345 -                      {filteredModels.map(model => (         
      346 -                        <button                              
      347 -                          key={model.id}                     
      348 -                          onClick={() => handleSelect(model.id
          -)}                                                           
      349 -                          className={`w-full flex items-center
          - justify-between px-3 py-2.5 rounded-xl transition-all duratio
          -n-150 text-left group ${selectedModel === model.id           
      350 -                            ? 'bg-primary-500/15 border border
          --primary-500/25'                                             
      351 -                            : 'hover:bg-white/[0.03] border bo
          -rder-transparent'                                            
      352 -                            }`}                              
      353 -                        >                                    
      354 -                          <div className="flex-1 min-w-0">   
      355 -                            <p className={`text-sm font-medium
          - truncate ${selectedModel === model.id ? 'text-dark-50' : 'tex
          -t-dark-200 group-hover:text-dark-100'}`}>{model.name}</p>    
      356 -                            <p className="text-xs text-dark-50
          -0 truncate">                                                 
      357 -                              {getProvider(model.id)}        
      358 -                              {model.contextLength && (      
      359 -                                <span className="ml-1.5 text-d
          -ark-600">• {Math.round(model.contextLength / 1000)}k</span>  
      360 -                              )}                             
      361 -                              {model.pricing && (            
      362 -                                <span className="ml-1.5 text-g
          -reen-500/80">                                                
      363 -                                  • ${(parseFloat(model.pricin
          -g.prompt) * 1000000).toFixed(2)} / ${(parseFloat(model.pricing
          -.completion) * 1000000).toFixed(2)}                          
      364 -                                </span>                      
      365 -                              )}                             
      366 -                            </p>                             
      367 -                          </div>                             
      368 -                          {selectedModel === model.id && (   
      369 -                            <div className="w-5 h-5 rounded-md
          - gradient-primary flex items-center justify-center flex-shrink
          --0 ml-2">                                                    
      370 -                              <Check className="w-3 h-3 text-w
          -hite" />                                                     
      371 -                            </div>                           
      372 -                          )}                                 
      373 -                        </button>                            
      374 -                      ))}                                    
      375 -                    </div>                                   
      376 -                  )}                                         
      377 -                </div>                                       
      378 -              </>                                            
      379 -            )}                                               
      380 -          </div>                                             
      381 -        </div>                                               
      382 -      )}                                                     
      383 -    </div>                                                   
      384 -  );                                                         
      385 -}                                                            
      386 -                                                             
      387 -export default ModelSelector;                                
      388 -export { DEFAULT_MODEL, RECENT_MODELS_KEY, MODELS_CACHE_KEY };
          -                                                              
        1 +import React, { useState, useEffect, useRef, useMemo } from 'r
          +eact';                                                        
        2 +import { Bot, ChevronDown, Check, Search, Clock, Loader2, X } 
          +from 'lucide-react';                                          
        3 +                                                              
        4 +const DEFAULT_MODEL = 'moonshotai/kimi-k2-thinking';          
        5 +const RECENT_MODELS_KEY = 'budi_chat_recent_models';          
        6 +const MODELS_CACHE_KEY = 'budi_chat_models_cache';            
        7 +const MODELS_CACHE_EXPIRY = 24 * 60 * 60 * 1000; // 24 hours  
        8 +const MAX_RECENT_MODELS = 5;                                  
        9 +                                                              
       10 +// Fallback models in case API fails                          
       11 +const FALLBACK_MODELS = [                                     
       12 +  { id: 'moonshotai/kimi-k2-thinking', name: 'Kimi K2 Thinking
          +', description: 'Moonshot AI reasoning model' },              
       13 +  { id: 'anthropic/claude-sonnet-4', name: 'Claude Sonnet 4', 
          +description: 'Anthropic Claude Sonnet 4' },                   
       14 +  { id: 'anthropic/claude-3.5-sonnet', name: 'Claude 3.5 Sonne
          +t', description: 'Anthropic Claude 3.5 Sonnet' },             
       15 +  { id: 'openai/gpt-4o', name: 'GPT-4o', description: 'OpenAI 
          +GPT-4o' },                                                    
       16 +  { id: 'openai/gpt-4-turbo', name: 'GPT-4 Turbo', description
          +: 'OpenAI GPT-4 Turbo' },                                     
       17 +  { id: 'google/gemini-2.5-pro-preview', name: 'Gemini 2.5 Pro
          +', description: 'Google Gemini 2.5 Pro' },                    
       18 +  { id: 'google/gemini-2.5-flash-preview', name: 'Gemini 2.5 F
          +lash', description: 'Google Gemini 2.5 Flash' },              
       19 +  { id: 'deepseek/deepseek-r1', name: 'DeepSeek R1', descripti
          +on: 'DeepSeek R1 reasoning model' },                          
       20 +  { id: 'deepseek/deepseek-chat', name: 'DeepSeek Chat', descr
          +iption: 'DeepSeek Chat model' },                              
       21 +  { id: 'meta-llama/llama-3.3-70b-instruct', name: 'Llama 3.3 
          +70B', description: 'Meta Llama 3.3 70B' },                    
       22 +  { id: 'qwen/qwen-2.5-72b-instruct', name: 'Qwen 2.5 72B', de
          +scription: 'Alibaba Qwen 2.5 72B' },                          
       23 +  { id: 'mistralai/mistral-large-2411', name: 'Mistral Large',
          + description: 'Mistral Large 2411' },                         
       24 +];                                                            
       25 +                                                              
       26 +function ModelSelector({ selectedModel, onModelChange, isDropd
          +own = true }) {                                               
       27 +  const [isOpen, setIsOpen] = useState(false);                
       28 +  const [models, setModels] = useState([]);                   
       29 +  const [loading, setLoading] = useState(true);               
       30 +  const [searchQuery, setSearchQuery] = useState('');         
       31 +  const [recentModels, setRecentModels] = useState([]);       
       32 +  const dropdownRef = useRef(null);                           
       33 +  const searchInputRef = useRef(null);                        
       34 +                                                              
       35 +  // Load recent models from localStorage                     
       36 +  useEffect(() => {                                           
       37 +    const stored = localStorage.getItem(RECENT_MODELS_KEY);   
       38 +    if (stored) {                                             
       39 +      try {                                                   
       40 +        setRecentModels(JSON.parse(stored));                  
       41 +      } catch (e) {                                           
       42 +        console.error('Failed to parse recent models:', e);   
       43 +      }                                                       
       44 +    }                                                         
       45 +  }, []);                                                     
       46 +                                                              
       47 +  // Fetch models from OpenRouter or cache                    
       48 +  useEffect(() => {                                           
       49 +    const fetchModels = async () => {                         
       50 +      // Check cache first                                    
       51 +      const cached = localStorage.getItem(MODELS_CACHE_KEY);  
       52 +      if (cached) {                                           
       53 +        try {                                                 
       54 +          const { models: cachedModels, timestamp } = JSON.par
          +se(cached);                                                   
       55 +          if (Date.now() - timestamp < MODELS_CACHE_EXPIRY) { 
       56 +            setModels(cachedModels);                          
       57 +            setLoading(false);                                
       58 +            return;                                           
       59 +          }                                                   
       60 +        } catch (e) {                                         
       61 +          console.error('Failed to parse cached models:', e); 
       62 +        }                                                     
       63 +      }                                                       
       64 +                                                              
       65 +      // Fetch from OpenRouter                                
       66 +      try {                                                   
       67 +        const response = await fetch('https://openrouter.ai/ap
          +i/v1/models');                                                
       68 +        if (!response.ok) throw new Error('Failed to fetch mod
          +els');                                                        
       69 +                                                              
       70 +        const data = await response.json();                   
       71 +        const fetchedModels = data.data                       
       72 +          .filter(model => model.id && model.name)            
       73 +          .map(model => ({                                    
       74 +            id: model.id,                                     
       75 +            name: model.name,                                 
       76 +            description: model.description || '',             
       77 +            contextLength: model.context_length,              
       78 +            pricing: model.pricing,                           
       79 +          }))                                                 
       80 +          .sort((a, b) => a.name.localeCompare(b.name));      
       81 +                                                              
       82 +        setModels(fetchedModels);                             
       83 +                                                              
       84 +        // Cache the results                                  
       85 +        localStorage.setItem(MODELS_CACHE_KEY, JSON.stringify(
          +{                                                             
       86 +          models: fetchedModels,                              
       87 +          timestamp: Date.now()                               
       88 +        }));                                                  
       89 +      } catch (error) {                                       
       90 +        console.error('Failed to fetch models from OpenRouter:
          +', error);                                                    
       91 +        setModels(FALLBACK_MODELS);                           
       92 +      } finally {                                             
       93 +        setLoading(false);                                    
       94 +      }                                                       
       95 +    };                                                        
       96 +                                                              
       97 +    fetchModels();                                            
       98 +  }, []);                                                     
       99 +                                                              
      100 +  // Close dropdown when clicking outside                     
      101 +  useEffect(() => {                                           
      102 +    const handleClickOutside = (event) => {                   
      103 +      if (dropdownRef.current && !dropdownRef.current.contains
          +(event.target)) {                                             
      104 +        setIsOpen(false);                                     
      105 +        setSearchQuery('');                                   
      106 +      }                                                       
      107 +    };                                                        
      108 +    document.addEventListener('mousedown', handleClickOutside)
          +;                                                             
      109 +    return () => document.removeEventListener('mousedown', han
          +dleClickOutside);                                             
      110 +  }, []);                                                     
      111 +                                                              
      112 +  // Focus search input when dropdown opens                   
      113 +  useEffect(() => {                                           
      114 +    if (isOpen && searchInputRef.current) {                   
      115 +      setTimeout(() => searchInputRef.current?.focus(), 50);  
      116 +    }                                                         
      117 +  }, [isOpen]);                                               
      118 +                                                              
      119 +  // Add model to recent list                                 
      120 +  const addToRecentModels = (modelId) => {                    
      121 +    const updated = [modelId, ...recentModels.filter(id => id 
          +!== modelId)].slice(0, MAX_RECENT_MODELS);                    
      122 +    setRecentModels(updated);                                 
      123 +    localStorage.setItem(RECENT_MODELS_KEY, JSON.stringify(upd
          +ated));                                                       
      124 +  };                                                          
      125 +                                                              
      126 +  // Handle model selection                                   
      127 +  const handleSelect = (modelId) => {                         
      128 +    addToRecentModels(modelId);                               
      129 +    onModelChange(modelId);                                   
      130 +    setIsOpen(false);                                         
      131 +    setSearchQuery('');                                       
      132 +  };                                                          
      133 +                                                              
      134 +  // Filter and rank models based on search query             
      135 +  const filteredModels = useMemo(() => {                      
      136 +    if (!searchQuery.trim()) return models;                   
      137 +    const query = searchQuery.toLowerCase();                  
      138 +                                                              
      139 +    // Filter matching models                                 
      140 +    const matches = models.filter(model =>                    
      141 +      model.id.toLowerCase().includes(query) ||               
      142 +      model.name.toLowerCase().includes(query) ||             
      143 +      (model.description && model.description.toLowerCase().in
          +cludes(query))                                                
      144 +    );                                                        
      145 +                                                              
      146 +    // Rank by relevance: name match > ID match > description 
          +match                                                         
      147 +    return matches.sort((a, b) => {                           
      148 +      const aName = a.name.toLowerCase();                     
      149 +      const bName = b.name.toLowerCase();                     
      150 +      const aId = a.id.toLowerCase();                         
      151 +      const bId = b.id.toLowerCase();                         
      152 +                                                              
      153 +      // Exact name starts with query                         
      154 +      const aNameStarts = aName.startsWith(query) ? 3 : (aName
          +.includes(query) ? 2 : 0);                                    
      155 +      const bNameStarts = bName.startsWith(query) ? 3 : (bName
          +.includes(query) ? 2 : 0);                                    
      156 +      if (aNameStarts !== bNameStarts) return bNameStarts - aN
          +ameStarts;                                                    
      157 +                                                              
      158 +      // ID contains query                                    
      159 +      const aIdMatch = aId.includes(query) ? 1 : 0;           
      160 +      const bIdMatch = bId.includes(query) ? 1 : 0;           
      161 +      if (aIdMatch !== bIdMatch) return bIdMatch - aIdMatch;  
      162 +                                                              
      163 +      // Alphabetical fallback                                
      164 +      return aName.localeCompare(bName);                      
      165 +    });                                                       
      166 +  }, [models, searchQuery]);                                  
      167 +                                                              
      168 +  // Get recent models data                                   
      169 +  const recentModelsData = useMemo(() => {                    
      170 +    return recentModels                                       
      171 +      .map(id => models.find(m => m.id === id))               
      172 +      .filter(Boolean);                                       
      173 +  }, [recentModels, models]);                                 
      174 +                                                              
      175 +  // Get the display name for current model                   
      176 +  const getModelDisplayName = (modelId) => {                  
      177 +    const model = models.find(m => m.id === modelId);         
      178 +    if (model) return model.name;                             
      179 +    // Extract a readable name from the ID                    
      180 +    const parts = modelId.split('/');                         
      181 +    return parts[parts.length - 1].replace(/-/g, ' ').replace(
          +/\b\w/g, l => l.toUpperCase());                               
      182 +  };                                                          
      183 +                                                              
      184 +  // Get provider from model ID                               
      185 +  const getProvider = (modelId) => {                          
      186 +    const parts = modelId.split('/');                         
      187 +    if (parts.length > 1) {                                   
      188 +      return parts[0].replace(/-/g, ' ').replace(/\b\w/g, l =>
          + l.toUpperCase());                                            
      189 +    }                                                         
      190 +    return '';                                                
      191 +  };                                                          
      192 +                                                              
      193 +  if (!isDropdown) {                                          
      194 +    // Render as a regular select for settings panel          
      195 +    return (                                                  
      196 +      <select                                                 
      197 +        value={selectedModel}                                 
      198 +        onChange={(e) => {                                    
      199 +          addToRecentModels(e.target.value);                  
      200 +          onModelChange(e.target.value);                      
      201 +        }}                                                    
      202 +        className="w-full px-3 py-2 rounded-lg glass-input out
          +line-none text-dark-100 bg-dark-800"                          
      203 +        disabled={loading}                                    
      204 +      >                                                       
      205 +        {loading ? (                                          
      206 +          <option>Loading models...</option>                  
      207 +        ) : (                                                 
      208 +          <>                                                  
      209 +            {recentModelsData.length > 0 && (                 
      210 +              <optgroup label="Recently Used">                
      211 +                {recentModelsData.map(model => (              
      212 +                  <option key={`recent-${model.id}`} value={mo
          +del.id}>                                                      
      213 +                    {model.name}                              
      214 +                  </option>                                   
      215 +                ))}                                           
      216 +              </optgroup>                                     
      217 +            )}                                                
      218 +            <optgroup label="All Models">                     
      219 +              {models.map(model => (                          
      220 +                <option key={model.id} value={model.id}>      
      221 +                  {model.name} ({getProvider(model.id)})      
      222 +                </option>                                     
      223 +              ))}                                             
      224 +            </optgroup>                                       
      225 +          </>                                                 
      226 +        )}                                                    
      227 +      </select>                                               
      228 +    );                                                        
      229 +  }                                                           
      230 +                                                              
      231 +  return (                                                    
      232 +    <div className="relative" ref={dropdownRef}>              
      233 +      <button                                                 
      234 +        onClick={() => setIsOpen(!isOpen)}                    
      235 +        className={`flex items-center gap-2.5 px-4 py-2.5 roun
          +ded-xl transition-all duration-200 text-sm ${isOpen           
      236 +          ? 'bg-primary-500/10 border border-primary-500/20'  
      237 +          : 'glass-button'                                    
      238 +          }`}                                                 
      239 +      >                                                       
      240 +        <div className="w-6 h-6 rounded-lg bg-primary-500 flex
          + items-center justify-center flex-shrink-0">                  
      241 +          <Bot className="w-3.5 h-3.5 text-white" />          
      242 +        </div>                                                
      243 +        <span className="text-dark-200 font-medium max-w-[180p
          +x] truncate">                                                 
      244 +          {getModelDisplayName(selectedModel)}                
      245 +        </span>                                               
      246 +        <ChevronDown className={`w-4 h-4 text-dark-400 transit
          +ion-transform duration-200 ${isOpen ? 'rotate-180' : ''}`} /> 
      247 +      </button>                                               
      248 +                                                              
      249 +      {isOpen && (                                            
      250 +        <div className="absolute top-full left-0 mt-2 w-[380px
          +] glass-dropdown rounded-2xl z-[100] overflow-hidden shadow-2x
          +l scale-in">                                                  
      251 +          {/* Search Bar */}                                  
      252 +          <div className="p-3 border-b border-dark-700/50 bg-d
          +ark-850">                                                     
      253 +            <div className="relative">                        
      254 +              <Search className="absolute left-3.5 top-1/2 -tr
          +anslate-y-1/2 w-4 h-4 text-dark-400" />                       
      255 +              <input                                          
      256 +                ref={searchInputRef}                          
      257 +                type="text"                                   
      258 +                value={searchQuery}                           
      259 +                onChange={(e) => setSearchQuery(e.target.value
          +)}                                                            
      260 +                placeholder="Search models..."                
      261 +                className="w-full pl-10 pr-9 py-2.5 rounded-xl
          + bg-dark-800 border border-dark-700 outline-none text-dark-100
          + placeholder-dark-500 text-sm focus:border-primary-500/50"    
      262 +              />                                              
      263 +              {searchQuery && (                               
      264 +                <button                                       
      265 +                  onClick={() => setSearchQuery('')}          
      266 +                  className="absolute right-2.5 top-1/2 -trans
          +late-y-1/2 p-1 hover:bg-dark-700/50 rounded-lg transition-colo
          +rs"                                                           
      267 +                >                                             
      268 +                  <X className="w-3.5 h-3.5 text-dark-400" /> 
      269 +                </button>                                     
      270 +              )}                                              
      271 +            </div>                                            
      272 +          </div>                                              
      273 +                                                              
      274 +          <div className="max-h-[400px] overflow-y-auto">     
      275 +            {loading ? (                                      
      276 +              <div className="flex items-center justify-center
          + py-12">                                                      
      277 +                <Loader2 className="w-6 h-6 text-primary-400 a
          +nimate-spin" />                                               
      278 +                <span className="ml-3 text-dark-400 text-sm">L
          +oading models...</span>                                       
      279 +              </div>                                          
      280 +            ) : (                                             
      281 +              <>                                              
      282 +                {/* Recently Used Section */}                 
      283 +                {!searchQuery && recentModelsData.length > 0 &
          +& (                                                           
      284 +                  <div className="p-2 border-b border-dark-700
          +/50">                                                         
      285 +                    <div className="flex items-center gap-2 px
          +-3 py-2 text-[11px] font-semibold text-dark-500 uppercase trac
          +king-wider">                                                  
      286 +                      <Clock className="w-3 h-3" />           
      287 +                      Recently Used                           
      288 +                    </div>                                    
      289 +                    {recentModelsData.map(model => (          
      290 +                      <button                                 
      291 +                        key={`recent-${model.id}`}            
      292 +                        onClick={() => handleSelect(model.id)}
      293 +                        className={`w-full flex items-center j
          +ustify-between px-3 py-2.5 rounded-xl transition-all duration-
          +150 text-left group ${selectedModel === model.id              
      294 +                          ? 'bg-primary-500/10 border border-p
          +rimary-500/20'                                                
      295 +                          : 'hover:bg-dark-700/50 border borde
          +r-transparent'                                                
      296 +                          }`}                                 
      297 +                      >                                       
      298 +                        <div className="flex-1 min-w-0">      
      299 +                          <p className={`text-sm font-medium t
          +runcate ${selectedModel === model.id ? 'text-dark-50' : 'text-
          +dark-200 group-hover:text-dark-100'}`}>{model.name}</p>       
      300 +                          <p className="text-xs text-dark-500 
          +truncate">                                                    
      301 +                            {getProvider(model.id)}           
      302 +                            {model.contextLength && (         
      303 +                              <span className="ml-1.5 text-dar
          +k-600">• {Math.round(model.contextLength / 1000)}k</span>     
      304 +                            )}                                
      305 +                            {model.pricing && (               
      306 +                              <span className="ml-1.5 text-gre
          +en-500/80">                                                   
      307 +                                • ${(parseFloat(model.pricing.
          +prompt) * 1000000).toFixed(2)} / ${(parseFloat(model.pricing.c
          +ompletion) * 1000000).toFixed(2)}                             
      308 +                              </span>                         
      309 +                            )}                                
      310 +                          </p>                                
      311 +                        </div>                                
      312 +                        {selectedModel === model.id && (      
      313 +                          <div className="w-5 h-5 rounded-md b
          +g-primary-500 flex items-center justify-center flex-shrink-0 m
          +l-2">                                                         
      314 +                            <Check className="w-3 h-3 text-whi
          +te" />                                                        
      315 +                          </div>                              
      316 +                        )}                                    
      317 +                      </button>                               
      318 +                    ))}                                       
      319 +                  </div>                                      
      320 +                )}                                            
      321 +                                                              
      322 +                {/* All Models Section */}                    
      323 +                <div className="p-2">                         
      324 +                  {!searchQuery && (                          
      325 +                    <div className="px-3 py-2 text-[11px] font
          +-semibold text-dark-500 uppercase tracking-wider">            
      326 +                      All Models <span className="text-dark-60
          +0">({filteredModels.length})</span>                           
      327 +                    </div>                                    
      328 +                  )}                                          
      329 +                  {searchQuery && (                           
      330 +                    <div className="px-3 py-2 text-xs text-dar
          +k-400">                                                       
      331 +                      {filteredModels.length} result{filteredM
          +odels.length !== 1 ? 's' : ''} for "<span className="text-prim
          +ary-400">{searchQuery}</span>"                                
      332 +                    </div>                                    
      333 +                  )}                                          
      334 +                                                              
      335 +                  {filteredModels.length === 0 ? (            
      336 +                    <div className="py-12 text-center">       
      337 +                      <div className="w-12 h-12 rounded-xl bg-
          +dark-800 flex items-center justify-center mx-auto mb-3">      
      338 +                        <Search className="w-6 h-6 text-dark-5
          +00" />                                                        
      339 +                      </div>                                  
      340 +                      <p className="text-dark-400 font-medium"
          +>No models found</p>                                          
      341 +                      <p className="text-xs text-dark-500 mt-1
          +">Try a different search term</p>                             
      342 +                    </div>                                    
      343 +                  ) : (                                       
      344 +                    <div className="space-y-0.5">             
      345 +                      {filteredModels.map(model => (          
      346 +                        <button                               
      347 +                          key={model.id}                      
      348 +                          onClick={() => handleSelect(model.id
          +)}                                                            
      349 +                          className={`w-full flex items-center
          + justify-between px-3 py-2.5 rounded-xl transition-all duratio
          +n-150 text-left group ${selectedModel === model.id            
      350 +                            ? 'bg-primary-500/10 border border
          +-primary-500/20'                                              
      351 +                            : 'hover:bg-dark-700/50 border bor
          +der-transparent'                                              
      352 +                            }`}                               
      353 +                        >                                     
      354 +                          <div className="flex-1 min-w-0">    
      355 +                            <p className={`text-sm font-medium
          + truncate ${selectedModel === model.id ? 'text-dark-50' : 'tex
          +t-dark-200 group-hover:text-dark-100'}`}>{model.name}</p>     
      356 +                            <p className="text-xs text-dark-50
          +0 truncate">                                                  
      357 +                              {getProvider(model.id)}         
      358 +                              {model.contextLength && (       
      359 +                                <span className="ml-1.5 text-d
          +ark-600">• {Math.round(model.contextLength / 1000)}k</span>   
      360 +                              )}                              
      361 +                              {model.pricing && (             
      362 +                                <span className="ml-1.5 text-g
          +reen-500/80">                                                 
      363 +                                  • ${(parseFloat(model.pricin
          +g.prompt) * 1000000).toFixed(2)} / ${(parseFloat(model.pricing
          +.completion) * 1000000).toFixed(2)}                           
      364 +                                </span>                       
      365 +                              )}                              
      366 +                            </p>                              
      367 +                          </div>                              
      368 +                          {selectedModel === model.id && (    
      369 +                            <div className="w-5 h-5 rounded-md
          + bg-primary-500 flex items-center justify-center flex-shrink-0
          + ml-2">                                                       
      370 +                              <Check className="w-3 h-3 text-w
          +hite" />                                                      
      371 +                            </div>                            
      372 +                          )}                                  
      373 +                        </button>                             
      374 +                      ))}                                     
      375 +                    </div>                                    
      376 +                  )}                                          
      377 +                </div>                                        
      378 +              </>                                             
      379 +            )}                                                
      380 +          </div>                                              
      381 +        </div>                                                
      382 +      )}                                                      
      383 +    </div>                                                    
      384 +  );                                                          
      385 +}                                                             
      386 +                                                              
      387 +export default ModelSelector;                                 
      388 +export { DEFAULT_MODEL, RECENT_MODELS_KEY, MODELS_CACHE_KEY };
✔ Task #5 updated: status → completed
✔ Task #6 updated: status → in progress

● Now let me update the auth pages.

● Write(client\src\pages\Login.jsx)
  ⎿  Added 129 lines, removed 129 lines
        1 -import React, { useState, useContext } from 'react';         
        2 -import { Link } from 'react-router-dom';                     
        3 -import { MessageSquare, Lock, Mail, Sparkles } from 'lucide-re
          -act';                                                        
        4 -import { AuthContext } from '../contexts/AuthContext';       
        5 -                                                             
        6 -function Login() {                                           
        7 -  const [email, setEmail] = useState('');                    
        8 -  const [password, setPassword] = useState('');              
        9 -  const [error, setError] = useState('');                    
       10 -  const [loading, setLoading] = useState(false);             
       11 -  const { login } = useContext(AuthContext);                 
       12 -                                                             
       13 -  const handleSubmit = async (e) => {                        
       14 -    e.preventDefault();                                      
       15 -    setError('');                                            
       16 -    setLoading(true);                                        
       17 -                                                             
       18 -    try {                                                    
       19 -      const res = await fetch('/api/auth/login', {           
       20 -        method: 'POST',                                      
       21 -        headers: { 'Content-Type': 'application/json' },     
       22 -        body: JSON.stringify({ email, password })            
       23 -      });                                                    
       24 -                                                             
       25 -      const data = await res.json();                         
       26 -                                                             
       27 -      if (!res.ok) {                                         
       28 -        throw new Error(data.error || 'Login failed');       
       29 -      }                                                      
       30 -                                                             
       31 -      login(data.token, data.user);                          
       32 -    } catch (err) {                                          
       33 -      setError(err.message);                                 
       34 -    } finally {                                              
       35 -      setLoading(false);                                     
       36 -    }                                                        
       37 -  };                                                         
       38 -                                                             
       39 -  return (                                                   
       40 -    <div className="min-h-screen flex items-center justify-cen
          -ter bg-dark-950 bg-mesh p-4">                                
       41 -      <div className="max-w-md w-full">                      
       42 -        <div className="text-center mb-8">                   
       43 -          <div className="inline-flex items-center justify-cen
          -ter w-16 h-16 rounded-2xl gradient-primary mb-4 shadow-glow">
       44 -            <MessageSquare className="w-8 h-8 text-white" /> 
       45 -          </div>                                             
       46 -          <h1 className="text-4xl font-bold gradient-text mb-2
          -">Budi Chat</h1>                                             
       47 -          <p className="text-dark-400">Welcome back! Please si
          -gn in to continue.</p>                                       
       48 -        </div>                                               
       49 -                                                             
       50 -        <div className="glass-card rounded-2xl p-8">         
       51 -          <form onSubmit={handleSubmit} className="space-y-6">
          -                                                              
       52 -            {error && (                                      
       53 -              <div className="bg-red-500/20 border border-red-
          -500/30 text-red-300 px-4 py-3 rounded-lg text-sm">           
       54 -                {error}                                      
       55 -              </div>                                         
       56 -            )}                                               
       57 -                                                             
       58 -            <div>                                            
       59 -              <label className="block text-sm font-medium text
          --dark-200 mb-2">                                             
       60 -                Email Address                                
       61 -              </label>                                       
       62 -              <div className="relative">                     
       63 -                <Mail className="absolute left-3 top-1/2 -tran
          -slate-y-1/2 w-5 h-5 text-dark-400" />                        
       64 -                <input                                       
       65 -                  type="email"                               
       66 -                  value={email}                              
       67 -                  onChange={(e) => setEmail(e.target.value)} 
       68 -                  className="w-full pl-10 pr-4 py-3 rounded-lg
          - glass-input outline-none text-dark-100 bg-dark-800/50 transit
          -ion"                                                         
       69 -                  placeholder="you@example.com"              
       70 -                  required                                   
       71 -                />                                           
       72 -              </div>                                         
       73 -            </div>                                           
       74 -                                                             
       75 -            <div>                                            
       76 -              <label className="block text-sm font-medium text
          --dark-200 mb-2">                                             
       77 -                Password                                     
       78 -              </label>                                       
       79 -              <div className="relative">                     
       80 -                <Lock className="absolute left-3 top-1/2 -tran
          -slate-y-1/2 w-5 h-5 text-dark-400" />                        
       81 -                <input                                       
       82 -                  type="password"                            
       83 -                  value={password}                           
       84 -                  onChange={(e) => setPassword(e.target.value)
          -}                                                            
       85 -                  className="w-full pl-10 pr-4 py-3 rounded-lg
          - glass-input outline-none text-dark-100 bg-dark-800/50 transit
          -ion"                                                         
       86 -                  placeholder="••••••••"                     
       87 -                  required                                   
       88 -                />                                           
       89 -              </div>                                         
       90 -            </div>                                           
       91 -                                                             
       92 -            <button                                          
       93 -              type="submit"                                  
       94 -              disabled={loading}                             
       95 -              className="w-full gradient-primary text-white py
          --3 rounded-lg font-medium hover:shadow-glow transition-all dis
          -abled:opacity-50 disabled:cursor-not-allowed flex items-center
          - justify-center gap-2"                                       
       96 -            >                                                
       97 -              {loading ? (                                   
       98 -                <>                                           
       99 -                  <div className="animate-spin rounded-full h-
          -5 w-5 border-2 border-white border-t-transparent"></div>     
      100 -                  Signing in...                              
      101 -                </>                                          
      102 -              ) : (                                          
      103 -                <>                                           
      104 -                  <Sparkles className="w-5 h-5" />           
      105 -                  Sign In                                    
      106 -                </>                                          
      107 -              )}                                             
      108 -            </button>                                        
      109 -          </form>                                            
      110 -                                                             
      111 -          <div className="mt-6 text-center">                 
      112 -            <p className="text-sm text-dark-400">            
      113 -              Don't have an account?{' '}                    
      114 -              <Link to="/register" className="text-primary-400
          - hover:text-primary-300 font-medium">                        
      115 -                Sign up                                      
      116 -              </Link>                                        
      117 -            </p>                                             
      118 -          </div>                                             
      119 -        </div>                                               
      120 -                                                             
      121 -        <div className="mt-6 text-center text-sm text-dark-500
          -">                                                           
      122 -          <p>Multi-user AI chat with memories, tools & agent m
          -ode</p>                                                      
      123 -        </div>                                               
      124 -      </div>                                                 
      125 -    </div>                                                   
      126 -  );                                                         
      127 -}                                                            
      128 -                                                             
      129 -export default Login;                                        
        1 +import React, { useState, useContext } from 'react';          
        2 +import { Link } from 'react-router-dom';                      
        3 +import { MessageSquare, Lock, Mail, ArrowRight } from 'lucide-
          +react';                                                       
        4 +import { AuthContext } from '../contexts/AuthContext';        
        5 +                                                              
        6 +function Login() {                                            
        7 +  const [email, setEmail] = useState('');                     
        8 +  const [password, setPassword] = useState('');               
        9 +  const [error, setError] = useState('');                     
       10 +  const [loading, setLoading] = useState(false);              
       11 +  const { login } = useContext(AuthContext);                  
       12 +                                                              
       13 +  const handleSubmit = async (e) => {                         
       14 +    e.preventDefault();                                       
       15 +    setError('');                                             
       16 +    setLoading(true);                                         
       17 +                                                              
       18 +    try {                                                     
       19 +      const res = await fetch('/api/auth/login', {            
       20 +        method: 'POST',                                       
       21 +        headers: { 'Content-Type': 'application/json' },      
       22 +        body: JSON.stringify({ email, password })             
       23 +      });                                                     
       24 +                                                              
       25 +      const data = await res.json();                          
       26 +                                                              
       27 +      if (!res.ok) {                                          
       28 +        throw new Error(data.error || 'Login failed');        
       29 +      }                                                       
       30 +                                                              
       31 +      login(data.token, data.user);                           
       32 +    } catch (err) {                                           
       33 +      setError(err.message);                                  
       34 +    } finally {                                               
       35 +      setLoading(false);                                      
       36 +    }                                                         
       37 +  };                                                          
       38 +                                                              
       39 +  return (                                                    
       40 +    <div className="min-h-screen flex items-center justify-cen
          +ter bg-dark-950 bg-mesh p-4">                                 
       41 +      <div className="max-w-md w-full">                       
       42 +        <div className="text-center mb-8">                    
       43 +          <div className="inline-flex items-center justify-cen
          +ter w-16 h-16 rounded-2xl bg-primary-500 mb-4">               
       44 +            <MessageSquare className="w-8 h-8 text-white" />  
       45 +          </div>                                              
       46 +          <h1 className="text-4xl font-bold text-primary-400 m
          +b-2 tracking-tight">AI Chat Hub</h1>                          
       47 +          <p className="text-dark-400">Welcome back. Sign in t
          +o continue.</p>                                               
       48 +        </div>                                                
       49 +                                                              
       50 +        <div className="glass-card rounded-2xl p-8">          
       51 +          <form onSubmit={handleSubmit} className="space-y-6">
       52 +            {error && (                                       
       53 +              <div className="bg-red-500/10 border border-red-
          +500/20 text-red-400 px-4 py-3 rounded-xl text-sm">            
       54 +                {error}                                       
       55 +              </div>                                          
       56 +            )}                                                
       57 +                                                              
       58 +            <div>                                             
       59 +              <label className="block text-sm font-medium text
          +-dark-300 mb-2">                                              
       60 +                Email Address                                 
       61 +              </label>                                        
       62 +              <div className="relative">                      
       63 +                <Mail className="absolute left-3.5 top-1/2 -tr
          +anslate-y-1/2 w-5 h-5 text-dark-400" />                       
       64 +                <input                                        
       65 +                  type="email"                                
       66 +                  value={email}                               
       67 +                  onChange={(e) => setEmail(e.target.value)}  
       68 +                  className="w-full pl-11 pr-4 py-3 rounded-xl
          + glass-input outline-none text-dark-100 text-sm"              
       69 +                  placeholder="you@example.com"               
       70 +                  required                                    
       71 +                />                                            
       72 +              </div>                                          
       73 +            </div>                                            
       74 +                                                              
       75 +            <div>                                             
       76 +              <label className="block text-sm font-medium text
          +-dark-300 mb-2">                                              
       77 +                Password                                      
       78 +              </label>                                        
       79 +              <div className="relative">                      
       80 +                <Lock className="absolute left-3.5 top-1/2 -tr
          +anslate-y-1/2 w-5 h-5 text-dark-400" />                       
       81 +                <input                                        
       82 +                  type="password"                             
       83 +                  value={password}                            
       84 +                  onChange={(e) => setPassword(e.target.value)
          +}                                                             
       85 +                  className="w-full pl-11 pr-4 py-3 rounded-xl
          + glass-input outline-none text-dark-100 text-sm"              
       86 +                  placeholder="Enter your password"           
       87 +                  required                                    
       88 +                />                                            
       89 +              </div>                                          
       90 +            </div>                                            
       91 +                                                              
       92 +            <button                                           
       93 +              type="submit"                                   
       94 +              disabled={loading}                              
       95 +              className="w-full bg-primary-500 hover:bg-primar
          +y-600 text-white py-3 rounded-xl font-semibold transition-all 
          +duration-200 disabled:opacity-50 disabled:cursor-not-allowed f
          +lex items-center justify-center gap-2 active:scale-[0.98]"    
       96 +            >                                                 
       97 +              {loading ? (                                    
       98 +                <>                                            
       99 +                  <div className="animate-spin rounded-full h-
          +5 w-5 border-2 border-white border-t-transparent"></div>      
      100 +                  Signing in...                               
      101 +                </>                                           
      102 +              ) : (                                           
      103 +                <>                                            
      104 +                  Sign In                                     
      105 +                  <ArrowRight className="w-4 h-4" />          
      106 +                </>                                           
      107 +              )}                                              
      108 +            </button>                                         
      109 +          </form>                                             
      110 +                                                              
      111 +          <div className="mt-6 text-center">                  
      112 +            <p className="text-sm text-dark-400">             
      113 +              Don't have an account?{' '}                     
      114 +              <Link to="/register" className="text-primary-400
          + hover:text-primary-300 font-medium transition-colors">       
      115 +                Sign up                                       
      116 +              </Link>                                         
      117 +            </p>                                              
      118 +          </div>                                              
      119 +        </div>                                                
      120 +                                                              
      121 +        <div className="mt-6 text-center text-sm text-dark-500
          +">                                                            
      122 +          <p>Multi-user AI chat with memories, tools & agent m
          +ode</p>                                                       
      123 +        </div>                                                
      124 +      </div>                                                  
      125 +    </div>                                                    
      126 +  );                                                          
      127 +}                                                             
      128 +                                                              
      129 +export default Login;                                         

● Write(client\src\pages\Register.jsx)
  ⎿  Added 149 lines, removed 149 lines
        1 -import React, { useState, useContext } from 'react';         
        2 -import { Link } from 'react-router-dom';                     
        3 -import { MessageSquare, Lock, Mail, User, Sparkles } from 'luc
          -ide-react';                                                  
        4 -import { AuthContext } from '../contexts/AuthContext';       
        5 -                                                             
        6 -function Register() {                                        
        7 -  const [email, setEmail] = useState('');                    
        8 -  const [password, setPassword] = useState('');              
        9 -  const [name, setName] = useState('');                      
       10 -  const [error, setError] = useState('');                    
       11 -  const [loading, setLoading] = useState(false);             
       12 -  const { login } = useContext(AuthContext);                 
       13 -                                                             
       14 -  const handleSubmit = async (e) => {                        
       15 -    e.preventDefault();                                      
       16 -    setError('');                                            
       17 -    setLoading(true);                                        
       18 -                                                             
       19 -    try {                                                    
       20 -      const res = await fetch('/api/auth/register', {        
       21 -        method: 'POST',                                      
       22 -        headers: { 'Content-Type': 'application/json' },     
       23 -        body: JSON.stringify({ email, password, name })      
       24 -      });                                                    
       25 -                                                             
       26 -      const data = await res.json();                         
       27 -                                                             
       28 -      if (!res.ok) {                                         
       29 -        throw new Error(data.error || 'Registration failed');
       30 -      }                                                      
       31 -                                                             
       32 -      login(data.token, data.user);                          
       33 -    } catch (err) {                                          
       34 -      setError(err.message);                                 
       35 -    } finally {                                              
       36 -      setLoading(false);                                     
       37 -    }                                                        
       38 -  };                                                         
       39 -                                                             
       40 -  return (                                                   
       41 -    <div className="min-h-screen flex items-center justify-cen
          -ter bg-dark-950 bg-mesh p-4">                                
       42 -      <div className="max-w-md w-full">                      
       43 -        <div className="text-center mb-8">                   
       44 -          <div className="inline-flex items-center justify-cen
          -ter w-16 h-16 rounded-2xl gradient-primary mb-4 shadow-glow">
       45 -            <MessageSquare className="w-8 h-8 text-white" /> 
       46 -          </div>                                             
       47 -          <h1 className="text-4xl font-bold gradient-text mb-2
          -">Budi Chat</h1>                                             
       48 -          <p className="text-dark-400">Create your account to 
          -get started.</p>                                             
       49 -        </div>                                               
       50 -                                                             
       51 -        <div className="glass-card rounded-2xl p-8">         
       52 -          <form onSubmit={handleSubmit} className="space-y-6">
          -                                                              
       53 -            {error && (                                      
       54 -              <div className="bg-red-500/20 border border-red-
          -500/30 text-red-300 px-4 py-3 rounded-lg text-sm">           
       55 -                {error}                                      
       56 -              </div>                                         
       57 -            )}                                               
       58 -                                                             
       59 -            <div>                                            
       60 -              <label className="block text-sm font-medium text
          --dark-200 mb-2">                                             
       61 -                Full Name                                    
       62 -              </label>                                       
       63 -              <div className="relative">                     
       64 -                <User className="absolute left-3 top-1/2 -tran
          -slate-y-1/2 w-5 h-5 text-dark-400" />                        
       65 -                <input                                       
       66 -                  type="text"                                
       67 -                  value={name}                               
       68 -                  onChange={(e) => setName(e.target.value)}  
       69 -                  className="w-full pl-10 pr-4 py-3 rounded-lg
          - glass-input outline-none text-dark-100 bg-dark-800/50 transit
          -ion"                                                         
       70 -                  placeholder="John Doe"                     
       71 -                  required                                   
       72 -                />                                           
       73 -              </div>                                         
       74 -            </div>                                           
       75 -                                                             
       76 -            <div>                                            
       77 -              <label className="block text-sm font-medium text
          --dark-200 mb-2">                                             
       78 -                Email Address                                
       79 -              </label>                                       
       80 -              <div className="relative">                     
       81 -                <Mail className="absolute left-3 top-1/2 -tran
          -slate-y-1/2 w-5 h-5 text-dark-400" />                        
       82 -                <input                                       
       83 -                  type="email"                               
       84 -                  value={email}                              
       85 -                  onChange={(e) => setEmail(e.target.value)} 
       86 -                  className="w-full pl-10 pr-4 py-3 rounded-lg
          - glass-input outline-none text-dark-100 bg-dark-800/50 transit
          -ion"                                                         
       87 -                  placeholder="you@example.com"              
       88 -                  required                                   
       89 -                />                                           
       90 -              </div>                                         
       91 -            </div>                                           
       92 -                                                             
       93 -            <div>                                            
       94 -              <label className="block text-sm font-medium text
          --dark-200 mb-2">                                             
       95 -                Password                                     
       96 -              </label>                                       
       97 -              <div className="relative">                     
       98 -                <Lock className="absolute left-3 top-1/2 -tran
          -slate-y-1/2 w-5 h-5 text-dark-400" />                        
       99 -                <input                                       
      100 -                  type="password"                            
      101 -                  value={password}                           
      102 -                  onChange={(e) => setPassword(e.target.value)
          -}                                                            
      103 -                  className="w-full pl-10 pr-4 py-3 rounded-lg
          - glass-input outline-none text-dark-100 bg-dark-800/50 transit
          -ion"                                                         
      104 -                  placeholder="••••••••"                     
      105 -                  required                                   
      106 -                  minLength={6}                              
      107 -                />                                           
      108 -              </div>                                         
      109 -              <p className="mt-1 text-xs text-dark-500">At lea
          -st 6 characters</p>                                          
      110 -            </div>                                           
      111 -                                                             
      112 -            <button                                          
      113 -              type="submit"                                  
      114 -              disabled={loading}                             
      115 -              className="w-full gradient-primary text-white py
          --3 rounded-lg font-medium hover:shadow-glow transition-all dis
          -abled:opacity-50 disabled:cursor-not-allowed flex items-center
          - justify-center gap-2"                                       
      116 -            >                                                
      117 -              {loading ? (                                   
      118 -                <>                                           
      119 -                  <div className="animate-spin rounded-full h-
          -5 w-5 border-2 border-white border-t-transparent"></div>     
      120 -                  Creating account...                        
      121 -                </>                                          
      122 -              ) : (                                          
      123 -                <>                                           
      124 -                  <Sparkles className="w-5 h-5" />           
      125 -                  Create Account                             
      126 -                </>                                          
      127 -              )}                                             
      128 -            </button>                                        
      129 -          </form>                                            
      130 -                                                             
      131 -          <div className="mt-6 text-center">                 
      132 -            <p className="text-sm text-dark-400">            
      133 -              Already have an account?{' '}                  
      134 -              <Link to="/login" className="text-primary-400 ho
          -ver:text-primary-300 font-medium">                           
      135 -                Sign in                                      
      136 -              </Link>                                        
      137 -            </p>                                             
      138 -          </div>                                             
      139 -        </div>                                               
      140 -                                                             
      141 -        <div className="mt-6 text-center text-sm text-dark-500
          -">                                                           
      142 -          <p>Multi-user AI chat with memories, tools & agent m
          -ode</p>                                                      
      143 -        </div>                                               
      144 -      </div>                                                 
      145 -    </div>                                                   
      146 -  );                                                         
      147 -}                                                            
      148 -                                                             
      149 -export default Register;                                     
        1 +import React, { useState, useContext } from 'react';          
        2 +import { Link } from 'react-router-dom';                      
        3 +import { MessageSquare, Lock, Mail, User, ArrowRight } from 'l
          +ucide-react';                                                 
        4 +import { AuthContext } from '../contexts/AuthContext';        
        5 +                                                              
        6 +function Register() {                                         
        7 +  const [email, setEmail] = useState('');                     
        8 +  const [password, setPassword] = useState('');               
        9 +  const [name, setName] = useState('');                       
       10 +  const [error, setError] = useState('');                     
       11 +  const [loading, setLoading] = useState(false);              
       12 +  const { login } = useContext(AuthContext);                  
       13 +                                                              
       14 +  const handleSubmit = async (e) => {                         
       15 +    e.preventDefault();                                       
       16 +    setError('');                                             
       17 +    setLoading(true);                                         
       18 +                                                              
       19 +    try {                                                     
       20 +      const res = await fetch('/api/auth/register', {         
       21 +        method: 'POST',                                       
       22 +        headers: { 'Content-Type': 'application/json' },      
       23 +        body: JSON.stringify({ email, password, name })       
       24 +      });                                                     
       25 +                                                              
       26 +      const data = await res.json();                          
       27 +                                                              
       28 +      if (!res.ok) {                                          
       29 +        throw new Error(data.error || 'Registration failed'); 
       30 +      }                                                       
       31 +                                                              
       32 +      login(data.token, data.user);                           
       33 +    } catch (err) {                                           
       34 +      setError(err.message);                                  
       35 +    } finally {                                               
       36 +      setLoading(false);                                      
       37 +    }                                                         
       38 +  };                                                          
       39 +                                                              
       40 +  return (                                                    
       41 +    <div className="min-h-screen flex items-center justify-cen
          +ter bg-dark-950 bg-mesh p-4">                                 
       42 +      <div className="max-w-md w-full">                       
       43 +        <div className="text-center mb-8">                    
       44 +          <div className="inline-flex items-center justify-cen
          +ter w-16 h-16 rounded-2xl bg-primary-500 mb-4">               
       45 +            <MessageSquare className="w-8 h-8 text-white" />  
       46 +          </div>                                              
       47 +          <h1 className="text-4xl font-bold text-primary-400 m
          +b-2 tracking-tight">AI Chat Hub</h1>                          
       48 +          <p className="text-dark-400">Create your account to 
          +get started.</p>                                              
       49 +        </div>                                                
       50 +                                                              
       51 +        <div className="glass-card rounded-2xl p-8">          
       52 +          <form onSubmit={handleSubmit} className="space-y-6">
       53 +            {error && (                                       
       54 +              <div className="bg-red-500/10 border border-red-
          +500/20 text-red-400 px-4 py-3 rounded-xl text-sm">            
       55 +                {error}                                       
       56 +              </div>                                          
       57 +            )}                                                
       58 +                                                              
       59 +            <div>                                             
       60 +              <label className="block text-sm font-medium text
          +-dark-300 mb-2">                                              
       61 +                Full Name                                     
       62 +              </label>                                        
       63 +              <div className="relative">                      
       64 +                <User className="absolute left-3.5 top-1/2 -tr
          +anslate-y-1/2 w-5 h-5 text-dark-400" />                       
       65 +                <input                                        
       66 +                  type="text"                                 
       67 +                  value={name}                                
       68 +                  onChange={(e) => setName(e.target.value)}   
       69 +                  className="w-full pl-11 pr-4 py-3 rounded-xl
          + glass-input outline-none text-dark-100 text-sm"              
       70 +                  placeholder="John Doe"                      
       71 +                  required                                    
       72 +                />                                            
       73 +              </div>                                          
       74 +            </div>                                            
       75 +                                                              
       76 +            <div>                                             
       77 +              <label className="block text-sm font-medium text
          +-dark-300 mb-2">                                              
       78 +                Email Address                                 
       79 +              </label>                                        
       80 +              <div className="relative">                      
       81 +                <Mail className="absolute left-3.5 top-1/2 -tr
          +anslate-y-1/2 w-5 h-5 text-dark-400" />                       
       82 +                <input                                        
       83 +                  type="email"                                
       84 +                  value={email}                               
       85 +                  onChange={(e) => setEmail(e.target.value)}  
       86 +                  className="w-full pl-11 pr-4 py-3 rounded-xl
          + glass-input outline-none text-dark-100 text-sm"              
       87 +                  placeholder="you@example.com"               
       88 +                  required                                    
       89 +                />                                            
       90 +              </div>                                          
       91 +            </div>                                            
       92 +                                                              
       93 +            <div>                                             
       94 +              <label className="block text-sm font-medium text
          +-dark-300 mb-2">                                              
       95 +                Password                                      
       96 +              </label>                                        
       97 +              <div className="relative">                      
       98 +                <Lock className="absolute left-3.5 top-1/2 -tr
          +anslate-y-1/2 w-5 h-5 text-dark-400" />                       
       99 +                <input                                        
      100 +                  type="password"                             
      101 +                  value={password}                            
      102 +                  onChange={(e) => setPassword(e.target.value)
          +}                                                             
      103 +                  className="w-full pl-11 pr-4 py-3 rounded-xl
          + glass-input outline-none text-dark-100 text-sm"              
      104 +                  placeholder="Create a password"             
      105 +                  required                                    
      106 +                  minLength={6}                               
      107 +                />                                            
      108 +              </div>                                          
      109 +              <p className="mt-1.5 text-xs text-dark-500">At l
          +east 6 characters</p>                                         
      110 +            </div>                                            
      111 +                                                              
      112 +            <button                                           
      113 +              type="submit"                                   
      114 +              disabled={loading}                              
      115 +              className="w-full bg-primary-500 hover:bg-primar
          +y-600 text-white py-3 rounded-xl font-semibold transition-all 
          +duration-200 disabled:opacity-50 disabled:cursor-not-allowed f
          +lex items-center justify-center gap-2 active:scale-[0.98]"    
      116 +            >                                                 
      117 +              {loading ? (                                    
      118 +                <>                                            
      119 +                  <div className="animate-spin rounded-full h-
          +5 w-5 border-2 border-white border-t-transparent"></div>      
      120 +                  Creating account...                         
      121 +                </>                                           
      122 +              ) : (                                           
      123 +                <>                                            
      124 +                  Create Account                              
      125 +                  <ArrowRight className="w-4 h-4" />          
      126 +                </>                                           
      127 +              )}                                              
      128 +            </button>                                         
      129 +          </form>                                             
      130 +                                                              
      131 +          <div className="mt-6 text-center">                  
      132 +            <p className="text-sm text-dark-400">             
      133 +              Already have an account?{' '}                   
      134 +              <Link to="/login" className="text-primary-400 ho
          +ver:text-primary-300 font-medium transition-colors">          
      135 +                Sign in                                       
      136 +              </Link>                                         
      137 +            </p>                                              
      138 +          </div>                                              
      139 +        </div>                                                
      140 +                                                              
      141 +        <div className="mt-6 text-center text-sm text-dark-500
          +">                                                            
      142 +          <p>Multi-user AI chat with memories, tools & agent m
          +ode</p>                                                       
      143 +        </div>                                                
      144 +      </div>                                                  
      145 +    </div>                                                    
      146 +  );                                                          
      147 +}                                                             
      148 +                                                              
      149 +export default Register;                                      
✔ Task #6 updated: status → completed
✔ Task #7 updated: status → in progress

● Now let me update the Profile, StatsTab, and Memories pages.

● Write(client\src\pages\Profile.jsx)
  ⎿  Added 72 lines, removed 72 lines
       1 -import React, { useState, useContext } from 'react';          
       2 -import { useNavigate } from 'react-router-dom';               
       3 -import { ArrowLeft, User, BarChart2, Settings } from 'lucide-re
         -act';                                                         
       4 -import { AuthContext } from '../contexts/AuthContext';        
       5 -import ProfileTab from '../components/ProfileTab';            
       6 -import StatsTab from '../components/StatsTab';                
       7 -import SettingsTab from '../components/SettingsTab';          
       8 -                                                              
       9 -function Profile() {                                          
      10 -  const { user, logout } = useContext(AuthContext);           
      11 -  const navigate = useNavigate();                             
      12 -  const [activeTab, setActiveTab] = useState('profile');      
      13 -                                                              
      14 -  const tabs = [                                              
      15 -    { id: 'profile', label: 'Profile', icon: User },          
      16 -    { id: 'stats', label: 'Stats', icon: BarChart2 },         
      17 -    { id: 'settings', label: 'Settings', icon: Settings },    
      18 -  ];                                                          
      19 -                                                              
      20 -  return (                                                    
      21 -    <div className="min-h-screen bg-dark-950 bg-mesh">        
      22 -      <div className="max-w-6xl mx-auto p-6">                 
      23 -        <button                                               
      24 -          onClick={() => navigate('/')}                       
      25 -          className="mb-6 flex items-center gap-2 text-dark-400
         - hover:text-dark-200 transition-colors"                       
      26 -        >                                                     
      27 -          <ArrowLeft className="w-4 h-4" />                   
      28 -          Back to Chat                                        
      29 -        </button>                                             
      30 -                                                              
      31 -        <div className="flex gap-6">                          
      32 -          {/* Sidebar */}                                     
      33 -          <div className="w-56 shrink-0">                     
      34 -            <div className="glass-card rounded-2xl p-4 sticky t
         -op-6">                                                        
      35 -              <h1 className="text-xl font-bold gradient-text mb
         --4 px-2">Account</h1>                                         
      36 -              <nav className="space-y-1">                     
      37 -                {tabs.map((tab) => {                          
      38 -                  const Icon = tab.icon;                      
      39 -                  return (                                    
      40 -                    <button                                   
      41 -                      key={tab.id}                            
      42 -                      onClick={() => setActiveTab(tab.id)}    
      43 -                      className={`w-full flex items-center gap-
         -3 px-4 py-3 rounded-xl transition-all ${                      
      44 -                        activeTab === tab.id                  
      45 -                          ? 'gradient-primary text-white shadow
         --glow'                                                        
      46 -                          : 'text-dark-300 hover:text-dark-100 
         -hover:bg-dark-800/50'                                         
      47 -                      }`}                                     
      48 -                    >                                         
      49 -                      <Icon className="w-5 h-5" />            
      50 -                      <span className="font-medium">{tab.label}
         -</span>                                                       
      51 -                    </button>                                 
      52 -                  );                                          
      53 -                })}                                           
      54 -              </nav>                                          
      55 -            </div>                                            
      56 -          </div>                                              
      57 -                                                              
      58 -          {/* Content Area */}                                
      59 -          <div className="flex-1 min-w-0">                    
      60 -            <div className="glass-card rounded-2xl p-8">      
      61 -              {activeTab === 'profile' && <ProfileTab user={use
         -r} />}                                                        
      62 -              {activeTab === 'stats' && <StatsTab />}         
      63 -              {activeTab === 'settings' && <SettingsTab user={u
         -ser} logout={logout} />}                                      
      64 -            </div>                                            
      65 -          </div>                                              
      66 -        </div>                                                
      67 -      </div>                                                  
      68 -    </div>                                                    
      69 -  );                                                          
      70 -}                                                             
      71 -                                                              
      72 -export default Profile;                                       
       1 +import React, { useState, useContext } from 'react';           
       2 +import { useNavigate } from 'react-router-dom';                
       3 +import { ArrowLeft, User, BarChart2, Settings } from 'lucide-re
         +act';                                                          
       4 +import { AuthContext } from '../contexts/AuthContext';         
       5 +import ProfileTab from '../components/ProfileTab';             
       6 +import StatsTab from '../components/StatsTab';                 
       7 +import SettingsTab from '../components/SettingsTab';           
       8 +                                                               
       9 +function Profile() {                                           
      10 +  const { user, logout } = useContext(AuthContext);            
      11 +  const navigate = useNavigate();                              
      12 +  const [activeTab, setActiveTab] = useState('profile');       
      13 +                                                               
      14 +  const tabs = [                                               
      15 +    { id: 'profile', label: 'Profile', icon: User },           
      16 +    { id: 'stats', label: 'Stats', icon: BarChart2 },          
      17 +    { id: 'settings', label: 'Settings', icon: Settings },     
      18 +  ];                                                           
      19 +                                                               
      20 +  return (                                                     
      21 +    <div className="min-h-screen bg-dark-950 bg-mesh">         
      22 +      <div className="max-w-6xl mx-auto p-6">                  
      23 +        <button                                                
      24 +          onClick={() => navigate('/')}                        
      25 +          className="mb-6 flex items-center gap-2 text-dark-400
         + hover:text-dark-200 transition-colors"                        
      26 +        >                                                      
      27 +          <ArrowLeft className="w-4 h-4" />                    
      28 +          Back to Chat                                         
      29 +        </button>                                              
      30 +                                                               
      31 +        <div className="flex gap-6">                           
      32 +          {/* Sidebar */}                                      
      33 +          <div className="w-56 shrink-0">                      
      34 +            <div className="glass-card rounded-2xl p-4 sticky t
         +op-6">                                                         
      35 +              <h1 className="text-xl font-bold text-primary-400
         + mb-4 px-2 tracking-tight">Account</h1>                        
      36 +              <nav className="space-y-1">                      
      37 +                {tabs.map((tab) => {                           
      38 +                  const Icon = tab.icon;                       
      39 +                  return (                                     
      40 +                    <button                                    
      41 +                      key={tab.id}                             
      42 +                      onClick={() => setActiveTab(tab.id)}     
      43 +                      className={`w-full flex items-center gap-
         +3 px-4 py-3 rounded-xl transition-all duration-200 ${          
      44 +                        activeTab === tab.id                   
      45 +                          ? 'bg-primary-500 text-white'        
      46 +                          : 'text-dark-300 hover:text-dark-100 
         +hover:bg-dark-700/50'                                          
      47 +                      }`}                                      
      48 +                    >                                          
      49 +                      <Icon className="w-5 h-5" />             
      50 +                      <span className="font-medium">{tab.label}
         +</span>                                                        
      51 +                    </button>                                  
      52 +                  );                                           
      53 +                })}                                            
      54 +              </nav>                                           
      55 +            </div>                                             
      56 +          </div>                                               
      57 +                                                               
      58 +          {/* Content Area */}                                 
      59 +          <div className="flex-1 min-w-0">                     
      60 +            <div className="glass-card rounded-2xl p-8">       
      61 +              {activeTab === 'profile' && <ProfileTab user={use
         +r} />}                                                         
      62 +              {activeTab === 'stats' && <StatsTab />}          
      63 +              {activeTab === 'settings' && <SettingsTab user={u
         +ser} logout={logout} />}                                       
      64 +            </div>                                             
      65 +          </div>                                               
      66 +        </div>                                                 
      67 +      </div>                                                   
      68 +    </div>                                                     
      69 +  );                                                           
      70 +}                                                              
      71 +                                                               
      72 +export default Profile;                                        

● Write(client\src\components\StatsTab.jsx)
  ⎿  Added 13 lines, removed 15 lines
      129    const activeDays = weekData.filter(
      130      (d) => d.hasActivity && !d.isFuture,
      131    ).length;
      132 -  const progressPercent =                                     
      133 -    daysUpToToday > 0 ? (activeDays / daysUpToToday) * 100 : 0
          -;                                                             
      132  
      133    return (
      134      <div>
      137 -      <h2 className="text-2xl font-bold text-dark-100 mb-2">  
      135 +      <h2 className="text-2xl font-bold text-dark-100 mb-2 tra
          +cking-tight">                                                 
      136          Usage Statistics
      137        </h2>
      138        <p className="text-dark-400 mb-6">
     ...
      140        </p>
      141  
      142        {/* Weekly Activity Calendar */}
      145 -      <div className="bg-dark-800/30 rounded-xl p-6 border bor
          -der-dark-700/30 mb-8">                                        
      143 +      <div className="bg-dark-800/50 rounded-xl p-6 border bor
          +der-dark-700/50 mb-8">                                        
      144          <h3 className="text-lg font-semibold text-dark-100 mb-
           4 flex items-center gap-2">
      145            <Calendar className="w-5 h-5 text-accent-400" />
      146            Weekly Activity
     ...
      159                      transition-all duration-300 cursor-default
      160                      ${
      161                        day.hasActivity
      164 -                        ? "bg-gradient-to-br from-primary-500 
          -to-accent-500 text-white shadow-lg shadow-primary-500/30"     
      162 +                        ? "bg-primary-500 text-white"         
      163                          : day.isToday
      164                            ? "bg-dark-700 border-2 border-prima
           ry-500/50 text-dark-300"
      165                            : day.isFuture
     ...
      196  
      197                  {/* Hover tooltip */}
      198                  <div className="absolute -top-14 left-1/2 -tra
           nslate-x-1/2 opacity-0 group-hover:opacity-100 transition-opac
           ity pointer-events-none z-20">
      201 -                  <div className="bg-dark-800 border border-da
          -rk-600 rounded-lg px-3 py-2 text-xs whitespace-nowrap shadow-x
          -l">                                                           
      199 +                  <div className="bg-dark-800 border border-da
          +rk-700 rounded-lg px-3 py-2 text-xs whitespace-nowrap shadow-x
          +l">                                                           
      200                      <div className="text-dark-300 font-medium"
           >
      201                        {new Date(day.date).toLocaleDateString("
           en-US", {
      202                          weekday: "long",
     ...
      212                      </div>
      213                    </div>
      214                    {/* Tooltip arrow */}
      217 -                  <div className="absolute left-1/2 -translate
          --x-1/2 -bottom-1 w-2 h-2 bg-dark-800 border-r border-b border-
          -dark-600 rotate-45" />                                        
      215 +                  <div className="absolute left-1/2 -translate
          +-x-1/2 -bottom-1 w-2 h-2 bg-dark-800 border-r border-b border-
          +dark-700 rotate-45" />                                        
      216                  </div>
      217                </div>
      218  
     ...
      221                  <div
      222                    className={`flex-1 h-1 mx-1 rounded-full sel
           f-start mt-[22px] min-w-[40px] ${
      223                      day.hasActivity && weekData[index + 1].has
           Activity
      226 -                      ? "bg-gradient-to-r from-primary-500 to-
          -accent-500"                                                   
      224 +                      ? "bg-primary-500"                      
      225                        : day.hasActivity || weekData[index + 1]
           .hasActivity
      228 -                        ? "bg-gradient-to-r from-primary-500/3
          -0 to-accent-500/30"                                           
      226 +                        ? "bg-primary-500/30"                 
      227                          : "bg-dark-700"
      228                    }`}
      229                  />
     ...
      280        </div>
      281  
      282        {/* Top 3 Models */}
      285 -      <div className="bg-dark-800/30 rounded-xl p-6 border bor
          -der-dark-700/30">                                             
      283 +      <div className="bg-dark-800/50 rounded-xl p-6 border bor
          +der-dark-700/50">                                             
      284          <h3 className="text-lg font-semibold text-dark-100 mb-
           4 flex items-center gap-2">
      285            <BarChart2 className="w-5 h-5 text-primary-400" />
      286            Top 3 Models by Token Usage
     ...
      298                    <div
      299                      className={`text-2xl font-bold w-8 shrink-
           0 ${
      300                        idx === 0
      303 -                        ? "text-yellow-400"                   
      301 +                        ? "text-primary-400"                  
      302                          : idx === 1
      303                            ? "text-dark-400"
      306 -                          : "text-amber-700"                  
      304 +                          : "text-accent-500"                 
      305                      }`}
      306                    >
      307                      {idx + 1}
     ...
      331  
      332                      <div className="h-2 bg-dark-700 rounded-fu
           ll overflow-hidden">
      333                        <div
      336 -                        className="h-full bg-gradient-to-r fro
          -m-primary-500 to-accent-500 rounded-full transition-all durati
          -on-500"                                                       
      334 +                        className="h-full bg-primary-500 round
          +ed-full transition-all duration-500"                          
      335                          style={{
      336                            width: `${(model.total_tokens / maxT
           okens) * 100}%`,
      337                          }}
     ...
      347  
      348        {/* Additional Stats */}
      349        <div className="mt-6 grid grid-cols-2 gap-4">
      352 -        <div className="bg-dark-800/30 p-4 rounded-lg border b
          -order-dark-700/30">                                           
      350 +        <div className="bg-dark-800/50 p-4 rounded-xl border b
          +order-dark-700/50">                                           
      351            <div className="flex items-center gap-2 text-dark-40
           0 text-sm mb-1">
      352              <Hash className="w-4 h-4" />
      353              Total Messages
     ...
      357            </div>
      358          </div>
      359  
      362 -        <div className="bg-dark-800/30 p-4 rounded-lg border b
          -order-dark-700/30">                                           
      360 +        <div className="bg-dark-800/50 p-4 rounded-xl border b
          +order-dark-700/50">                                           
      361            <div className="text-dark-400 text-sm mb-1">Avg Resp
           onse Time</div>
      362            <div className="text-xl font-bold text-dark-200">
      363              {totals.avg_response_time_ms}ms

● Write(client\src\pages\Memories.jsx)
  ⎿  Added 299 lines, removed 297 lines
        1 -import React, { useState, useEffect } from 'react';          
        2 -import { useNavigate } from 'react-router-dom';              
        3 -import { ArrowLeft, Brain, Plus, Trash2, Edit2, Save, X, Star 
          -} from 'lucide-react';                                       
        4 -                                                             
        5 -function Memories() {                                        
        6 -  const navigate = useNavigate();                            
        7 -  const [memories, setMemories] = useState([]);              
        8 -  const [loading, setLoading] = useState(false);             
        9 -  const [editingId, setEditingId] = useState(null);          
       10 -  const [showNewMemory, setShowNewMemory] = useState(false); 
       11 -  const [formData, setFormData] = useState({                 
       12 -    content: '',                                             
       13 -    category: 'general',                                     
       14 -    importance: 1                                            
       15 -  });                                                        
       16 -                                                             
       17 -  useEffect(() => {                                          
       18 -    loadMemories();                                          
       19 -  }, []);                                                    
       20 -                                                             
       21 -  const loadMemories = async () => {                         
       22 -    try {                                                    
       23 -      const res = await fetch('/api/memories', {             
       24 -        headers: { 'Authorization': `Bearer ${localStorage.get
          -Item('token')}` }                                            
       25 -      });                                                    
       26 -      const data = await res.json();                         
       27 -      setMemories(data);                                     
       28 -    } catch (error) {                                        
       29 -      console.error('Failed to load memories:', error);      
       30 -    }                                                        
       31 -  };                                                         
       32 -                                                             
       33 -  const handleSubmit = async (e) => {                        
       34 -    e.preventDefault();                                      
       35 -    setLoading(true);                                        
       36 -                                                             
       37 -    try {                                                    
       38 -      if (editingId) {                                       
       39 -        await fetch(`/api/memories/${editingId}`, {          
       40 -          method: 'PUT',                                     
       41 -          headers: {                                         
       42 -            'Content-Type': 'application/json',              
       43 -            'Authorization': `Bearer ${localStorage.getItem('t
          -oken')}`                                                     
       44 -          },                                                 
       45 -          body: JSON.stringify(formData)                     
       46 -        });                                                  
       47 -      } else {                                               
       48 -        await fetch('/api/memories', {                       
       49 -          method: 'POST',                                    
       50 -          headers: {                                         
       51 -            'Content-Type': 'application/json',              
       52 -            'Authorization': `Bearer ${localStorage.getItem('t
          -oken')}`                                                     
       53 -          },                                                 
       54 -          body: JSON.stringify(formData)                     
       55 -        });                                                  
       56 -      }                                                      
       57 -                                                             
       58 -      setFormData({ content: '', category: 'general', importan
          -ce: 1 });                                                    
       59 -      setEditingId(null);                                    
       60 -      setShowNewMemory(false);                               
       61 -      loadMemories();                                        
       62 -    } catch (error) {                                        
       63 -      console.error('Failed to save memory:', error);        
       64 -      alert('Failed to save memory');                        
       65 -    } finally {                                              
       66 -      setLoading(false);                                     
       67 -    }                                                        
       68 -  };                                                         
       69 -                                                             
       70 -  const handleEdit = (memory) => {                           
       71 -    setFormData({                                            
       72 -      content: memory.content,                               
       73 -      category: memory.category,                             
       74 -      importance: memory.importance                          
       75 -    });                                                      
       76 -    setEditingId(memory.id);                                 
       77 -    setShowNewMemory(true);                                  
       78 -  };                                                         
       79 -                                                             
       80 -  const handleDelete = async (id) => {                       
       81 -    if (!confirm('Are you sure you want to delete this memory?
          -')) return;                                                  
       82 -                                                             
       83 -    try {                                                    
       84 -      await fetch(`/api/memories/${id}`, {                   
       85 -        method: 'DELETE',                                    
       86 -        headers: { 'Authorization': `Bearer ${localStorage.get
          -Item('token')}` }                                            
       87 -      });                                                    
       88 -      loadMemories();                                        
       89 -    } catch (error) {                                        
       90 -      console.error('Failed to delete memory:', error);      
       91 -    }                                                        
       92 -  };                                                         
       93 -                                                             
       94 -  const cancelEdit = () => {                                 
       95 -    setFormData({ content: '', category: 'general', importance
          -: 1 });                                                      
       96 -    setEditingId(null);                                      
       97 -    setShowNewMemory(false);                                 
       98 -  };                                                         
       99 -                                                             
      100 -  const getCategoryColor = (category) => {                   
      101 -    const colors = {                                         
      102 -      general: 'bg-dark-600/50 text-dark-200 border-dark-500/5
          -0',                                                          
      103 -      personal: 'bg-primary-500/20 text-primary-300 border-pri
          -mary-500/30',                                                
      104 -      work: 'bg-accent-500/20 text-accent-300 border-accent-50
          -0/30',                                                       
      105 -      preferences: 'bg-purple-500/20 text-purple-300 border-pu
          -rple-500/30'                                                 
      106 -    };                                                       
      107 -    return colors[category] || colors.general;               
      108 -  };                                                         
      109 -                                                             
      110 -  return (                                                   
      111 -    <div className="min-h-screen bg-dark-950 bg-mesh">       
      112 -      <div className="max-w-4xl mx-auto p-6">                
      113 -        <button                                              
      114 -          onClick={() => navigate('/')}                      
      115 -          className="mb-6 flex items-center gap-2 text-dark-40
          -0 hover:text-dark-200 transition-colors"                     
      116 -        >                                                    
      117 -          <ArrowLeft className="w-4 h-4" />                  
      118 -          Back to Chat                                       
      119 -        </button>                                            
      120 -                                                             
      121 -        <div className="glass-card rounded-2xl p-8">         
      122 -          <div className="flex items-center justify-between mb
          --8">                                                         
      123 -            <div>                                            
      124 -              <h1 className="text-3xl font-bold gradient-text 
          -mb-2 flex items-center gap-3">                               
      125 -                <Brain className="w-8 h-8" />                
      126 -                Memories                                     
      127 -              </h1>                                          
      128 -              <p className="text-dark-400">                  
      129 -                Store important context that the AI can refere
          -nce in conversations                                         
      130 -              </p>                                           
      131 -            </div>                                           
      132 -                                                             
      133 -            {!showNewMemory && (                             
      134 -              <button                                        
      135 -                onClick={() => setShowNewMemory(true)}       
      136 -                className="px-4 py-2 gradient-primary text-whi
          -te rounded-lg font-medium hover:shadow-glow transition-all fle
          -x items-center gap-2"                                        
      137 -              >                                              
      138 -                <Plus className="w-4 h-4" />                 
      139 -                Add Memory                                   
      140 -              </button>                                      
      141 -            )}                                               
      142 -          </div>                                             
      143 -                                                             
      144 -          {/* New/Edit Memory Form */}                       
      145 -          {showNewMemory && (                                
      146 -            <form onSubmit={handleSubmit} className="mb-8 p-6 
          -glass rounded-xl border border-primary-500/30">              
      147 -              <div className="flex items-center justify-betwee
          -n mb-4">                                                     
      148 -                <h3 className="font-semibold text-lg text-dark
          --100">                                                       
      149 -                  {editingId ? 'Edit Memory' : 'New Memory'} 
      150 -                </h3>                                        
      151 -                <button                                      
      152 -                  type="button"                              
      153 -                  onClick={cancelEdit}                       
      154 -                  className="p-1 hover:bg-dark-700/50 rounded 
          -transition-colors"                                           
      155 -                >                                            
      156 -                  <X className="w-5 h-5 text-dark-400" />    
      157 -                </button>                                    
      158 -              </div>                                         
      159 -                                                             
      160 -              <div className="space-y-4">                    
      161 -                <div>                                        
      162 -                  <label className="block text-sm font-medium 
          -text-dark-200 mb-2">                                         
      163 -                    Content                                  
      164 -                  </label>                                   
      165 -                  <textarea                                  
      166 -                    value={formData.content}                 
      167 -                    onChange={(e) => setFormData({ ...formData
          -, content: e.target.value })}                                
      168 -                    className="w-full px-4 py-3 rounded-lg gla
          -ss-input outline-none resize-none text-dark-100 bg-dark-800/50
          -"                                                            
      169 -                    rows="4"                                 
      170 -                    placeholder="What should the AI remember a
          -bout you?"                                                   
      171 -                    required                                 
      172 -                  />                                         
      173 -                </div>                                       
      174 -                                                             
      175 -                <div className="grid grid-cols-2 gap-4">     
      176 -                  <div>                                      
      177 -                    <label className="block text-sm font-mediu
          -m text-dark-200 mb-2">                                       
      178 -                      Category                               
      179 -                    </label>                                 
      180 -                    <select                                  
      181 -                      value={formData.category}              
      182 -                      onChange={(e) => setFormData({ ...formDa
          -ta, category: e.target.value })}                             
      183 -                      className="w-full px-4 py-3 rounded-lg g
          -lass-input outline-none text-dark-100 bg-dark-800"           
      184 -                    >                                        
      185 -                      <option value="general">General</option>
          -                                                              
      186 -                      <option value="personal">Personal</optio
          -n>                                                           
      187 -                      <option value="work">Work</option>     
      188 -                      <option value="preferences">Preferences<
          -/option>                                                     
      189 -                    </select>                                
      190 -                  </div>                                     
      191 -                                                             
      192 -                  <div>                                      
      193 -                    <label className="block text-sm font-mediu
          -m text-dark-200 mb-2">                                       
      194 -                      Importance: {formData.importance}      
      195 -                    </label>                                 
      196 -                    <input                                   
      197 -                      type="range"                           
      198 -                      min="1"                                
      199 -                      max="5"                                
      200 -                      value={formData.importance}            
      201 -                      onChange={(e) => setFormData({ ...formDa
          -ta, importance: parseInt(e.target.value) })}                 
      202 -                      className="w-full"                     
      203 -                    />                                       
      204 -                    <div className="flex justify-between text-
          -xs text-dark-500 mt-1">                                      
      205 -                      <span>Low</span>                       
      206 -                      <span>High</span>                      
      207 -                    </div>                                   
      208 -                  </div>                                     
      209 -                </div>                                       
      210 -                                                             
      211 -                <button                                      
      212 -                  type="submit"                              
      213 -                  disabled={loading}                         
      214 -                  className="w-full gradient-primary text-whit
          -e py-3 rounded-lg font-medium hover:shadow-glow transition-all
          - disabled:opacity-50 flex items-center justify-center gap-2" 
      215 -                >                                            
      216 -                  {loading ? (                               
      217 -                    <>                                       
      218 -                      <div className="animate-spin rounded-ful
          -l h-5 w-5 border-2 border-white border-t-transparent"></div> 
      219 -                      Saving...                              
      220 -                    </>                                      
      221 -                  ) : (                                      
      222 -                    <>                                       
      223 -                      <Save className="w-4 h-4" />           
      224 -                      {editingId ? 'Update Memory' : 'Save Mem
          -ory'}                                                        
      225 -                    </>                                      
      226 -                  )}                                         
      227 -                </button>                                    
      228 -              </div>                                         
      229 -            </form>                                          
      230 -          )}                                                 
      231 -                                                             
      232 -          {/* Memories List */}                              
      233 -          <div className="space-y-4">                        
      234 -            {memories.length === 0 ? (                       
      235 -              <div className="text-center py-12">            
      236 -                <Brain className="w-16 h-16 text-dark-600 mx-a
          -uto mb-4" />                                                 
      237 -                <p className="text-dark-400">No memories yet. 
          -Add your first memory to help the AI remember important contex
          -t.</p>                                                       
      238 -              </div>                                         
      239 -            ) : (                                            
      240 -              memories.map(memory => (                       
      241 -                <div                                         
      242 -                  key={memory.id}                            
      243 -                  className="p-5 glass rounded-xl hover:border
          --primary-500/30 transition-all"                              
      244 -                >                                            
      245 -                  <div className="flex items-start justify-bet
          -ween gap-4">                                                 
      246 -                    <div className="flex-1">                 
      247 -                      <div className="flex items-center gap-2 
          -mb-2">                                                       
      248 -                        <span className={`px-2.5 py-1 rounded-
          -full text-xs font-medium border ${getCategoryColor(memory.cate
          -gory)}`}>                                                    
      249 -                          {memory.category}                  
      250 -                        </span>                              
      251 -                        <div className="flex items-center gap-
          -0.5">                                                        
      252 -                          {[...Array(5)].map((_, i) => (     
      253 -                            <Star                            
      254 -                              key={i}                        
      255 -                              className={`w-3 h-3 ${         
      256 -                                i < memory.importance        
      257 -                                  ? 'text-yellow-400 fill-yell
          -ow-400'                                                      
      258 -                                  : 'text-dark-600'          
      259 -                              }`}                            
      260 -                            />                               
      261 -                          ))}                                
      262 -                        </div>                               
      263 -                      </div>                                 
      264 -                      <p className="text-dark-200 whitespace-p
          -re-wrap">{memory.content}</p>                                
      265 -                      <p className="text-xs text-dark-500 mt-2
          -">                                                           
      266 -                        Created {new Date(memory.created_at).t
          -oLocaleDateString()}                                         
      267 -                      </p>                                   
      268 -                    </div>                                   
      269 -                                                             
      270 -                    <div className="flex gap-2">             
      271 -                      <button                                
      272 -                        onClick={() => handleEdit(memory)}   
      273 -                        className="p-2 hover:bg-primary-500/20
          - rounded-lg transition-colors"                               
      274 -                        title="Edit"                         
      275 -                      >                                      
      276 -                        <Edit2 className="w-4 h-4 text-primary
          --400" />                                                     
      277 -                      </button>                              
      278 -                      <button                                
      279 -                        onClick={() => handleDelete(memory.id)
          -}                                                            
      280 -                        className="p-2 hover:bg-red-500/20 rou
          -nded-lg transition-colors"                                   
      281 -                        title="Delete"                       
      282 -                      >                                      
      283 -                        <Trash2 className="w-4 h-4 text-red-40
          -0" />                                                        
      284 -                      </button>                              
      285 -                    </div>                                   
      286 -                  </div>                                     
      287 -                </div>                                       
      288 -              ))                                             
      289 -            )}                                               
      290 -          </div>                                             
      291 -        </div>                                               
      292 -      </div>                                                 
      293 -    </div>                                                   
      294 -  );                                                         
      295 -}                                                            
      296 -                                                             
      297 -export default Memories;                                     
        1 +import React, { useState, useEffect } from 'react';           
        2 +import { useNavigate } from 'react-router-dom';               
        3 +import { ArrowLeft, Brain, Plus, Trash2, Edit2, Save, X, Star 
          +} from 'lucide-react';                                        
        4 +                                                              
        5 +function Memories() {                                         
        6 +  const navigate = useNavigate();                             
        7 +  const [memories, setMemories] = useState([]);               
        8 +  const [loading, setLoading] = useState(false);              
        9 +  const [editingId, setEditingId] = useState(null);           
       10 +  const [showNewMemory, setShowNewMemory] = useState(false);  
       11 +  const [formData, setFormData] = useState({                  
       12 +    content: '',                                              
       13 +    category: 'general',                                      
       14 +    importance: 1                                             
       15 +  });                                                         
       16 +                                                              
       17 +  useEffect(() => {                                           
       18 +    loadMemories();                                           
       19 +  }, []);                                                     
       20 +                                                              
       21 +  const loadMemories = async () => {                          
       22 +    try {                                                     
       23 +      const res = await fetch('/api/memories', {              
       24 +        headers: { 'Authorization': `Bearer ${localStorage.get
          +Item('token')}` }                                             
       25 +      });                                                     
       26 +      const data = await res.json();                          
       27 +      setMemories(data);                                      
       28 +    } catch (error) {                                         
       29 +      console.error('Failed to load memories:', error);       
       30 +    }                                                         
       31 +  };                                                          
       32 +                                                              
       33 +  const handleSubmit = async (e) => {                         
       34 +    e.preventDefault();                                       
       35 +    setLoading(true);                                         
       36 +                                                              
       37 +    try {                                                     
       38 +      if (editingId) {                                        
       39 +        await fetch(`/api/memories/${editingId}`, {           
       40 +          method: 'PUT',                                      
       41 +          headers: {                                          
       42 +            'Content-Type': 'application/json',               
       43 +            'Authorization': `Bearer ${localStorage.getItem('t
          +oken')}`                                                      
       44 +          },                                                  
       45 +          body: JSON.stringify(formData)                      
       46 +        });                                                   
       47 +      } else {                                                
       48 +        await fetch('/api/memories', {                        
       49 +          method: 'POST',                                     
       50 +          headers: {                                          
       51 +            'Content-Type': 'application/json',               
       52 +            'Authorization': `Bearer ${localStorage.getItem('t
          +oken')}`                                                      
       53 +          },                                                  
       54 +          body: JSON.stringify(formData)                      
       55 +        });                                                   
       56 +      }                                                       
       57 +                                                              
       58 +      setFormData({ content: '', category: 'general', importan
          +ce: 1 });                                                     
       59 +      setEditingId(null);                                     
       60 +      setShowNewMemory(false);                                
       61 +      loadMemories();                                         
       62 +    } catch (error) {                                         
       63 +      console.error('Failed to save memory:', error);         
       64 +      alert('Failed to save memory');                         
       65 +    } finally {                                               
       66 +      setLoading(false);                                      
       67 +    }                                                         
       68 +  };                                                          
       69 +                                                              
       70 +  const handleEdit = (memory) => {                            
       71 +    setFormData({                                             
       72 +      content: memory.content,                                
       73 +      category: memory.category,                              
       74 +      importance: memory.importance                           
       75 +    });                                                       
       76 +    setEditingId(memory.id);                                  
       77 +    setShowNewMemory(true);                                   
       78 +  };                                                          
       79 +                                                              
       80 +  const handleDelete = async (id) => {                        
       81 +    if (!confirm('Are you sure you want to delete this memory?
          +')) return;                                                   
       82 +                                                              
       83 +    try {                                                     
       84 +      await fetch(`/api/memories/${id}`, {                    
       85 +        method: 'DELETE',                                     
       86 +        headers: { 'Authorization': `Bearer ${localStorage.get
          +Item('token')}` }                                             
       87 +      });                                                     
       88 +      loadMemories();                                         
       89 +    } catch (error) {                                         
       90 +      console.error('Failed to delete memory:', error);       
       91 +    }                                                         
       92 +  };                                                          
       93 +                                                              
       94 +  const cancelEdit = () => {                                  
       95 +    setFormData({ content: '', category: 'general', importance
          +: 1 });                                                       
       96 +    setEditingId(null);                                       
       97 +    setShowNewMemory(false);                                  
       98 +  };                                                          
       99 +                                                              
      100 +  const getCategoryColor = (category) => {                    
      101 +    const colors = {                                          
      102 +      general: 'bg-dark-700/50 text-dark-300 border-dark-600',
      103 +      personal: 'bg-primary-500/10 text-primary-400 border-pri
          +mary-500/20',                                                 
      104 +      work: 'bg-accent-500/10 text-accent-400 border-accent-50
          +0/20',                                                        
      105 +      preferences: 'bg-purple-500/10 text-purple-400 border-pu
          +rple-500/20'                                                  
      106 +    };                                                        
      107 +    return colors[category] || colors.general;                
      108 +  };                                                          
      109 +                                                              
      110 +  return (                                                    
      111 +    <div className="min-h-screen bg-dark-950 bg-mesh">        
      112 +      <div className="max-w-4xl mx-auto p-6">                 
      113 +        <button                                               
      114 +          onClick={() => navigate('/')}                       
      115 +          className="mb-6 flex items-center gap-2 text-dark-40
          +0 hover:text-dark-200 transition-colors"                      
      116 +        >                                                     
      117 +          <ArrowLeft className="w-4 h-4" />                   
      118 +          Back to Chat                                        
      119 +        </button>                                             
      120 +                                                              
      121 +        <div className="glass-card rounded-2xl p-8">          
      122 +          <div className="flex items-center justify-between mb
          +-8">                                                          
      123 +            <div>                                             
      124 +              <h1 className="text-3xl font-bold text-primary-4
          +00 mb-2 flex items-center gap-3 tracking-tight">              
      125 +                <Brain className="w-8 h-8" />                 
      126 +                Memories                                      
      127 +              </h1>                                           
      128 +              <p className="text-dark-400">                   
      129 +                Store important context that the AI can refere
          +nce in conversations                                          
      130 +              </p>                                            
      131 +            </div>                                            
      132 +                                                              
      133 +            {!showNewMemory && (                              
      134 +              <button                                         
      135 +                onClick={() => setShowNewMemory(true)}        
      136 +                className="px-4 py-2.5 bg-primary-500 hover:bg
          +-primary-600 text-white rounded-xl font-semibold transition-al
          +l duration-200 flex items-center gap-2 active:scale-[0.98]"   
      137 +              >                                               
      138 +                <Plus className="w-4 h-4" />                  
      139 +                Add Memory                                    
      140 +              </button>                                       
      141 +            )}                                                
      142 +          </div>                                              
      143 +                                                              
      144 +          {/* New/Edit Memory Form */}                        
      145 +          {showNewMemory && (                                 
      146 +            <form onSubmit={handleSubmit} className="mb-8 p-6 
          +bg-dark-800/50 rounded-xl border border-primary-500/20">      
      147 +              <div className="flex items-center justify-betwee
          +n mb-4">                                                      
      148 +                <h3 className="font-semibold text-lg text-dark
          +-100">                                                        
      149 +                  {editingId ? 'Edit Memory' : 'New Memory'}  
      150 +                </h3>                                         
      151 +                <button                                       
      152 +                  type="button"                               
      153 +                  onClick={cancelEdit}                        
      154 +                  className="p-1.5 hover:bg-dark-700/50 rounde
          +d-lg transition-colors"                                       
      155 +                >                                             
      156 +                  <X className="w-5 h-5 text-dark-400" />     
      157 +                </button>                                     
      158 +              </div>                                          
      159 +                                                              
      160 +              <div className="space-y-4">                     
      161 +                <div>                                         
      162 +                  <label className="block text-sm font-medium 
          +text-dark-300 mb-2">                                          
      163 +                    Content                                   
      164 +                  </label>                                    
      165 +                  <textarea                                   
      166 +                    value={formData.content}                  
      167 +                    onChange={(e) => setFormData({ ...formData
          +, content: e.target.value })}                                 
      168 +                    className="w-full px-4 py-3 rounded-xl gla
          +ss-input outline-none resize-none text-dark-100 text-sm"      
      169 +                    rows="4"                                  
      170 +                    placeholder="What should the AI remember a
          +bout you?"                                                    
      171 +                    required                                  
      172 +                  />                                          
      173 +                </div>                                        
      174 +                                                              
      175 +                <div className="grid grid-cols-2 gap-4">      
      176 +                  <div>                                       
      177 +                    <label className="block text-sm font-mediu
          +m text-dark-300 mb-2">                                        
      178 +                      Category                                
      179 +                    </label>                                  
      180 +                    <select                                   
      181 +                      value={formData.category}               
      182 +                      onChange={(e) => setFormData({ ...formDa
          +ta, category: e.target.value })}                              
      183 +                      className="w-full px-4 py-3 rounded-xl g
          +lass-input outline-none text-dark-100 bg-dark-800 text-sm"    
      184 +                    >                                         
      185 +                      <option value="general">General</option>
      186 +                      <option value="personal">Personal</optio
          +n>                                                            
      187 +                      <option value="work">Work</option>      
      188 +                      <option value="preferences">Preferences<
          +/option>                                                      
      189 +                    </select>                                 
      190 +                  </div>                                      
      191 +                                                              
      192 +                  <div>                                       
      193 +                    <label className="block text-sm font-mediu
          +m text-dark-300 mb-2">                                        
      194 +                      Importance: {formData.importance}       
      195 +                    </label>                                  
      196 +                    <input                                    
      197 +                      type="range"                            
      198 +                      min="1"                                 
      199 +                      max="5"                                 
      200 +                      value={formData.importance}             
      201 +                      onChange={(e) => setFormData({ ...formDa
          +ta, importance: parseInt(e.target.value) })}                  
      202 +                      className="w-full mt-2"                 
      203 +                    />                                        
      204 +                    <div className="flex justify-between text-
          +xs text-dark-500 mt-1">                                       
      205 +                      <span>Low</span>                        
      206 +                      <span>High</span>                       
      207 +                    </div>                                    
      208 +                  </div>                                      
      209 +                </div>                                        
      210 +                                                              
      211 +                <button                                       
      212 +                  type="submit"                               
      213 +                  disabled={loading}                          
      214 +                  className="w-full bg-primary-500 hover:bg-pr
          +imary-600 text-white py-3 rounded-xl font-semibold transition-
          +all duration-200 disabled:opacity-50 flex items-center justify
          +-center gap-2 active:scale-[0.98]"                            
      215 +                >                                             
      216 +                  {loading ? (                                
      217 +                    <>                                        
      218 +                      <div className="animate-spin rounded-ful
          +l h-5 w-5 border-2 border-white border-t-transparent"></div>  
      219 +                      Saving...                               
      220 +                    </>                                       
      221 +                  ) : (                                       
      222 +                    <>                                        
      223 +                      <Save className="w-4 h-4" />            
      224 +                      {editingId ? 'Update Memory' : 'Save Mem
          +ory'}                                                         
      225 +                    </>                                       
      226 +                  )}                                          
      227 +                </button>                                     
      228 +              </div>                                          
      229 +            </form>                                           
      230 +          )}                                                  
      231 +                                                              
      232 +          {/* Memories List */}                               
      233 +          <div className="space-y-4">                         
      234 +            {memories.length === 0 ? (                        
      235 +              <div className="text-center py-12">             
      236 +                <div className="w-16 h-16 rounded-2xl bg-dark-
          +800 flex items-center justify-center mx-auto mb-4">           
      237 +                  <Brain className="w-8 h-8 text-dark-500" /> 
      238 +                </div>                                        
      239 +                <p className="text-dark-400">No memories yet. 
          +Add your first memory to help the AI remember important contex
          +t.</p>                                                        
      240 +              </div>                                          
      241 +            ) : (                                             
      242 +              memories.map(memory => (                        
      243 +                <div                                          
      244 +                  key={memory.id}                             
      245 +                  className="p-5 bg-dark-800/50 border border-
          +dark-700/50 rounded-xl hover:border-dark-600 transition-all du
          +ration-200"                                                   
      246 +                >                                             
      247 +                  <div className="flex items-start justify-bet
          +ween gap-4">                                                  
      248 +                    <div className="flex-1">                  
      249 +                      <div className="flex items-center gap-2 
          +mb-2">                                                        
      250 +                        <span className={`px-2.5 py-1 rounded-
          +lg text-xs font-medium border ${getCategoryColor(memory.catego
          +ry)}`}>                                                       
      251 +                          {memory.category}                   
      252 +                        </span>                               
      253 +                        <div className="flex items-center gap-
          +0.5">                                                         
      254 +                          {[...Array(5)].map((_, i) => (      
      255 +                            <Star                             
      256 +                              key={i}                         
      257 +                              className={`w-3 h-3 ${          
      258 +                                i < memory.importance         
      259 +                                  ? 'text-primary-400 fill-pri
          +mary-400'                                                     
      260 +                                  : 'text-dark-600'           
      261 +                              }`}                             
      262 +                            />                                
      263 +                          ))}                                 
      264 +                        </div>                                
      265 +                      </div>                                  
      266 +                      <p className="text-dark-200 whitespace-p
          +re-wrap text-sm">{memory.content}</p>                         
      267 +                      <p className="text-xs text-dark-500 mt-2
          +">                                                            
      268 +                        Created {new Date(memory.created_at).t
          +oLocaleDateString()}                                          
      269 +                      </p>                                    
      270 +                    </div>                                    
      271 +                                                              
      272 +                    <div className="flex gap-2">              
      273 +                      <button                                 
      274 +                        onClick={() => handleEdit(memory)}    
      275 +                        className="p-2 hover:bg-primary-500/10
          + rounded-lg transition-colors"                                
      276 +                        title="Edit"                          
      277 +                      >                                       
      278 +                        <Edit2 className="w-4 h-4 text-primary
          +-400" />                                                      
      279 +                      </button>                               
      280 +                      <button                                 
      281 +                        onClick={() => handleDelete(memory.id)
          +}                                                             
      282 +                        className="p-2 hover:bg-red-500/10 rou
          +nded-lg transition-colors"                                    
      283 +                        title="Delete"                        
      284 +                      >                                       
      285 +                        <Trash2 className="w-4 h-4 text-red-40
          +0" />                                                         
      286 +                      </button>                               
      287 +                    </div>                                    
      288 +                  </div>                                      
      289 +                </div>                                        
      290 +              ))                                              
      291 +            )}                                                
      292 +          </div>                                              
      293 +        </div>                                                
      294 +      </div>                                                  
      295 +    </div>                                                    
      296 +  );                                                          
      297 +}                                                             
      298 +                                                              
      299 +export default Memories;                                      
✔ Task #7 updated: status → completed

● Let me also check and update the SettingsTab and ProfileTab components.

● Read(client\src\components\SettingsTab.jsx)
  ⎿  Read 326 lines

● Read(client\src\components\ProfileTab.jsx)
  ⎿  Read 179 lines

● I need to update these components to use the new design system.

● Write(client\src\components\SettingsTab.jsx)
  ⎿  Added 325 lines, removed 325 lines
        1 -import React, { useState, useEffect } from 'react';          
        2 -import { useNavigate } from 'react-router-dom';              
        3 -import { Key, Eye, EyeOff, Trash2, AlertTriangle, Shield, Save
          -, ExternalLink } from 'lucide-react';                        
        4 -                                                             
        5 -function SettingsTab({ user, logout }) {                     
        6 -  const navigate = useNavigate();                            
        7 -  const [apiKey, setApiKey] = useState('');                  
        8 -  const [showApiKey, setShowApiKey] = useState(false);       
        9 -  const [hasApiKey, setHasApiKey] = useState(false);         
       10 -  const [loading, setLoading] = useState(false);             
       11 -  const [success, setSuccess] = useState('');                
       12 -  const [error, setError] = useState('');                    
       13 -  const [showDeleteConfirm, setShowDeleteConfirm] = useState(f
          -alse);                                                       
       14 -  const [deletePassword, setDeletePassword] = useState('');  
       15 -  const [deleteLoading, setDeleteLoading] = useState(false); 
       16 -  const [deleteError, setDeleteError] = useState('');        
       17 -                                                             
       18 -  useEffect(() => {                                          
       19 -    loadUserData();                                          
       20 -  }, []);                                                    
       21 -                                                             
       22 -  const loadUserData = async () => {                         
       23 -    try {                                                    
       24 -      const res = await fetch('/api/auth/me', {              
       25 -        headers: { 'Authorization': `Bearer ${localStorage.get
          -Item('token')}` }                                            
       26 -      });                                                    
       27 -      const data = await res.json();                         
       28 -      setHasApiKey(!!data.has_api_key);                      
       29 -    } catch (error) {                                        
       30 -      console.error('Failed to load user data:', error);     
       31 -    }                                                        
       32 -  };                                                         
       33 -                                                             
       34 -  const handleSaveApiKey = async (e) => {                    
       35 -    e.preventDefault();                                      
       36 -    if (!apiKey.trim()) return;                              
       37 -                                                             
       38 -    setError('');                                            
       39 -    setSuccess('');                                          
       40 -    setLoading(true);                                        
       41 -                                                             
       42 -    try {                                                    
       43 -      const res = await fetch('/api/auth/profile', {         
       44 -        method: 'PUT',                                       
       45 -        headers: {                                           
       46 -          'Content-Type': 'application/json',                
       47 -          'Authorization': `Bearer ${localStorage.getItem('tok
          -en')}`                                                       
       48 -        },                                                   
       49 -        body: JSON.stringify({ openai_api_key: apiKey })     
       50 -      });                                                    
       51 -                                                             
       52 -      if (!res.ok) {                                         
       53 -        throw new Error('Failed to save API key');           
       54 -      }                                                      
       55 -                                                             
       56 -      setSuccess('API key saved successfully!');             
       57 -      setApiKey('');                                         
       58 -      setHasApiKey(true);                                    
       59 -    } catch (err) {                                          
       60 -      setError(err.message);                                 
       61 -    } finally {                                              
       62 -      setLoading(false);                                     
       63 -    }                                                        
       64 -  };                                                         
       65 -                                                             
       66 -  const removeApiKey = async () => {                         
       67 -    if (!confirm('Are you sure you want to remove your API key
          -?')) return;                                                 
       68 -                                                             
       69 -    try {                                                    
       70 -      await fetch('/api/auth/profile', {                     
       71 -        method: 'PUT',                                       
       72 -        headers: {                                           
       73 -          'Content-Type': 'application/json',                
       74 -          'Authorization': `Bearer ${localStorage.getItem('tok
          -en')}`                                                       
       75 -        },                                                   
       76 -        body: JSON.stringify({ openai_api_key: null })       
       77 -      });                                                    
       78 -      setHasApiKey(false);                                   
       79 -      setSuccess('API key removed successfully');            
       80 -    } catch (error) {                                        
       81 -      setError('Failed to remove API key');                  
       82 -    }                                                        
       83 -  };                                                         
       84 -                                                             
       85 -  const handleDeleteAccount = async () => {                  
       86 -    if (!deletePassword) {                                   
       87 -      setDeleteError('Please enter your password');          
       88 -      return;                                                
       89 -    }                                                        
       90 -                                                             
       91 -    setDeleteLoading(true);                                  
       92 -    setDeleteError('');                                      
       93 -                                                             
       94 -    try {                                                    
       95 -      const res = await fetch('/api/auth/profile', {         
       96 -        method: 'DELETE',                                    
       97 -        headers: {                                           
       98 -          'Content-Type': 'application/json',                
       99 -          'Authorization': `Bearer ${localStorage.getItem('tok
          -en')}`                                                       
      100 -        },                                                   
      101 -        body: JSON.stringify({ password: deletePassword })   
      102 -      });                                                    
      103 -                                                             
      104 -      const data = await res.json();                         
      105 -                                                             
      106 -      if (!res.ok) {                                         
      107 -        throw new Error(data.error || 'Failed to delete accoun
          -t');                                                         
      108 -      }                                                      
      109 -                                                             
      110 -      logout();                                              
      111 -      navigate('/login');                                    
      112 -    } catch (err) {                                          
      113 -      setDeleteError(err.message);                           
      114 -    } finally {                                              
      115 -      setDeleteLoading(false);                               
      116 -    }                                                        
      117 -  };                                                         
      118 -                                                             
      119 -  return (                                                   
      120 -    <div className="space-y-8">                              
      121 -      <div>                                                  
      122 -        <h2 className="text-2xl font-bold text-dark-100 mb-2">
          -Settings</h2>                                                
      123 -        <p className="text-dark-400 mb-6">Manage your API key 
          -and account</p>                                              
      124 -      </div>                                                 
      125 -                                                             
      126 -      {error && (                                            
      127 -        <div className="bg-red-500/20 border border-red-500/30
          - text-red-300 px-4 py-3 rounded-lg">                         
      128 -          {error}                                            
      129 -        </div>                                               
      130 -      )}                                                     
      131 -                                                             
      132 -      {success && (                                          
      133 -        <div className="bg-green-500/20 border border-green-50
          -0/30 text-green-300 px-4 py-3 rounded-lg">                   
      134 -          {success}                                          
      135 -        </div>                                               
      136 -      )}                                                     
      137 -                                                             
      138 -      {/* API Key Section */}                                
      139 -      <section className="border-b border-dark-700/50 pb-8"> 
      140 -        <h3 className="text-xl font-semibold mb-4 flex items-c
          -enter gap-2 text-dark-100">                                  
      141 -          <Key className="w-5 h-5 text-accent-400" />        
      142 -          OpenRouter API Key                                 
      143 -        </h3>                                                
      144 -                                                             
      145 -        {user?.use_default_key ? (                           
      146 -          <div className="bg-primary-500/20 border border-prim
          -ary-500/30 rounded-lg p-4 mb-4">                             
      147 -            <p className="text-primary-300 text-sm">         
      148 -              You are currently using the default API key set 
          -by the administrator.                                        
      149 -              You can still set your own API key to override t
          -his.                                                         
      150 -            </p>                                             
      151 -          </div>                                             
      152 -        ) : (                                                
      153 -          <div className="bg-amber-500/20 border border-amber-
          -500/30 rounded-lg p-4 mb-4">                                 
      154 -            <p className="text-amber-300 text-sm">           
      155 -              You need to set your own API key or ask an admin
          -istrator to enable the default key for you.                  
      156 -            </p>                                             
      157 -          </div>                                             
      158 -        )}                                                   
      159 -                                                             
      160 -        {hasApiKey && (                                      
      161 -          <div className="bg-green-500/20 border border-green-
          -500/30 rounded-lg p-4 mb-4">                                 
      162 -            <div className="flex items-center justify-between"
          ->                                                            
      163 -              <p className="text-green-300 text-sm">         
      164 -                You have configured your personal API key    
      165 -              </p>                                           
      166 -              <button                                        
      167 -                type="button"                                
      168 -                onClick={removeApiKey}                       
      169 -                className="text-sm text-red-400 hover:text-red
          --300 font-medium"                                            
      170 -              >                                              
      171 -                Remove Key                                   
      172 -              </button>                                      
      173 -            </div>                                           
      174 -          </div>                                             
      175 -        )}                                                   
      176 -                                                             
      177 -        <form onSubmit={handleSaveApiKey} className="space-y-4
          -">                                                           
      178 -          <div>                                              
      179 -            <label className="block text-sm font-medium text-d
          -ark-200 mb-2">                                               
      180 -              {hasApiKey ? 'Update API Key' : 'Set API Key'} 
      181 -            </label>                                         
      182 -            <div className="relative">                       
      183 -              <input                                         
      184 -                type={showApiKey ? 'text' : 'password'}      
      185 -                value={apiKey}                               
      186 -                onChange={(e) => setApiKey(e.target.value)}  
      187 -                className="w-full px-4 py-3 pr-12 rounded-lg g
          -lass-input outline-none font-mono text-sm text-dark-100 bg-dar
          -k-800/50"                                                    
      188 -                placeholder="sk-..."                         
      189 -              />                                             
      190 -              <button                                        
      191 -                type="button"                                
      192 -                onClick={() => setShowApiKey(!showApiKey)}   
      193 -                className="absolute right-3 top-1/2 -translate
          --y-1/2 text-dark-400 hover:text-dark-200"                    
      194 -              >                                              
      195 -                {showApiKey ? <EyeOff className="w-5 h-5" /> :
          - <Eye className="w-5 h-5" />}                                
      196 -              </button>                                      
      197 -            </div>                                           
      198 -            <p className="text-xs text-dark-500 mt-2 flex item
          -s-center gap-1">                                             
      199 -              Get your API key at{' '}                       
      200 -              <a                                             
      201 -                href="https://openrouter.ai/keys"            
      202 -                target="_blank"                              
      203 -                rel="noopener noreferrer"                    
      204 -                className="text-primary-400 hover:underline in
          -line-flex items-center gap-1"                                
      205 -              >                                              
      206 -                OpenRouter                                   
      207 -                <ExternalLink className="w-3 h-3" />         
      208 -              </a>                                           
      209 -            </p>                                             
      210 -          </div>                                             
      211 -                                                             
      212 -          <button                                            
      213 -            type="submit"                                    
      214 -            disabled={loading || !apiKey.trim()}             
      215 -            className="gradient-primary text-white px-6 py-3 r
          -ounded-lg font-medium hover:shadow-glow transition-all disable
          -d:opacity-50 disabled:cursor-not-allowed flex items-center gap
          --2"                                                          
      216 -          >                                                  
      217 -            {loading ? (                                     
      218 -              <>                                             
      219 -                <div className="animate-spin rounded-full h-5 
          -w-5 border-2 border-white border-t-transparent"></div>       
      220 -                Saving...                                    
      221 -              </>                                            
      222 -            ) : (                                            
      223 -              <>                                             
      224 -                <Save className="w-5 h-5" />                 
      225 -                Save API Key                                 
      226 -              </>                                            
      227 -            )}                                               
      228 -          </button>                                          
      229 -        </form>                                              
      230 -      </section>                                             
      231 -                                                             
      232 -      {/* Danger Zone */}                                    
      233 -      <section>                                              
      234 -        <h3 className="text-xl font-semibold mb-4 flex items-c
          -enter gap-2 text-red-400">                                   
      235 -          <AlertTriangle className="w-5 h-5" />              
      236 -          Danger Zone                                        
      237 -        </h3>                                                
      238 -                                                             
      239 -        <div className="bg-red-500/10 border border-red-500/30
          - rounded-xl p-6">                                            
      240 -          <h4 className="font-semibold text-red-300 mb-2">Dele
          -te Account</h4>                                              
      241 -          <p className="text-sm text-dark-400 mb-4">         
      242 -            This action cannot be undone. All your chats, mess
          -ages, and memories will be permanently deleted.              
      243 -          </p>                                               
      244 -                                                             
      245 -          {user?.is_admin ? (                                
      246 -            <div className="flex items-center gap-2 text-sm te
          -xt-dark-400 bg-dark-800/50 p-3 rounded-lg">                  
      247 -              <Shield className="w-4 h-4" />                 
      248 -              Admin accounts cannot be deleted               
      249 -            </div>                                           
      250 -          ) : (                                              
      251 -            <button                                          
      252 -              onClick={() => setShowDeleteConfirm(true)}     
      253 -              className="px-4 py-2 bg-red-500/20 hover:bg-red-
          -500/30 text-red-300 rounded-lg font-medium transition-colors f
          -lex items-center gap-2"                                      
      254 -            >                                                
      255 -              <Trash2 className="w-4 h-4" />                 
      256 -              Delete Account                                 
      257 -            </button>                                        
      258 -          )}                                                 
      259 -        </div>                                               
      260 -      </section>                                             
      261 -                                                             
      262 -      {/* Delete Confirmation Modal */}                      
      263 -      {showDeleteConfirm && (                                
      264 -        <div className="fixed inset-0 bg-dark-950/80 backdrop-
          -blur-md flex items-center justify-center z-50 scale-in">     
      265 -          <div className="glass-card rounded-2xl p-6 w-full ma
          -x-w-md mx-4 shadow-2xl">                                     
      266 -            <h3 className="text-xl font-bold text-red-400 mb-2
          - flex items-center gap-2">                                   
      267 -              <AlertTriangle className="w-6 h-6" />          
      268 -              Confirm Account Deletion                       
      269 -            </h3>                                            
      270 -            <p className="text-dark-300 mb-6">               
      271 -              Please enter your password to confirm. This acti
          -on is irreversible and will delete all your data.            
      272 -            </p>                                             
      273 -                                                             
      274 -            {deleteError && (                                
      275 -              <div className="bg-red-500/20 border border-red-
          -500/30 text-red-300 px-4 py-3 rounded-lg mb-4 text-sm">      
      276 -                {deleteError}                                
      277 -              </div>                                         
      278 -            )}                                               
      279 -                                                             
      280 -            <input                                           
      281 -              type="password"                                
      282 -              value={deletePassword}                         
      283 -              onChange={(e) => setDeletePassword(e.target.valu
          -e)}                                                          
      284 -              placeholder="Enter your password"              
      285 -              className="w-full px-4 py-3 rounded-lg glass-inp
          -ut outline-none text-dark-100 bg-dark-800/50 mb-4"           
      286 -              autoFocus                                      
      287 -            />                                               
      288 -                                                             
      289 -            <div className="flex gap-3">                     
      290 -              <button                                        
      291 -                onClick={() => {                             
      292 -                  setShowDeleteConfirm(false);               
      293 -                  setDeletePassword('');                     
      294 -                  setDeleteError('');                        
      295 -                }}                                           
      296 -                className="flex-1 px-4 py-3 glass-button round
          -ed-lg text-dark-300 hover:text-dark-100 font-medium transition
          --colors"                                                     
      297 -              >                                              
      298 -                Cancel                                       
      299 -              </button>                                      
      300 -              <button                                        
      301 -                onClick={handleDeleteAccount}                
      302 -                disabled={!deletePassword || deleteLoading}  
      303 -                className="flex-1 px-4 py-3 bg-red-500 hover:b
          -g-red-600 text-white rounded-lg font-medium transition-colors 
          -disabled:opacity-50 disabled:cursor-not-allowed flex items-cen
          -ter justify-center gap-2"                                    
      304 -              >                                              
      305 -                {deleteLoading ? (                           
      306 -                  <>                                         
      307 -                    <div className="animate-spin rounded-full 
          -h-5 w-5 border-2 border-white border-t-transparent"></div>   
      308 -                    Deleting...                              
      309 -                  </>                                        
      310 -                ) : (                                        
      311 -                  <>                                         
      312 -                    <Trash2 className="w-4 h-4" />           
      313 -                    Delete Forever                           
      314 -                  </>                                        
      315 -                )}                                           
      316 -              </button>                                      
      317 -            </div>                                           
      318 -          </div>                                             
      319 -        </div>                                               
      320 -      )}                                                     
      321 -    </div>                                                   
      322 -  );                                                         
      323 -}                                                            
      324 -                                                             
      325 -export default SettingsTab;                                  
        1 +import React, { useState, useEffect } from 'react';           
        2 +import { useNavigate } from 'react-router-dom';               
        3 +import { Key, Eye, EyeOff, Trash2, AlertTriangle, Shield, Save
          +, ExternalLink } from 'lucide-react';                         
        4 +                                                              
        5 +function SettingsTab({ user, logout }) {                      
        6 +  const navigate = useNavigate();                             
        7 +  const [apiKey, setApiKey] = useState('');                   
        8 +  const [showApiKey, setShowApiKey] = useState(false);        
        9 +  const [hasApiKey, setHasApiKey] = useState(false);          
       10 +  const [loading, setLoading] = useState(false);              
       11 +  const [success, setSuccess] = useState('');                 
       12 +  const [error, setError] = useState('');                     
       13 +  const [showDeleteConfirm, setShowDeleteConfirm] = useState(f
          +alse);                                                        
       14 +  const [deletePassword, setDeletePassword] = useState('');   
       15 +  const [deleteLoading, setDeleteLoading] = useState(false);  
       16 +  const [deleteError, setDeleteError] = useState('');         
       17 +                                                              
       18 +  useEffect(() => {                                           
       19 +    loadUserData();                                           
       20 +  }, []);                                                     
       21 +                                                              
       22 +  const loadUserData = async () => {                          
       23 +    try {                                                     
       24 +      const res = await fetch('/api/auth/me', {               
       25 +        headers: { 'Authorization': `Bearer ${localStorage.get
          +Item('token')}` }                                             
       26 +      });                                                     
       27 +      const data = await res.json();                          
       28 +      setHasApiKey(!!data.has_api_key);                       
       29 +    } catch (error) {                                         
       30 +      console.error('Failed to load user data:', error);      
       31 +    }                                                         
       32 +  };                                                          
       33 +                                                              
       34 +  const handleSaveApiKey = async (e) => {                     
       35 +    e.preventDefault();                                       
       36 +    if (!apiKey.trim()) return;                               
       37 +                                                              
       38 +    setError('');                                             
       39 +    setSuccess('');                                           
       40 +    setLoading(true);                                         
       41 +                                                              
       42 +    try {                                                     
       43 +      const res = await fetch('/api/auth/profile', {          
       44 +        method: 'PUT',                                        
       45 +        headers: {                                            
       46 +          'Content-Type': 'application/json',                 
       47 +          'Authorization': `Bearer ${localStorage.getItem('tok
          +en')}`                                                        
       48 +        },                                                    
       49 +        body: JSON.stringify({ openai_api_key: apiKey })      
       50 +      });                                                     
       51 +                                                              
       52 +      if (!res.ok) {                                          
       53 +        throw new Error('Failed to save API key');            
       54 +      }                                                       
       55 +                                                              
       56 +      setSuccess('API key saved successfully!');              
       57 +      setApiKey('');                                          
       58 +      setHasApiKey(true);                                     
       59 +    } catch (err) {                                           
       60 +      setError(err.message);                                  
       61 +    } finally {                                               
       62 +      setLoading(false);                                      
       63 +    }                                                         
       64 +  };                                                          
       65 +                                                              
       66 +  const removeApiKey = async () => {                          
       67 +    if (!confirm('Are you sure you want to remove your API key
          +?')) return;                                                  
       68 +                                                              
       69 +    try {                                                     
       70 +      await fetch('/api/auth/profile', {                      
       71 +        method: 'PUT',                                        
       72 +        headers: {                                            
       73 +          'Content-Type': 'application/json',                 
       74 +          'Authorization': `Bearer ${localStorage.getItem('tok
          +en')}`                                                        
       75 +        },                                                    
       76 +        body: JSON.stringify({ openai_api_key: null })        
       77 +      });                                                     
       78 +      setHasApiKey(false);                                    
       79 +      setSuccess('API key removed successfully');             
       80 +    } catch (error) {                                         
       81 +      setError('Failed to remove API key');                   
       82 +    }                                                         
       83 +  };                                                          
       84 +                                                              
       85 +  const handleDeleteAccount = async () => {                   
       86 +    if (!deletePassword) {                                    
       87 +      setDeleteError('Please enter your password');           
       88 +      return;                                                 
       89 +    }                                                         
       90 +                                                              
       91 +    setDeleteLoading(true);                                   
       92 +    setDeleteError('');                                       
       93 +                                                              
       94 +    try {                                                     
       95 +      const res = await fetch('/api/auth/profile', {          
       96 +        method: 'DELETE',                                     
       97 +        headers: {                                            
       98 +          'Content-Type': 'application/json',                 
       99 +          'Authorization': `Bearer ${localStorage.getItem('tok
          +en')}`                                                        
      100 +        },                                                    
      101 +        body: JSON.stringify({ password: deletePassword })    
      102 +      });                                                     
      103 +                                                              
      104 +      const data = await res.json();                          
      105 +                                                              
      106 +      if (!res.ok) {                                          
      107 +        throw new Error(data.error || 'Failed to delete accoun
          +t');                                                          
      108 +      }                                                       
      109 +                                                              
      110 +      logout();                                               
      111 +      navigate('/login');                                     
      112 +    } catch (err) {                                           
      113 +      setDeleteError(err.message);                            
      114 +    } finally {                                               
      115 +      setDeleteLoading(false);                                
      116 +    }                                                         
      117 +  };                                                          
      118 +                                                              
      119 +  return (                                                    
      120 +    <div className="space-y-8">                               
      121 +      <div>                                                   
      122 +        <h2 className="text-2xl font-bold text-dark-100 mb-2 t
          +racking-tight">Settings</h2>                                  
      123 +        <p className="text-dark-400 mb-6">Manage your API key 
          +and account</p>                                               
      124 +      </div>                                                  
      125 +                                                              
      126 +      {error && (                                             
      127 +        <div className="bg-red-500/10 border border-red-500/20
          + text-red-400 px-4 py-3 rounded-xl text-sm">                  
      128 +          {error}                                             
      129 +        </div>                                                
      130 +      )}                                                      
      131 +                                                              
      132 +      {success && (                                           
      133 +        <div className="bg-green-500/10 border border-green-50
          +0/20 text-green-400 px-4 py-3 rounded-xl text-sm">            
      134 +          {success}                                           
      135 +        </div>                                                
      136 +      )}                                                      
      137 +                                                              
      138 +      {/* API Key Section */}                                 
      139 +      <section className="border-b border-dark-700/50 pb-8">  
      140 +        <h3 className="text-xl font-semibold mb-4 flex items-c
          +enter gap-2 text-dark-100">                                   
      141 +          <Key className="w-5 h-5 text-accent-400" />         
      142 +          OpenRouter API Key                                  
      143 +        </h3>                                                 
      144 +                                                              
      145 +        {user?.use_default_key ? (                            
      146 +          <div className="bg-primary-500/10 border border-prim
          +ary-500/20 rounded-xl p-4 mb-4">                              
      147 +            <p className="text-primary-400 text-sm">          
      148 +              You are currently using the default API key set 
          +by the administrator.                                         
      149 +              You can still set your own API key to override t
          +his.                                                          
      150 +            </p>                                              
      151 +          </div>                                              
      152 +        ) : (                                                 
      153 +          <div className="bg-accent-500/10 border border-accen
          +t-500/20 rounded-xl p-4 mb-4">                                
      154 +            <p className="text-accent-400 text-sm">           
      155 +              You need to set your own API key or ask an admin
          +istrator to enable the default key for you.                   
      156 +            </p>                                              
      157 +          </div>                                              
      158 +        )}                                                    
      159 +                                                              
      160 +        {hasApiKey && (                                       
      161 +          <div className="bg-green-500/10 border border-green-
          +500/20 rounded-xl p-4 mb-4">                                  
      162 +            <div className="flex items-center justify-between"
          +>                                                             
      163 +              <p className="text-green-400 text-sm">          
      164 +                You have configured your personal API key     
      165 +              </p>                                            
      166 +              <button                                         
      167 +                type="button"                                 
      168 +                onClick={removeApiKey}                        
      169 +                className="text-sm text-red-400 hover:text-red
          +-300 font-medium"                                             
      170 +              >                                               
      171 +                Remove Key                                    
      172 +              </button>                                       
      173 +            </div>                                            
      174 +          </div>                                              
      175 +        )}                                                    
      176 +                                                              
      177 +        <form onSubmit={handleSaveApiKey} className="space-y-4
          +">                                                            
      178 +          <div>                                               
      179 +            <label className="block text-sm font-medium text-d
          +ark-300 mb-2">                                                
      180 +              {hasApiKey ? 'Update API Key' : 'Set API Key'}  
      181 +            </label>                                          
      182 +            <div className="relative">                        
      183 +              <input                                          
      184 +                type={showApiKey ? 'text' : 'password'}       
      185 +                value={apiKey}                                
      186 +                onChange={(e) => setApiKey(e.target.value)}   
      187 +                className="w-full px-4 py-3 pr-12 rounded-xl g
          +lass-input outline-none font-mono text-sm text-dark-100"      
      188 +                placeholder="sk-..."                          
      189 +              />                                              
      190 +              <button                                         
      191 +                type="button"                                 
      192 +                onClick={() => setShowApiKey(!showApiKey)}    
      193 +                className="absolute right-3 top-1/2 -translate
          +-y-1/2 text-dark-400 hover:text-dark-200"                     
      194 +              >                                               
      195 +                {showApiKey ? <EyeOff className="w-5 h-5" /> :
          + <Eye className="w-5 h-5" />}                                 
      196 +              </button>                                       
      197 +            </div>                                            
      198 +            <p className="text-xs text-dark-500 mt-2 flex item
          +s-center gap-1">                                              
      199 +              Get your API key at{' '}                        
      200 +              <a                                              
      201 +                href="https://openrouter.ai/keys"             
      202 +                target="_blank"                               
      203 +                rel="noopener noreferrer"                     
      204 +                className="text-primary-400 hover:underline in
          +line-flex items-center gap-1"                                 
      205 +              >                                               
      206 +                OpenRouter                                    
      207 +                <ExternalLink className="w-3 h-3" />          
      208 +              </a>                                            
      209 +            </p>                                              
      210 +          </div>                                              
      211 +                                                              
      212 +          <button                                             
      213 +            type="submit"                                     
      214 +            disabled={loading || !apiKey.trim()}              
      215 +            className="bg-primary-500 hover:bg-primary-600 tex
          +t-white px-6 py-3 rounded-xl font-semibold transition-all dura
          +tion-200 disabled:opacity-50 disabled:cursor-not-allowed flex 
          +items-center gap-2 active:scale-[0.98]"                       
      216 +          >                                                   
      217 +            {loading ? (                                      
      218 +              <>                                              
      219 +                <div className="animate-spin rounded-full h-5 
          +w-5 border-2 border-white border-t-transparent"></div>        
      220 +                Saving...                                     
      221 +              </>                                             
      222 +            ) : (                                             
      223 +              <>                                              
      224 +                <Save className="w-5 h-5" />                  
      225 +                Save API Key                                  
      226 +              </>                                             
      227 +            )}                                                
      228 +          </button>                                           
      229 +        </form>                                               
      230 +      </section>                                              
      231 +                                                              
      232 +      {/* Danger Zone */}                                     
      233 +      <section>                                               
      234 +        <h3 className="text-xl font-semibold mb-4 flex items-c
          +enter gap-2 text-red-400">                                    
      235 +          <AlertTriangle className="w-5 h-5" />               
      236 +          Danger Zone                                         
      237 +        </h3>                                                 
      238 +                                                              
      239 +        <div className="bg-red-500/10 border border-red-500/20
          + rounded-xl p-6">                                             
      240 +          <h4 className="font-semibold text-red-400 mb-2">Dele
          +te Account</h4>                                               
      241 +          <p className="text-sm text-dark-400 mb-4">          
      242 +            This action cannot be undone. All your chats, mess
          +ages, and memories will be permanently deleted.               
      243 +          </p>                                                
      244 +                                                              
      245 +          {user?.is_admin ? (                                 
      246 +            <div className="flex items-center gap-2 text-sm te
          +xt-dark-400 bg-dark-800/50 p-3 rounded-lg">                   
      247 +              <Shield className="w-4 h-4" />                  
      248 +              Admin accounts cannot be deleted                
      249 +            </div>                                            
      250 +          ) : (                                               
      251 +            <button                                           
      252 +              onClick={() => setShowDeleteConfirm(true)}      
      253 +              className="px-4 py-2.5 bg-red-500/10 hover:bg-re
          +d-500/20 text-red-400 rounded-xl font-medium transition-colors
          + flex items-center gap-2"                                     
      254 +            >                                                 
      255 +              <Trash2 className="w-4 h-4" />                  
      256 +              Delete Account                                  
      257 +            </button>                                         
      258 +          )}                                                  
      259 +        </div>                                                
      260 +      </section>                                              
      261 +                                                              
      262 +      {/* Delete Confirmation Modal */}                       
      263 +      {showDeleteConfirm && (                                 
      264 +        <div className="fixed inset-0 bg-dark-950/80 backdrop-
          +blur-md flex items-center justify-center z-50 scale-in">      
      265 +          <div className="glass-modal rounded-2xl p-6 w-full m
          +ax-w-md mx-4 shadow-2xl">                                     
      266 +            <h3 className="text-xl font-bold text-red-400 mb-2
          + flex items-center gap-2">                                    
      267 +              <AlertTriangle className="w-6 h-6" />           
      268 +              Confirm Account Deletion                        
      269 +            </h3>                                             
      270 +            <p className="text-dark-400 mb-6">                
      271 +              Please enter your password to confirm. This acti
          +on is irreversible and will delete all your data.             
      272 +            </p>                                              
      273 +                                                              
      274 +            {deleteError && (                                 
      275 +              <div className="bg-red-500/10 border border-red-
          +500/20 text-red-400 px-4 py-3 rounded-xl mb-4 text-sm">       
      276 +                {deleteError}                                 
      277 +              </div>                                          
      278 +            )}                                                
      279 +                                                              
      280 +            <input                                            
      281 +              type="password"                                 
      282 +              value={deletePassword}                          
      283 +              onChange={(e) => setDeletePassword(e.target.valu
          +e)}                                                           
      284 +              placeholder="Enter your password"               
      285 +              className="w-full px-4 py-3 rounded-xl glass-inp
          +ut outline-none text-dark-100 mb-4"                           
      286 +              autoFocus                                       
      287 +            />                                                
      288 +                                                              
      289 +            <div className="flex gap-3">                      
      290 +              <button                                         
      291 +                onClick={() => {                              
      292 +                  setShowDeleteConfirm(false);                
      293 +                  setDeletePassword('');                      
      294 +                  setDeleteError('');                         
      295 +                }}                                            
      296 +                className="flex-1 px-4 py-3 glass-button round
          +ed-xl text-dark-300 hover:text-dark-100 font-semibold transiti
          +on-colors"                                                    
      297 +              >                                               
      298 +                Cancel                                        
      299 +              </button>                                       
      300 +              <button                                         
      301 +                onClick={handleDeleteAccount}                 
      302 +                disabled={!deletePassword || deleteLoading}   
      303 +                className="flex-1 px-4 py-3 bg-red-500 hover:b
          +g-red-600 text-white rounded-xl font-semibold transition-color
          +s disabled:opacity-50 disabled:cursor-not-allowed flex items-c
          +enter justify-center gap-2"                                   
      304 +              >                                               
      305 +                {deleteLoading ? (                            
      306 +                  <>                                          
      307 +                    <div className="animate-spin rounded-full 
          +h-5 w-5 border-2 border-white border-t-transparent"></div>    
      308 +                    Deleting...                               
      309 +                  </>                                         
      310 +                ) : (                                         
      311 +                  <>                                          
      312 +                    <Trash2 className="w-4 h-4" />            
      313 +                    Delete Forever                            
      314 +                  </>                                         
      315 +                )}                                            
      316 +              </button>                                       
      317 +            </div>                                            
      318 +          </div>                                              
      319 +        </div>                                                
      320 +      )}                                                      
      321 +    </div>                                                    
      322 +  );                                                          
      323 +}                                                             
      324 +                                                              
      325 +export default SettingsTab;                                   

● Write(client\src\components\ProfileTab.jsx)
  ⎿  Added 178 lines, removed 178 lines
        1 -import React, { useState, useEffect } from 'react';          
        2 -import { User, Mail, Lock, Save } from 'lucide-react';       
        3 -                                                             
        4 -function ProfileTab({ user }) {                              
        5 -  const [name, setName] = useState(user?.name || '');        
        6 -  const [password, setPassword] = useState('');              
        7 -  const [confirmPassword, setConfirmPassword] = useState('');
        8 -  const [loading, setLoading] = useState(false);             
        9 -  const [success, setSuccess] = useState('');                
       10 -  const [error, setError] = useState('');                    
       11 -                                                             
       12 -  useEffect(() => {                                          
       13 -    loadUserData();                                          
       14 -  }, []);                                                    
       15 -                                                             
       16 -  const loadUserData = async () => {                         
       17 -    try {                                                    
       18 -      const res = await fetch('/api/auth/me', {              
       19 -        headers: { 'Authorization': `Bearer ${localStorage.get
          -Item('token')}` }                                            
       20 -      });                                                    
       21 -      const data = await res.json();                         
       22 -      setName(data.name);                                    
       23 -    } catch (error) {                                        
       24 -      console.error('Failed to load user data:', error);     
       25 -    }                                                        
       26 -  };                                                         
       27 -                                                             
       28 -  const handleSave = async (e) => {                          
       29 -    e.preventDefault();                                      
       30 -    setError('');                                            
       31 -    setSuccess('');                                          
       32 -                                                             
       33 -    if (password && password !== confirmPassword) {          
       34 -      setError('Passwords do not match');                    
       35 -      return;                                                
       36 -    }                                                        
       37 -                                                             
       38 -    if (password && password.length < 6) {                   
       39 -      setError('Password must be at least 6 characters');    
       40 -      return;                                                
       41 -    }                                                        
       42 -                                                             
       43 -    setLoading(true);                                        
       44 -                                                             
       45 -    try {                                                    
       46 -      const updates = { name };                              
       47 -                                                             
       48 -      if (password) {                                        
       49 -        updates.password = password;                         
       50 -      }                                                      
       51 -                                                             
       52 -      const res = await fetch('/api/auth/profile', {         
       53 -        method: 'PUT',                                       
       54 -        headers: {                                           
       55 -          'Content-Type': 'application/json',                
       56 -          'Authorization': `Bearer ${localStorage.getItem('tok
          -en')}`                                                       
       57 -        },                                                   
       58 -        body: JSON.stringify(updates)                        
       59 -      });                                                    
       60 -                                                             
       61 -      if (!res.ok) {                                         
       62 -        throw new Error('Failed to update profile');         
       63 -      }                                                      
       64 -                                                             
       65 -      setSuccess('Profile updated successfully!');           
       66 -      setPassword('');                                       
       67 -      setConfirmPassword('');                                
       68 -    } catch (err) {                                          
       69 -      setError(err.message);                                 
       70 -    } finally {                                              
       71 -      setLoading(false);                                     
       72 -    }                                                        
       73 -  };                                                         
       74 -                                                             
       75 -  return (                                                   
       76 -    <div>                                                    
       77 -      <h2 className="text-2xl font-bold text-dark-100 mb-2">Pr
          -ofile Information</h2>                                       
       78 -      <p className="text-dark-400 mb-6">Update your personal i
          -nformation and password</p>                                  
       79 -                                                             
       80 -      {error && (                                            
       81 -        <div className="bg-red-500/20 border border-red-500/30
          - text-red-300 px-4 py-3 rounded-lg mb-6">                    
       82 -          {error}                                            
       83 -        </div>                                               
       84 -      )}                                                     
       85 -                                                             
       86 -      {success && (                                          
       87 -        <div className="bg-green-500/20 border border-green-50
          -0/30 text-green-300 px-4 py-3 rounded-lg mb-6">              
       88 -          {success}                                          
       89 -        </div>                                               
       90 -      )}                                                     
       91 -                                                             
       92 -      <form onSubmit={handleSave} className="space-y-6">     
       93 -        <div>                                                
       94 -          <label className="block text-sm font-medium text-dar
          -k-200 mb-2 flex items-center gap-2">                         
       95 -            <User className="w-4 h-4 text-primary-400" />    
       96 -            Name                                             
       97 -          </label>                                           
       98 -          <input                                             
       99 -            type="text"                                      
      100 -            value={name}                                     
      101 -            onChange={(e) => setName(e.target.value)}        
      102 -            className="w-full px-4 py-3 rounded-lg glass-input
          - outline-none text-dark-100 bg-dark-800/50"                  
      103 -            required                                         
      104 -          />                                                 
      105 -        </div>                                               
      106 -                                                             
      107 -        <div>                                                
      108 -          <label className="block text-sm font-medium text-dar
          -k-200 mb-2 flex items-center gap-2">                         
      109 -            <Mail className="w-4 h-4 text-primary-400" />    
      110 -            Email                                            
      111 -          </label>                                           
      112 -          <input                                             
      113 -            type="email"                                     
      114 -            value={user?.email || ''}                        
      115 -            disabled                                         
      116 -            className="w-full px-4 py-3 rounded-lg bg-dark-800
          -/30 border border-dark-700/50 text-dark-500"                 
      117 -          />                                                 
      118 -          <p className="mt-1 text-xs text-dark-500">Email cann
          -ot be changed</p>                                            
      119 -        </div>                                               
      120 -                                                             
      121 -        <div className="border-t border-dark-700/50 pt-6">   
      122 -          <h3 className="text-lg font-semibold text-dark-100 m
          -b-4 flex items-center gap-2">                                
      123 -            <Lock className="w-4 h-4 text-accent-400" />     
      124 -            Change Password                                  
      125 -          </h3>                                              
      126 -                                                             
      127 -          <div className="space-y-4">                        
      128 -            <div>                                            
      129 -              <label className="block text-sm font-medium text
          --dark-200 mb-2">                                             
      130 -                New Password                                 
      131 -              </label>                                       
      132 -              <input                                         
      133 -                type="password"                              
      134 -                value={password}                             
      135 -                onChange={(e) => setPassword(e.target.value)}
      136 -                className="w-full px-4 py-3 rounded-lg glass-i
          -nput outline-none text-dark-100 bg-dark-800/50"              
      137 -                placeholder="Leave blank to keep current passw
          -ord"                                                         
      138 -              />                                             
      139 -            </div>                                           
      140 -                                                             
      141 -            <div>                                            
      142 -              <label className="block text-sm font-medium text
          --dark-200 mb-2">                                             
      143 -                Confirm New Password                         
      144 -              </label>                                       
      145 -              <input                                         
      146 -                type="password"                              
      147 -                value={confirmPassword}                      
      148 -                onChange={(e) => setConfirmPassword(e.target.v
          -alue)}                                                       
      149 -                className="w-full px-4 py-3 rounded-lg glass-i
          -nput outline-none text-dark-100 bg-dark-800/50"              
      150 -                placeholder="Confirm new password"           
      151 -              />                                             
      152 -            </div>                                           
      153 -          </div>                                             
      154 -        </div>                                               
      155 -                                                             
      156 -        <button                                              
      157 -          type="submit"                                      
      158 -          disabled={loading}                                 
      159 -          className="w-full gradient-primary text-white py-3 r
          -ounded-lg font-medium hover:shadow-glow transition-all disable
          -d:opacity-50 disabled:cursor-not-allowed flex items-center jus
          -tify-center gap-2"                                           
      160 -        >                                                    
      161 -          {loading ? (                                       
      162 -            <>                                               
      163 -              <div className="animate-spin rounded-full h-5 w-
          -5 border-2 border-white border-t-transparent"></div>         
      164 -              Saving...                                      
      165 -            </>                                              
      166 -          ) : (                                              
      167 -            <>                                               
      168 -              <Save className="w-5 h-5" />                   
      169 -              Save Changes                                   
      170 -            </>                                              
      171 -          )}                                                 
      172 -        </button>                                            
      173 -      </form>                                                
      174 -    </div>                                                   
      175 -  );                                                         
      176 -}                                                            
      177 -                                                             
      178 -export default ProfileTab;                                   
        1 +import React, { useState, useEffect } from 'react';           
        2 +import { User, Mail, Lock, Save } from 'lucide-react';        
        3 +                                                              
        4 +function ProfileTab({ user }) {                               
        5 +  const [name, setName] = useState(user?.name || '');         
        6 +  const [password, setPassword] = useState('');               
        7 +  const [confirmPassword, setConfirmPassword] = useState(''); 
        8 +  const [loading, setLoading] = useState(false);              
        9 +  const [success, setSuccess] = useState('');                 
       10 +  const [error, setError] = useState('');                     
       11 +                                                              
       12 +  useEffect(() => {                                           
       13 +    loadUserData();                                           
       14 +  }, []);                                                     
       15 +                                                              
       16 +  const loadUserData = async () => {                          
       17 +    try {                                                     
       18 +      const res = await fetch('/api/auth/me', {               
       19 +        headers: { 'Authorization': `Bearer ${localStorage.get
          +Item('token')}` }                                             
       20 +      });                                                     
       21 +      const data = await res.json();                          
       22 +      setName(data.name);                                     
       23 +    } catch (error) {                                         
       24 +      console.error('Failed to load user data:', error);      
       25 +    }                                                         
       26 +  };                                                          
       27 +                                                              
       28 +  const handleSave = async (e) => {                           
       29 +    e.preventDefault();                                       
       30 +    setError('');                                             
       31 +    setSuccess('');                                           
       32 +                                                              
       33 +    if (password && password !== confirmPassword) {           
       34 +      setError('Passwords do not match');                     
       35 +      return;                                                 
       36 +    }                                                         
       37 +                                                              
       38 +    if (password && password.length < 6) {                    
       39 +      setError('Password must be at least 6 characters');     
       40 +      return;                                                 
       41 +    }                                                         
       42 +                                                              
       43 +    setLoading(true);                                         
       44 +                                                              
       45 +    try {                                                     
       46 +      const updates = { name };                               
       47 +                                                              
       48 +      if (password) {                                         
       49 +        updates.password = password;                          
       50 +      }                                                       
       51 +                                                              
       52 +      const res = await fetch('/api/auth/profile', {          
       53 +        method: 'PUT',                                        
       54 +        headers: {                                            
       55 +          'Content-Type': 'application/json',                 
       56 +          'Authorization': `Bearer ${localStorage.getItem('tok
          +en')}`                                                        
       57 +        },                                                    
       58 +        body: JSON.stringify(updates)                         
       59 +      });                                                     
       60 +                                                              
       61 +      if (!res.ok) {                                          
       62 +        throw new Error('Failed to update profile');          
       63 +      }                                                       
       64 +                                                              
       65 +      setSuccess('Profile updated successfully!');            
       66 +      setPassword('');                                        
       67 +      setConfirmPassword('');                                 
       68 +    } catch (err) {                                           
       69 +      setError(err.message);                                  
       70 +    } finally {                                               
       71 +      setLoading(false);                                      
       72 +    }                                                         
       73 +  };                                                          
       74 +                                                              
       75 +  return (                                                    
       76 +    <div>                                                     
       77 +      <h2 className="text-2xl font-bold text-dark-100 mb-2 tra
          +cking-tight">Profile Information</h2>                         
       78 +      <p className="text-dark-400 mb-6">Update your personal i
          +nformation and password</p>                                   
       79 +                                                              
       80 +      {error && (                                             
       81 +        <div className="bg-red-500/10 border border-red-500/20
          + text-red-400 px-4 py-3 rounded-xl mb-6 text-sm">             
       82 +          {error}                                             
       83 +        </div>                                                
       84 +      )}                                                      
       85 +                                                              
       86 +      {success && (                                           
       87 +        <div className="bg-green-500/10 border border-green-50
          +0/20 text-green-400 px-4 py-3 rounded-xl mb-6 text-sm">       
       88 +          {success}                                           
       89 +        </div>                                                
       90 +      )}                                                      
       91 +                                                              
       92 +      <form onSubmit={handleSave} className="space-y-6">      
       93 +        <div>                                                 
       94 +          <label className="block text-sm font-medium text-dar
          +k-300 mb-2 flex items-center gap-2">                          
       95 +            <User className="w-4 h-4 text-primary-400" />     
       96 +            Name                                              
       97 +          </label>                                            
       98 +          <input                                              
       99 +            type="text"                                       
      100 +            value={name}                                      
      101 +            onChange={(e) => setName(e.target.value)}         
      102 +            className="w-full px-4 py-3 rounded-xl glass-input
          + outline-none text-dark-100"                                  
      103 +            required                                          
      104 +          />                                                  
      105 +        </div>                                                
      106 +                                                              
      107 +        <div>                                                 
      108 +          <label className="block text-sm font-medium text-dar
          +k-300 mb-2 flex items-center gap-2">                          
      109 +            <Mail className="w-4 h-4 text-primary-400" />     
      110 +            Email                                             
      111 +          </label>                                            
      112 +          <input                                              
      113 +            type="email"                                      
      114 +            value={user?.email || ''}                         
      115 +            disabled                                          
      116 +            className="w-full px-4 py-3 rounded-xl bg-dark-800
          +/30 border border-dark-700/50 text-dark-500"                  
      117 +          />                                                  
      118 +          <p className="mt-1.5 text-xs text-dark-500">Email ca
          +nnot be changed</p>                                           
      119 +        </div>                                                
      120 +                                                              
      121 +        <div className="border-t border-dark-700/50 pt-6">    
      122 +          <h3 className="text-lg font-semibold text-dark-100 m
          +b-4 flex items-center gap-2">                                 
      123 +            <Lock className="w-4 h-4 text-accent-400" />      
      124 +            Change Password                                   
      125 +          </h3>                                               
      126 +                                                              
      127 +          <div className="space-y-4">                         
      128 +            <div>                                             
      129 +              <label className="block text-sm font-medium text
          +-dark-300 mb-2">                                              
      130 +                New Password                                  
      131 +              </label>                                        
      132 +              <input                                          
      133 +                type="password"                               
      134 +                value={password}                              
      135 +                onChange={(e) => setPassword(e.target.value)} 
      136 +                className="w-full px-4 py-3 rounded-xl glass-i
          +nput outline-none text-dark-100"                              
      137 +                placeholder="Leave blank to keep current passw
          +ord"                                                          
      138 +              />                                              
      139 +            </div>                                            
      140 +                                                              
      141 +            <div>                                             
      142 +              <label className="block text-sm font-medium text
          +-dark-300 mb-2">                                              
      143 +                Confirm New Password                          
      144 +              </label>                                        
      145 +              <input                                          
      146 +                type="password"                               
      147 +                value={confirmPassword}                       
      148 +                onChange={(e) => setConfirmPassword(e.target.v
          +alue)}                                                        
      149 +                className="w-full px-4 py-3 rounded-xl glass-i
          +nput outline-none text-dark-100"                              
      150 +                placeholder="Confirm new password"            
      151 +              />                                              
      152 +            </div>                                            
      153 +          </div>                                              
      154 +        </div>                                                
      155 +                                                              
      156 +        <button                                               
      157 +          type="submit"                                       
      158 +          disabled={loading}                                  
      159 +          className="w-full bg-primary-500 hover:bg-primary-60
          +0 text-white py-3 rounded-xl font-semibold transition-all dura
          +tion-200 disabled:opacity-50 disabled:cursor-not-allowed flex 
          +items-center justify-center gap-2 active:scale-[0.98]"        
      160 +        >                                                     
      161 +          {loading ? (                                        
      162 +            <>                                                
      163 +              <div className="animate-spin rounded-full h-5 w-
          +5 border-2 border-white border-t-transparent"></div>          
      164 +              Saving...                                       
      165 +            </>                                               
      166 +          ) : (                                               
      167 +            <>                                                
      168 +              <Save className="w-5 h-5" />                    
      169 +              Save Changes                                    
      170 +            </>                                               
      171 +          )}                                                  
      172 +        </button>                                             
      173 +      </form>                                                 
      174 +    </div>                                                    
      175 +  );                                                          
      176 +}                                                             
      177 +                                                              
      178 +export default ProfileTab;                                    

● Let me check if there's an Admin page that also needs updating.

● Search(pattern: "client/src/pages/*.jsx")
  ⎿  Found 6 files (ctrl+o to expand)
  ⎿  You've hit your limit · resets 6am (Europe/London)
     /upgrade to increase your usage limit.

✻ Cooked for 11m 40s
 ▐▛███▜▌   Claude Code v2.1.19
▝▜█████▛▘  Opus 4.5 · Claude Pro
  ▘▘ ▝▝    ~\workspace\budi_chat_truenas

❯ Implement the following plan:                                             
                                                                            
  # Frontend Redesign Plan: AI Chat Hub                                     
                                                                            
  ## Design Direction                                                       
                                                                            
  **From:** Cyan/purple "AI slop" with excessive glows, gradients, and      
  glass effects                                                             
  **To:** Refined minimal dark theme with warm amber/gold accents, elegant  
  restraint                                                                 
                                                                            
  **Inspirations:** Linear, Raycast - premium software with intentional     
  design                                                                    
                                                                            
  ---                                                                       
                                                                            
  ## Design Specifications                                                  
                                                                            
  | Aspect | Decision |                                                     
  |--------|----------|                                                     
  | **Aesthetic** | Refined Minimal |                                       
  | **Primary Color** | Amber/Gold (#f59e0b) |                              
  | **Secondary Color** | Copper/Warm Orange (#fb923c) |                    
  | **Typography** | Source Sans 3 (humanist sans) |                        
  | **Glassmorphism** | Selective - modals/dropdowns only |                 
  | **Chat Layout** | Centered narrow column (max-w-2xl) |                  
  | **Messages** | Subtle background tint, no bubbles |                     
  | **Background** | Subtle static gradient, no animation |                 
                                                                            
  ---                                                                       
                                                                            
  ## Implementation Phases                                                  
                                                                            
  ### Phase 1: Foundation                                                   
                                                                            
  **1. tailwind.config.js** - Replace color palette:                        
  ```javascript                                                             
  // Primary: Amber                                                         
  primary: {                                                                
  400: '#fbbf24',                                                           
  500: '#f59e0b',  // Main                                                  
  600: '#d97706',                                                           
  }                                                                         
                                                                            
  // Accent: Copper                                                         
  accent: {                                                                 
  400: '#fb923c',                                                           
  500: '#f97316',                                                           
  }                                                                         
                                                                            
  // Dark: Refined charcoal (keep scale, adjust values)                     
  dark: {                                                                   
  700: '#3f3f46',                                                           
  800: '#27272a',  // Cards                                                 
  850: '#1f1f23',  // Sidebar                                               
  900: '#18181b',  // Main bg                                               
  950: '#09090b',  // Deepest                                               
  }                                                                         
  ```                                                                       
                                                                            
  **2. index.html** - Add font:                                             
  ```html                                                                   
  <link href="https://fonts.googleapis.com/css2?family=Source+Sans+3:wght@4 
  00;500;600;700&display=swap" rel="stylesheet">                            
  ```                                                                       
                                                                            
  **3. index.css** - Major overhaul:                                        
                                                                            
  *Remove entirely:*                                                        
  - `.bg-mesh-animated` and `@keyframes float`                              
  - `.glow`, `.glow-accent`, `.glow-lg`, `.text-glow`                       
  - `.shine` effect                                                         
  - `.pulse-subtle`                                                         
  - `.gradient-text`                                                        
  - `.avatar-ring` gradient                                                 
                                                                            
  *Simplify:*                                                               
  - `.bg-mesh` → static subtle gradient                                     
  - `.glass` → simple `bg-dark-800/80 border-dark-700/50` (no blur)         
  - `.glass-card` → `bg-dark-800 border-dark-700/50`                        
  - `.glass-sidebar` → solid `bg-dark-850`                                  
                                                                            
  *Keep glass blur only for:*                                               
  - `.glass-modal` - modals with `backdrop-blur-xl`                         
  - `.glass-dropdown` - dropdowns/tooltips with `backdrop-blur-lg`          
                                                                            
  *Update colors in:*                                                       
  - Markdown styles (cyan → amber)                                          
  - Range slider thumb (gradient → solid amber)                             
  - Checkbox checked (gradient → solid amber)                               
  - Focus states (cyan → amber)                                             
                                                                            
  ---                                                                       
                                                                            
  ### Phase 2: Chat Interface (Chat.jsx)                                    
                                                                            
  **Sidebar:**                                                              
  - Logo: solid `bg-primary-500` (remove gradient)                          
  - Brand text: `text-primary-400` (remove gradient-text)                   
  - New Chat button: solid amber, remove shine                              
  - Chat items: `hover:bg-dark-700/50`, selected: `bg-dark-700 border-l-2   
  border-primary-500`                                                       
  - Remove all glow effects                                                 
                                                                            
  **Header:**                                                               
  - Solid `bg-dark-850 border-b border-dark-700/50` (remove glass)          
  - Agent mode badge: `bg-primary-500/10 text-primary-400` (no gradient)    
                                                                            
  **Messages:**                                                             
  - Container: `max-w-2xl` (narrow, focused reading)                        
  - User messages: `bg-dark-800 border-l-2 border-primary-500/50`           
  - AI messages: `bg-dark-850/50` (very subtle)                             
  - Full-width layout (remove bubble corners)                               
  - Simplify action buttons                                                 
                                                                            
  **Input:**                                                                
  - Send button: solid amber                                                
  - Remove shine effect                                                     
                                                                            
  **Settings Panel:**                                                       
  - Solid `bg-dark-850` (remove glass)                                      
  - Clean temperature slider                                                
  - Monospace system prompt textarea                                        
                                                                            
  ---                                                                       
                                                                            
  ### Phase 3: ModelSelector.jsx                                            
                                                                            
  - Apply `glass-dropdown` (selective blur)                                 
  - Group models by provider (Anthropic, OpenAI, Google...)                 
  - Add price tier indicators ($, $$, $$$)                                  
  - Solid amber hover highlight                                             
  - Remove gradient checkmark                                               
  - Reduce width to 380px                                                   
                                                                            
  ---                                                                       
                                                                            
  ### Phase 4: Auth Pages (Login.jsx, Register.jsx)                         
                                                                            
  - Static gradient background (remove mesh animation)                      
  - Solid amber buttons                                                     
  - Remove glow from logo                                                   
  - Clean input focus states                                                
                                                                            
  ---                                                                       
                                                                            
  ### Phase 5: Profile & Secondary Pages                                    
                                                                            
  **Profile.jsx:**                                                          
  - Solid `bg-dark-800` sidebar                                             
  - Clean tab selection                                                     
                                                                            
  **StatsTab.jsx:**                                                         
  - Solid amber for active calendar days                                    
  - Cleaner progress bars                                                   
                                                                            
  **Memories.jsx:**                                                         
  - Remove gradient from icons                                              
  - Simplify card hovers                                                    
                                                                            
  ---                                                                       
                                                                            
  ## Files to Modify                                                        
                                                                            
  | File | Scope |                                                          
  |------|-------|                                                          
  | `client/index.html` | Add Google Font |                                 
  | `client/tailwind.config.js` | New color palette, font family |          
  | `client/src/index.css` | Remove ~150 lines, modify ~100 lines |         
  | `client/src/pages/Chat.jsx` | ~50 class changes, message layout |       
  | `client/src/components/ModelSelector.jsx` | Dropdown styling, grouping  
  |                                                                         
  | `client/src/pages/Login.jsx` | ~15 class simplifications |              
  | `client/src/pages/Register.jsx` | Same as Login |                       
  | `client/src/pages/Profile.jsx` | ~10 class updates |                    
  | `client/src/components/StatsTab.jsx` | ~20 color changes |              
  | `client/src/components/SettingsTab.jsx` | Modal simplification |        
  | `client/src/pages/Memories.jsx` | ~20 class simplifications |           
                                                                            
  ---                                                                       
                                                                            
  ## Design Tokens Quick Reference                                          
                                                                            
  **Backgrounds:**                                                          
  - Page: `bg-dark-900`                                                     
  - Sidebar: `bg-dark-850`                                                  
  - Cards: `bg-dark-800`                                                    
  - Hover: `bg-dark-700/50`                                                 
                                                                            
  **Text:**                                                                 
  - Primary: `text-dark-100`                                                
  - Secondary: `text-dark-400`                                              
  - Muted: `text-dark-500`                                                  
  - Accent: `text-primary-400`                                              
                                                                            
  **Borders:**                                                              
  - Default: `border-dark-700/50`                                           
  - Hover: `border-dark-600`                                                
  - Active: `border-primary-500/50`                                         
                                                                            
  **Interactive:**                                                          
  - Button: `bg-primary-500 hover:bg-primary-600`                           
  - Selected: `bg-dark-700 border-l-2 border-primary-500`                   
  - Focus: `ring-1 ring-primary-500/30`                                     
                                                                            
  ---                                                                       
                                                                            
  ## Verification                                                           
                                                                            
  1. **Visual check:** Run `npm run dev` in client/, verify:                
  - Amber/gold accent appears throughout                                    
  - No cyan/purple remnants                                                 
  - Glass blur only on modals/dropdowns                                     
  - Static background (no floating orbs)                                    
                                                                            
  2. **Functionality check:**                                               
  - Send a message, verify streaming works                                  
  - Open model selector, test search                                        
  - Toggle settings panel                                                   
  - Fork a chat                                                             
  - Test login/logout flow                                                  
                                                                            
  3. **Responsive check:**                                                  
  - Collapse sidebar                                                        
  - Test on narrow viewport                                                 
                                                                            
                                                                            
  If you need specific details from before exiting plan mode (like exact    
  code snippets, error messages, or content you generated), read the full   
  transcript at: C:\Users\Jaxx\.claude\projects\C--Users-Jaxx-workspace-bud 
  i-chat-truenas\560fba45-bfc2-4bc0-a47c-94c2592d7dcf.jsonl                 

● I'll implement this frontend redesign systematically. Let me start by reading
  the current files to understand what needs to change.

● Read(client\index.html)
  ⎿  Read 13 lines

● Read(client\tailwind.config.js)
  ⎿  Read 69 lines

● Read(client\src\index.css)
  ⎿  Read 506 lines

● Now let me read the main component files.

● Read(client\src\pages\Chat.jsx)
  ⎿  Read 1521 lines

● Read(client\src\components\ModelSelector.jsx)
  ⎿  Read 389 lines

● Read(client\src\pages\Login.jsx)
  ⎿  Read 130 lines

● Let me read the remaining files.

● Read(client\src\pages\Register.jsx)
  ⎿  Read 150 lines

● Read(client\src\pages\Profile.jsx)
  ⎿  Read 73 lines

● Read(client\src\components\StatsTab.jsx)
  ⎿  Read 374 lines

● Read(client\src\pages\Memories.jsx)
  ⎿  Read 298 lines

● I have all the files. Let me create tasks to track this redesign and then
  start implementing.
✔ Task #1 created: Update tailwind.config.js with new color palette
✔ Task #2 created: Add Source Sans 3 font to index.html
✔ Task #3 created: Overhaul index.css - remove effects and update colors
✔ Task #4 created: Update Chat.jsx with new design system
✔ Task #5 created: Update ModelSelector.jsx styling
✔ Task #6 created: Update Login.jsx and Register.jsx
✔ Task #7 created: Update Profile.jsx, StatsTab.jsx, Memories.jsx

● Now let me start implementing. I'll begin with Phase 1: Foundation.
✔ Task #1 updated: status → in progress

● Write(client\tailwind.config.js)
  ⎿  Added 64 lines, removed 68 lines
       1 -/** @type {import('tailwindcss').Config} */                   
       2 -export default {                                              
       3 -  content: [                                                  
       4 -    "./index.html",                                           
       5 -    "./src/**/*.{js,ts,jsx,tsx}",                             
       6 -  ],                                                          
       7 -  theme: {                                                    
       8 -    extend: {                                                 
       9 -      colors: {                                               
      10 -        // Dark theme base colors                             
      11 -        dark: {                                               
      12 -          50: '#f8fafc',                                      
      13 -          100: '#f1f5f9',                                     
      14 -          200: '#e2e8f0',                                     
      15 -          300: '#cbd5e1',                                     
      16 -          400: '#94a3b8',                                     
      17 -          500: '#64748b',                                     
      18 -          600: '#475569',                                     
      19 -          700: '#334155',                                     
      20 -          800: '#1e293b',                                     
      21 -          850: '#172033',                                     
      22 -          900: '#0f172a',                                     
      23 -          950: '#0a0f1a',                                     
      24 -        },                                                    
      25 -        // Primary accent - vibrant cyan/teal                 
      26 -        primary: {                                            
      27 -          50: '#ecfeff',                                      
      28 -          100: '#cffafe',                                     
      29 -          200: '#a5f3fc',                                     
      30 -          300: '#67e8f9',                                     
      31 -          400: '#22d3ee',                                     
      32 -          500: '#06b6d4',                                     
      33 -          600: '#0891b2',                                     
      34 -          700: '#0e7490',                                     
      35 -          800: '#155e75',                                     
      36 -          900: '#164e63',                                     
      37 -        },                                                    
      38 -        // Secondary accent - vibrant purple/violet           
      39 -        accent: {                                             
      40 -          50: '#faf5ff',                                      
      41 -          100: '#f3e8ff',                                     
      42 -          200: '#e9d5ff',                                     
      43 -          300: '#d8b4fe',                                     
      44 -          400: '#c084fc',                                     
      45 -          500: '#a855f7',                                     
      46 -          600: '#9333ea',                                     
      47 -          700: '#7c3aed',                                     
      48 -          800: '#6b21a8',                                     
      49 -          900: '#581c87',                                     
      50 -        },                                                    
      51 -      },                                                      
      52 -      backgroundImage: {                                      
      53 -        'gradient-radial': 'radial-gradient(var(--tw-gradient-s
         -tops))',                                                      
      54 -        'gradient-mesh': 'linear-gradient(135deg, var(--tw-grad
         -ient-stops))',                                                
      55 -      },                                                      
      56 -      backdropBlur: {                                         
      57 -        xs: '2px',                                            
      58 -      },                                                      
      59 -      boxShadow: {                                            
      60 -        'glow': '0 0 20px rgba(6, 182, 212, 0.3)',            
      61 -        'glow-accent': '0 0 20px rgba(168, 85, 247, 0.3)',    
      62 -        'glow-lg': '0 0 40px rgba(6, 182, 212, 0.4)',         
      63 -        'inner-glow': 'inset 0 0 20px rgba(6, 182, 212, 0.1)',
      64 -      },                                                      
      65 -    },                                                        
      66 -  },                                                          
      67 -  plugins: [],                                                
      68 -};                                                            
       1 +/** @type {import('tailwindcss').Config} */                    
       2 +export default {                                               
       3 +  content: [                                                   
       4 +    "./index.html",                                            
       5 +    "./src/**/*.{js,ts,jsx,tsx}",                              
       6 +  ],                                                           
       7 +  theme: {                                                     
       8 +    extend: {                                                  
       9 +      fontFamily: {                                            
      10 +        sans: ['"Source Sans 3"', 'system-ui', 'sans-serif'],  
      11 +      },                                                       
      12 +      colors: {                                                
      13 +        // Dark theme base colors - refined charcoal           
      14 +        dark: {                                                
      15 +          50: '#fafafa',                                       
      16 +          100: '#f4f4f5',                                      
      17 +          200: '#e4e4e7',                                      
      18 +          300: '#d4d4d8',                                      
      19 +          400: '#a1a1aa',                                      
      20 +          500: '#71717a',                                      
      21 +          600: '#52525b',                                      
      22 +          700: '#3f3f46',                                      
      23 +          800: '#27272a',                                      
      24 +          850: '#1f1f23',                                      
      25 +          900: '#18181b',                                      
      26 +          950: '#09090b',                                      
      27 +        },                                                     
      28 +        // Primary accent - amber/gold                         
      29 +        primary: {                                             
      30 +          50: '#fffbeb',                                       
      31 +          100: '#fef3c7',                                      
      32 +          200: '#fde68a',                                      
      33 +          300: '#fcd34d',                                      
      34 +          400: '#fbbf24',                                      
      35 +          500: '#f59e0b',                                      
      36 +          600: '#d97706',                                      
      37 +          700: '#b45309',                                      
      38 +          800: '#92400e',                                      
      39 +          900: '#78350f',                                      
      40 +        },                                                     
      41 +        // Secondary accent - copper/warm orange               
      42 +        accent: {                                              
      43 +          50: '#fff7ed',                                       
      44 +          100: '#ffedd5',                                      
      45 +          200: '#fed7aa',                                      
      46 +          300: '#fdba74',                                      
      47 +          400: '#fb923c',                                      
      48 +          500: '#f97316',                                      
      49 +          600: '#ea580c',                                      
      50 +          700: '#c2410c',                                      
      51 +          800: '#9a3412',                                      
      52 +          900: '#7c2d12',                                      
      53 +        },                                                     
      54 +      },                                                       
      55 +      backgroundImage: {                                       
      56 +        'gradient-radial': 'radial-gradient(var(--tw-gradient-s
         +tops))',                                                       
      57 +      },                                                       
      58 +      backdropBlur: {                                          
      59 +        xs: '2px',                                             
      60 +      },                                                       
      61 +    },                                                         
      62 +  },                                                           
      63 +  plugins: [],                                                 
      64 +};                                                             
✔ Task #1 updated: status → completed
✔ Task #2 updated: status → in progress

● Write(client\index.html)
  ⎿  Added 15 lines, removed 12 lines
       1 -<!DOCTYPE html>                                               
       2 -<html lang="en">                                              
       3 -  <head>                                                      
       4 -    <meta charset="UTF-8" />                                  
       5 -    <meta name="viewport" content="width=device-width, initial-
         -scale=1.0" />                                                 
       6 -    <title>Budi Chat</title>                                  
       7 -  </head>                                                     
       8 -  <body>                                                      
       9 -    <div id="root"></div>                                     
      10 -    <script type="module" src="/src/main.jsx"></script>       
      11 -  </body>                                                     
      12 -</html>                                                       
       1 +<!DOCTYPE html>                                                
       2 +<html lang="en">                                               
       3 +  <head>                                                       
       4 +    <meta charset="UTF-8" />                                   
       5 +    <meta name="viewport" content="width=device-width, initial-
         +scale=1.0" />                                                  
       6 +    <link rel="preconnect" href="https://fonts.googleapis.com">
       7 +    <link rel="preconnect" href="https://fonts.gstatic.com" cro
         +ssorigin>                                                      
       8 +    <link href="https://fonts.googleapis.com/css2?family=Source
         ++Sans+3:wght@400;500;600;700&display=swap" rel="stylesheet">   
       9 +    <title>AI Chat Hub</title>                                 
      10 +  </head>                                                      
      11 +  <body>                                                       
      12 +    <div id="root"></div>                                      
      13 +    <script type="module" src="/src/main.jsx"></script>        
      14 +  </body>                                                      
      15 +</html>                                                        
✔ Task #2 updated: status → completed
✔ Task #3 updated: status → in progress

● Now let me overhaul index.css with the major changes.

● Write(client\src\index.css)
  ⎿  Added 340 lines, removed 505 lines
        1 -@tailwind base;                                              
        2 -@tailwind components;                                        
        3 -@tailwind utilities;                                         
        4 -                                                             
        5 -@layer base {                                                
        6 -  * {                                                        
        7 -    @apply scrollbar-thin scrollbar-thumb-dark-600 scrollbar-t
          -rack-transparent;                                            
        8 -  }                                                          
        9 -                                                             
       10 -  body {                                                     
       11 -    @apply bg-dark-950 text-dark-100 antialiased;            
       12 -    font-feature-settings: "cv02", "cv03", "cv04", "cv11";   
       13 -  }                                                          
       14 -                                                             
       15 -  /* Smoother font rendering */                              
       16 -  html {                                                     
       17 -    -webkit-font-smoothing: antialiased;                     
       18 -    -moz-osx-font-smoothing: grayscale;                      
       19 -    text-rendering: optimizeLegibility;                      
       20 -  }                                                          
       21 -}                                                            
       22 -                                                             
       23 -@layer utilities {                                           
       24 -  /* Custom scrollbar */                                     
       25 -  .scrollbar-thin::-webkit-scrollbar {                       
       26 -    width: 6px;                                              
       27 -    height: 6px;                                             
       28 -  }                                                          
       29 -                                                             
       30 -  .scrollbar-thumb-dark-600::-webkit-scrollbar-thumb {       
       31 -    @apply bg-dark-600/60 rounded-full;                      
       32 -    transition: background-color 0.2s;                       
       33 -  }                                                          
       34 -                                                             
       35 -  .scrollbar-thumb-dark-600::-webkit-scrollbar-thumb:hover { 
       36 -    @apply bg-dark-500/80;                                   
       37 -  }                                                          
       38 -                                                             
       39 -  .scrollbar-track-transparent::-webkit-scrollbar-track {    
       40 -    @apply bg-transparent;                                   
       41 -  }                                                          
       42 -                                                             
       43 -  /* Primary gradient */                                     
       44 -  .gradient-primary {                                        
       45 -    @apply bg-gradient-to-r from-primary-500 via-primary-400 t
          -o-accent-500;                                                
       46 -  }                                                          
       47 -                                                             
       48 -  /* Subtle gradient */                                      
       49 -  .gradient-subtle {                                         
       50 -    @apply bg-gradient-to-r from-primary-500/10 to-accent-500/
          -10;                                                          
       51 -  }                                                          
       52 -                                                             
       53 -  /* Gradient text */                                        
       54 -  .gradient-text {                                           
       55 -    @apply bg-gradient-to-r from-primary-400 via-cyan-300 to-a
          -ccent-400 bg-clip-text text-transparent;                     
       56 -  }                                                          
       57 -                                                             
       58 -  /* Glass effect utilities - enhanced */                    
       59 -  .glass {                                                   
       60 -    @apply bg-dark-900/50 backdrop-blur-xl border border-white
          -/[0.08];                                                     
       61 -    background: linear-gradient(                             
       62 -      135deg,                                                
       63 -      rgba(30, 41, 59, 0.5) 0%,                              
       64 -      rgba(15, 23, 42, 0.6) 100%                             
       65 -    );                                                       
       66 -  }                                                          
       67 -                                                             
       68 -  .glass-light {                                             
       69 -    @apply bg-dark-800/30 backdrop-blur-lg border border-white
          -/[0.06];                                                     
       70 -  }                                                          
       71 -                                                             
       72 -  .glass-card {                                              
       73 -    @apply backdrop-blur-xl shadow-2xl;                      
       74 -    background: linear-gradient(                             
       75 -      145deg,                                                
       76 -      rgba(30, 41, 59, 0.6) 0%,                              
       77 -      rgba(15, 23, 42, 0.7) 100%                             
       78 -    );                                                       
       79 -    border: 1px solid rgba(255, 255, 255, 0.08);             
       80 -    box-shadow:                                              
       81 -      0 4px 6px -1px rgba(0, 0, 0, 0.2),                     
       82 -      0 2px 4px -2px rgba(0, 0, 0, 0.1),                     
       83 -      inset 0 1px 0 rgba(255, 255, 255, 0.05);               
       84 -  }                                                          
       85 -                                                             
       86 -  .glass-card-hover {                                        
       87 -    @apply glass-card transition-all duration-300;           
       88 -  }                                                          
       89 -                                                             
       90 -  .glass-card-hover:hover {                                  
       91 -    border-color: rgba(255, 255, 255, 0.12);                 
       92 -    box-shadow:                                              
       93 -      0 8px 25px -5px rgba(0, 0, 0, 0.3),                    
       94 -      0 4px 10px -6px rgba(0, 0, 0, 0.2),                    
       95 -      inset 0 1px 0 rgba(255, 255, 255, 0.08);               
       96 -    transform: translateY(-1px);                             
       97 -  }                                                          
       98 -                                                             
       99 -  .glass-sidebar {                                           
      100 -    @apply backdrop-blur-2xl;                                
      101 -    background: linear-gradient(                             
      102 -      180deg,                                                
      103 -      rgba(15, 23, 42, 0.95) 0%,                             
      104 -      rgba(15, 23, 42, 0.85) 100%                            
      105 -    );                                                       
      106 -    border-right: 1px solid rgba(255, 255, 255, 0.06);       
      107 -  }                                                          
      108 -                                                             
      109 -  .glass-input {                                             
      110 -    @apply bg-dark-800/40 backdrop-blur-sm border border-white
          -/[0.08]                                                      
      111 -           focus:border-primary-500/50 focus:ring-2 focus:ring
          --primary-500/20                                              
      112 -           transition-all duration-200;                      
      113 -  }                                                          
      114 -                                                             
      115 -  .glass-input:hover:not(:focus) {                           
      116 -    border-color: rgba(255, 255, 255, 0.12);                 
      117 -  }                                                          
      118 -                                                             
      119 -  .glass-button {                                            
      120 -    @apply bg-dark-700/40 backdrop-blur-sm border border-white
          -/[0.08]                                                      
      121 -           hover:bg-dark-600/50 hover:border-white/[0.12]    
      122 -           active:scale-[0.98] transition-all duration-200;  
      123 -  }                                                          
      124 -                                                             
      125 -  /* Animated gradient background - enhanced */              
      126 -  .bg-mesh {                                                 
      127 -    background:                                              
      128 -      radial-gradient(ellipse 80% 50% at 20% 40%, rgba(6, 182,
          - 212, 0.12) 0%, transparent 50%),                            
      129 -      radial-gradient(ellipse 60% 50% at 80% 60%, rgba(168, 85
          -, 247, 0.12) 0%, transparent 50%),                           
      130 -      radial-gradient(ellipse 40% 40% at 50% 90%, rgba(6, 182,
          - 212, 0.08) 0%, transparent 50%),                            
      131 -      linear-gradient(180deg, rgba(15, 23, 42, 1) 0%, rgba(10,
          - 15, 26, 1) 100%);                                           
      132 -    background-attachment: fixed;                            
      133 -  }                                                          
      134 -                                                             
      135 -  /* Animated gradient orbs */                               
      136 -  .bg-mesh-animated {                                        
      137 -    position: relative;                                      
      138 -    overflow: hidden;                                        
      139 -  }                                                          
      140 -                                                             
      141 -  .bg-mesh-animated::before,                                 
      142 -  .bg-mesh-animated::after {                                 
      143 -    content: '';                                             
      144 -    position: absolute;                                      
      145 -    border-radius: 50%;                                      
      146 -    filter: blur(80px);                                      
      147 -    opacity: 0.5;                                            
      148 -    animation: float 20s ease-in-out infinite;               
      149 -  }                                                          
      150 -                                                             
      151 -  .bg-mesh-animated::before {                                
      152 -    width: 500px;                                            
      153 -    height: 500px;                                           
      154 -    background: radial-gradient(circle, rgba(6, 182, 212, 0.3)
          - 0%, transparent 70%);                                       
      155 -    top: -200px;                                             
      156 -    left: -100px;                                            
      157 -  }                                                          
      158 -                                                             
      159 -  .bg-mesh-animated::after {                                 
      160 -    width: 400px;                                            
      161 -    height: 400px;                                           
      162 -    background: radial-gradient(circle, rgba(168, 85, 247, 0.2
          -5) 0%, transparent 70%);                                     
      163 -    bottom: -150px;                                          
      164 -    right: -100px;                                           
      165 -    animation-delay: -10s;                                   
      166 -  }                                                          
      167 -                                                             
      168 -  @keyframes float {                                         
      169 -    0%, 100% { transform: translate(0, 0) scale(1); }        
      170 -    33% { transform: translate(30px, -30px) scale(1.05); }   
      171 -    66% { transform: translate(-20px, 20px) scale(0.95); }   
      172 -  }                                                          
      173 -                                                             
      174 -  /* Glow effects - enhanced */                              
      175 -  .glow {                                                    
      176 -    box-shadow:                                              
      177 -      0 0 15px rgba(6, 182, 212, 0.3),                       
      178 -      0 0 30px rgba(6, 182, 212, 0.15);                      
      179 -  }                                                          
      180 -                                                             
      181 -  .glow-accent {                                             
      182 -    box-shadow:                                              
      183 -      0 0 15px rgba(168, 85, 247, 0.3),                      
      184 -      0 0 30px rgba(168, 85, 247, 0.15);                     
      185 -  }                                                          
      186 -                                                             
      187 -  .glow-lg {                                                 
      188 -    box-shadow:                                              
      189 -      0 0 20px rgba(6, 182, 212, 0.4),                       
      190 -      0 0 40px rgba(6, 182, 212, 0.2),                       
      191 -      0 0 60px rgba(168, 85, 247, 0.1);                      
      192 -  }                                                          
      193 -                                                             
      194 -  /* Text glow */                                            
      195 -  .text-glow {                                               
      196 -    text-shadow: 0 0 20px rgba(6, 182, 212, 0.5);            
      197 -  }                                                          
      198 -                                                             
      199 -  /* Shine effect for buttons */                             
      200 -  .shine {                                                   
      201 -    position: relative;                                      
      202 -    overflow: hidden;                                        
      203 -  }                                                          
      204 -                                                             
      205 -  .shine::before {                                           
      206 -    content: '';                                             
      207 -    position: absolute;                                      
      208 -    top: 0;                                                  
      209 -    left: -100%;                                             
      210 -    width: 100%;                                             
      211 -    height: 100%;                                            
      212 -    background: linear-gradient(                             
      213 -      90deg,                                                 
      214 -      transparent,                                           
      215 -      rgba(255, 255, 255, 0.1),                              
      216 -      transparent                                            
      217 -    );                                                       
      218 -    transition: left 0.5s ease;                              
      219 -  }                                                          
      220 -                                                             
      221 -  .shine:hover::before {                                     
      222 -    left: 100%;                                              
      223 -  }                                                          
      224 -                                                             
      225 -  /* Pulse animation */                                      
      226 -  .pulse-subtle {                                            
      227 -    animation: pulse-subtle 3s ease-in-out infinite;         
      228 -  }                                                          
      229 -                                                             
      230 -  @keyframes pulse-subtle {                                  
      231 -    0%, 100% { opacity: 1; }                                 
      232 -    50% { opacity: 0.8; }                                    
      233 -  }                                                          
      234 -                                                             
      235 -  /* Fade in animation */                                    
      236 -  .fade-in {                                                 
      237 -    animation: fadeIn 0.3s ease-out;                         
      238 -  }                                                          
      239 -                                                             
      240 -  @keyframes fadeIn {                                        
      241 -    from { opacity: 0; transform: translateY(10px); }        
      242 -    to { opacity: 1; transform: translateY(0); }             
      243 -  }                                                          
      244 -                                                             
      245 -  /* Slide in animation */                                   
      246 -  .slide-in-left {                                           
      247 -    animation: slideInLeft 0.3s ease-out;                    
      248 -  }                                                          
      249 -                                                             
      250 -  @keyframes slideInLeft {                                   
      251 -    from { opacity: 0; transform: translateX(-20px); }       
      252 -    to { opacity: 1; transform: translateX(0); }             
      253 -  }                                                          
      254 -                                                             
      255 -  /* Scale in animation */                                   
      256 -  .scale-in {                                                
      257 -    animation: scaleIn 0.2s ease-out;                        
      258 -  }                                                          
      259 -                                                             
      260 -  @keyframes scaleIn {                                       
      261 -    from { opacity: 0; transform: scale(0.95); }             
      262 -    to { opacity: 1; transform: scale(1); }                  
      263 -  }                                                          
      264 -}                                                            
      265 -                                                             
      266 -/* Markdown styles for dark theme - enhanced */              
      267 -.markdown-content {                                          
      268 -  @apply max-w-none text-sm leading-relaxed text-dark-200;   
      269 -}                                                            
      270 -                                                             
      271 -.markdown-content > *:first-child {                          
      272 -  margin-top: 0;                                             
      273 -}                                                            
      274 -                                                             
      275 -.markdown-content > *:last-child {                           
      276 -  margin-bottom: 0;                                          
      277 -}                                                            
      278 -                                                             
      279 -.markdown-content pre {                                      
      280 -  @apply rounded-xl p-4 overflow-x-auto my-4;                
      281 -  background: linear-gradient(145deg, rgba(15, 23, 42, 0.8) 0%
          -, rgba(10, 15, 26, 0.9) 100%);                               
      282 -  border: 1px solid rgba(255, 255, 255, 0.06);               
      283 -  box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);            
      284 -}                                                            
      285 -                                                             
      286 -.markdown-content code {                                     
      287 -  @apply bg-primary-500/10 text-primary-300 px-1.5 py-0.5 roun
          -ded-md text-[13px] font-mono;                                
      288 -  border: 1px solid rgba(6, 182, 212, 0.15);                 
      289 -}                                                            
      290 -                                                             
      291 -.markdown-content pre code {                                 
      292 -  @apply bg-transparent text-dark-100 p-0 border-0;          
      293 -}                                                            
      294 -                                                             
      295 -.markdown-content h1 {                                       
      296 -  @apply text-xl font-bold mt-6 mb-4 text-dark-50 tracking-tig
          -ht;                                                          
      297 -}                                                            
      298 -                                                             
      299 -.markdown-content h2 {                                       
      300 -  @apply text-lg font-bold mt-5 mb-3 text-dark-50 tracking-tig
          -ht;                                                          
      301 -}                                                            
      302 -                                                             
      303 -.markdown-content h3 {                                       
      304 -  @apply text-base font-semibold mt-4 mb-2 text-dark-100;    
      305 -}                                                            
      306 -                                                             
      307 -.markdown-content p {                                        
      308 -  @apply my-3;                                               
      309 -}                                                            
      310 -                                                             
      311 -.markdown-content ul,                                        
      312 -.markdown-content ol {                                       
      313 -  @apply my-3 pl-5;                                          
      314 -}                                                            
      315 -                                                             
      316 -.markdown-content ul {                                       
      317 -  list-style-type: disc;                                     
      318 -}                                                            
      319 -                                                             
      320 -.markdown-content ol {                                       
      321 -  list-style-type: decimal;                                  
      322 -}                                                            
      323 -                                                             
      324 -.markdown-content li {                                       
      325 -  @apply my-1.5;                                             
      326 -}                                                            
      327 -                                                             
      328 -.markdown-content li::marker {                               
      329 -  @apply text-primary-400/60;                                
      330 -}                                                            
      331 -                                                             
      332 -.markdown-content a {                                        
      333 -  @apply text-primary-400 hover:text-primary-300 underline dec
          -oration-primary-400/30                                       
      334 -         hover:decoration-primary-300/50 underline-offset-2 tr
          -ansition-colors;                                             
      335 -}                                                            
      336 -                                                             
      337 -.markdown-content blockquote {                               
      338 -  @apply border-l-2 border-primary-500/50 pl-4 my-4 text-dark-
          -300 italic;                                                  
      339 -  background: linear-gradient(90deg, rgba(6, 182, 212, 0.05) 0
          -%, transparent 100%);                                        
      340 -  padding: 0.75rem 1rem 0.75rem 1rem;                        
      341 -  border-radius: 0 0.5rem 0.5rem 0;                          
      342 -}                                                            
      343 -                                                             
      344 -.markdown-content table {                                    
      345 -  @apply w-full my-4 border-collapse;                        
      346 -}                                                            
      347 -                                                             
      348 -.markdown-content th,                                        
      349 -.markdown-content td {                                       
      350 -  @apply border border-dark-700/50 px-3 py-2 text-sm;        
      351 -}                                                            
      352 -                                                             
      353 -.markdown-content th {                                       
      354 -  @apply bg-dark-800/50 font-semibold text-dark-100 text-left;
          -                                                              
      355 -}                                                            
      356 -                                                             
      357 -.markdown-content tr:hover td {                              
      358 -  @apply bg-dark-800/20;                                     
      359 -}                                                            
      360 -                                                             
      361 -.markdown-content hr {                                       
      362 -  @apply my-6 border-dark-700/50;                            
      363 -}                                                            
      364 -                                                             
      365 -.markdown-content img {                                      
      366 -  @apply rounded-lg my-4 max-w-full;                         
      367 -}                                                            
      368 -                                                             
      369 -/* Custom range slider for dark theme - enhanced */          
      370 -input[type="range"] {                                        
      371 -  @apply w-full h-1.5 rounded-full appearance-none cursor-poin
          -ter;                                                         
      372 -  background: linear-gradient(90deg, rgba(30, 41, 59, 0.8) 0%,
          - rgba(51, 65, 85, 0.6) 100%);                                
      373 -}                                                            
      374 -                                                             
      375 -input[type="range"]::-webkit-slider-thumb {                  
      376 -  @apply appearance-none w-4 h-4 rounded-full cursor-pointer s
          -hadow-lg;                                                    
      377 -  background: linear-gradient(135deg, #06b6d4 0%, #a855f7 100%
          -);                                                           
      378 -  box-shadow: 0 0 10px rgba(6, 182, 212, 0.4);               
      379 -  transition: transform 0.15s ease, box-shadow 0.15s ease;   
      380 -}                                                            
      381 -                                                             
      382 -input[type="range"]::-webkit-slider-thumb:hover {            
      383 -  transform: scale(1.1);                                     
      384 -  box-shadow: 0 0 15px rgba(6, 182, 212, 0.6);               
      385 -}                                                            
      386 -                                                             
      387 -input[type="range"]::-moz-range-thumb {                      
      388 -  @apply w-4 h-4 rounded-full cursor-pointer border-0;       
      389 -  background: linear-gradient(135deg, #06b6d4 0%, #a855f7 100%
          -);                                                           
      390 -  box-shadow: 0 0 10px rgba(6, 182, 212, 0.4);               
      391 -}                                                            
      392 -                                                             
      393 -/* Checkbox styling - enhanced */                            
      394 -input[type="checkbox"] {                                     
      395 -  @apply w-4 h-4 rounded cursor-pointer appearance-none;     
      396 -  background: linear-gradient(145deg, rgba(30, 41, 59, 0.8) 0%
          -, rgba(15, 23, 42, 0.9) 100%);                               
      397 -  border: 1px solid rgba(255, 255, 255, 0.1);                
      398 -  transition: all 0.2s ease;                                 
      399 -}                                                            
      400 -                                                             
      401 -input[type="checkbox"]:hover {                               
      402 -  border-color: rgba(6, 182, 212, 0.3);                      
      403 -}                                                            
      404 -                                                             
      405 -input[type="checkbox"]:checked {                             
      406 -  background: linear-gradient(135deg, #06b6d4 0%, #a855f7 100%
          -);                                                           
      407 -  border-color: transparent;                                 
      408 -  background-image: url("data:image/svg+xml,%3csvg viewBox='0 
          -0 16 16' fill='white' xmlns='http://www.w3.org/2000/svg'%3e%3c
          -path d='M12.207 4.793a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0l-2
          --2a1 1 0 011.414-1.414L6.5 9.086l4.293-4.293a1 1 0 011.414 0z'
          -/%3e%3c/svg%3e");                                            
      409 -  background-size: 100% 100%;                                
      410 -  background-position: center;                               
      411 -  background-repeat: no-repeat;                              
      412 -}                                                            
      413 -                                                             
      414 -input[type="checkbox"]:focus {                               
      415 -  @apply ring-2 ring-primary-500/30 outline-none;            
      416 -}                                                            
      417 -                                                             
      418 -/* Selection styling */                                      
      419 -::selection {                                                
      420 -  @apply bg-primary-500/30 text-white;                       
      421 -}                                                            
      422 -                                                             
      423 -/* Focus visible styling */                                  
      424 -:focus-visible {                                             
      425 -  @apply outline-none ring-2 ring-primary-500/50 ring-offset-2
          - ring-offset-dark-900;                                       
      426 -}                                                            
      427 -                                                             
      428 -/* Button press effect */                                    
      429 -.btn-press {                                                 
      430 -  transition: transform 0.1s ease;                           
      431 -}                                                            
      432 -                                                             
      433 -.btn-press:active {                                          
      434 -  transform: scale(0.97);                                    
      435 -}                                                            
      436 -                                                             
      437 -/* Tooltip styling */                                        
      438 -.tooltip {                                                   
      439 -  @apply relative;                                           
      440 -}                                                            
      441 -                                                             
      442 -.tooltip::after {                                            
      443 -  @apply absolute bottom-full left-1/2 -translate-x-1/2 mb-2 p
          -x-2 py-1                                                     
      444 -         text-xs text-white rounded-md opacity-0 pointer-event
          -s-none                                                       
      445 -         transition-opacity duration-200 whitespace-nowrap;  
      446 -  content: attr(data-tooltip);                               
      447 -  background: linear-gradient(145deg, rgba(30, 41, 59, 0.95) 0
          -%, rgba(15, 23, 42, 0.98) 100%);                             
      448 -  border: 1px solid rgba(255, 255, 255, 0.1);                
      449 -}                                                            
      450 -                                                             
      451 -.tooltip:hover::after {                                      
      452 -  @apply opacity-100;                                        
      453 -}                                                            
      454 -                                                             
      455 -/* Loading shimmer */                                        
      456 -.shimmer {                                                   
      457 -  background: linear-gradient(                               
      458 -    90deg,                                                   
      459 -    rgba(255, 255, 255, 0) 0%,                               
      460 -    rgba(255, 255, 255, 0.05) 50%,                           
      461 -    rgba(255, 255, 255, 0) 100%                              
      462 -  );                                                         
      463 -  background-size: 200% 100%;                                
      464 -  animation: shimmer 2s infinite;                            
      465 -}                                                            
      466 -                                                             
      467 -@keyframes shimmer {                                         
      468 -  0% { background-position: -200% 0; }                       
      469 -  100% { background-position: 200% 0; }                      
      470 -}                                                            
      471 -                                                             
      472 -/* Avatar ring */                                            
      473 -.avatar-ring {                                               
      474 -  @apply relative;                                           
      475 -}                                                            
      476 -                                                             
      477 -.avatar-ring::before {                                       
      478 -  content: '';                                               
      479 -  @apply absolute inset-0 rounded-full;                      
      480 -  background: linear-gradient(135deg, #06b6d4 0%, #a855f7 100%
          -);                                                           
      481 -  padding: 2px;                                              
      482 -  -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-
          -gradient(#fff 0 0);                                          
      483 -  mask: linear-gradient(#fff 0 0) content-box, linear-gradient
          -(#fff 0 0);                                                  
      484 -  -webkit-mask-composite: xor;                               
      485 -  mask-composite: exclude;                                   
      486 -}                                                            
      487 -                                                             
      488 -/* Divider with gradient */                                  
      489 -.divider-gradient {                                          
      490 -  @apply h-px;                                               
      491 -  background: linear-gradient(90deg, transparent 0%, rgba(255,
          - 255, 255, 0.1) 50%, transparent 100%);                      
      492 -}                                                            
      493 -                                                             
      494 -/* Badge */                                                  
      495 -.badge {                                                     
      496 -  @apply inline-flex items-center px-2 py-0.5 rounded-full tex
          -t-xs font-medium;                                            
      497 -}                                                            
      498 -                                                             
      499 -.badge-primary {                                             
      500 -  @apply bg-primary-500/20 text-primary-300 border border-prim
          -ary-500/30;                                                  
      501 -}                                                            
      502 -                                                             
      503 -.badge-accent {                                              
      504 -  @apply bg-accent-500/20 text-accent-300 border border-accent
          --500/30;                                                     
      505 -}                                                            
        1 +@tailwind base;                                               
        2 +@tailwind components;                                         
        3 +@tailwind utilities;                                          
        4 +                                                              
        5 +@layer base {                                                 
        6 +  * {                                                         
        7 +    @apply scrollbar-thin scrollbar-thumb-dark-600 scrollbar-t
          +rack-transparent;                                             
        8 +  }                                                           
        9 +                                                              
       10 +  body {                                                      
       11 +    @apply bg-dark-950 text-dark-100 antialiased;             
       12 +    font-feature-settings: "cv02", "cv03", "cv04", "cv11";    
       13 +  }                                                           
       14 +                                                              
       15 +  /* Smoother font rendering */                               
       16 +  html {                                                      
       17 +    -webkit-font-smoothing: antialiased;                      
       18 +    -moz-osx-font-smoothing: grayscale;                       
       19 +    text-rendering: optimizeLegibility;                       
       20 +  }                                                           
       21 +}                                                             
       22 +                                                              
       23 +@layer utilities {                                            
       24 +  /* Custom scrollbar */                                      
       25 +  .scrollbar-thin::-webkit-scrollbar {                        
       26 +    width: 6px;                                               
       27 +    height: 6px;                                              
       28 +  }                                                           
       29 +                                                              
       30 +  .scrollbar-thumb-dark-600::-webkit-scrollbar-thumb {        
       31 +    @apply bg-dark-600/60 rounded-full;                       
       32 +    transition: background-color 0.2s;                        
       33 +  }                                                           
       34 +                                                              
       35 +  .scrollbar-thumb-dark-600::-webkit-scrollbar-thumb:hover {  
       36 +    @apply bg-dark-500/80;                                    
       37 +  }                                                           
       38 +                                                              
       39 +  .scrollbar-track-transparent::-webkit-scrollbar-track {     
       40 +    @apply bg-transparent;                                    
       41 +  }                                                           
       42 +                                                              
       43 +  /* Static gradient background */                            
       44 +  .bg-mesh {                                                  
       45 +    background:                                               
       46 +      radial-gradient(ellipse 80% 50% at 20% 40%, rgba(245, 15
          +8, 11, 0.06) 0%, transparent 50%),                            
       47 +      radial-gradient(ellipse 60% 50% at 80% 60%, rgba(251, 14
          +6, 60, 0.05) 0%, transparent 50%),                            
       48 +      linear-gradient(180deg, #18181b 0%, #09090b 100%);      
       49 +    background-attachment: fixed;                             
       50 +  }                                                           
       51 +                                                              
       52 +  /* Simplified glass effects */                              
       53 +  .glass {                                                    
       54 +    @apply bg-dark-800/80 border border-dark-700/50;          
       55 +  }                                                           
       56 +                                                              
       57 +  .glass-light {                                              
       58 +    @apply bg-dark-800/40 border border-dark-700/40;          
       59 +  }                                                           
       60 +                                                              
       61 +  .glass-card {                                               
       62 +    @apply bg-dark-800 border border-dark-700/50;             
       63 +  }                                                           
       64 +                                                              
       65 +  .glass-card-hover {                                         
       66 +    @apply glass-card transition-all duration-200;            
       67 +  }                                                           
       68 +                                                              
       69 +  .glass-card-hover:hover {                                   
       70 +    @apply border-dark-600;                                   
       71 +  }                                                           
       72 +                                                              
       73 +  .glass-sidebar {                                            
       74 +    @apply bg-dark-850 border-r border-dark-700/50;           
       75 +  }                                                           
       76 +                                                              
       77 +  /* Glass with blur - only for modals and dropdowns */       
       78 +  .glass-modal {                                              
       79 +    @apply bg-dark-900/95 backdrop-blur-xl border border-dark-
          +700/50;                                                       
       80 +  }                                                           
       81 +                                                              
       82 +  .glass-dropdown {                                           
       83 +    @apply bg-dark-900/95 backdrop-blur-lg border border-dark-
          +700/50;                                                       
       84 +  }                                                           
       85 +                                                              
       86 +  .glass-input {                                              
       87 +    @apply bg-dark-800/60 border border-dark-700/50           
       88 +           focus:border-primary-500/50 focus:ring-1 focus:ring
          +-primary-500/20                                               
       89 +           transition-all duration-200;                       
       90 +  }                                                           
       91 +                                                              
       92 +  .glass-input:hover:not(:focus) {                            
       93 +    @apply border-dark-600;                                   
       94 +  }                                                           
       95 +                                                              
       96 +  .glass-button {                                             
       97 +    @apply bg-dark-700/50 border border-dark-700/50           
       98 +           hover:bg-dark-600/50 hover:border-dark-600         
       99 +           active:scale-[0.98] transition-all duration-200;   
      100 +  }                                                           
      101 +                                                              
      102 +  /* Fade in animation */                                     
      103 +  .fade-in {                                                  
      104 +    animation: fadeIn 0.3s ease-out;                          
      105 +  }                                                           
      106 +                                                              
      107 +  @keyframes fadeIn {                                         
      108 +    from { opacity: 0; transform: translateY(10px); }         
      109 +    to { opacity: 1; transform: translateY(0); }              
      110 +  }                                                           
      111 +                                                              
      112 +  /* Slide in animation */                                    
      113 +  .slide-in-left {                                            
      114 +    animation: slideInLeft 0.3s ease-out;                     
      115 +  }                                                           
      116 +                                                              
      117 +  @keyframes slideInLeft {                                    
      118 +    from { opacity: 0; transform: translateX(-20px); }        
      119 +    to { opacity: 1; transform: translateX(0); }              
      120 +  }                                                           
      121 +                                                              
      122 +  /* Scale in animation */                                    
      123 +  .scale-in {                                                 
      124 +    animation: scaleIn 0.2s ease-out;                         
      125 +  }                                                           
      126 +                                                              
      127 +  @keyframes scaleIn {                                        
      128 +    from { opacity: 0; transform: scale(0.95); }              
      129 +    to { opacity: 1; transform: scale(1); }                   
      130 +  }                                                           
      131 +}                                                             
      132 +                                                              
      133 +/* Markdown styles for dark theme */                          
      134 +.markdown-content {                                           
      135 +  @apply max-w-none text-sm leading-relaxed text-dark-200;    
      136 +}                                                             
      137 +                                                              
      138 +.markdown-content > *:first-child {                           
      139 +  margin-top: 0;                                              
      140 +}                                                             
      141 +                                                              
      142 +.markdown-content > *:last-child {                            
      143 +  margin-bottom: 0;                                           
      144 +}                                                             
      145 +                                                              
      146 +.markdown-content pre {                                       
      147 +  @apply rounded-xl p-4 overflow-x-auto my-4 bg-dark-900 borde
          +r border-dark-700/50;                                         
      148 +}                                                             
      149 +                                                              
      150 +.markdown-content code {                                      
      151 +  @apply bg-primary-500/10 text-primary-400 px-1.5 py-0.5 roun
          +ded-md text-[13px] font-mono;                                 
      152 +  border: 1px solid rgba(245, 158, 11, 0.15);                 
      153 +}                                                             
      154 +                                                              
      155 +.markdown-content pre code {                                  
      156 +  @apply bg-transparent text-dark-100 p-0 border-0;           
      157 +}                                                             
      158 +                                                              
      159 +.markdown-content h1 {                                        
      160 +  @apply text-xl font-bold mt-6 mb-4 text-dark-50 tracking-tig
          +ht;                                                           
      161 +}                                                             
      162 +                                                              
      163 +.markdown-content h2 {                                        
      164 +  @apply text-lg font-bold mt-5 mb-3 text-dark-50 tracking-tig
          +ht;                                                           
      165 +}                                                             
      166 +                                                              
      167 +.markdown-content h3 {                                        
      168 +  @apply text-base font-semibold mt-4 mb-2 text-dark-100;     
      169 +}                                                             
      170 +                                                              
      171 +.markdown-content p {                                         
      172 +  @apply my-3;                                                
      173 +}                                                             
      174 +                                                              
      175 +.markdown-content ul,                                         
      176 +.markdown-content ol {                                        
      177 +  @apply my-3 pl-5;                                           
      178 +}                                                             
      179 +                                                              
      180 +.markdown-content ul {                                        
      181 +  list-style-type: disc;                                      
      182 +}                                                             
      183 +                                                              
      184 +.markdown-content ol {                                        
      185 +  list-style-type: decimal;                                   
      186 +}                                                             
      187 +                                                              
      188 +.markdown-content li {                                        
      189 +  @apply my-1.5;                                              
      190 +}                                                             
      191 +                                                              
      192 +.markdown-content li::marker {                                
      193 +  @apply text-primary-400/60;                                 
      194 +}                                                             
      195 +                                                              
      196 +.markdown-content a {                                         
      197 +  @apply text-primary-400 hover:text-primary-300 underline dec
          +oration-primary-400/30                                        
      198 +         hover:decoration-primary-300/50 underline-offset-2 tr
          +ansition-colors;                                              
      199 +}                                                             
      200 +                                                              
      201 +.markdown-content blockquote {                                
      202 +  @apply border-l-2 border-primary-500/50 pl-4 my-4 text-dark-
          +300 italic bg-primary-500/5;                                  
      203 +  padding: 0.75rem 1rem 0.75rem 1rem;                         
      204 +  border-radius: 0 0.5rem 0.5rem 0;                           
      205 +}                                                             
      206 +                                                              
      207 +.markdown-content table {                                     
      208 +  @apply w-full my-4 border-collapse;                         
      209 +}                                                             
      210 +                                                              
      211 +.markdown-content th,                                         
      212 +.markdown-content td {                                        
      213 +  @apply border border-dark-700/50 px-3 py-2 text-sm;         
      214 +}                                                             
      215 +                                                              
      216 +.markdown-content th {                                        
      217 +  @apply bg-dark-800/50 font-semibold text-dark-100 text-left;
      218 +}                                                             
      219 +                                                              
      220 +.markdown-content tr:hover td {                               
      221 +  @apply bg-dark-800/20;                                      
      222 +}                                                             
      223 +                                                              
      224 +.markdown-content hr {                                        
      225 +  @apply my-6 border-dark-700/50;                             
      226 +}                                                             
      227 +                                                              
      228 +.markdown-content img {                                       
      229 +  @apply rounded-lg my-4 max-w-full;                          
      230 +}                                                             
      231 +                                                              
      232 +/* Custom range slider for dark theme */                      
      233 +input[type="range"] {                                         
      234 +  @apply w-full h-1.5 rounded-full appearance-none cursor-poin
          +ter bg-dark-700;                                              
      235 +}                                                             
      236 +                                                              
      237 +input[type="range"]::-webkit-slider-thumb {                   
      238 +  @apply appearance-none w-4 h-4 rounded-full cursor-pointer b
          +g-primary-500;                                                
      239 +  transition: transform 0.15s ease;                           
      240 +}                                                             
      241 +                                                              
      242 +input[type="range"]::-webkit-slider-thumb:hover {             
      243 +  transform: scale(1.1);                                      
      244 +}                                                             
      245 +                                                              
      246 +input[type="range"]::-moz-range-thumb {                       
      247 +  @apply w-4 h-4 rounded-full cursor-pointer border-0 bg-prima
          +ry-500;                                                       
      248 +}                                                             
      249 +                                                              
      250 +/* Checkbox styling */                                        
      251 +input[type="checkbox"] {                                      
      252 +  @apply w-4 h-4 rounded cursor-pointer appearance-none bg-dar
          +k-700 border border-dark-600;                                 
      253 +  transition: all 0.2s ease;                                  
      254 +}                                                             
      255 +                                                              
      256 +input[type="checkbox"]:hover {                                
      257 +  @apply border-primary-500/50;                               
      258 +}                                                             
      259 +                                                              
      260 +input[type="checkbox"]:checked {                              
      261 +  @apply bg-primary-500 border-primary-500;                   
      262 +  background-image: url("data:image/svg+xml,%3csvg viewBox='0 
          +0 16 16' fill='white' xmlns='http://www.w3.org/2000/svg'%3e%3c
          +path d='M12.207 4.793a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0l-2
          +-2a1 1 0 011.414-1.414L6.5 9.086l4.293-4.293a1 1 0 011.414 0z'
          +/%3e%3c/svg%3e");                                             
      263 +  background-size: 100% 100%;                                 
      264 +  background-position: center;                                
      265 +  background-repeat: no-repeat;                               
      266 +}                                                             
      267 +                                                              
      268 +input[type="checkbox"]:focus {                                
      269 +  @apply ring-1 ring-primary-500/30 outline-none;             
      270 +}                                                             
      271 +                                                              
      272 +/* Selection styling */                                       
      273 +::selection {                                                 
      274 +  @apply bg-primary-500/30 text-white;                        
      275 +}                                                             
      276 +                                                              
      277 +/* Focus visible styling */                                   
      278 +:focus-visible {                                              
      279 +  @apply outline-none ring-1 ring-primary-500/50 ring-offset-2
          + ring-offset-dark-900;                                        
      280 +}                                                             
      281 +                                                              
      282 +/* Button press effect */                                     
      283 +.btn-press {                                                  
      284 +  transition: transform 0.1s ease;                            
      285 +}                                                             
      286 +                                                              
      287 +.btn-press:active {                                           
      288 +  transform: scale(0.97);                                     
      289 +}                                                             
      290 +                                                              
      291 +/* Tooltip styling */                                         
      292 +.tooltip {                                                    
      293 +  @apply relative;                                            
      294 +}                                                             
      295 +                                                              
      296 +.tooltip::after {                                             
      297 +  @apply absolute bottom-full left-1/2 -translate-x-1/2 mb-2 p
          +x-2 py-1                                                      
      298 +         text-xs text-white rounded-md opacity-0 pointer-event
          +s-none                                                        
      299 +         transition-opacity duration-200 whitespace-nowrap bg-
          +dark-800 border border-dark-700;                              
      300 +  content: attr(data-tooltip);                                
      301 +}                                                             
      302 +                                                              
      303 +.tooltip:hover::after {                                       
      304 +  @apply opacity-100;                                         
      305 +}                                                             
      306 +                                                              
      307 +/* Loading shimmer */                                         
      308 +.shimmer {                                                    
      309 +  background: linear-gradient(                                
      310 +    90deg,                                                    
      311 +    rgba(255, 255, 255, 0) 0%,                                
      312 +    rgba(255, 255, 255, 0.03) 50%,                            
      313 +    rgba(255, 255, 255, 0) 100%                               
      314 +  );                                                          
      315 +  background-size: 200% 100%;                                 
      316 +  animation: shimmer 2s infinite;                             
      317 +}                                                             
      318 +                                                              
      319 +@keyframes shimmer {                                          
      320 +  0% { background-position: -200% 0; }                        
      321 +  100% { background-position: 200% 0; }                       
      322 +}                                                             
      323 +                                                              
      324 +/* Divider */                                                 
      325 +.divider-gradient {                                           
      326 +  @apply h-px bg-dark-700/50;                                 
      327 +}                                                             
      328 +                                                              
      329 +/* Badge */                                                   
      330 +.badge {                                                      
      331 +  @apply inline-flex items-center px-2 py-0.5 rounded-full tex
          +t-xs font-medium;                                             
      332 +}                                                             
      333 +                                                              
      334 +.badge-primary {                                              
      335 +  @apply bg-primary-500/10 text-primary-400 border border-prim
          +ary-500/20;                                                   
      336 +}                                                             
      337 +                                                              
      338 +.badge-accent {                                               
      339 +  @apply bg-accent-500/10 text-accent-400 border border-accent
          +-500/20;                                                      
      340 +}                                                             
✔ Task #3 updated: status → completed
✔ Task #4 updated: status → in progress

● Now let me update Chat.jsx with the new design system. This is a large file
  with many changes.

● Write(client\src\pages\Chat.jsx)
  ⎿  Added 1517 lines, removed 1520 lines
         1 -import React, { useState, useEffect, useContext, useRef, memo
           -, useCallback, useMemo } from 'react';                      
         2 -import { useNavigate } from 'react-router-dom';             
         3 -import {                                                    
         4 -  MessageSquare, Plus, Settings as SettingsIcon, LogOut, Brai
           -n,                                                          
         5 -  Send, Trash2, GitBranch, Bot, User as UserIcon,           
         6 -  Sparkles, Zap, Menu, X, ChevronDown, ChevronRight, Square,
         7 -  Check, Trash, Copy, Pencil, Info, DollarSign, Hash        
         8 -} from 'lucide-react';                                      
         9 -import { AuthContext } from '../contexts/AuthContext';      
        10 -import { marked } from 'marked';                            
        11 -import DOMPurify from 'dompurify';                          
        12 -import ModelSelector, { DEFAULT_MODEL, RECENT_MODELS_KEY, MOD
           -ELS_CACHE_KEY } from '../components/ModelSelector';         
        13 -                                                            
        14 -marked.setOptions({                                         
        15 -  breaks: true,                                             
        16 -  gfm: true                                                 
        17 -});                                                         
        18 -                                                            
        19 -const LAST_MODEL_KEY = 'budi_chat_last_model';              
        20 -                                                            
        21 -// Format time as seconds or minutes:seconds (integer display
           -)                                                           
        22 -const formatThinkingTime = (seconds) => {                   
        23 -  const s = Math.floor(seconds);                            
        24 -  if (s < 60) {                                             
        25 -    return `${s}s`;                                         
        26 -  }                                                         
        27 -  const mins = Math.floor(s / 60);                          
        28 -  const secs = s % 60;                                      
        29 -  return `${mins}m ${secs.toString().padStart(2, '0')}s`;   
        30 -};                                                          
        31 -                                                            
        32 -// Get model data from OpenRouter cache                     
        33 -const getModelFromCache = (modelId) => {                    
        34 -  try {                                                     
        35 -    const cached = localStorage.getItem(MODELS_CACHE_KEY);  
        36 -    if (cached) {                                           
        37 -      const { models } = JSON.parse(cached);                
        38 -      return models.find(m => m.id === modelId);            
        39 -    }                                                       
        40 -  } catch (e) {                                             
        41 -    console.error('Failed to get model from cache:', e);    
        42 -  }                                                         
        43 -  return null;                                              
        44 -};                                                          
        45 -                                                            
        46 -// Get context window size for a model (from cache or fallbac
           -k)                                                          
        47 -const getModelContext = (modelId) => {                      
        48 -  const model = getModelFromCache(modelId);                 
        49 -  return model?.contextLength || 128000; // fallback to 128k
        50 -};                                                          
        51 -                                                            
        52 -// Calculate cost using cached pricing data                 
        53 -const calculateCost = (promptTokens, completionTokens, modelI
           -d) => {                                                     
        54 -  const model = getModelFromCache(modelId);                 
        55 -  if (model?.pricing) {                                     
        56 -    const inputCost = promptTokens * parseFloat(model.pricing
           -.prompt);                                                   
        57 -    const outputCost = completionTokens * parseFloat(model.pr
           -icing.completion);                                          
        58 -    return inputCost + outputCost;                          
        59 -  }                                                         
        60 -  // Fallback: rough estimate                               
        61 -  return (promptTokens + completionTokens) * 0.000001;      
        62 -};                                                          
        63 -                                                            
        64 -// Memoized ThinkingSection component to prevent re-renders d
           -uring streaming                                             
        65 -const ThinkingSection = memo(({ reasoning, isExpanded, onTogg
           -le, isStreaming, elapsedTime, stats }) => {                 
        66 -  const contentRef = useRef(null);                          
        67 -  const shouldAutoScrollRef = useRef(true);                 
        68 -                                                            
        69 -  useEffect(() => {                                         
        70 -    if (isExpanded && isStreaming && shouldAutoScrollRef.curr
           -ent) {                                                      
        71 -      const scroll = () => {                                
        72 -        if (contentRef.current) {                           
        73 -          contentRef.current.scrollTop = contentRef.current.s
           -crollHeight;                                                
        74 -        }                                                   
        75 -      };                                                    
        76 -      requestAnimationFrame(scroll);                        
        77 -    }                                                       
        78 -  }, [reasoning, isExpanded, isStreaming]);                 
        79 -                                                            
        80 -  const handleScroll = (e) => {                             
        81 -    const { scrollTop, scrollHeight, clientHeight } = e.targe
           -t;                                                          
        82 -    // If user is within 50px of bottom, enable auto-scroll, 
           -otherwise disable                                           
        83 -    const isAtBottom = scrollHeight - scrollTop - clientHeigh
           -t < 50;                                                     
        84 -    shouldAutoScrollRef.current = isAtBottom;               
        85 -  };                                                        
        86 -                                                            
        87 -  if (!reasoning && !isStreaming) return null;              
        88 -                                                            
        89 -  const hasStats = stats && (stats.totalTokens > 0 || stats.d
           -uration > 0);                                               
        90 -  const cost = hasStats ? (stats.cost || (stats.promptTokens 
           -|| 0) > 0 ? calculateCost(stats.promptTokens || 0, stats.comp
           -letionTokens || 0, stats.model) : 0) : 0;                   
        91 -                                                            
        92 -  return (                                                  
        93 -    <div className="mb-4">                                  
        94 -      <div className="flex items-center justify-between">   
        95 -        <button                                             
        96 -          type="button"                                     
        97 -          onMouseDown={(e) => {                             
        98 -            e.preventDefault();                             
        99 -            onToggle();                                     
       100 -          }}                                                
       101 -          className="flex items-center gap-2 text-sm font-med
           -ium text-dark-400 hover:text-dark-300 transition-colors px-3 
           -py-1.5 rounded-lg hover:bg-white/[0.03] select-none"        
       102 -        >                                                   
       103 -          <Brain className="w-4 h-4 text-accent-400" />     
       104 -          <span>                                            
       105 -            {isStreaming ? (                                
       106 -              <>Thinking... <span className="text-accent-400 
           -font-mono text-xs ml-1">{formatThinkingTime(elapsedTime || 0)
           -}</span></>                                                 
       107 -            ) : (                                           
       108 -              'Thought Process'                             
       109 -            )}                                              
       110 -          </span>                                           
       111 -          <ChevronDown className={`w-4 h-4 transition-transfo
           -rm duration-200 ${isExpanded ? 'rotate-180' : ''}`} />      
       112 -        </button>                                           
       113 -                                                            
       114 -        {/* Details on hover - bottom right */}             
       115 -        {!isStreaming && hasStats && (                      
       116 -          <div className="group relative">                  
       117 -            <span className="text-[10px] text-dark-500 cursor
           --default">details</span>                                    
       118 -            <div className="absolute bottom-full right-0 mb-1
           - hidden group-hover:block z-10">                            
       119 -              <div className="bg-dark-800 border border-dark-
           -600 rounded-lg px-3 py-2 text-xs whitespace-nowrap shadow-xl"
           ->                                                           
       120 -                <div className="space-y-1">                 
       121 -                  {stats.duration > 0 && (                  
       122 -                    <div className="flex justify-between gap-
           -4">                                                         
       123 -                      <span className="text-dark-400">Time:</
           -span>                                                       
       124 -                      <span className="text-dark-200 font-mon
           -o">{formatThinkingTime(stats.duration)}</span>              
       125 -                    </div>                                  
       126 -                  )}                                        
       127 -                  {stats.totalTokens > 0 && (               
       128 -                    <div className="flex justify-between gap-
           -4">                                                         
       129 -                      <span className="text-dark-400">Tokens:
           -</span>                                                     
       130 -                      <span className="text-dark-200 font-mon
           -o">{stats.totalTokens.toLocaleString()} tks</span>          
       131 -                    </div>                                  
       132 -                  )}                                        
       133 -                  {cost > 0 && (                            
       134 -                    <div className="flex justify-between gap-
           -4">                                                         
       135 -                      <span className="text-dark-400">Cost:</
           -span>                                                       
       136 -                      <span className="text-accent-400 font-m
           -ono">${cost < 0.01 ? cost.toFixed(4) : cost.toFixed(3)}</span
           ->                                                           
       137 -                    </div>                                  
       138 -                  )}                                        
       139 -                </div>                                      
       140 -              </div>                                        
       141 -            </div>                                          
       142 -          </div>                                            
       143 -        )}                                                  
       144 -      </div>                                                
       145 -      {isExpanded && (                                      
       146 -        <div                                                
       147 -          ref={contentRef}                                  
       148 -          onScroll={handleScroll}                           
       149 -          className="mt-2 px-4 py-3 text-sm text-dark-300 rou
           -nded-xl border border-white/[0.06] italic bg-dark-900/40 text
           --left max-h-[300px] overflow-y-auto prose prose-invert prose-
           -sm max-w-none"                                              
       150 -          dangerouslySetInnerHTML={{                        
       151 -            __html: DOMPurify.sanitize(marked.parse(reasoning
           - || 'Thinking...'))                                         
       152 -          }}                                                
       153 -        />                                                  
       154 -      )}                                                    
       155 -    </div>                                                  
       156 -  );                                                        
       157 -});                                                         
       158 -                                                            
       159 -function Chat() {                                           
       160 -  const { user, logout } = useContext(AuthContext);         
       161 -  const navigate = useNavigate();                           
       162 -  const [chats, setChats] = useState([]);                   
       163 -  const [currentChat, setCurrentChat] = useState(() => ({   
       164 -    title: 'New Chat',                                      
       165 -    model: localStorage.getItem(LAST_MODEL_KEY) || DEFAULT_MO
           -DEL,                                                        
       166 -    temperature: 0.7,                                       
       167 -    system_prompt: '',                                      
       168 -    agent_mode: false                                       
       169 -  }));                                                      
       170 -  const [messages, setMessages] = useState([]);             
       171 -  const [inputMessage, setInputMessage] = useState('');     
       172 -  const [loading, setLoading] = useState(false);            
       173 -  const [streaming, setStreaming] = useState(false);        
       174 -  const [streamingMessage, setStreamingMessage] = useState(''
           -);                                                          
       175 -  const [streamingReasoning, setStreamingReasoning] = useStat
           -e('');                                                      
       176 -  const [showSettings, setShowSettings] = useState(false);  
       177 -  const [showSidebar, setShowSidebar] = useState(true);     
       178 -  const [showForkModal, setShowForkModal] = useState(false);
       179 -  const [deletingChatId, setDeletingChatId] = useState(null);
           -                                                             
       180 -  const [forkMessageId, setForkMessageId] = useState(null); 
       181 -  const [forkModel, setForkModel] = useState(DEFAULT_MODEL);
       182 -  const messagesEndRef = useRef(null);                      
       183 -  const messagesContainerRef = useRef(null);                
       184 -  const abortControllerRef = useRef(null);                  
       185 -  const isCreatingChatRef = useRef(false);                  
       186 -  const userHasScrolledUp = useRef(false);                  
       187 -  const statsPopupRef = useRef(null);                       
       188 -  const textareaRef = useRef(null);                         
       189 -  const [expandedThinkingSections, setExpandedThinkingSection
           -s] = useState(new Set());                                   
       190 -  const [copiedMessageId, setCopiedMessageId] = useState(null
           -);                                                          
       191 -  const [editingMessageId, setEditingMessageId] = useState(nu
           -ll);                                                        
       192 -  const [editContent, setEditContent] = useState('');       
       193 -  const [showInfoModal, setShowInfoModal] = useState(false);
       194 -  const [usageStats, setUsageStats] = useState(null);       
       195 -  const [thinkingStartTime, setThinkingStartTime] = useState(
           -null);                                                      
       196 -  const [thinkingElapsedTime, setThinkingElapsedTime] = useSt
           -ate(0);                                                     
       197 -  const [lastThinkingStats, setLastThinkingStats] = useState(
           -null);                                                      
       198 -                                                            
       199 -  const [chatSettings, setChatSettings] = useState(() => ({ 
       200 -    model: localStorage.getItem(LAST_MODEL_KEY) || DEFAULT_MO
           -DEL,                                                        
       201 -    temperature: 0.7,                                       
       202 -    system_prompt: '',                                      
       203 -    agent_mode: false                                       
       204 -  }));                                                      
       205 -                                                            
       206 -  // Calculate chat totals from persisted message data      
       207 -  const chatTotals = useMemo(() => {                        
       208 -    const assistantMsgs = messages.filter(m => m.role === 'as
           -sistant');                                                  
       209 -    return {                                                
       210 -      totalPromptTokens: assistantMsgs.reduce((sum, m) => sum
           - + (m.prompt_tokens || 0), 0),                              
       211 -      totalCompletionTokens: assistantMsgs.reduce((sum, m) =>
           - sum + (m.completion_tokens || 0), 0),                      
       212 -      totalTokens: assistantMsgs.reduce((sum, m) => sum + (m.
           -prompt_tokens || 0) + (m.completion_tokens || 0), 0),       
       213 -      totalTimeMs: assistantMsgs.reduce((sum, m) => sum + (m.
           -response_time_ms || 0), 0),                                 
       214 -      totalCost: assistantMsgs.reduce((sum, m) => sum + (m.co
           -st || 0), 0),                                               
       215 -    };                                                      
       216 -  }, [messages]);                                           
       217 -                                                            
       218 -  useEffect(() => {                                         
       219 -    loadChats();                                            
       220 -  }, []);                                                   
       221 -                                                            
       222 -  useEffect(() => {                                         
       223 -    // Skip clearing/aborting if we're in the middle of creat
           -ing a new chat                                              
       224 -    if (isCreatingChatRef.current) {                        
       225 -      return;                                               
       226 -    }                                                       
       227 -                                                            
       228 -    // Clear state immediately when switching chats or if no 
           -chat is selected                                            
       229 -    setStreamingMessage('');                                
       230 -    setStreamingReasoning('');                              
       231 -    setStreaming(false);                                    
       232 -    setUsageStats(null);                                    
       233 -                                                            
       234 -    if (abortControllerRef.current) {                       
       235 -      abortControllerRef.current.abort();                   
       236 -    }                                                       
       237 -                                                            
       238 -    if (currentChat?.id) {                                  
       239 -      loadMessages(currentChat.id);                         
       240 -    }                                                       
       241 -  }, [currentChat?.id]);                                    
       242 -                                                            
       243 -  useEffect(() => {                                         
       244 -    // Only auto-scroll if user hasn't manually scrolled up 
       245 -    if (!userHasScrolledUp.current) {                       
       246 -      scrollToBottom();                                     
       247 -    }                                                       
       248 -  }, [messages, streamingMessage]);                         
       249 -                                                            
       250 -  // Reset scroll flag when streaming ends                  
       251 -  useEffect(() => {                                         
       252 -    if (!streaming) {                                       
       253 -      userHasScrolledUp.current = false;                    
       254 -    }                                                       
       255 -  }, [streaming]);                                          
       256 -                                                            
       257 -  // Timer for thinking section                             
       258 -  useEffect(() => {                                         
       259 -    let interval;                                           
       260 -    if (streaming && thinkingStartTime) {                   
       261 -      interval = setInterval(() => {                        
       262 -        setThinkingElapsedTime((Date.now() - thinkingStartTim
           -e) / 1000);                                                 
       263 -      }, 100);                                              
       264 -    }                                                       
       265 -    return () => clearInterval(interval);                   
       266 -  }, [streaming, thinkingStartTime]);                       
       267 -                                                            
       268 -  // Reset thinking timer when streaming starts             
       269 -  useEffect(() => {                                         
       270 -    if (streaming) {                                        
       271 -      setThinkingStartTime(Date.now());                     
       272 -      setThinkingElapsedTime(0);                            
       273 -      setLastThinkingStats(null);                           
       274 -    }                                                       
       275 -  }, [streaming]);                                          
       276 -                                                            
       277 -  // Close stats popup when clicking outside                
       278 -  useEffect(() => {                                         
       279 -    const handleClickOutside = (event) => {                 
       280 -      if (statsPopupRef.current && !statsPopupRef.current.con
           -tains(event.target)) {                                      
       281 -        setShowInfoModal(false);                            
       282 -      }                                                     
       283 -    };                                                      
       284 -    if (showInfoModal) {                                    
       285 -      document.addEventListener('mousedown', handleClickOutsi
           -de);                                                        
       286 -      return () => document.removeEventListener('mousedown', 
           -handleClickOutside);                                        
       287 -    }                                                       
       288 -  }, [showInfoModal]);                                      
       289 -                                                            
       290 -  const scrollToBottom = () => {                            
       291 -    messagesEndRef.current?.scrollIntoView({ behavior: 'smoot
           -h' });                                                      
       292 -  };                                                        
       293 -                                                            
       294 -  const handleMessagesScroll = (e) => {                     
       295 -    const container = e.target;                             
       296 -    const threshold = 100; // pixels from bottom            
       297 -    const isNearBottom = container.scrollHeight - container.s
           -crollTop - container.clientHeight < threshold;              
       298 -    userHasScrolledUp.current = !isNearBottom;              
       299 -  };                                                        
       300 -                                                            
       301 -  const toggleThinkingSection = useCallback((messageId) => {
       302 -    setExpandedThinkingSections(prev => {                   
       303 -      const newSet = new Set(prev);                         
       304 -      if (newSet.has(messageId)) {                          
       305 -        newSet.delete(messageId);                           
       306 -      } else {                                              
       307 -        newSet.add(messageId);                              
       308 -      }                                                     
       309 -      return newSet;                                        
       310 -    });                                                     
       311 -  }, []);                                                   
       312 -                                                            
       313 -  const loadChats = async () => {                           
       314 -    try {                                                   
       315 -      const res = await fetch('/api/chats', {               
       316 -        headers: { 'Authorization': `Bearer ${localStorage.ge
           -tItem('token')}` }                                          
       317 -      });                                                   
       318 -      const data = await res.json();                        
       319 -      setChats(data);                                       
       320 -    } catch (error) {                                       
       321 -      console.error('Failed to load chats:', error);        
       322 -    }                                                       
       323 -  };                                                        
       324 -                                                            
       325 -  const loadMessages = async (chatId) => {                  
       326 -    try {                                                   
       327 -      const res = await fetch(`/api/chats/${chatId}`, {     
       328 -        headers: { 'Authorization': `Bearer ${localStorage.ge
           -tItem('token')}` }                                          
       329 -      });                                                   
       330 -      const data = await res.json();                        
       331 -      setMessages(data.messages || []);                     
       332 -      setChatSettings({                                     
       333 -        model: data.model,                                  
       334 -        temperature: data.temperature,                      
       335 -        system_prompt: data.system_prompt || '',            
       336 -        agent_mode: !!data.agent_mode                       
       337 -      });                                                   
       338 -      // Update currentChat with latest data (including updat
           -ed title)                                                   
       339 -      const { messages: _, ...chatData } = data;            
       340 -      setCurrentChat(prev => ({ ...prev, ...chatData }));   
       341 -    } catch (error) {                                       
       342 -      console.error('Failed to load messages:', error);     
       343 -    }                                                       
       344 -  };                                                        
       345 -                                                            
       346 -  const createNewChat = () => {                             
       347 -    const modelToUse = localStorage.getItem(LAST_MODEL_KEY) |
           -| DEFAULT_MODEL;                                            
       348 -    // Create a temporary chat object without an ID         
       349 -    // The actual chat will be created when the first message
           - is sent                                                    
       350 -    setCurrentChat({                                        
       351 -      title: 'New Chat',                                    
       352 -      model: modelToUse,                                    
       353 -      temperature: 0.7,                                     
       354 -      system_prompt: '',                                    
       355 -      agent_mode: false                                     
       356 -    });                                                     
       357 -    setChatSettings({                                       
       358 -      model: modelToUse,                                    
       359 -      temperature: 0.7,                                     
       360 -      system_prompt: '',                                    
       361 -      agent_mode: false                                     
       362 -    });                                                     
       363 -  };                                                        
       364 -                                                            
       365 -  const updateChatSettings = async () => {                  
       366 -    if (!currentChat) return;                               
       367 -                                                            
       368 -    // If it's a new chat without an ID, just update local st
           -ate                                                         
       369 -    if (!currentChat.id) {                                  
       370 -      setCurrentChat({ ...currentChat, ...chatSettings });  
       371 -      setShowSettings(false);                               
       372 -      return;                                               
       373 -    }                                                       
       374 -                                                            
       375 -    try {                                                   
       376 -      await fetch(`/api/chats/${currentChat.id}`, {         
       377 -        method: 'PUT',                                      
       378 -        headers: {                                          
       379 -          'Content-Type': 'application/json',               
       380 -          'Authorization': `Bearer ${localStorage.getItem('to
           -ken')}`                                                     
       381 -        },                                                  
       382 -        body: JSON.stringify(chatSettings)                  
       383 -      });                                                   
       384 -      setShowSettings(false);                               
       385 -    } catch (error) {                                       
       386 -      console.error('Failed to update chat:', error);       
       387 -    }                                                       
       388 -  };                                                        
       389 -                                                            
       390 -  const handleModelChange = async (modelId) => {            
       391 -    // Save as last used model                              
       392 -    localStorage.setItem(LAST_MODEL_KEY, modelId);          
       393 -                                                            
       394 -    setChatSettings(prev => ({ ...prev, model: modelId })); 
       395 -                                                            
       396 -    // If we have a current chat with an ID, update it immedi
           -ately                                                       
       397 -    if (currentChat && currentChat.id) {                    
       398 -      try {                                                 
       399 -        await fetch(`/api/chats/${currentChat.id}`, {       
       400 -          method: 'PUT',                                    
       401 -          headers: {                                        
       402 -            'Content-Type': 'application/json',             
       403 -            'Authorization': `Bearer ${localStorage.getItem('
           -token')}`                                                   
       404 -          },                                                
       405 -          body: JSON.stringify({ ...chatSettings, model: mode
           -lId })                                                      
       406 -        });                                                 
       407 -      } catch (error) {                                     
       408 -        console.error('Failed to update chat model:', error);
           -                                                             
       409 -      }                                                     
       410 -    } else if (currentChat && !currentChat.id) {            
       411 -      // If it's a new chat without an ID, just update local 
           -state                                                       
       412 -      setCurrentChat({ ...currentChat, model: modelId });   
       413 -    }                                                       
       414 -  };                                                        
       415 -                                                            
       416 -  const deleteChat = async (chatId) => {                    
       417 -    try {                                                   
       418 -      await fetch(`/api/chats/${chatId}`, {                 
       419 -        method: 'DELETE',                                   
       420 -        headers: { 'Authorization': `Bearer ${localStorage.ge
           -tItem('token')}` }                                          
       421 -      });                                                   
       422 -      setChats(chats.filter(c => c.id !== chatId));         
       423 -      if (currentChat?.id === chatId) {                     
       424 -        // Automatically open a new chat instead of leaving b
           -lank                                                        
       425 -        setMessages([]);                                    
       426 -        createNewChat();                                    
       427 -      }                                                     
       428 -      setDeletingChatId(null);                              
       429 -    } catch (error) {                                       
       430 -      console.error('Failed to delete chat:', error);       
       431 -    }                                                       
       432 -  };                                                        
       433 -                                                            
       434 -  const openForkModal = (messageId) => {                    
       435 -    setForkMessageId(messageId);                            
       436 -    setForkModel(chatSettings.model);                       
       437 -    setShowForkModal(true);                                 
       438 -  };                                                        
       439 -                                                            
       440 -  const forkChat = async () => {                            
       441 -    if (!currentChat || !forkMessageId) return;             
       442 -                                                            
       443 -    try {                                                   
       444 -      const res = await fetch(`/api/chats/${currentChat.id}/f
           -ork`, {                                                     
       445 -        method: 'POST',                                     
       446 -        headers: {                                          
       447 -          'Content-Type': 'application/json',               
       448 -          'Authorization': `Bearer ${localStorage.getItem('to
           -ken')}`                                                     
       449 -        },                                                  
       450 -        body: JSON.stringify({                              
       451 -          message_id: forkMessageId,                        
       452 -          model: forkModel                                  
       453 -        })                                                  
       454 -      });                                                   
       455 -      const data = await res.json();                        
       456 -      setChats([data, ...chats]);                           
       457 -      setCurrentChat(data);                                 
       458 -      setShowForkModal(false);                              
       459 -      setForkMessageId(null);                               
       460 -                                                            
       461 -      // Save the fork model as last used                   
       462 -      localStorage.setItem(LAST_MODEL_KEY, forkModel);      
       463 -    } catch (error) {                                       
       464 -      console.error('Failed to fork chat:', error);         
       465 -    }                                                       
       466 -  };                                                        
       467 -                                                            
       468 -  const stopGeneration = () => {                            
       469 -    if (abortControllerRef.current) {                       
       470 -      abortControllerRef.current.abort();                   
       471 -      setStreaming(false);                                  
       472 -    }                                                       
       473 -  };                                                        
       474 -                                                            
       475 -  const sendMessage = async (e) => {                        
       476 -    e.preventDefault();                                     
       477 -    if (!inputMessage.trim() || !currentChat || streaming) re
           -turn;                                                       
       478 -                                                            
       479 -    const userMessage = inputMessage.trim();                
       480 -    setInputMessage('');                                    
       481 -    // Reset textarea height                                
       482 -    if (textareaRef.current) {                              
       483 -      textareaRef.current.style.height = '52px';            
       484 -    }                                                       
       485 -    setStreaming(true);                                     
       486 -    setStreamingMessage('');                                
       487 -    setStreamingReasoning('');                              
       488 -                                                            
       489 -    abortControllerRef.current = new AbortController();     
       490 -                                                            
       491 -    // Add user message to UI immediately                   
       492 -    const tempUserMessage = {                               
       493 -      id: Date.now(),                                       
       494 -      role: 'user',                                         
       495 -      content: userMessage,                                 
       496 -      created_at: new Date().toISOString()                  
       497 -    };                                                      
       498 -    setMessages(prev => [...prev, tempUserMessage]);        
       499 -                                                            
       500 -    try {                                                   
       501 -      // If this is a new chat without an ID, create it first
           -                                                             
       502 -      let chatId = currentChat.id;                          
       503 -      if (!chatId) {                                        
       504 -        isCreatingChatRef.current = true;                   
       505 -        const createRes = await fetch('/api/chats', {       
       506 -          method: 'POST',                                   
       507 -          headers: {                                        
       508 -            'Content-Type': 'application/json',             
       509 -            'Authorization': `Bearer ${localStorage.getItem('
           -token')}`                                                   
       510 -          },                                                
       511 -          body: JSON.stringify({                            
       512 -            title: 'New Chat',                              
       513 -            model: chatSettings.model,                      
       514 -            temperature: chatSettings.temperature,          
       515 -            system_prompt: chatSettings.system_prompt,      
       516 -            agent_mode: chatSettings.agent_mode             
       517 -          })                                                
       518 -        });                                                 
       519 -        const newChat = await createRes.json();             
       520 -        chatId = newChat.id;                                
       521 -        setCurrentChat(newChat);                            
       522 -        setChats(prev => [newChat, ...prev]);               
       523 -      }                                                     
       524 -                                                            
       525 -      const res = await fetch(`/api/messages/${chatId}`, {  
       526 -        method: 'POST',                                     
       527 -        headers: {                                          
       528 -          'Content-Type': 'application/json',               
       529 -          'Authorization': `Bearer ${localStorage.getItem('to
           -ken')}`                                                     
       530 -        },                                                  
       531 -        body: JSON.stringify({ content: userMessage }),     
       532 -        signal: abortControllerRef.current.signal           
       533 -      });                                                   
       534 -                                                            
       535 -      if (!res.ok) {                                        
       536 -        const errorData = await res.json();                 
       537 -        throw new Error(errorData.error || 'Failed to send me
           -ssage');                                                    
       538 -      }                                                     
       539 -                                                            
       540 -      const reader = res.body.getReader();                  
       541 -      const decoder = new TextDecoder();                    
       542 -      let buffer = '';                                      
       543 -                                                            
       544 -      while (true) {                                        
       545 -        const { done, value } = await reader.read();        
       546 -        if (done) break;                                    
       547 -                                                            
       548 -        buffer += decoder.decode(value, { stream: true });  
       549 -        const lines = buffer.split('\n');                   
       550 -        buffer = lines.pop();                               
       551 -                                                            
       552 -        for (const line of lines) {                         
       553 -          if (line.startsWith('data: ')) {                  
       554 -            try {                                           
       555 -              const data = JSON.parse(line.slice(6));       
       556 -                                                            
       557 -              if (data.type === 'reasoning') {              
       558 -                setStreamingReasoning(prev => prev + data.con
           -tent);                                                      
       559 -              } else if (data.type === 'content') {         
       560 -                setStreamingMessage(prev => prev + data.conte
           -nt);                                                        
       561 -              } else if (data.type === 'done') {            
       562 -                // Calculate thinking duration              
       563 -                const thinkingDuration = thinkingStartTime ? 
           -(Date.now() - thinkingStartTime) / 1000 : 0;                
       564 -                                                            
       565 -                // Capture usage data if provided           
       566 -                if (data.usage) {                           
       567 -                  const stats = {                           
       568 -                    promptTokens: data.usage.prompt_tokens ||
           - 0,                                                         
       569 -                    completionTokens: data.usage.completion_t
           -okens || 0,                                                 
       570 -                    totalTokens: data.usage.total_tokens || 0
           -,                                                           
       571 -                    model: data.model,                      
       572 -                    duration: thinkingDuration,             
       573 -                    cost: data.cost || 0                    
       574 -                  };                                        
       575 -                  setLastThinkingStats(stats);              
       576 -                  setUsageStats(prev => ({                  
       577 -                    ...prev,                                
       578 -                    lastMessage: stats,                     
       579 -                    totalPromptTokens: (prev?.totalPromptToke
           -ns || 0) + (data.usage.prompt_tokens || 0),                 
       580 -                    totalCompletionTokens: (prev?.totalComple
           -tionTokens || 0) + (data.usage.completion_tokens || 0),     
       581 -                    totalTokens: (prev?.totalTokens || 0) + (
           -data.usage.total_tokens || 0),                              
       582 -                    messageCount: (prev?.messageCount || 0) +
           - 1                                                          
       583 -                  }));                                      
       584 -                } else {                                    
       585 -                  // No usage data, but we still have duratio
           -n                                                           
       586 -                  setLastThinkingStats({ duration: thinkingDu
           -ration, totalTokens: 0 });                                  
       587 -                }                                           
       588 -                // Don't clear streaming states immediately -
           - let loadMessages handle it                                 
       589 -                // This prevents the thinking section from di
           -sappearing before the message is added                      
       590 -                loadMessages(chatId);                       
       591 -                loadChats();                                
       592 -                // Clear streaming states after a short delay
           - to ensure smooth transition                                
       593 -                setTimeout(() => {                          
       594 -                  setStreamingMessage('');                  
       595 -                  setStreamingReasoning('');                
       596 -                }, 100);                                    
       597 -              } else if (data.type === 'error') {           
       598 -                alert('Error: ' + data.error);              
       599 -              }                                             
       600 -            } catch (e) {                                   
       601 -              console.error('Failed to parse SSE data:', e);
       602 -            }                                               
       603 -          }                                                 
       604 -        }                                                   
       605 -      }                                                     
       606 -    } catch (error) {                                       
       607 -      if (error.name === 'AbortError') {                    
       608 -        console.log('Generation aborted');                  
       609 -      } else {                                              
       610 -        console.error('Failed to send message:', error);    
       611 -        alert(error.message || 'Failed to send message. Pleas
           -e check your API key configuration.');                      
       612 -      }                                                     
       613 -    } finally {                                             
       614 -      setStreaming(false);                                  
       615 -      abortControllerRef.current = null;                    
       616 -      isCreatingChatRef.current = false;                    
       617 -    }                                                       
       618 -  };                                                        
       619 -                                                            
       620 -  const renderMessage = (content) => {                      
       621 -    const html = DOMPurify.sanitize(marked(content || '')); 
       622 -    return <div className="markdown-content" dangerouslySetIn
           -nerHTML={{ __html: html }} />;                              
       623 -  };                                                        
       624 -                                                            
       625 -  const stripMarkdown = (text) => {                         
       626 -    if (!text) return '';                                   
       627 -    return text                                             
       628 -      .replace(/#{1,6}\s?/g, '')           // headers       
       629 -      .replace(/\*\*(.+?)\*\*/g, '$1')     // bold          
       630 -      .replace(/\*(.+?)\*/g, '$1')         // italic        
       631 -      .replace(/__(.+?)__/g, '$1')         // bold alt      
       632 -      .replace(/_(.+?)_/g, '$1')           // italic alt    
       633 -      .replace(/`{3}[\s\S]*?`{3}/g, '')    // code blocks   
       634 -      .replace(/`(.+?)`/g, '$1')           // inline code   
       635 -      .replace(/\[(.+?)\]\(.+?\)/g, '$1')  // links         
       636 -      .replace(/!\[.*?\]\(.+?\)/g, '')     // images        
       637 -      .replace(/^\s*[-*+]\s/gm, '')        // unordered lists
           -                                                             
       638 -      .replace(/^\s*\d+\.\s/gm, '')        // ordered lists 
       639 -      .replace(/>\s?/g, '')                // blockquotes   
       640 -      .replace(/---/g, '')                 // horizontal rule
           -s                                                           
       641 -      .trim();                                              
       642 -  };                                                        
       643 -                                                            
       644 -  const handleCopy = async (messageId, content, type) => {  
       645 -    const textToCopy = type === 'raw' ? stripMarkdown(content
           -) : content;                                                
       646 -    await navigator.clipboard.writeText(textToCopy);        
       647 -    setCopiedMessageId(`${messageId}-${type}`);             
       648 -    setTimeout(() => setCopiedMessageId(null), 2000);       
       649 -  };                                                        
       650 -                                                            
       651 -  const handleEditStart = (message) => {                    
       652 -    setEditingMessageId(message.id);                        
       653 -    setEditContent(message.content);                        
       654 -  };                                                        
       655 -                                                            
       656 -  const handleEditCancel = () => {                          
       657 -    setEditingMessageId(null);                              
       658 -    setEditContent('');                                     
       659 -  };                                                        
       660 -                                                            
       661 -  const handleEditSave = async (messageId) => {             
       662 -    if (!editContent.trim() || !currentChat) return;        
       663 -                                                            
       664 -    try {                                                   
       665 -      // 1. Delete branch from this message onward          
       666 -      const res = await fetch(`/api/messages/${messageId}/bra
           -nch`, {                                                     
       667 -        method: 'DELETE',                                   
       668 -        headers: {                                          
       669 -          'Authorization': `Bearer ${localStorage.getItem('to
           -ken')}`                                                     
       670 -        }                                                   
       671 -      });                                                   
       672 -                                                            
       673 -      if (!res.ok) throw new Error('Failed to delete message 
           -branch');                                                   
       674 -                                                            
       675 -      // 2. Trigger new message with edited content         
       676 -      // We manually call sendMessage implementation        
       677 -      const userMessage = editContent.trim();               
       678 -      setEditingMessageId(null);                            
       679 -      setEditContent('');                                   
       680 -      setStreaming(true);                                   
       681 -      setStreamingMessage('');                              
       682 -      setStreamingReasoning('');                            
       683 -      abortControllerRef.current = new AbortController();   
       684 -                                                            
       685 -      // Update UI: load messages again to show the deletion
       686 -      await loadMessages(currentChat.id);                   
       687 -                                                            
       688 -      // Add temporary user message to UI for responsiveness
       689 -      const tempUserMessage = {                             
       690 -        id: Date.now(),                                     
       691 -        role: 'user',                                       
       692 -        content: userMessage,                               
       693 -        created_at: new Date().toISOString()                
       694 -      };                                                    
       695 -      setMessages(prev => [...prev, tempUserMessage]);      
       696 -                                                            
       697 -      // Trigger the API call to start regeneration         
       698 -      const sendRes = await fetch(`/api/messages/${currentCha
           -t.id}`, {                                                   
       699 -        method: 'POST',                                     
       700 -        headers: {                                          
       701 -          'Content-Type': 'application/json',               
       702 -          'Authorization': `Bearer ${localStorage.getItem('to
           -ken')}`                                                     
       703 -        },                                                  
       704 -        body: JSON.stringify({ content: userMessage }),     
       705 -        signal: abortControllerRef.current.signal           
       706 -      });                                                   
       707 -                                                            
       708 -      if (!sendRes.ok) {                                    
       709 -        const errorData = await sendRes.json();             
       710 -        throw new Error(errorData.error || 'Failed to send me
           -ssage');                                                    
       711 -      }                                                     
       712 -                                                            
       713 -      const reader = sendRes.body.getReader();              
       714 -      const decoder = new TextDecoder();                    
       715 -      let buffer = '';                                      
       716 -                                                            
       717 -      while (true) {                                        
       718 -        const { done, value } = await reader.read();        
       719 -        if (done) break;                                    
       720 -                                                            
       721 -        buffer += decoder.decode(value, { stream: true });  
       722 -        const lines = buffer.split('\n');                   
       723 -        buffer = lines.pop();                               
       724 -                                                            
       725 -        for (const line of lines) {                         
       726 -          if (line.startsWith('data: ')) {                  
       727 -            try {                                           
       728 -              const data = JSON.parse(line.slice(6));       
       729 -              if (data.type === 'reasoning') {              
       730 -                setStreamingReasoning(prev => prev + data.con
           -tent);                                                      
       731 -              } else if (data.type === 'content') {         
       732 -                setStreamingMessage(prev => prev + data.conte
           -nt);                                                        
       733 -              } else if (data.type === 'done') {            
       734 -                // Calculate thinking duration              
       735 -                const thinkingDuration = thinkingStartTime ? 
           -(Date.now() - thinkingStartTime) / 1000 : 0;                
       736 -                                                            
       737 -                if (data.usage) {                           
       738 -                  const stats = {                           
       739 -                    promptTokens: data.usage.prompt_tokens ||
           - 0,                                                         
       740 -                    completionTokens: data.usage.completion_t
           -okens || 0,                                                 
       741 -                    totalTokens: data.usage.total_tokens || 0
           -,                                                           
       742 -                    model: data.model,                      
       743 -                    duration: thinkingDuration,             
       744 -                    cost: data.cost || 0                    
       745 -                  };                                        
       746 -                  setLastThinkingStats(stats);              
       747 -                  setUsageStats(prev => ({                  
       748 -                    ...prev,                                
       749 -                    lastMessage: stats,                     
       750 -                    totalPromptTokens: (prev?.totalPromptToke
           -ns || 0) + (data.usage.prompt_tokens || 0),                 
       751 -                    totalCompletionTokens: (prev?.totalComple
           -tionTokens || 0) + (data.usage.completion_tokens || 0),     
       752 -                    totalTokens: (prev?.totalTokens || 0) + (
           -data.usage.total_tokens || 0),                              
       753 -                    messageCount: (prev?.messageCount || 0) +
           - 1                                                          
       754 -                  }));                                      
       755 -                } else {                                    
       756 -                  setLastThinkingStats({ duration: thinkingDu
           -ration, totalTokens: 0 });                                  
       757 -                }                                           
       758 -                loadMessages(currentChat.id);               
       759 -                loadChats();                                
       760 -                setTimeout(() => {                          
       761 -                  setStreamingMessage('');                  
       762 -                  setStreamingReasoning('');                
       763 -                }, 100);                                    
       764 -              } else if (data.type === 'error') {           
       765 -                alert('Error: ' + data.error);              
       766 -              }                                             
       767 -            } catch (e) {                                   
       768 -              console.error('Failed to parse SSE data:', e);
       769 -            }                                               
       770 -          }                                                 
       771 -        }                                                   
       772 -      }                                                     
       773 -    } catch (error) {                                       
       774 -      if (error.name === 'AbortError') {                    
       775 -        console.log('Generation aborted');                  
       776 -      } else {                                              
       777 -        console.error('Failed to edit message:', error);    
       778 -        alert('Failed to edit message: ' + error.message);  
       779 -      }                                                     
       780 -      setStreaming(false);                                  
       781 -    }                                                       
       782 -  };                                                        
       783 -                                                            
       784 -  return (                                                  
       785 -    <div className="flex h-screen bg-dark-950 bg-mesh">     
       786 -      {/* Sidebar */}                                       
       787 -      <div className={`${showSidebar ? 'w-80' : 'w-16'} trans
           -ition-all duration-300 ease-out glass-sidebar flex flex-col o
           -verflow-hidden`}>                                           
       788 -        <div className={`${showSidebar ? 'p-5' : 'p-2'} borde
           -r-b border-white/[0.06]`}>                                  
       789 -          <div className={`flex items-center ${showSidebar ? 
           -'justify-between mb-5' : 'justify-center mb-2'}`}>          
       790 -            {showSidebar ? (                                
       791 -              <>                                            
       792 -                <div className="flex items-center gap-3">   
       793 -                  <div className="relative">                
       794 -                    <div className="w-11 h-11 rounded-2xl gra
           -dient-primary flex items-center justify-center shadow-lg glow
           -">                                                          
       795 -                      <MessageSquare className="w-5 h-5 text-
           -white" />                                                   
       796 -                    </div>                                  
       797 -                    <div className="absolute -bottom-0.5 -rig
           -ht-0.5 w-3 h-3 bg-green-500 rounded-full border-2 border-dark
           --900"></div>                                                
       798 -                  </div>                                    
       799 -                  <div>                                     
       800 -                    <h1 className="font-bold text-lg gradient
           --text tracking-tight">Budi Chat</h1>                        
       801 -                    <p className="text-xs text-dark-400 font-
           -medium">{user?.name}</p>                                    
       802 -                  </div>                                    
       803 -                </div>                                      
       804 -                <button                                     
       805 -                  onClick={() => setShowSidebar(false)}     
       806 -                  className="p-2 hover:bg-white/[0.05] rounde
           -d-xl transition-all duration-200"                           
       807 -                  title="Collapse sidebar"                  
       808 -                >                                           
       809 -                  <ChevronRight className="w-5 h-5 text-dark-
           -400" />                                                     
       810 -                </button>                                   
       811 -              </>                                           
       812 -            ) : (                                           
       813 -              <button                                       
       814 -                onClick={() => setShowSidebar(true)}        
       815 -                className="p-2 hover:bg-white/[0.05] rounded-
           -xl transition-all duration-200"                             
       816 -                title="Expand sidebar"                      
       817 -              >                                             
       818 -                <Menu className="w-5 h-5 text-dark-400" />  
       819 -              </button>                                     
       820 -            )}                                              
       821 -          </div>                                            
       822 -                                                            
       823 -          <button                                           
       824 -            onClick={createNewChat}                         
       825 -            className={`${showSidebar ? 'w-full py-3 gap-2' :
           - 'w-10 h-10 mx-auto'} gradient-primary text-white rounded-xl 
           -font-semibold hover:shadow-glow transition-all duration-200 f
           -lex items-center justify-center shine active:scale-[0.98]`} 
       826 -            title={showSidebar ? undefined : "New Chat"}    
       827 -          >                                                 
       828 -            <Plus className="w-4 h-4" />                    
       829 -            {showSidebar && "New Chat"}                     
       830 -          </button>                                         
       831 -        </div>                                              
       832 -                                                            
       833 -        <div className={`flex-1 overflow-y-auto ${showSidebar
           - ? 'p-3 space-y-1.5' : 'p-2 space-y-1'}`}>                  
       834 -          {chats.length === 0 && showSidebar && (           
       835 -            <div className="text-center py-8 px-4">         
       836 -              <div className="w-12 h-12 rounded-xl bg-dark-80
           -0/50 flex items-center justify-center mx-auto mb-3">        
       837 -                <MessageSquare className="w-6 h-6 text-dark-5
           -00" />                                                      
       838 -              </div>                                        
       839 -              <p className="text-sm text-dark-400">No chats y
           -et</p>                                                      
       840 -              <p className="text-xs text-dark-500 mt-1">Creat
           -e a new chat to get started</p>                             
       841 -            </div>                                          
       842 -          )}                                                
       843 -          {chats.map(chat => (                              
       844 -            <div                                            
       845 -              key={chat.id}                                 
       846 -              className={`group ${showSidebar ? 'p-3' : 'p-2'
           -} rounded-xl cursor-pointer transition-all duration-200 ${cur
           -rentChat?.id === chat.id                                    
       847 -                ? 'glass-card border-primary-500/20 shadow-lg
           -'                                                           
       848 -                : 'hover:bg-white/[0.03] border border-transp
           -arent hover:border-white/[0.06]'                            
       849 -                }`}                                         
       850 -              onClick={() => setCurrentChat(chat)}          
       851 -              title={showSidebar ? undefined : chat.title}  
       852 -            >                                               
       853 -              {showSidebar ? (                              
       854 -                <div className="flex items-start justify-betw
           -een gap-2">                                                 
       855 -                  <div className="flex-1 min-w-0">          
       856 -                    <p className={`font-medium text-sm trunca
           -te ${currentChat?.id === chat.id ? 'text-dark-50' : 'text-dar
           -k-200'}`}>{chat.title}</p>                                  
       857 -                    <div className="flex items-center gap-2 m
           -t-1.5">                                                     
       858 -                      <span className="text-xs text-dark-500"
           ->{chat.message_count} messages</span>                       
       859 -                      {chat.agent_mode === 1 && (           
       860 -                        <span className="inline-flex items-ce
           -nter gap-1 px-1.5 py-0.5 rounded-md bg-accent-500/10 text-acc
           -ent-400 text-[10px] font-medium">                           
       861 -                          <Zap className="w-2.5 h-2.5" />   
       862 -                          Agent                             
       863 -                        </span>                             
       864 -                      )}                                    
       865 -                    </div>                                  
       866 -                  </div>                                    
       867 -                                                            
       868 -                  <div className="flex items-center gap-1"> 
       869 -                    {deletingChatId === chat.id ? (         
       870 -                      <>                                    
       871 -                        <button                             
       872 -                          onClick={(e) => {                 
       873 -                            e.stopPropagation();            
       874 -                            deleteChat(chat.id);            
       875 -                          }}                                
       876 -                          className="p-1.5 bg-green-500/10 ho
           -ver:bg-green-500/20 rounded-lg transition-all"              
       877 -                          title="Confirm Delete"            
       878 -                        >                                   
       879 -                          <Check className="w-3.5 h-3.5 text-
           -green-400" />                                               
       880 -                        </button>                           
       881 -                        <button                             
       882 -                          onClick={(e) => {                 
       883 -                            e.stopPropagation();            
       884 -                            setDeletingChatId(null);        
       885 -                          }}                                
       886 -                          className="p-1.5 bg-red-500/10 hove
           -r:bg-red-500/20 rounded-lg transition-all"                  
       887 -                          title="Cancel"                    
       888 -                        >                                   
       889 -                          <X className="w-3.5 h-3.5 text-red-
           -400" />                                                     
       890 -                        </button>                           
       891 -                      </>                                   
       892 -                    ) : (                                   
       893 -                      <button                               
       894 -                        onClick={(e) => {                   
       895 -                          e.stopPropagation();              
       896 -                          setDeletingChatId(chat.id);       
       897 -                        }}                                  
       898 -                        className="opacity-0 group-hover:opac
           -ity-100 p-1.5 hover:bg-red-500/10 rounded-lg transition-all"
       899 -                        title="Delete Chat"                 
       900 -                      >                                     
       901 -                        <Trash2 className="w-3.5 h-3.5 text-d
           -ark-400 hover:text-red-400" />                              
       902 -                      </button>                             
       903 -                    )}                                      
       904 -                  </div>                                    
       905 -                </div>                                      
       906 -              ) : (                                         
       907 -                <div className="flex justify-center">       
       908 -                  <MessageSquare className={`w-5 h-5 ${curren
           -tChat?.id === chat.id ? 'text-primary-400' : 'text-dark-400'}
           -`} />                                                       
       909 -                </div>                                      
       910 -              )}                                            
       911 -            </div>                                          
       912 -          ))}                                               
       913 -        </div>                                              
       914 -                                                            
       915 -        <div className={`${showSidebar ? 'p-3' : 'p-2'} borde
           -r-t border-white/[0.06] space-y-1`}>                        
       916 -          <button                                           
       917 -            onClick={() => navigate('/memories')}           
       918 -            className={`${showSidebar ? 'w-full px-4 gap-3' :
           - 'w-10 h-10 mx-auto'} flex items-center justify-center py-2.5
           - rounded-xl glass-button transition-all text-sm font-medium t
           -ext-dark-300 hover:text-dark-100`}                          
       919 -            title={showSidebar ? undefined : "Memories"}    
       920 -          >                                                 
       921 -            <Brain className="w-4 h-4 text-accent-400" />   
       922 -            {showSidebar && "Memories"}                     
       923 -          </button>                                         
       924 -          <button                                           
       925 -            onClick={() => navigate('/settings')}           
       926 -            className={`${showSidebar ? 'w-full px-4 gap-3' :
           - 'w-10 h-10 mx-auto'} flex items-center justify-center py-2.5
           - rounded-xl glass-button transition-all text-sm font-medium t
           -ext-dark-300 hover:text-dark-100`}                          
       927 -            title={showSidebar ? undefined : "Settings"}    
       928 -          >                                                 
       929 -            <SettingsIcon className="w-4 h-4 text-dark-400" /
           ->                                                           
       930 -            {showSidebar && "Settings"}                     
       931 -          </button>                                         
       932 -          {user?.is_admin && (                              
       933 -            <button                                         
       934 -              onClick={() => navigate('/admin')}            
       935 -              className={`${showSidebar ? 'w-full px-4 gap-3'
           - : 'w-10 h-10 mx-auto'} flex items-center justify-center py-2
           -.5 rounded-xl glass-button transition-all text-sm font-medium
           - text-accent-400 hover:text-accent-300`}                    
       936 -              title={showSidebar ? undefined : "Admin Panel"}
           -                                                             
       937 -            >                                               
       938 -              <Sparkles className="w-4 h-4" />              
       939 -              {showSidebar && "Admin Panel"}                
       940 -            </button>                                       
       941 -          )}                                                
       942 -          {showSidebar && <div className="divider-gradient my
           --2"></div>}                                                 
       943 -          <button                                           
       944 -            onClick={logout}                                
       945 -            className={`${showSidebar ? 'w-full px-4 gap-3' :
           - 'w-10 h-10 mx-auto'} flex items-center justify-center py-2.5
           - rounded-xl hover:bg-red-500/10 transition-all text-sm font-m
           -edium text-dark-400 hover:text-red-400`}                    
       946 -            title={showSidebar ? undefined : "Logout"}      
       947 -          >                                                 
       948 -            <LogOut className="w-4 h-4" />                  
       949 -            {showSidebar && "Logout"}                       
       950 -          </button>                                         
       951 -        </div>                                              
       952 -      </div>                                                
       953 -                                                            
       954 -      {/* Main Chat Area */}                                
       955 -      <div className="flex-1 flex flex-col min-w-0">        
       956 -        {/* Header */}                                      
       957 -        <div className="glass border-b border-white/[0.06] px
           --4 py-3 flex items-center justify-between relative z-50 overf
           -low-visible">                                               
       958 -          <div className="flex items-center gap-3">         
       959 -            {/* Chat Title and Model Selector */}           
       960 -            {currentChat ? (                                
       961 -              <>                                            
       962 -                <h2 className="text-base font-semibold text-d
           -ark-100">{currentChat.title}</h2>                           
       963 -                <div className="h-4 w-px bg-white/[0.06]"></d
           -iv>                                                         
       964 -                <ModelSelector                              
       965 -                  selectedModel={chatSettings.model}        
       966 -                  onModelChange={handleModelChange}         
       967 -                  isDropdown={true}                         
       968 -                />                                          
       969 -                {chatSettings.agent_mode && (               
       970 -                  <span className="flex items-center gap-1.5 
           -px-3 py-1.5 bg-accent-500/10 text-accent-400 rounded-lg text-
           -xs font-semibold border border-accent-500/20">              
       971 -                    <Zap className="w-3 h-3" />             
       972 -                    Agent Mode                              
       973 -                  </span>                                   
       974 -                )}                                          
       975 -              </>                                           
       976 -            ) : (                                           
       977 -              <p className="text-dark-500 text-sm">Select a c
           -hat or create a new one</p>                                 
       978 -            )}                                              
       979 -          </div>                                            
       980 -                                                            
       981 -          {currentChat && (                                 
       982 -            <div className="flex items-center gap-2 overflow-
           -visible">                                                   
       983 -              <div className="relative overflow-visible" ref=
           -{statsPopupRef}>                                            
       984 -                <button                                     
       985 -                  onClick={() => setShowInfoModal(!showInfoMo
           -dal)}                                                       
       986 -                  className={`p-2 rounded-xl transition-all d
           -uration-200 ${showInfoModal                                 
       987 -                    ? 'bg-accent-500/10 text-accent-400 borde
           -r border-accent-500/20'                                     
       988 -                    : 'glass-button text-dark-400 hover:text-
           -dark-200'                                                   
       989 -                    }`}                                     
       990 -                  title="Usage Stats"                       
       991 -                >                                           
       992 -                  <Info className="w-4 h-4" />              
       993 -                </button>                                   
       994 -                                                            
       995 -                {/* Usage Stats Panel */}                   
       996 -                {showInfoModal && (                         
       997 -                  <div className="fixed top-14 right-4 w-80 b
           -g-dark-900 border border-dark-700 rounded-xl z-[100] shadow-2
           -xl scale-in">                                               
       998 -                    <div className="p-3 border-b border-dark-
           -700">                                                       
       999 -                      <h4 className="text-sm font-semibold te
           -xt-dark-200 flex items-center gap-2">                       
      1000 -                        <Hash className="w-3.5 h-3.5 text-acc
           -ent-400" />                                                 
      1001 -                        Chat Stats                          
      1002 -                      </h4>                                 
      1003 -                    </div>                                  
      1004 -                                                            
      1005 -                    <div className="p-3 space-y-3">         
      1006 -                      {/* Current Model */}                 
      1007 -                      <div className="p-2 rounded-lg bg-dark-
           -800">                                                       
      1008 -                        <p className="text-dark-500 text-xs m
           -b-1">Current Model</p>                                      
      1009 -                        <p className="text-sm font-medium tex
           -t-dark-200 truncate">{chatSettings.model}</p>               
      1010 -                      </div>                                
      1011 -                                                            
      1012 -                      {/* Conversation Stats */}            
      1013 -                      <div className="grid grid-cols-2 gap-2 
           -text-xs">                                                   
      1014 -                        <div className="p-2 rounded-lg bg-dar
           -k-800">                                                     
      1015 -                          <p className="text-dark-500">Messag
           -es</p>                                                      
      1016 -                          <p className="text-sm font-semibold
           - text-dark-200">{messages.length}</p>                       
      1017 -                        </div>                              
      1018 -                        <div className="p-2 rounded-lg bg-dar
           -k-800">                                                     
      1019 -                          <p className="text-dark-500">AI Res
           -ponses</p>                                                  
      1020 -                          <p className="text-sm font-semibold
           - text-accent-400">{messages.filter(m => m.role === 'assistant
           -').length}</p>                                              
      1021 -                        </div>                              
      1022 -                      </div>                                
      1023 -                                                            
      1024 -                      {/* Token Usage - from persisted data *
           -/}                                                          
      1025 -                      {chatTotals.totalTokens > 0 && (      
      1026 -                        <div className="border-t border-dark-
           -700 pt-3">                                                  
      1027 -                          <p className="text-dark-500 text-xs
           - mb-2">Chat Token Usage</p>                                 
      1028 -                          <div className="space-y-1.5 text-xs
           -">                                                          
      1029 -                            <div className="flex justify-betw
           -een">                                                       
      1030 -                              <span className="text-dark-400"
           ->Total Cost</span>                                          
      1031 -                              <span className="font-semibold 
           -text-accent-400">                                           
      1032 -                                ${chatTotals.totalCost.toFixe
           -d(2)}                                                       
      1033 -                              </span>                       
      1034 -                            </div>                          
      1035 -                          </div>                            
      1036 -                                                            
      1037 -                          {/* Token Bar with USED/CONTEXT lab
           -el */}                                                      
      1038 -                          {(() => {                         
      1039 -                            const contextLimit = getModelCont
           -ext(chatSettings.model);                                    
      1040 -                            const inputPercent = (chatTotals.
           -totalPromptTokens / contextLimit) * 100;                    
      1041 -                            const outputPercent = (chatTotals
           -.totalCompletionTokens / contextLimit) * 100;               
      1042 -                            const freePercent = Math.max(0, 1
           -00 - inputPercent - outputPercent);                         
      1043 -                            return (                        
      1044 -                              <>                            
      1045 -                                <div className="flex justify-
           -between mt-3 mb-1 text-xs">                                 
      1046 -                                  <span className="text-dark-
           -400">Tokens Used</span>                                     
      1047 -                                  <span className="font-mediu
           -m text-dark-200">                                           
      1048 -                                    {chatTotals.totalTokens.t
           -oLocaleString()}                                            
      1049 -                                    <span className="text-dar
           -k-500"> / {contextLimit.toLocaleString()}</span>            
      1050 -                                  </span>                   
      1051 -                                </div>                      
      1052 -                                <div className="h-2 bg-dark-6
           -00 rounded-full overflow-hidden flex">                      
      1053 -                                  <div                      
      1054 -                                    className="h-full bg-cyan
           --500"                                                       
      1055 -                                    style={{ width: `${inputP
           -ercent}%` }}                                                
      1056 -                                    title={`Input: ${chatTota
           -ls.totalPromptTokens.toLocaleString()}`}                    
      1057 -                                  />                        
      1058 -                                  <div                      
      1059 -                                    className="h-full bg-acce
           -nt-500"                                                     
      1060 -                                    style={{ width: `${output
           -Percent}%` }}                                               
      1061 -                                    title={`Output: ${chatTot
           -als.totalCompletionTokens.toLocaleString()}`}               
      1062 -                                  />                        
      1063 -                                  <div                      
      1064 -                                    className="h-full bg-dark
           --700"                                                       
      1065 -                                    style={{ width: `${freePe
           -rcent}%` }}                                                 
      1066 -                                    title={`Free: ${(contextL
           -imit - chatTotals.totalTokens).toLocaleString()}`}          
      1067 -                                  />                        
      1068 -                                </div>                      
      1069 -                                <div className="flex justify-
           -between mt-1 text-[10px] text-dark-500">                    
      1070 -                                  <div className="flex items-
           -center gap-2">                                              
      1071 -                                    <span className="flex ite
           -ms-center gap-1">                                           
      1072 -                                      <span className="w-2 h-
           -2 rounded-full bg-cyan-500"></span>                         
      1073 -                                      Input ({chatTotals.tota
           -lPromptTokens.toLocaleString()})                            
      1074 -                                    </span>                 
      1075 -                                    <span className="flex ite
           -ms-center gap-1">                                           
      1076 -                                      <span className="w-2 h-
           -2 rounded-full bg-accent-500"></span>                       
      1077 -                                      Output ({chatTotals.tot
           -alCompletionTokens.toLocaleString()})                       
      1078 -                                    </span>                 
      1079 -                                  </div>                    
      1080 -                                  <span className="flex items
           --center gap-1">                                             
      1081 -                                    <span className="w-2 h-2 
           -rounded-full bg-dark-700"></span>                           
      1082 -                                    Free                    
      1083 -                                  </span>                   
      1084 -                                </div>                      
      1085 -                              </>                           
      1086 -                            );                              
      1087 -                          })()}                             
      1088 -                        </div>                              
      1089 -                      )}                                    
      1090 -                                                            
      1091 -                      {/* No token data message - only show i
           -f no persisted data */}                                     
      1092 -                      {chatTotals.totalTokens === 0 && messag
           -es.length > 0 && (                                          
      1093 -                        <p className="text-[10px] text-dark-5
           -00 text-center pt-2 border-t border-dark-700">              
      1094 -                          Token usage will appear after sendi
           -ng messages                                                 
      1095 -                        </p>                                
      1096 -                      )}                                    
      1097 -                    </div>                                  
      1098 -                  </div>                                    
      1099 -                )}                                          
      1100 -              </div>                                        
      1101 -              <button                                       
      1102 -                onClick={() => setShowSettings(!showSettings)
           -}                                                           
      1103 -                className={`px-4 py-2 flex items-center gap-2
           - rounded-xl transition-all duration-200 text-sm font-medium $
           -{showSettings                                               
      1104 -                  ? 'bg-primary-500/10 text-primary-400 borde
           -r border-primary-500/20'                                    
      1105 -                  : 'glass-button text-dark-300 hover:text-da
           -rk-100'                                                     
      1106 -                  }`}                                       
      1107 -              >                                             
      1108 -                <SettingsIcon className="w-4 h-4" />        
      1109 -                Settings                                    
      1110 -              </button>                                     
      1111 -            </div>                                          
      1112 -          )}                                                
      1113 -        </div>                                              
      1114 -                                                            
      1115 -        {/* Settings Panel */}                              
      1116 -        {showSettings && currentChat && (                   
      1117 -          <div className="glass border-b border-white/[0.06] 
           -p-6 scale-in">                                              
      1118 -            <div className="max-w-4xl mx-auto space-y-5">   
      1119 -              <div className="grid grid-cols-1 md:grid-cols-2
           - gap-5">                                                    
      1120 -                <div>                                       
      1121 -                  <label className="block text-sm font-medium
           - text-dark-300 mb-2">                                       
      1122 -                    Model                                   
      1123 -                  </label>                                  
      1124 -                  <ModelSelector                            
      1125 -                    selectedModel={chatSettings.model}      
      1126 -                    onModelChange={handleModelChange}       
      1127 -                    isDropdown={true}                       
      1128 -                  />                                        
      1129 -                </div>                                      
      1130 -                                                            
      1131 -                <div>                                       
      1132 -                  <label className="block text-sm font-medium
           - text-dark-300 mb-2">                                       
      1133 -                    Temperature                             
      1134 -                    <span className="ml-2 px-2 py-0.5 bg-dark
           --800/50 rounded-md text-xs text-primary-400 font-mono">     
      1135 -                      {chatSettings.temperature}            
      1136 -                    </span>                                 
      1137 -                  </label>                                  
      1138 -                  <div className="pt-2">                    
      1139 -                    <input                                  
      1140 -                      type="range"                          
      1141 -                      min="0"                               
      1142 -                      max="2"                               
      1143 -                      step="0.1"                            
      1144 -                      value={chatSettings.temperature}      
      1145 -                      onChange={(e) => setChatSettings({ ...c
           -hatSettings, temperature: parseFloat(e.target.value) })}    
      1146 -                      className="w-full"                    
      1147 -                    />                                      
      1148 -                    <div className="flex justify-between text
           --xs text-dark-500 mt-1">                                    
      1149 -                      <span>Precise</span>                  
      1150 -                      <span>Creative</span>                 
      1151 -                    </div>                                  
      1152 -                  </div>                                    
      1153 -                </div>                                      
      1154 -              </div>                                        
      1155 -                                                            
      1156 -              <div>                                         
      1157 -                <label className="block text-sm font-medium t
           -ext-dark-300 mb-2">                                         
      1158 -                  System Prompt                             
      1159 -                </label>                                    
      1160 -                <textarea                                   
      1161 -                  value={chatSettings.system_prompt}        
      1162 -                  onChange={(e) => setChatSettings({ ...chatS
           -ettings, system_prompt: e.target.value })}                  
      1163 -                  className="w-full px-4 py-3 rounded-xl glas
           -s-input outline-none resize-none text-dark-100 placeholder-da
           -rk-500 text-sm"                                             
      1164 -                  rows="3"                                  
      1165 -                  placeholder="Set a custom system prompt for
           - this chat..."                                              
      1166 -                />                                          
      1167 -              </div>                                        
      1168 -                                                            
      1169 -              <div className="flex items-center justify-betwe
           -en pt-2">                                                   
      1170 -                <label className="flex items-center gap-3 cur
           -sor-pointer group">                                         
      1171 -                  <input                                    
      1172 -                    type="checkbox"                         
      1173 -                    checked={chatSettings.agent_mode}       
      1174 -                    onChange={(e) => setChatSettings({ ...cha
           -tSettings, agent_mode: e.target.checked })}                 
      1175 -                    className="w-5 h-5 rounded-md"          
      1176 -                  />                                        
      1177 -                  <span className="text-sm font-medium text-d
           -ark-300 flex items-center gap-2 group-hover:text-dark-200 tra
           -nsition-colors">                                            
      1178 -                    <Zap className="w-4 h-4 text-accent-400" 
           -/>                                                          
      1179 -                    Enable Agent Mode                       
      1180 -                    <span className="text-xs text-dark-500">(
           -with tools)</span>                                          
      1181 -                  </span>                                   
      1182 -                </label>                                    
      1183 -                                                            
      1184 -                <button                                     
      1185 -                  onClick={updateChatSettings}              
      1186 -                  className="px-5 py-2.5 gradient-primary tex
           -t-white rounded-xl font-semibold hover:shadow-glow transition
           --all duration-200 active:scale-[0.98]"                      
      1187 -                >                                           
      1188 -                  Save Settings                             
      1189 -                </button>                                   
      1190 -              </div>                                        
      1191 -            </div>                                          
      1192 -          </div>                                            
      1193 -        )}                                                  
      1194 -                                                            
      1195 -        {/* Messages */}                                    
      1196 -        <div                                                
      1197 -          ref={messagesContainerRef}                        
      1198 -          onScroll={handleMessagesScroll}                   
      1199 -          className="flex-1 overflow-y-auto p-6 relative z-0"
           -                                                             
      1200 -        >                                                   
      1201 -          {currentChat && (                                 
      1202 -            <div className="max-w-4xl mx-auto space-y-6">   
      1203 -              {messages.length === 0 && !streaming && (     
      1204 -                <div className="text-center py-16 fade-in"> 
      1205 -                  <div className="relative inline-block mb-6"
           ->                                                           
      1206 -                    <div className="w-20 h-20 rounded-2xl gra
           -dient-primary flex items-center justify-center shadow-lg glow
           --lg">                                                       
      1207 -                      <Bot className="w-10 h-10 text-white" /
           ->                                                           
      1208 -                    </div>                                  
      1209 -                    <div className="absolute -top-1 -right-1 
           -w-6 h-6 rounded-full gradient-primary flex items-center justi
           -fy-center shadow-lg">                                       
      1210 -                      <Sparkles className="w-3 h-3 text-white
           -" />                                                        
      1211 -                    </div>                                  
      1212 -                  </div>                                    
      1213 -                  <h3 className="text-2xl font-bold text-dark
           --100 mb-3 tracking-tight">Start a conversation</h3>         
      1214 -                  <p className="text-dark-400 max-w-sm mx-aut
           -o">Type a message below to begin chatting with AI. I'm here t
           -o help with anything you need.</p>                          
      1215 -                </div>                                      
      1216 -              )}                                            
      1217 -                                                            
      1218 -              {messages.map((message, index) => (           
      1219 -                <div                                        
      1220 -                  key={message.id}                          
      1221 -                  className={`flex gap-4 ${message.role === '
           -user' ? 'flex-row-reverse' : ''}`}                          
      1222 -                >                                           
      1223 -                  <div className={`flex-shrink-0 w-8 h-8 roun
           -ded-full flex items-center justify-center ${message.role === 
           -'user'                                                      
      1224 -                    ? 'gradient-primary shadow-glow'        
      1225 -                    : 'glass-card'                          
      1226 -                    }`}>                                    
      1227 -                    {message.role === 'user' ? (            
      1228 -                      <UserIcon className="w-4 h-4 text-white
           -" />                                                        
      1229 -                    ) : (                                   
      1230 -                      <Bot className="w-4 h-4 text-primary-40
           -0" />                                                       
      1231 -                    )}                                      
      1232 -                  </div>                                    
      1233 -                                                            
      1234 -                  <div className={`flex-1 ${message.role === 
           -'user' ? 'text-right' : ''}`}>                              
      1235 -                    {message.role === 'assistant' && message.
           -reasoning_content && (                                      
      1236 -                      <div className="text-left">           
      1237 -                        <ThinkingSection                    
      1238 -                          reasoning={message.reasoning_conten
           -t}                                                          
      1239 -                          isExpanded={expandedThinkingSection
           -s.has(message.id)}                                          
      1240 -                          onToggle={() => toggleThinkingSecti
           -on(message.id)}                                             
      1241 -                          isStreaming={false}               
      1242 -                          elapsedTime={0}                   
      1243 -                          stats={null}                      
      1244 -                        />                                  
      1245 -                      </div>                                
      1246 -                    )}                                      
      1247 -                    <div className={`inline-block max-w-[80%]
           - ${message.role === 'user'                                  
      1248 -                      ? 'bg-dark-700/80 border border-dark-60
           -0 text-dark-100 rounded-2xl rounded-tr-sm px-4 py-3'        
      1249 -                      : 'bg-gradient-to-br from-dark-800 to-d
           -ark-900 border border-dark-600/50 rounded-2xl rounded-tl-sm p
           -x-4 py-3 text-left shadow-lg'                               
      1250 -                      }`}>                                  
      1251 -                      {message.role === 'user' ? (          
      1252 -                        editingMessageId === message.id ? ( 
      1253 -                          <div className="space-y-2 text-left
           -">                                                          
      1254 -                            <textarea                       
      1255 -                              value={editContent}           
      1256 -                              onChange={(e) => setEditContent
           -(e.target.value)}                                           
      1257 -                              className="w-full min-w-[300px]
           - bg-dark-800/50 border border-dark-600 rounded-lg p-2 text-wh
           -ite resize-none focus:outline-none focus:border-primary-400"
      1258 -                              rows={3}                      
      1259 -                              autoFocus                     
      1260 -                            />                              
      1261 -                            <div className="flex gap-2 justif
           -y-end">                                                     
      1262 -                              <button                       
      1263 -                                onClick={handleEditCancel}  
      1264 -                                className="px-3 py-1 text-xs 
           -rounded-lg bg-dark-700 hover:bg-dark-600 transition-colors" 
      1265 -                              >                             
      1266 -                                Cancel                      
      1267 -                              </button>                     
      1268 -                              <button                       
      1269 -                                onClick={() => handleEditSave
           -(message.id)}                                               
      1270 -                                className="px-3 py-1 text-xs 
           -rounded-lg bg-primary-500 hover:bg-primary-400 transition-col
           -ors"                                                        
      1271 -                              >                             
      1272 -                                Save & Regenerate           
      1273 -                              </button>                     
      1274 -                            </div>                          
      1275 -                          </div>                            
      1276 -                        ) : (                               
      1277 -                          renderMessage(message.content)    
      1278 -                        )                                   
      1279 -                      ) : (                                 
      1280 -                        renderMessage(message.content)      
      1281 -                      )}                                    
      1282 -                    </div>                                  
      1283 -                                                            
      1284 -                    {message.role === 'user' && editingMessag
           -eId !== message.id && (                                     
      1285 -                      <div className="mt-2 flex gap-2 justify
           --end">                                                      
      1286 -                        <button                             
      1287 -                          onClick={() => handleCopy(message.i
           -d, message.content, 'raw')}                                 
      1288 -                          className="text-xs text-dark-400 ho
           -ver:text-primary-400 flex items-center gap-1 transition-color
           -s"                                                          
      1289 -                        >                                   
      1290 -                          {copiedMessageId === `${message.id}
           --raw` ? <Check className="w-3 h-3" /> : <Copy className="w-3 
           -h-3" />}                                                    
      1291 -                          {copiedMessageId === `${message.id}
           --raw` ? 'Copied!' : 'Copy'}                                 
      1292 -                        </button>                           
      1293 -                        <button                             
      1294 -                          onClick={() => handleEditStart(mess
           -age)}                                                       
      1295 -                          className="text-xs text-dark-400 ho
           -ver:text-primary-400 flex items-center gap-1 transition-color
           -s"                                                          
      1296 -                        >                                   
      1297 -                          <Pencil className="w-3 h-3" />    
      1298 -                          Edit                              
      1299 -                        </button>                           
      1300 -                      </div>                                
      1301 -                    )}                                      
      1302 -                                                            
      1303 -                    {message.role === 'assistant' && (      
      1304 -                      <div className="mt-2 flex gap-2 items-c
           -enter">                                                     
      1305 -                        <button                             
      1306 -                          onClick={() => handleCopy(message.i
           -d, message.content, 'raw')}                                 
      1307 -                          className="text-xs text-dark-400 ho
           -ver:text-primary-400 flex items-center gap-1 transition-color
           -s"                                                          
      1308 -                        >                                   
      1309 -                          {copiedMessageId === `${message.id}
           --raw` ? <Check className="w-3 h-3" /> : <Copy className="w-3 
           -h-3" />}                                                    
      1310 -                          {copiedMessageId === `${message.id}
           --raw` ? 'Copied!' : 'Copy Raw'}                             
      1311 -                        </button>                           
      1312 -                        <button                             
      1313 -                          onClick={() => handleCopy(message.i
           -d, message.content, 'markdown')}                            
      1314 -                          className="text-xs text-dark-400 ho
           -ver:text-primary-400 flex items-center gap-1 transition-color
           -s"                                                          
      1315 -                        >                                   
      1316 -                          {copiedMessageId === `${message.id}
           --markdown` ? <Check className="w-3 h-3" /> : <Copy className=
           -"w-3 h-3" />}                                               
      1317 -                          {copiedMessageId === `${message.id}
           --markdown` ? 'Copied!' : 'Copy Markdown'}                   
      1318 -                        </button>                           
      1319 -                        <button                             
      1320 -                          onClick={() => openForkModal(messag
           -e.id)}                                                      
      1321 -                          className="text-xs text-dark-400 ho
           -ver:text-primary-400 flex items-center gap-1 transition-color
           -s"                                                          
      1322 -                        >                                   
      1323 -                          <GitBranch className="w-3 h-3" /> 
      1324 -                          Fork from here                    
      1325 -                        </button>                           
      1326 -                                                            
      1327 -                        {/* Details hover - show if message h
           -as stats */}                                                
      1328 -                        {(message.prompt_tokens || message.re
           -sponse_time_ms || message.cost > 0) && (                    
      1329 -                          <div className="group relative">  
      1330 -                            <button className="text-xs text-d
           -ark-400 hover:text-primary-400 flex items-center gap-1 transi
           -tion-colors">                                               
      1331 -                              <Info className="w-3 h-3" />  
      1332 -                            </button>                       
      1333 -                            <div className="absolute bottom-f
           -ull left-0 mb-1 hidden group-hover:block z-10">             
      1334 -                              <div className="bg-dark-800 bor
           -der border-dark-600 rounded-lg px-3 py-2 text-xs whitespace-n
           -owrap shadow-xl">                                           
      1335 -                                <div className="space-y-1"> 
      1336 -                                  {message.response_time_ms >
           - 0 && (                                                     
      1337 -                                    <div className="flex just
           -ify-between gap-4">                                         
      1338 -                                      <span className="text-d
           -ark-400">Time:</span>                                       
      1339 -                                      <span className="text-d
           -ark-200 font-mono">{formatThinkingTime(message.response_time_
           -ms / 1000)}</span>                                          
      1340 -                                    </div>                  
      1341 -                                  )}                        
      1342 -                                  {(message.prompt_tokens || 
           -message.completion_tokens) && (                             
      1343 -                                    <div className="flex just
           -ify-between gap-4">                                         
      1344 -                                      <span className="text-d
           -ark-400">Tokens:</span>                                     
      1345 -                                      <span className="text-d
           -ark-200 font-mono">{((message.prompt_tokens || 0) + (message.
           -completion_tokens || 0)).toLocaleString()} tks</span>       
      1346 -                                    </div>                  
      1347 -                                  )}                        
      1348 -                                  {message.cost > 0 && (    
      1349 -                                    <div className="flex just
           -ify-between gap-4">                                         
      1350 -                                      <span className="text-d
           -ark-400">Cost:</span>                                       
      1351 -                                      <span className="text-a
           -ccent-400 font-mono">                                       
      1352 -                                        ${message.cost.toFixe
           -d(2)}                                                       
      1353 -                                      </span>               
      1354 -                                    </div>                  
      1355 -                                  )}                        
      1356 -                                </div>                      
      1357 -                              </div>                        
      1358 -                            </div>                          
      1359 -                          </div>                            
      1360 -                        )}                                  
      1361 -                      </div>                                
      1362 -                    )}                                      
      1363 -                                                            
      1364 -                  </div>                                    
      1365 -                </div>                                      
      1366 -              ))}                                           
      1367 -                                                            
      1368 -              {(streaming || streamingMessage || streamingRea
           -soning) && (                                                
      1369 -                <div className="flex gap-4">                
      1370 -                  <div className="flex-shrink-0 w-8 h-8 round
           -ed-full glass-card flex items-center justify-center">       
      1371 -                    <Bot className="w-4 h-4 text-primary-400"
           - />                                                         
      1372 -                  </div>                                    
      1373 -                  <div className="flex-1">                  
      1374 -                    {(streamingReasoning || (streaming && !st
           -reamingMessage)) && (                                       
      1375 -                      <ThinkingSection                      
      1376 -                        reasoning={streamingReasoning}      
      1377 -                        isExpanded={expandedThinkingSections.
           -has('streaming')}                                           
      1378 -                        onToggle={() => toggleThinkingSection
           -('streaming')}                                              
      1379 -                        isStreaming={!streamingMessage || (st
           -reamingReasoning && streaming)}                             
      1380 -                        elapsedTime={thinkingElapsedTime}   
      1381 -                        stats={lastThinkingStats}           
      1382 -                      />                                    
      1383 -                    )}                                      
      1384 -                                                            
      1385 -                    {streamingMessage && (                  
      1386 -                      <div className="inline-block max-w-[80%
           -] glass-card rounded-2xl rounded-tl-sm px-4 py-3">          
      1387 -                        {renderMessage(streamingMessage)}   
      1388 -                      </div>                                
      1389 -                    )}                                      
      1390 -                                                            
      1391 -                    {streaming && !streamingMessage && !strea
           -mingReasoning && (                                          
      1392 -                      <div className="inline-block glass-card
           - rounded-2xl rounded-tl-sm px-4 py-3">                      
      1393 -                        <div className="flex gap-1">        
      1394 -                          <div className="w-2 h-2 bg-primary-
           -400 rounded-full animate-bounce" style={{ animationDelay: '0m
           -s' }}></div>                                                
      1395 -                          <div className="w-2 h-2 bg-primary-
           -400 rounded-full animate-bounce" style={{ animationDelay: '15
           -0ms' }}></div>                                              
      1396 -                          <div className="w-2 h-2 bg-primary-
           -400 rounded-full animate-bounce" style={{ animationDelay: '30
           -0ms' }}></div>                                              
      1397 -                        </div>                              
      1398 -                      </div>                                
      1399 -                    )}                                      
      1400 -                  </div>                                    
      1401 -                </div>                                      
      1402 -              )}                                            
      1403 -                                                            
      1404 -              <div ref={messagesEndRef} />                  
      1405 -            </div>                                          
      1406 -          )}                                                
      1407 -        </div>                                              
      1408 -                                                            
      1409 -        {/* Input */}                                       
      1410 -        {currentChat && (                                   
      1411 -          <div className="border-t border-white/[0.06] glass 
           -p-4">                                                       
      1412 -            <div className="max-w-4xl mx-auto">             
      1413 -              {streaming && (                               
      1414 -                <div className="flex justify-center mb-4">  
      1415 -                  <button                                   
      1416 -                    onClick={stopGeneration}                
      1417 -                    className="flex items-center gap-2 px-5 p
           -y-2.5 bg-red-500/10 text-red-400 border border-red-500/20 rou
           -nded-xl text-sm font-semibold hover:bg-red-500/20 transition-
           -all duration-200 active:scale-[0.98]"                       
      1418 -                  >                                         
      1419 -                    <Square className="w-3 h-3 fill-current" 
           -/>                                                          
      1420 -                    Stop Generating                         
      1421 -                  </button>                                 
      1422 -                </div>                                      
      1423 -              )}                                            
      1424 -              <form onSubmit={sendMessage} className="flex ga
           -p-3">                                                       
      1425 -                <div className="flex-1 relative">           
      1426 -                  <textarea                                 
      1427 -                    ref={textareaRef}                       
      1428 -                    value={inputMessage}                    
      1429 -                    onChange={(e) => setInputMessage(e.target
           -.value)}                                                    
      1430 -                    onKeyDown={(e) => {                     
      1431 -                      if (e.key === 'Enter' && !e.shiftKey) {
           -                                                             
      1432 -                        e.preventDefault();                 
      1433 -                        if (inputMessage.trim() && !streaming
           -) {                                                         
      1434 -                          sendMessage(e);                   
      1435 -                        }                                   
      1436 -                      }                                     
      1437 -                    }}                                      
      1438 -                    placeholder={streaming ? "AI is respondin
           -g..." : "Type your message... (Shift+Enter for new line)"}  
      1439 -                    className="w-full px-5 py-3.5 rounded-2xl
           - glass-input outline-none text-dark-100 placeholder-dark-500 
           -text-sm pr-4 resize-none overflow-y-auto"                   
      1440 -                    style={{ minHeight: '52px', maxHeight: '1
           -40px' }}                                                    
      1441 -                    rows={1}                                
      1442 -                    disabled={streaming}                    
      1443 -                    onInput={(e) => {                       
      1444 -                      e.target.style.height = 'auto';       
      1445 -                      e.target.style.height = Math.min(e.targ
           -et.scrollHeight, 140) + 'px';                               
      1446 -                    }}                                      
      1447 -                  />                                        
      1448 -                </div>                                      
      1449 -                <button                                     
      1450 -                  type="submit"                             
      1451 -                  disabled={!inputMessage.trim() || streaming
           -}                                                           
      1452 -                  className="px-6 py-3.5 gradient-primary tex
           -t-white rounded-2xl font-semibold hover:shadow-glow transitio
           -n-all duration-200 disabled:opacity-40 disabled:cursor-not-al
           -lowed disabled:hover:shadow-none flex items-center gap-2 acti
           -ve:scale-[0.98] shine"                                      
      1453 -                >                                           
      1454 -                  <Send className="w-4 h-4" />              
      1455 -                  <span className="hidden sm:inline">Send</sp
           -an>                                                         
      1456 -                </button>                                   
      1457 -              </form>                                       
      1458 -            </div>                                          
      1459 -          </div>                                            
      1460 -        )}                                                  
      1461 -      </div>                                                
      1462 -                                                            
      1463 -      {/* Fork Modal */}                                    
      1464 -      {showForkModal && (                                   
      1465 -        <div className="fixed inset-0 bg-dark-950/80 backdrop
           --blur-md flex items-center justify-center z-50 scale-in">   
      1466 -          <div className="glass-card rounded-2xl p-6 w-full m
           -ax-w-md mx-4 shadow-2xl">                                   
      1467 -            <div className="flex items-center justify-between
           - mb-5">                                                     
      1468 -              <h3 className="text-lg font-bold text-dark-100 
           -flex items-center gap-2.5">                                 
      1469 -                <div className="w-8 h-8 rounded-lg gradient-p
           -rimary flex items-center justify-center shadow-lg">         
      1470 -                  <GitBranch className="w-4 h-4 text-white" /
           ->                                                           
      1471 -                </div>                                      
      1472 -                Fork Chat                                   
      1473 -              </h3>                                         
      1474 -              <button                                       
      1475 -                onClick={() => setShowForkModal(false)}     
      1476 -                className="p-2 hover:bg-white/[0.05] rounded-
           -xl transition-all duration-200"                             
      1477 -              >                                             
      1478 -                <X className="w-5 h-5 text-dark-400" />     
      1479 -              </button>                                     
      1480 -            </div>                                          
      1481 -                                                            
      1482 -            <p className="text-dark-400 text-sm mb-5 leading-
           -relaxed">                                                   
      1483 -              Create a new chat branch from this point. You c
           -an choose a different model for the forked chat.            
      1484 -            </p>                                            
      1485 -                                                            
      1486 -            <div className="mb-6">                          
      1487 -              <label className="block text-sm font-medium tex
           -t-dark-300 mb-2">                                           
      1488 -                Model for forked chat                       
      1489 -              </label>                                      
      1490 -              <ModelSelector                                
      1491 -                selectedModel={forkModel}                   
      1492 -                onModelChange={setForkModel}                
      1493 -                isDropdown={true}                           
      1494 -              />                                            
      1495 -            </div>                                          
      1496 -                                                            
      1497 -            <div className="flex gap-3">                    
      1498 -              <button                                       
      1499 -                onClick={() => setShowForkModal(false)}     
      1500 -                className="flex-1 px-4 py-3 rounded-xl glass-
           -button text-dark-300 font-semibold transition-all duration-20
           -0 hover:text-dark-100"                                      
      1501 -              >                                             
      1502 -                Cancel                                      
      1503 -              </button>                                     
      1504 -              <button                                       
      1505 -                onClick={forkChat}                          
      1506 -                className="flex-1 px-4 py-3 rounded-xl gradie
           -nt-primary text-white font-semibold hover:shadow-glow transit
           -ion-all duration-200 flex items-center justify-center gap-2 a
           -ctive:scale-[0.98] shine"                                   
      1507 -              >                                             
      1508 -                <GitBranch className="w-4 h-4" />           
      1509 -                Fork Chat                                   
      1510 -              </button>                                     
      1511 -            </div>                                          
      1512 -          </div>                                            
      1513 -        </div>                                              
      1514 -      )}                                                    
      1515 -                                                            
      1516 -    </div>                                                  
      1517 -  );                                                        
      1518 -}                                                           
      1519 -                                                            
      1520 -export default Chat;                                        
         1 +import React, { useState, useEffect, useContext, useRef, memo
           +, useCallback, useMemo } from 'react';                       
         2 +import { useNavigate } from 'react-router-dom';              
         3 +import {                                                     
         4 +  MessageSquare, Plus, Settings as SettingsIcon, LogOut, Brai
           +n,                                                           
         5 +  Send, Trash2, GitBranch, Bot, User as UserIcon,            
         6 +  Sparkles, Zap, Menu, X, ChevronDown, ChevronRight, Square, 
         7 +  Check, Trash, Copy, Pencil, Info, DollarSign, Hash         
         8 +} from 'lucide-react';                                       
         9 +import { AuthContext } from '../contexts/AuthContext';       
        10 +import { marked } from 'marked';                             
        11 +import DOMPurify from 'dompurify';                           
        12 +import ModelSelector, { DEFAULT_MODEL, RECENT_MODELS_KEY, MOD
           +ELS_CACHE_KEY } from '../components/ModelSelector';          
        13 +                                                             
        14 +marked.setOptions({                                          
        15 +  breaks: true,                                              
        16 +  gfm: true                                                  
        17 +});                                                          
        18 +                                                             
        19 +const LAST_MODEL_KEY = 'budi_chat_last_model';               
        20 +                                                             
        21 +// Format time as seconds or minutes:seconds (integer display
           +)                                                            
        22 +const formatThinkingTime = (seconds) => {                    
        23 +  const s = Math.floor(seconds);                             
        24 +  if (s < 60) {                                              
        25 +    return `${s}s`;                                          
        26 +  }                                                          
        27 +  const mins = Math.floor(s / 60);                           
        28 +  const secs = s % 60;                                       
        29 +  return `${mins}m ${secs.toString().padStart(2, '0')}s`;    
        30 +};                                                           
        31 +                                                             
        32 +// Get model data from OpenRouter cache                      
        33 +const getModelFromCache = (modelId) => {                     
        34 +  try {                                                      
        35 +    const cached = localStorage.getItem(MODELS_CACHE_KEY);   
        36 +    if (cached) {                                            
        37 +      const { models } = JSON.parse(cached);                 
        38 +      return models.find(m => m.id === modelId);             
        39 +    }                                                        
        40 +  } catch (e) {                                              
        41 +    console.error('Failed to get model from cache:', e);     
        42 +  }                                                          
        43 +  return null;                                               
        44 +};                                                           
        45 +                                                             
        46 +// Get context window size for a model (from cache or fallbac
           +k)                                                           
        47 +const getModelContext = (modelId) => {                       
        48 +  const model = getModelFromCache(modelId);                  
        49 +  return model?.contextLength || 128000; // fallback to 128k 
        50 +};                                                           
        51 +                                                             
        52 +// Calculate cost using cached pricing data                  
        53 +const calculateCost = (promptTokens, completionTokens, modelI
           +d) => {                                                      
        54 +  const model = getModelFromCache(modelId);                  
        55 +  if (model?.pricing) {                                      
        56 +    const inputCost = promptTokens * parseFloat(model.pricing
           +.prompt);                                                    
        57 +    const outputCost = completionTokens * parseFloat(model.pr
           +icing.completion);                                           
        58 +    return inputCost + outputCost;                           
        59 +  }                                                          
        60 +  // Fallback: rough estimate                                
        61 +  return (promptTokens + completionTokens) * 0.000001;       
        62 +};                                                           
        63 +                                                             
        64 +// Memoized ThinkingSection component to prevent re-renders d
           +uring streaming                                              
        65 +const ThinkingSection = memo(({ reasoning, isExpanded, onTogg
           +le, isStreaming, elapsedTime, stats }) => {                  
        66 +  const contentRef = useRef(null);                           
        67 +  const shouldAutoScrollRef = useRef(true);                  
        68 +                                                             
        69 +  useEffect(() => {                                          
        70 +    if (isExpanded && isStreaming && shouldAutoScrollRef.curr
           +ent) {                                                       
        71 +      const scroll = () => {                                 
        72 +        if (contentRef.current) {                            
        73 +          contentRef.current.scrollTop = contentRef.current.s
           +crollHeight;                                                 
        74 +        }                                                    
        75 +      };                                                     
        76 +      requestAnimationFrame(scroll);                         
        77 +    }                                                        
        78 +  }, [reasoning, isExpanded, isStreaming]);                  
        79 +                                                             
        80 +  const handleScroll = (e) => {                              
        81 +    const { scrollTop, scrollHeight, clientHeight } = e.targe
           +t;                                                           
        82 +    // If user is within 50px of bottom, enable auto-scroll, 
           +otherwise disable                                            
        83 +    const isAtBottom = scrollHeight - scrollTop - clientHeigh
           +t < 50;                                                      
        84 +    shouldAutoScrollRef.current = isAtBottom;                
        85 +  };                                                         
        86 +                                                             
        87 +  if (!reasoning && !isStreaming) return null;               
        88 +                                                             
        89 +  const hasStats = stats && (stats.totalTokens > 0 || stats.d
           +uration > 0);                                                
        90 +  const cost = hasStats ? (stats.cost || (stats.promptTokens 
           +|| 0) > 0 ? calculateCost(stats.promptTokens || 0, stats.comp
           +letionTokens || 0, stats.model) : 0) : 0;                    
        91 +                                                             
        92 +  return (                                                   
        93 +    <div className="mb-4">                                   
        94 +      <div className="flex items-center justify-between">    
        95 +        <button                                              
        96 +          type="button"                                      
        97 +          onMouseDown={(e) => {                              
        98 +            e.preventDefault();                              
        99 +            onToggle();                                      
       100 +          }}                                                 
       101 +          className="flex items-center gap-2 text-sm font-med
           +ium text-dark-400 hover:text-dark-300 transition-colors px-3 
           +py-1.5 rounded-lg hover:bg-dark-700/50 select-none"          
       102 +        >                                                    
       103 +          <Brain className="w-4 h-4 text-accent-400" />      
       104 +          <span>                                             
       105 +            {isStreaming ? (                                 
       106 +              <>Thinking... <span className="text-accent-400 
           +font-mono text-xs ml-1">{formatThinkingTime(elapsedTime || 0)
           +}</span></>                                                  
       107 +            ) : (                                            
       108 +              'Thought Process'                              
       109 +            )}                                               
       110 +          </span>                                            
       111 +          <ChevronDown className={`w-4 h-4 transition-transfo
           +rm duration-200 ${isExpanded ? 'rotate-180' : ''}`} />       
       112 +        </button>                                            
       113 +                                                             
       114 +        {/* Details on hover - bottom right */}              
       115 +        {!isStreaming && hasStats && (                       
       116 +          <div className="group relative">                   
       117 +            <span className="text-[10px] text-dark-500 cursor
           +-default">details</span>                                     
       118 +            <div className="absolute bottom-full right-0 mb-1
           + hidden group-hover:block z-10">                             
       119 +              <div className="bg-dark-800 border border-dark-
           +700 rounded-lg px-3 py-2 text-xs whitespace-nowrap shadow-xl"
           +>                                                            
       120 +                <div className="space-y-1">                  
       121 +                  {stats.duration > 0 && (                   
       122 +                    <div className="flex justify-between gap-
           +4">                                                          
       123 +                      <span className="text-dark-400">Time:</
           +span>                                                        
       124 +                      <span className="text-dark-200 font-mon
           +o">{formatThinkingTime(stats.duration)}</span>               
       125 +                    </div>                                   
       126 +                  )}                                         
       127 +                  {stats.totalTokens > 0 && (                
       128 +                    <div className="flex justify-between gap-
           +4">                                                          
       129 +                      <span className="text-dark-400">Tokens:
           +</span>                                                      
       130 +                      <span className="text-dark-200 font-mon
           +o">{stats.totalTokens.toLocaleString()} tks</span>           
       131 +                    </div>                                   
       132 +                  )}                                         
       133 +                  {cost > 0 && (                             
       134 +                    <div className="flex justify-between gap-
           +4">                                                          
       135 +                      <span className="text-dark-400">Cost:</
           +span>                                                        
       136 +                      <span className="text-primary-400 font-
           +mono">${cost < 0.01 ? cost.toFixed(4) : cost.toFixed(3)}</spa
           +n>                                                           
       137 +                    </div>                                   
       138 +                  )}                                         
       139 +                </div>                                       
       140 +              </div>                                         
       141 +            </div>                                           
       142 +          </div>                                             
       143 +        )}                                                   
       144 +      </div>                                                 
       145 +      {isExpanded && (                                       
       146 +        <div                                                 
       147 +          ref={contentRef}                                   
       148 +          onScroll={handleScroll}                            
       149 +          className="mt-2 px-4 py-3 text-sm text-dark-300 rou
           +nded-xl border border-dark-700/50 italic bg-dark-900/50 text-
           +left max-h-[300px] overflow-y-auto prose prose-invert prose-s
           +m max-w-none"                                                
       150 +          dangerouslySetInnerHTML={{                         
       151 +            __html: DOMPurify.sanitize(marked.parse(reasoning
           + || 'Thinking...'))                                          
       152 +          }}                                                 
       153 +        />                                                   
       154 +      )}                                                     
       155 +    </div>                                                   
       156 +  );                                                         
       157 +});                                                          
       158 +                                                             
       159 +function Chat() {                                            
       160 +  const { user, logout } = useContext(AuthContext);          
       161 +  const navigate = useNavigate();                            
       162 +  const [chats, setChats] = useState([]);                    
       163 +  const [currentChat, setCurrentChat] = useState(() => ({    
       164 +    title: 'New Chat',                                       
       165 +    model: localStorage.getItem(LAST_MODEL_KEY) || DEFAULT_MO
           +DEL,                                                         
       166 +    temperature: 0.7,                                        
       167 +    system_prompt: '',                                       
       168 +    agent_mode: false                                        
       169 +  }));                                                       
       170 +  const [messages, setMessages] = useState([]);              
       171 +  const [inputMessage, setInputMessage] = useState('');      
       172 +  const [loading, setLoading] = useState(false);             
       173 +  const [streaming, setStreaming] = useState(false);         
       174 +  const [streamingMessage, setStreamingMessage] = useState(''
           +);                                                           
       175 +  const [streamingReasoning, setStreamingReasoning] = useStat
           +e('');                                                       
       176 +  const [showSettings, setShowSettings] = useState(false);   
       177 +  const [showSidebar, setShowSidebar] = useState(true);      
       178 +  const [showForkModal, setShowForkModal] = useState(false); 
       179 +  const [deletingChatId, setDeletingChatId] = useState(null);
       180 +  const [forkMessageId, setForkMessageId] = useState(null);  
       181 +  const [forkModel, setForkModel] = useState(DEFAULT_MODEL); 
       182 +  const messagesEndRef = useRef(null);                       
       183 +  const messagesContainerRef = useRef(null);                 
       184 +  const abortControllerRef = useRef(null);                   
       185 +  const isCreatingChatRef = useRef(false);                   
       186 +  const userHasScrolledUp = useRef(false);                   
       187 +  const statsPopupRef = useRef(null);                        
       188 +  const textareaRef = useRef(null);                          
       189 +  const [expandedThinkingSections, setExpandedThinkingSection
           +s] = useState(new Set());                                    
       190 +  const [copiedMessageId, setCopiedMessageId] = useState(null
           +);                                                           
       191 +  const [editingMessageId, setEditingMessageId] = useState(nu
           +ll);                                                         
       192 +  const [editContent, setEditContent] = useState('');        
       193 +  const [showInfoModal, setShowInfoModal] = useState(false); 
       194 +  const [usageStats, setUsageStats] = useState(null);        
       195 +  const [thinkingStartTime, setThinkingStartTime] = useState(
           +null);                                                       
       196 +  const [thinkingElapsedTime, setThinkingElapsedTime] = useSt
           +ate(0);                                                      
       197 +  const [lastThinkingStats, setLastThinkingStats] = useState(
           +null);                                                       
       198 +                                                             
       199 +  const [chatSettings, setChatSettings] = useState(() => ({  
       200 +    model: localStorage.getItem(LAST_MODEL_KEY) || DEFAULT_MO
           +DEL,                                                         
       201 +    temperature: 0.7,                                        
       202 +    system_prompt: '',                                       
       203 +    agent_mode: false                                        
       204 +  }));                                                       
       205 +                                                             
       206 +  // Calculate chat totals from persisted message data       
       207 +  const chatTotals = useMemo(() => {                         
       208 +    const assistantMsgs = messages.filter(m => m.role === 'as
           +sistant');                                                   
       209 +    return {                                                 
       210 +      totalPromptTokens: assistantMsgs.reduce((sum, m) => sum
           + + (m.prompt_tokens || 0), 0),                               
       211 +      totalCompletionTokens: assistantMsgs.reduce((sum, m) =>
           + sum + (m.completion_tokens || 0), 0),                       
       212 +      totalTokens: assistantMsgs.reduce((sum, m) => sum + (m.
           +prompt_tokens || 0) + (m.completion_tokens || 0), 0),        
       213 +      totalTimeMs: assistantMsgs.reduce((sum, m) => sum + (m.
           +response_time_ms || 0), 0),                                  
       214 +      totalCost: assistantMsgs.reduce((sum, m) => sum + (m.co
           +st || 0), 0),                                                
       215 +    };                                                       
       216 +  }, [messages]);                                            
       217 +                                                             
       218 +  useEffect(() => {                                          
       219 +    loadChats();                                             
       220 +  }, []);                                                    
       221 +                                                             
       222 +  useEffect(() => {                                          
       223 +    // Skip clearing/aborting if we're in the middle of creat
           +ing a new chat                                               
       224 +    if (isCreatingChatRef.current) {                         
       225 +      return;                                                
       226 +    }                                                        
       227 +                                                             
       228 +    // Clear state immediately when switching chats or if no 
           +chat is selected                                             
       229 +    setStreamingMessage('');                                 
       230 +    setStreamingReasoning('');                               
       231 +    setStreaming(false);                                     
       232 +    setUsageStats(null);                                     
       233 +                                                             
       234 +    if (abortControllerRef.current) {                        
       235 +      abortControllerRef.current.abort();                    
       236 +    }                                                        
       237 +                                                             
       238 +    if (currentChat?.id) {                                   
       239 +      loadMessages(currentChat.id);                          
       240 +    }                                                        
       241 +  }, [currentChat?.id]);                                     
       242 +                                                             
       243 +  useEffect(() => {                                          
       244 +    // Only auto-scroll if user hasn't manually scrolled up  
       245 +    if (!userHasScrolledUp.current) {                        
       246 +      scrollToBottom();                                      
       247 +    }                                                        
       248 +  }, [messages, streamingMessage]);                          
       249 +                                                             
       250 +  // Reset scroll flag when streaming ends                   
       251 +  useEffect(() => {                                          
       252 +    if (!streaming) {                                        
       253 +      userHasScrolledUp.current = false;                     
       254 +    }                                                        
       255 +  }, [streaming]);                                           
       256 +                                                             
       257 +  // Timer for thinking section                              
       258 +  useEffect(() => {                                          
       259 +    let interval;                                            
       260 +    if (streaming && thinkingStartTime) {                    
       261 +      interval = setInterval(() => {                         
       262 +        setThinkingElapsedTime((Date.now() - thinkingStartTim
           +e) / 1000);                                                  
       263 +      }, 100);                                               
       264 +    }                                                        
       265 +    return () => clearInterval(interval);                    
       266 +  }, [streaming, thinkingStartTime]);                        
       267 +                                                             
       268 +  // Reset thinking timer when streaming starts              
       269 +  useEffect(() => {                                          
       270 +    if (streaming) {                                         
       271 +      setThinkingStartTime(Date.now());                      
       272 +      setThinkingElapsedTime(0);                             
       273 +      setLastThinkingStats(null);                            
       274 +    }                                                        
       275 +  }, [streaming]);                                           
       276 +                                                             
       277 +  // Close stats popup when clicking outside                 
       278 +  useEffect(() => {                                          
       279 +    const handleClickOutside = (event) => {                  
       280 +      if (statsPopupRef.current && !statsPopupRef.current.con
           +tains(event.target)) {                                       
       281 +        setShowInfoModal(false);                             
       282 +      }                                                      
       283 +    };                                                       
       284 +    if (showInfoModal) {                                     
       285 +      document.addEventListener('mousedown', handleClickOutsi
           +de);                                                         
       286 +      return () => document.removeEventListener('mousedown', 
           +handleClickOutside);                                         
       287 +    }                                                        
       288 +  }, [showInfoModal]);                                       
       289 +                                                             
       290 +  const scrollToBottom = () => {                             
       291 +    messagesEndRef.current?.scrollIntoView({ behavior: 'smoot
           +h' });                                                       
       292 +  };                                                         
       293 +                                                             
       294 +  const handleMessagesScroll = (e) => {                      
       295 +    const container = e.target;                              
       296 +    const threshold = 100; // pixels from bottom             
       297 +    const isNearBottom = container.scrollHeight - container.s
           +crollTop - container.clientHeight < threshold;               
       298 +    userHasScrolledUp.current = !isNearBottom;               
       299 +  };                                                         
       300 +                                                             
       301 +  const toggleThinkingSection = useCallback((messageId) => { 
       302 +    setExpandedThinkingSections(prev => {                    
       303 +      const newSet = new Set(prev);                          
       304 +      if (newSet.has(messageId)) {                           
       305 +        newSet.delete(messageId);                            
       306 +      } else {                                               
       307 +        newSet.add(messageId);                               
       308 +      }                                                      
       309 +      return newSet;                                         
       310 +    });                                                      
       311 +  }, []);                                                    
       312 +                                                             
       313 +  const loadChats = async () => {                            
       314 +    try {                                                    
       315 +      const res = await fetch('/api/chats', {                
       316 +        headers: { 'Authorization': `Bearer ${localStorage.ge
           +tItem('token')}` }                                           
       317 +      });                                                    
       318 +      const data = await res.json();                         
       319 +      setChats(data);                                        
       320 +    } catch (error) {                                        
       321 +      console.error('Failed to load chats:', error);         
       322 +    }                                                        
       323 +  };                                                         
       324 +                                                             
       325 +  const loadMessages = async (chatId) => {                   
       326 +    try {                                                    
       327 +      const res = await fetch(`/api/chats/${chatId}`, {      
       328 +        headers: { 'Authorization': `Bearer ${localStorage.ge
           +tItem('token')}` }                                           
       329 +      });                                                    
       330 +      const data = await res.json();                         
       331 +      setMessages(data.messages || []);                      
       332 +      setChatSettings({                                      
       333 +        model: data.model,                                   
       334 +        temperature: data.temperature,                       
       335 +        system_prompt: data.system_prompt || '',             
       336 +        agent_mode: !!data.agent_mode                        
       337 +      });                                                    
       338 +      // Update currentChat with latest data (including updat
           +ed title)                                                    
       339 +      const { messages: _, ...chatData } = data;             
       340 +      setCurrentChat(prev => ({ ...prev, ...chatData }));    
       341 +    } catch (error) {                                        
       342 +      console.error('Failed to load messages:', error);      
       343 +    }                                                        
       344 +  };                                                         
       345 +                                                             
       346 +  const createNewChat = () => {                              
       347 +    const modelToUse = localStorage.getItem(LAST_MODEL_KEY) |
           +| DEFAULT_MODEL;                                             
       348 +    // Create a temporary chat object without an ID          
       349 +    // The actual chat will be created when the first message
           + is sent                                                     
       350 +    setCurrentChat({                                         
       351 +      title: 'New Chat',                                     
       352 +      model: modelToUse,                                     
       353 +      temperature: 0.7,                                      
       354 +      system_prompt: '',                                     
       355 +      agent_mode: false                                      
       356 +    });                                                      
       357 +    setChatSettings({                                        
       358 +      model: modelToUse,                                     
       359 +      temperature: 0.7,                                      
       360 +      system_prompt: '',                                     
       361 +      agent_mode: false                                      
       362 +    });                                                      
       363 +  };                                                         
       364 +                                                             
       365 +  const updateChatSettings = async () => {                   
       366 +    if (!currentChat) return;                                
       367 +                                                             
       368 +    // If it's a new chat without an ID, just update local st
           +ate                                                          
       369 +    if (!currentChat.id) {                                   
       370 +      setCurrentChat({ ...currentChat, ...chatSettings });   
       371 +      setShowSettings(false);                                
       372 +      return;                                                
       373 +    }                                                        
       374 +                                                             
       375 +    try {                                                    
       376 +      await fetch(`/api/chats/${currentChat.id}`, {          
       377 +        method: 'PUT',                                       
       378 +        headers: {                                           
       379 +          'Content-Type': 'application/json',                
       380 +          'Authorization': `Bearer ${localStorage.getItem('to
           +ken')}`                                                      
       381 +        },                                                   
       382 +        body: JSON.stringify(chatSettings)                   
       383 +      });                                                    
       384 +      setShowSettings(false);                                
       385 +    } catch (error) {                                        
       386 +      console.error('Failed to update chat:', error);        
       387 +    }                                                        
       388 +  };                                                         
       389 +                                                             
       390 +  const handleModelChange = async (modelId) => {             
       391 +    // Save as last used model                               
       392 +    localStorage.setItem(LAST_MODEL_KEY, modelId);           
       393 +                                                             
       394 +    setChatSettings(prev => ({ ...prev, model: modelId }));  
       395 +                                                             
       396 +    // If we have a current chat with an ID, update it immedi
           +ately                                                        
       397 +    if (currentChat && currentChat.id) {                     
       398 +      try {                                                  
       399 +        await fetch(`/api/chats/${currentChat.id}`, {        
       400 +          method: 'PUT',                                     
       401 +          headers: {                                         
       402 +            'Content-Type': 'application/json',              
       403 +            'Authorization': `Bearer ${localStorage.getItem('
           +token')}`                                                    
       404 +          },                                                 
       405 +          body: JSON.stringify({ ...chatSettings, model: mode
           +lId })                                                       
       406 +        });                                                  
       407 +      } catch (error) {                                      
       408 +        console.error('Failed to update chat model:', error);
       409 +      }                                                      
       410 +    } else if (currentChat && !currentChat.id) {             
       411 +      // If it's a new chat without an ID, just update local 
           +state                                                        
       412 +      setCurrentChat({ ...currentChat, model: modelId });    
       413 +    }                                                        
       414 +  };                                                         
       415 +                                                             
       416 +  const deleteChat = async (chatId) => {                     
       417 +    try {                                                    
       418 +      await fetch(`/api/chats/${chatId}`, {                  
       419 +        method: 'DELETE',                                    
       420 +        headers: { 'Authorization': `Bearer ${localStorage.ge
           +tItem('token')}` }                                           
       421 +      });                                                    
       422 +      setChats(chats.filter(c => c.id !== chatId));          
       423 +      if (currentChat?.id === chatId) {                      
       424 +        // Automatically open a new chat instead of leaving b
           +lank                                                         
       425 +        setMessages([]);                                     
       426 +        createNewChat();                                     
       427 +      }                                                      
       428 +      setDeletingChatId(null);                               
       429 +    } catch (error) {                                        
       430 +      console.error('Failed to delete chat:', error);        
       431 +    }                                                        
       432 +  };                                                         
       433 +                                                             
       434 +  const openForkModal = (messageId) => {                     
       435 +    setForkMessageId(messageId);                             
       436 +    setForkModel(chatSettings.model);                        
       437 +    setShowForkModal(true);                                  
       438 +  };                                                         
       439 +                                                             
       440 +  const forkChat = async () => {                             
       441 +    if (!currentChat || !forkMessageId) return;              
       442 +                                                             
       443 +    try {                                                    
       444 +      const res = await fetch(`/api/chats/${currentChat.id}/f
           +ork`, {                                                      
       445 +        method: 'POST',                                      
       446 +        headers: {                                           
       447 +          'Content-Type': 'application/json',                
       448 +          'Authorization': `Bearer ${localStorage.getItem('to
           +ken')}`                                                      
       449 +        },                                                   
       450 +        body: JSON.stringify({                               
       451 +          message_id: forkMessageId,                         
       452 +          model: forkModel                                   
       453 +        })                                                   
       454 +      });                                                    
       455 +      const data = await res.json();                         
       456 +      setChats([data, ...chats]);                            
       457 +      setCurrentChat(data);                                  
       458 +      setShowForkModal(false);                               
       459 +      setForkMessageId(null);                                
       460 +                                                             
       461 +      // Save the fork model as last used                    
       462 +      localStorage.setItem(LAST_MODEL_KEY, forkModel);       
       463 +    } catch (error) {                                        
       464 +      console.error('Failed to fork chat:', error);          
       465 +    }                                                        
       466 +  };                                                         
       467 +                                                             
       468 +  const stopGeneration = () => {                             
       469 +    if (abortControllerRef.current) {                        
       470 +      abortControllerRef.current.abort();                    
       471 +      setStreaming(false);                                   
       472 +    }                                                        
       473 +  };                                                         
       474 +                                                             
       475 +  const sendMessage = async (e) => {                         
       476 +    e.preventDefault();                                      
       477 +    if (!inputMessage.trim() || !currentChat || streaming) re
           +turn;                                                        
       478 +                                                             
       479 +    const userMessage = inputMessage.trim();                 
       480 +    setInputMessage('');                                     
       481 +    // Reset textarea height                                 
       482 +    if (textareaRef.current) {                               
       483 +      textareaRef.current.style.height = '52px';             
       484 +    }                                                        
       485 +    setStreaming(true);                                      
       486 +    setStreamingMessage('');                                 
       487 +    setStreamingReasoning('');                               
       488 +                                                             
       489 +    abortControllerRef.current = new AbortController();      
       490 +                                                             
       491 +    // Add user message to UI immediately                    
       492 +    const tempUserMessage = {                                
       493 +      id: Date.now(),                                        
       494 +      role: 'user',                                          
       495 +      content: userMessage,                                  
       496 +      created_at: new Date().toISOString()                   
       497 +    };                                                       
       498 +    setMessages(prev => [...prev, tempUserMessage]);         
       499 +                                                             
       500 +    try {                                                    
       501 +      // If this is a new chat without an ID, create it first
       502 +      let chatId = currentChat.id;                           
       503 +      if (!chatId) {                                         
       504 +        isCreatingChatRef.current = true;                    
       505 +        const createRes = await fetch('/api/chats', {        
       506 +          method: 'POST',                                    
       507 +          headers: {                                         
       508 +            'Content-Type': 'application/json',              
       509 +            'Authorization': `Bearer ${localStorage.getItem('
           +token')}`                                                    
       510 +          },                                                 
       511 +          body: JSON.stringify({                             
       512 +            title: 'New Chat',                               
       513 +            model: chatSettings.model,                       
       514 +            temperature: chatSettings.temperature,           
       515 +            system_prompt: chatSettings.system_prompt,       
       516 +            agent_mode: chatSettings.agent_mode              
       517 +          })                                                 
       518 +        });                                                  
       519 +        const newChat = await createRes.json();              
       520 +        chatId = newChat.id;                                 
       521 +        setCurrentChat(newChat);                             
       522 +        setChats(prev => [newChat, ...prev]);                
       523 +      }                                                      
       524 +                                                             
       525 +      const res = await fetch(`/api/messages/${chatId}`, {   
       526 +        method: 'POST',                                      
       527 +        headers: {                                           
       528 +          'Content-Type': 'application/json',                
       529 +          'Authorization': `Bearer ${localStorage.getItem('to
           +ken')}`                                                      
       530 +        },                                                   
       531 +        body: JSON.stringify({ content: userMessage }),      
       532 +        signal: abortControllerRef.current.signal            
       533 +      });                                                    
       534 +                                                             
       535 +      if (!res.ok) {                                         
       536 +        const errorData = await res.json();                  
       537 +        throw new Error(errorData.error || 'Failed to send me
           +ssage');                                                     
       538 +      }                                                      
       539 +                                                             
       540 +      const reader = res.body.getReader();                   
       541 +      const decoder = new TextDecoder();                     
       542 +      let buffer = '';                                       
       543 +                                                             
       544 +      while (true) {                                         
       545 +        const { done, value } = await reader.read();         
       546 +        if (done) break;                                     
       547 +                                                             
       548 +        buffer += decoder.decode(value, { stream: true });   
       549 +        const lines = buffer.split('\n');                    
       550 +        buffer = lines.pop();                                
       551 +                                                             
       552 +        for (const line of lines) {                          
       553 +          if (line.startsWith('data: ')) {                   
       554 +            try {                                            
       555 +              const data = JSON.parse(line.slice(6));        
       556 +                                                             
       557 +              if (data.type === 'reasoning') {               
       558 +                setStreamingReasoning(prev => prev + data.con
           +tent);                                                       
       559 +              } else if (data.type === 'content') {          
       560 +                setStreamingMessage(prev => prev + data.conte
           +nt);                                                         
       561 +              } else if (data.type === 'done') {             
       562 +                // Calculate thinking duration               
       563 +                const thinkingDuration = thinkingStartTime ? 
           +(Date.now() - thinkingStartTime) / 1000 : 0;                 
       564 +                                                             
       565 +                // Capture usage data if provided            
       566 +                if (data.usage) {                            
       567 +                  const stats = {                            
       568 +                    promptTokens: data.usage.prompt_tokens ||
           + 0,                                                          
       569 +                    completionTokens: data.usage.completion_t
           +okens || 0,                                                  
       570 +                    totalTokens: data.usage.total_tokens || 0
           +,                                                            
       571 +                    model: data.model,                       
       572 +                    duration: thinkingDuration,              
       573 +                    cost: data.cost || 0                     
       574 +                  };                                         
       575 +                  setLastThinkingStats(stats);               
       576 +                  setUsageStats(prev => ({                   
       577 +                    ...prev,                                 
       578 +                    lastMessage: stats,                      
       579 +                    totalPromptTokens: (prev?.totalPromptToke
           +ns || 0) + (data.usage.prompt_tokens || 0),                  
       580 +                    totalCompletionTokens: (prev?.totalComple
           +tionTokens || 0) + (data.usage.completion_tokens || 0),      
       581 +                    totalTokens: (prev?.totalTokens || 0) + (
           +data.usage.total_tokens || 0),                               
       582 +                    messageCount: (prev?.messageCount || 0) +
           + 1                                                           
       583 +                  }));                                       
       584 +                } else {                                     
       585 +                  // No usage data, but we still have duratio
           +n                                                            
       586 +                  setLastThinkingStats({ duration: thinkingDu
           +ration, totalTokens: 0 });                                   
       587 +                }                                            
       588 +                // Don't clear streaming states immediately -
           + let loadMessages handle it                                  
       589 +                // This prevents the thinking section from di
           +sappearing before the message is added                       
       590 +                loadMessages(chatId);                        
       591 +                loadChats();                                 
       592 +                // Clear streaming states after a short delay
           + to ensure smooth transition                                 
       593 +                setTimeout(() => {                           
       594 +                  setStreamingMessage('');                   
       595 +                  setStreamingReasoning('');                 
       596 +                }, 100);                                     
       597 +              } else if (data.type === 'error') {            
       598 +                alert('Error: ' + data.error);               
       599 +              }                                              
       600 +            } catch (e) {                                    
       601 +              console.error('Failed to parse SSE data:', e); 
       602 +            }                                                
       603 +          }                                                  
       604 +        }                                                    
       605 +      }                                                      
       606 +    } catch (error) {                                        
       607 +      if (error.name === 'AbortError') {                     
       608 +        console.log('Generation aborted');                   
       609 +      } else {                                               
       610 +        console.error('Failed to send message:', error);     
       611 +        alert(error.message || 'Failed to send message. Pleas
           +e check your API key configuration.');                       
       612 +      }                                                      
       613 +    } finally {                                              
       614 +      setStreaming(false);                                   
       615 +      abortControllerRef.current = null;                     
       616 +      isCreatingChatRef.current = false;                     
       617 +    }                                                        
       618 +  };                                                         
       619 +                                                             
       620 +  const renderMessage = (content) => {                       
       621 +    const html = DOMPurify.sanitize(marked(content || ''));  
       622 +    return <div className="markdown-content" dangerouslySetIn
           +nerHTML={{ __html: html }} />;                               
       623 +  };                                                         
       624 +                                                             
       625 +  const stripMarkdown = (text) => {                          
       626 +    if (!text) return '';                                    
       627 +    return text                                              
       628 +      .replace(/#{1,6}\s?/g, '')           // headers        
       629 +      .replace(/\*\*(.+?)\*\*/g, '$1')     // bold           
       630 +      .replace(/\*(.+?)\*/g, '$1')         // italic         
       631 +      .replace(/__(.+?)__/g, '$1')         // bold alt       
       632 +      .replace(/_(.+?)_/g, '$1')           // italic alt     
       633 +      .replace(/`{3}[\s\S]*?`{3}/g, '')    // code blocks    
       634 +      .replace(/`(.+?)`/g, '$1')           // inline code    
       635 +      .replace(/\[(.+?)\]\(.+?\)/g, '$1')  // links          
       636 +      .replace(/!\[.*?\]\(.+?\)/g, '')     // images         
       637 +      .replace(/^\s*[-*+]\s/gm, '')        // unordered lists
       638 +      .replace(/^\s*\d+\.\s/gm, '')        // ordered lists  
       639 +      .replace(/>\s?/g, '')                // blockquotes    
       640 +      .replace(/---/g, '')                 // horizontal rule
           +s                                                            
       641 +      .trim();                                               
       642 +  };                                                         
       643 +                                                             
       644 +  const handleCopy = async (messageId, content, type) => {   
       645 +    const textToCopy = type === 'raw' ? stripMarkdown(content
           +) : content;                                                 
       646 +    await navigator.clipboard.writeText(textToCopy);         
       647 +    setCopiedMessageId(`${messageId}-${type}`);              
       648 +    setTimeout(() => setCopiedMessageId(null), 2000);        
       649 +  };                                                         
       650 +                                                             
       651 +  const handleEditStart = (message) => {                     
       652 +    setEditingMessageId(message.id);                         
       653 +    setEditContent(message.content);                         
       654 +  };                                                         
       655 +                                                             
       656 +  const handleEditCancel = () => {                           
       657 +    setEditingMessageId(null);                               
       658 +    setEditContent('');                                      
       659 +  };                                                         
       660 +                                                             
       661 +  const handleEditSave = async (messageId) => {              
       662 +    if (!editContent.trim() || !currentChat) return;         
       663 +                                                             
       664 +    try {                                                    
       665 +      // 1. Delete branch from this message onward           
       666 +      const res = await fetch(`/api/messages/${messageId}/bra
           +nch`, {                                                      
       667 +        method: 'DELETE',                                    
       668 +        headers: {                                           
       669 +          'Authorization': `Bearer ${localStorage.getItem('to
           +ken')}`                                                      
       670 +        }                                                    
       671 +      });                                                    
       672 +                                                             
       673 +      if (!res.ok) throw new Error('Failed to delete message 
           +branch');                                                    
       674 +                                                             
       675 +      // 2. Trigger new message with edited content          
       676 +      // We manually call sendMessage implementation         
       677 +      const userMessage = editContent.trim();                
       678 +      setEditingMessageId(null);                             
       679 +      setEditContent('');                                    
       680 +      setStreaming(true);                                    
       681 +      setStreamingMessage('');                               
       682 +      setStreamingReasoning('');                             
       683 +      abortControllerRef.current = new AbortController();    
       684 +                                                             
       685 +      // Update UI: load messages again to show the deletion 
       686 +      await loadMessages(currentChat.id);                    
       687 +                                                             
       688 +      // Add temporary user message to UI for responsiveness 
       689 +      const tempUserMessage = {                              
       690 +        id: Date.now(),                                      
       691 +        role: 'user',                                        
       692 +        content: userMessage,                                
       693 +        created_at: new Date().toISOString()                 
       694 +      };                                                     
       695 +      setMessages(prev => [...prev, tempUserMessage]);       
       696 +                                                             
       697 +      // Trigger the API call to start regeneration          
       698 +      const sendRes = await fetch(`/api/messages/${currentCha
           +t.id}`, {                                                    
       699 +        method: 'POST',                                      
       700 +        headers: {                                           
       701 +          'Content-Type': 'application/json',                
       702 +          'Authorization': `Bearer ${localStorage.getItem('to
           +ken')}`                                                      
       703 +        },                                                   
       704 +        body: JSON.stringify({ content: userMessage }),      
       705 +        signal: abortControllerRef.current.signal            
       706 +      });                                                    
       707 +                                                             
       708 +      if (!sendRes.ok) {                                     
       709 +        const errorData = await sendRes.json();              
       710 +        throw new Error(errorData.error || 'Failed to send me
           +ssage');                                                     
       711 +      }                                                      
       712 +                                                             
       713 +      const reader = sendRes.body.getReader();               
       714 +      const decoder = new TextDecoder();                     
       715 +      let buffer = '';                                       
       716 +                                                             
       717 +      while (true) {                                         
       718 +        const { done, value } = await reader.read();         
       719 +        if (done) break;                                     
       720 +                                                             
       721 +        buffer += decoder.decode(value, { stream: true });   
       722 +        const lines = buffer.split('\n');                    
       723 +        buffer = lines.pop();                                
       724 +                                                             
       725 +        for (const line of lines) {                          
       726 +          if (line.startsWith('data: ')) {                   
       727 +            try {                                            
       728 +              const data = JSON.parse(line.slice(6));        
       729 +              if (data.type === 'reasoning') {               
       730 +                setStreamingReasoning(prev => prev + data.con
           +tent);                                                       
       731 +              } else if (data.type === 'content') {          
       732 +                setStreamingMessage(prev => prev + data.conte
           +nt);                                                         
       733 +              } else if (data.type === 'done') {             
       734 +                // Calculate thinking duration               
       735 +                const thinkingDuration = thinkingStartTime ? 
           +(Date.now() - thinkingStartTime) / 1000 : 0;                 
       736 +                                                             
       737 +                if (data.usage) {                            
       738 +                  const stats = {                            
       739 +                    promptTokens: data.usage.prompt_tokens ||
           + 0,                                                          
       740 +                    completionTokens: data.usage.completion_t
           +okens || 0,                                                  
       741 +                    totalTokens: data.usage.total_tokens || 0
           +,                                                            
       742 +                    model: data.model,                       
       743 +                    duration: thinkingDuration,              
       744 +                    cost: data.cost || 0                     
       745 +                  };                                         
       746 +                  setLastThinkingStats(stats);               
       747 +                  setUsageStats(prev => ({                   
       748 +                    ...prev,                                 
       749 +                    lastMessage: stats,                      
       750 +                    totalPromptTokens: (prev?.totalPromptToke
           +ns || 0) + (data.usage.prompt_tokens || 0),                  
       751 +                    totalCompletionTokens: (prev?.totalComple
           +tionTokens || 0) + (data.usage.completion_tokens || 0),      
       752 +                    totalTokens: (prev?.totalTokens || 0) + (
           +data.usage.total_tokens || 0),                               
       753 +                    messageCount: (prev?.messageCount || 0) +
           + 1                                                           
       754 +                  }));                                       
       755 +                } else {                                     
       756 +                  setLastThinkingStats({ duration: thinkingDu
           +ration, totalTokens: 0 });                                   
       757 +                }                                            
       758 +                loadMessages(currentChat.id);                
       759 +                loadChats();                                 
       760 +                setTimeout(() => {                           
       761 +                  setStreamingMessage('');                   
       762 +                  setStreamingReasoning('');                 
       763 +                }, 100);                                     
       764 +              } else if (data.type === 'error') {            
       765 +                alert('Error: ' + data.error);               
       766 +              }                                              
       767 +            } catch (e) {                                    
       768 +              console.error('Failed to parse SSE data:', e); 
       769 +            }                                                
       770 +          }                                                  
       771 +        }                                                    
       772 +      }                                                      
       773 +    } catch (error) {                                        
       774 +      if (error.name === 'AbortError') {                     
       775 +        console.log('Generation aborted');                   
       776 +      } else {                                               
       777 +        console.error('Failed to edit message:', error);     
       778 +        alert('Failed to edit message: ' + error.message);   
       779 +      }                                                      
       780 +      setStreaming(false);                                   
       781 +    }                                                        
       782 +  };                                                         
       783 +                                                             
       784 +  return (                                                   
       785 +    <div className="flex h-screen bg-dark-950 bg-mesh">      
       786 +      {/* Sidebar */}                                        
       787 +      <div className={`${showSidebar ? 'w-72' : 'w-16'} trans
           +ition-all duration-300 ease-out glass-sidebar flex flex-col o
           +verflow-hidden`}>                                            
       788 +        <div className={`${showSidebar ? 'p-5' : 'p-2'} borde
           +r-b border-dark-700/50`}>                                    
       789 +          <div className={`flex items-center ${showSidebar ? 
           +'justify-between mb-5' : 'justify-center mb-2'}`}>           
       790 +            {showSidebar ? (                                 
       791 +              <>                                             
       792 +                <div className="flex items-center gap-3">    
       793 +                  <div className="relative">                 
       794 +                    <div className="w-10 h-10 rounded-xl bg-p
           +rimary-500 flex items-center justify-center">                
       795 +                      <MessageSquare className="w-5 h-5 text-
           +white" />                                                    
       796 +                    </div>                                   
       797 +                    <div className="absolute -bottom-0.5 -rig
           +ht-0.5 w-3 h-3 bg-green-500 rounded-full border-2 border-dark
           +-850"></div>                                                 
       798 +                  </div>                                     
       799 +                  <div>                                      
       800 +                    <h1 className="font-bold text-lg text-pri
           +mary-400 tracking-tight">AI Chat Hub</h1>                    
       801 +                    <p className="text-xs text-dark-400 font-
           +medium">{user?.name}</p>                                     
       802 +                  </div>                                     
       803 +                </div>                                       
       804 +                <button                                      
       805 +                  onClick={() => setShowSidebar(false)}      
       806 +                  className="p-2 hover:bg-dark-700/50 rounded
           +-xl transition-all duration-200"                             
       807 +                  title="Collapse sidebar"                   
       808 +                >                                            
       809 +                  <ChevronRight className="w-5 h-5 text-dark-
           +400" />                                                      
       810 +                </button>                                    
       811 +              </>                                            
       812 +            ) : (                                            
       813 +              <button                                        
       814 +                onClick={() => setShowSidebar(true)}         
       815 +                className="p-2 hover:bg-dark-700/50 rounded-x
           +l transition-all duration-200"                               
       816 +                title="Expand sidebar"                       
       817 +              >                                              
       818 +                <Menu className="w-5 h-5 text-dark-400" />   
       819 +              </button>                                      
       820 +            )}                                               
       821 +          </div>                                             
       822 +                                                             
       823 +          <button                                            
       824 +            onClick={createNewChat}                          
       825 +            className={`${showSidebar ? 'w-full py-3 gap-2' :
           + 'w-10 h-10 mx-auto'} bg-primary-500 hover:bg-primary-600 tex
           +t-white rounded-xl font-semibold transition-all duration-200 
           +flex items-center justify-center active:scale-[0.98]`}       
       826 +            title={showSidebar ? undefined : "New Chat"}     
       827 +          >                                                  
       828 +            <Plus className="w-4 h-4" />                     
       829 +            {showSidebar && "New Chat"}                      
       830 +          </button>                                          
       831 +        </div>                                               
       832 +                                                             
       833 +        <div className={`flex-1 overflow-y-auto ${showSidebar
           + ? 'p-3 space-y-1' : 'p-2 space-y-1'}`}>                     
       834 +          {chats.length === 0 && showSidebar && (            
       835 +            <div className="text-center py-8 px-4">          
       836 +              <div className="w-12 h-12 rounded-xl bg-dark-80
           +0 flex items-center justify-center mx-auto mb-3">            
       837 +                <MessageSquare className="w-6 h-6 text-dark-5
           +00" />                                                       
       838 +              </div>                                         
       839 +              <p className="text-sm text-dark-400">No chats y
           +et</p>                                                       
       840 +              <p className="text-xs text-dark-500 mt-1">Creat
           +e a new chat to get started</p>                              
       841 +            </div>                                           
       842 +          )}                                                 
       843 +          {chats.map(chat => (                               
       844 +            <div                                             
       845 +              key={chat.id}                                  
       846 +              className={`group ${showSidebar ? 'p-3' : 'p-2'
           +} rounded-xl cursor-pointer transition-all duration-200 ${cur
           +rentChat?.id === chat.id                                     
       847 +                ? 'bg-dark-700 border-l-2 border-primary-500'
       848 +                : 'hover:bg-dark-700/50 border-l-2 border-tra
           +nsparent'                                                    
       849 +                }`}                                          
       850 +              onClick={() => setCurrentChat(chat)}           
       851 +              title={showSidebar ? undefined : chat.title}   
       852 +            >                                                
       853 +              {showSidebar ? (                               
       854 +                <div className="flex items-start justify-betw
           +een gap-2">                                                  
       855 +                  <div className="flex-1 min-w-0">           
       856 +                    <p className={`font-medium text-sm trunca
           +te ${currentChat?.id === chat.id ? 'text-dark-50' : 'text-dar
           +k-200'}`}>{chat.title}</p>                                   
       857 +                    <div className="flex items-center gap-2 m
           +t-1.5">                                                      
       858 +                      <span className="text-xs text-dark-500"
           +>{chat.message_count} messages</span>                        
       859 +                      {chat.agent_mode === 1 && (            
       860 +                        <span className="inline-flex items-ce
           +nter gap-1 px-1.5 py-0.5 rounded-md bg-primary-500/10 text-pr
           +imary-400 text-[10px] font-medium">                          
       861 +                          <Zap className="w-2.5 h-2.5" />    
       862 +                          Agent                              
       863 +                        </span>                              
       864 +                      )}                                     
       865 +                    </div>                                   
       866 +                  </div>                                     
       867 +                                                             
       868 +                  <div className="flex items-center gap-1">  
       869 +                    {deletingChatId === chat.id ? (          
       870 +                      <>                                     
       871 +                        <button                              
       872 +                          onClick={(e) => {                  
       873 +                            e.stopPropagation();             
       874 +                            deleteChat(chat.id);             
       875 +                          }}                                 
       876 +                          className="p-1.5 bg-green-500/10 ho
           +ver:bg-green-500/20 rounded-lg transition-all"               
       877 +                          title="Confirm Delete"             
       878 +                        >                                    
       879 +                          <Check className="w-3.5 h-3.5 text-
           +green-400" />                                                
       880 +                        </button>                            
       881 +                        <button                              
       882 +                          onClick={(e) => {                  
       883 +                            e.stopPropagation();             
       884 +                            setDeletingChatId(null);         
       885 +                          }}                                 
       886 +                          className="p-1.5 bg-red-500/10 hove
           +r:bg-red-500/20 rounded-lg transition-all"                   
       887 +                          title="Cancel"                     
       888 +                        >                                    
       889 +                          <X className="w-3.5 h-3.5 text-red-
           +400" />                                                      
       890 +                        </button>                            
       891 +                      </>                                    
       892 +                    ) : (                                    
       893 +                      <button                                
       894 +                        onClick={(e) => {                    
       895 +                          e.stopPropagation();               
       896 +                          setDeletingChatId(chat.id);        
       897 +                        }}                                   
       898 +                        className="opacity-0 group-hover:opac
           +ity-100 p-1.5 hover:bg-red-500/10 rounded-lg transition-all" 
       899 +                        title="Delete Chat"                  
       900 +                      >                                      
       901 +                        <Trash2 className="w-3.5 h-3.5 text-d
           +ark-400 hover:text-red-400" />                               
       902 +                      </button>                              
       903 +                    )}                                       
       904 +                  </div>                                     
       905 +                </div>                                       
       906 +              ) : (                                          
       907 +                <div className="flex justify-center">        
       908 +                  <MessageSquare className={`w-5 h-5 ${curren
           +tChat?.id === chat.id ? 'text-primary-400' : 'text-dark-400'}
           +`} />                                                        
       909 +                </div>                                       
       910 +              )}                                             
       911 +            </div>                                           
       912 +          ))}                                                
       913 +        </div>                                               
       914 +                                                             
       915 +        <div className={`${showSidebar ? 'p-3' : 'p-2'} borde
           +r-t border-dark-700/50 space-y-1`}>                          
       916 +          <button                                            
       917 +            onClick={() => navigate('/memories')}            
       918 +            className={`${showSidebar ? 'w-full px-4 gap-3' :
           + 'w-10 h-10 mx-auto'} flex items-center justify-center py-2.5
           + rounded-xl glass-button transition-all text-sm font-medium t
           +ext-dark-300 hover:text-dark-100`}                           
       919 +            title={showSidebar ? undefined : "Memories"}     
       920 +          >                                                  
       921 +            <Brain className="w-4 h-4 text-accent-400" />    
       922 +            {showSidebar && "Memories"}                      
       923 +          </button>                                          
       924 +          <button                                            
       925 +            onClick={() => navigate('/settings')}            
       926 +            className={`${showSidebar ? 'w-full px-4 gap-3' :
           + 'w-10 h-10 mx-auto'} flex items-center justify-center py-2.5
           + rounded-xl glass-button transition-all text-sm font-medium t
           +ext-dark-300 hover:text-dark-100`}                           
       927 +            title={showSidebar ? undefined : "Settings"}     
       928 +          >                                                  
       929 +            <SettingsIcon className="w-4 h-4 text-dark-400" /
           +>                                                            
       930 +            {showSidebar && "Settings"}                      
       931 +          </button>                                          
       932 +          {user?.is_admin && (                               
       933 +            <button                                          
       934 +              onClick={() => navigate('/admin')}             
       935 +              className={`${showSidebar ? 'w-full px-4 gap-3'
           + : 'w-10 h-10 mx-auto'} flex items-center justify-center py-2
           +.5 rounded-xl glass-button transition-all text-sm font-medium
           + text-primary-400 hover:text-primary-300`}                   
       936 +              title={showSidebar ? undefined : "Admin Panel"}
       937 +            >                                                
       938 +              <Sparkles className="w-4 h-4" />               
       939 +              {showSidebar && "Admin Panel"}                 
       940 +            </button>                                        
       941 +          )}                                                 
       942 +          {showSidebar && <div className="divider-gradient my
           +-2"></div>}                                                  
       943 +          <button                                            
       944 +            onClick={logout}                                 
       945 +            className={`${showSidebar ? 'w-full px-4 gap-3' :
           + 'w-10 h-10 mx-auto'} flex items-center justify-center py-2.5
           + rounded-xl hover:bg-red-500/10 transition-all text-sm font-m
           +edium text-dark-400 hover:text-red-400`}                     
       946 +            title={showSidebar ? undefined : "Logout"}       
       947 +          >                                                  
       948 +            <LogOut className="w-4 h-4" />                   
       949 +            {showSidebar && "Logout"}                        
       950 +          </button>                                          
       951 +        </div>                                               
       952 +      </div>                                                 
       953 +                                                             
       954 +      {/* Main Chat Area */}                                 
       955 +      <div className="flex-1 flex flex-col min-w-0">         
       956 +        {/* Header */}                                       
       957 +        <div className="bg-dark-850 border-b border-dark-700/
           +50 px-4 py-3 flex items-center justify-between relative z-50 
           +overflow-visible">                                           
       958 +          <div className="flex items-center gap-3">          
       959 +            {/* Chat Title and Model Selector */}            
       960 +            {currentChat ? (                                 
       961 +              <>                                             
       962 +                <h2 className="text-base font-semibold text-d
           +ark-100">{currentChat.title}</h2>                            
       963 +                <div className="h-4 w-px bg-dark-700"></div> 
       964 +                <ModelSelector                               
       965 +                  selectedModel={chatSettings.model}         
       966 +                  onModelChange={handleModelChange}          
       967 +                  isDropdown={true}                          
       968 +                />                                           
       969 +                {chatSettings.agent_mode && (                
       970 +                  <span className="flex items-center gap-1.5 
           +px-3 py-1.5 bg-primary-500/10 text-primary-400 rounded-lg tex
           +t-xs font-semibold border border-primary-500/20">            
       971 +                    <Zap className="w-3 h-3" />              
       972 +                    Agent Mode                               
       973 +                  </span>                                    
       974 +                )}                                           
       975 +              </>                                            
       976 +            ) : (                                            
       977 +              <p className="text-dark-500 text-sm">Select a c
           +hat or create a new one</p>                                  
       978 +            )}                                               
       979 +          </div>                                             
       980 +                                                             
       981 +          {currentChat && (                                  
       982 +            <div className="flex items-center gap-2 overflow-
           +visible">                                                    
       983 +              <div className="relative overflow-visible" ref=
           +{statsPopupRef}>                                             
       984 +                <button                                      
       985 +                  onClick={() => setShowInfoModal(!showInfoMo
           +dal)}                                                        
       986 +                  className={`p-2 rounded-xl transition-all d
           +uration-200 ${showInfoModal                                  
       987 +                    ? 'bg-primary-500/10 text-primary-400 bor
           +der border-primary-500/20'                                   
       988 +                    : 'glass-button text-dark-400 hover:text-
           +dark-200'                                                    
       989 +                    }`}                                      
       990 +                  title="Usage Stats"                        
       991 +                >                                            
       992 +                  <Info className="w-4 h-4" />               
       993 +                </button>                                    
       994 +                                                             
       995 +                {/* Usage Stats Panel */}                    
       996 +                {showInfoModal && (                          
       997 +                  <div className="fixed top-14 right-4 w-80 b
           +g-dark-900 border border-dark-700 rounded-xl z-[100] shadow-2
           +xl scale-in">                                                
       998 +                    <div className="p-3 border-b border-dark-
           +700">                                                        
       999 +                      <h4 className="text-sm font-semibold te
           +xt-dark-200 flex items-center gap-2">                        
      1000 +                        <Hash className="w-3.5 h-3.5 text-pri
           +mary-400" />                                                 
      1001 +                        Chat Stats                           
      1002 +                      </h4>                                  
      1003 +                    </div>                                   
      1004 +                                                             
      1005 +                    <div className="p-3 space-y-3">          
      1006 +                      {/* Current Model */}                  
      1007 +                      <div className="p-2 rounded-lg bg-dark-
           +800">                                                        
      1008 +                        <p className="text-dark-500 text-xs m
           +b-1">Current Model</p>                                       
      1009 +                        <p className="text-sm font-medium tex
           +t-dark-200 truncate">{chatSettings.model}</p>                
      1010 +                      </div>                                 
      1011 +                                                             
      1012 +                      {/* Conversation Stats */}             
      1013 +                      <div className="grid grid-cols-2 gap-2 
           +text-xs">                                                    
      1014 +                        <div className="p-2 rounded-lg bg-dar
           +k-800">                                                      
      1015 +                          <p className="text-dark-500">Messag
           +es</p>                                                       
      1016 +                          <p className="text-sm font-semibold
           + text-dark-200">{messages.length}</p>                        
      1017 +                        </div>                               
      1018 +                        <div className="p-2 rounded-lg bg-dar
           +k-800">                                                      
      1019 +                          <p className="text-dark-500">AI Res
           +ponses</p>                                                   
      1020 +                          <p className="text-sm font-semibold
           + text-primary-400">{messages.filter(m => m.role === 'assistan
           +t').length}</p>                                              
      1021 +                        </div>                               
      1022 +                      </div>                                 
      1023 +                                                             
      1024 +                      {/* Token Usage - from persisted data *
           +/}                                                           
      1025 +                      {chatTotals.totalTokens > 0 && (       
      1026 +                        <div className="border-t border-dark-
           +700 pt-3">                                                   
      1027 +                          <p className="text-dark-500 text-xs
           + mb-2">Chat Token Usage</p>                                  
      1028 +                          <div className="space-y-1.5 text-xs
           +">                                                           
      1029 +                            <div className="flex justify-betw
           +een">                                                        
      1030 +                              <span className="text-dark-400"
           +>Total Cost</span>                                           
      1031 +                              <span className="font-semibold 
           +text-primary-400">                                           
      1032 +                                ${chatTotals.totalCost.toFixe
           +d(2)}                                                        
      1033 +                              </span>                        
      1034 +                            </div>                           
      1035 +                          </div>                             
      1036 +                                                             
      1037 +                          {/* Token Bar with USED/CONTEXT lab
           +el */}                                                       
      1038 +                          {(() => {                          
      1039 +                            const contextLimit = getModelCont
           +ext(chatSettings.model);                                     
      1040 +                            const inputPercent = (chatTotals.
           +totalPromptTokens / contextLimit) * 100;                     
      1041 +                            const outputPercent = (chatTotals
           +.totalCompletionTokens / contextLimit) * 100;                
      1042 +                            const freePercent = Math.max(0, 1
           +00 - inputPercent - outputPercent);                          
      1043 +                            return (                         
      1044 +                              <>                             
      1045 +                                <div className="flex justify-
           +between mt-3 mb-1 text-xs">                                  
      1046 +                                  <span className="text-dark-
           +400">Tokens Used</span>                                      
      1047 +                                  <span className="font-mediu
           +m text-dark-200">                                            
      1048 +                                    {chatTotals.totalTokens.t
           +oLocaleString()}                                             
      1049 +                                    <span className="text-dar
           +k-500"> / {contextLimit.toLocaleString()}</span>             
      1050 +                                  </span>                    
      1051 +                                </div>                       
      1052 +                                <div className="h-2 bg-dark-7
           +00 rounded-full overflow-hidden flex">                       
      1053 +                                  <div                       
      1054 +                                    className="h-full bg-prim
           +ary-500"                                                     
      1055 +                                    style={{ width: `${inputP
           +ercent}%` }}                                                 
      1056 +                                    title={`Input: ${chatTota
           +ls.totalPromptTokens.toLocaleString()}`}                     
      1057 +                                  />                         
      1058 +                                  <div                       
      1059 +                                    className="h-full bg-acce
           +nt-500"                                                      
      1060 +                                    style={{ width: `${output
           +Percent}%` }}                                                
      1061 +                                    title={`Output: ${chatTot
           +als.totalCompletionTokens.toLocaleString()}`}                
      1062 +                                  />                         
      1063 +                                  <div                       
      1064 +                                    className="h-full bg-dark
           +-600"                                                        
      1065 +                                    style={{ width: `${freePe
           +rcent}%` }}                                                  
      1066 +                                    title={`Free: ${(contextL
           +imit - chatTotals.totalTokens).toLocaleString()}`}           
      1067 +                                  />                         
      1068 +                                </div>                       
      1069 +                                <div className="flex justify-
           +between mt-1 text-[10px] text-dark-500">                     
      1070 +                                  <div className="flex items-
           +center gap-2">                                               
      1071 +                                    <span className="flex ite
           +ms-center gap-1">                                            
      1072 +                                      <span className="w-2 h-
           +2 rounded-full bg-primary-500"></span>                       
      1073 +                                      Input ({chatTotals.tota
           +lPromptTokens.toLocaleString()})                             
      1074 +                                    </span>                  
      1075 +                                    <span className="flex ite
           +ms-center gap-1">                                            
      1076 +                                      <span className="w-2 h-
           +2 rounded-full bg-accent-500"></span>                        
      1077 +                                      Output ({chatTotals.tot
           +alCompletionTokens.toLocaleString()})                        
      1078 +                                    </span>                  
      1079 +                                  </div>                     
      1080 +                                  <span className="flex items
           +-center gap-1">                                              
      1081 +                                    <span className="w-2 h-2 
           +rounded-full bg-dark-600"></span>                            
      1082 +                                    Free                     
      1083 +                                  </span>                    
      1084 +                                </div>                       
      1085 +                              </>                            
      1086 +                            );                               
      1087 +                          })()}                              
      1088 +                        </div>                               
      1089 +                      )}                                     
      1090 +                                                             
      1091 +                      {/* No token data message - only show i
           +f no persisted data */}                                      
      1092 +                      {chatTotals.totalTokens === 0 && messag
           +es.length > 0 && (                                           
      1093 +                        <p className="text-[10px] text-dark-5
           +00 text-center pt-2 border-t border-dark-700">               
      1094 +                          Token usage will appear after sendi
           +ng messages                                                  
      1095 +                        </p>                                 
      1096 +                      )}                                     
      1097 +                    </div>                                   
      1098 +                  </div>                                     
      1099 +                )}                                           
      1100 +              </div>                                         
      1101 +              <button                                        
      1102 +                onClick={() => setShowSettings(!showSettings)
           +}                                                            
      1103 +                className={`px-4 py-2 flex items-center gap-2
           + rounded-xl transition-all duration-200 text-sm font-medium $
           +{showSettings                                                
      1104 +                  ? 'bg-primary-500/10 text-primary-400 borde
           +r border-primary-500/20'                                     
      1105 +                  : 'glass-button text-dark-300 hover:text-da
           +rk-100'                                                      
      1106 +                  }`}                                        
      1107 +              >                                              
      1108 +                <SettingsIcon className="w-4 h-4" />         
      1109 +                Settings                                     
      1110 +              </button>                                      
      1111 +            </div>                                           
      1112 +          )}                                                 
      1113 +        </div>                                               
      1114 +                                                             
      1115 +        {/* Settings Panel */}                               
      1116 +        {showSettings && currentChat && (                    
      1117 +          <div className="bg-dark-850 border-b border-dark-70
           +0/50 p-6 scale-in">                                          
      1118 +            <div className="max-w-2xl mx-auto space-y-5">    
      1119 +              <div className="grid grid-cols-1 md:grid-cols-2
           + gap-5">                                                     
      1120 +                <div>                                        
      1121 +                  <label className="block text-sm font-medium
           + text-dark-300 mb-2">                                        
      1122 +                    Model                                    
      1123 +                  </label>                                   
      1124 +                  <ModelSelector                             
      1125 +                    selectedModel={chatSettings.model}       
      1126 +                    onModelChange={handleModelChange}        
      1127 +                    isDropdown={true}                        
      1128 +                  />                                         
      1129 +                </div>                                       
      1130 +                                                             
      1131 +                <div>                                        
      1132 +                  <label className="block text-sm font-medium
           + text-dark-300 mb-2">                                        
      1133 +                    Temperature                              
      1134 +                    <span className="ml-2 px-2 py-0.5 bg-dark
           +-800 rounded-md text-xs text-primary-400 font-mono">         
      1135 +                      {chatSettings.temperature}             
      1136 +                    </span>                                  
      1137 +                  </label>                                   
      1138 +                  <div className="pt-2">                     
      1139 +                    <input                                   
      1140 +                      type="range"                           
      1141 +                      min="0"                                
      1142 +                      max="2"                                
      1143 +                      step="0.1"                             
      1144 +                      value={chatSettings.temperature}       
      1145 +                      onChange={(e) => setChatSettings({ ...c
           +hatSettings, temperature: parseFloat(e.target.value) })}     
      1146 +                      className="w-full"                     
      1147 +                    />                                       
      1148 +                    <div className="flex justify-between text
           +-xs text-dark-500 mt-1">                                     
      1149 +                      <span>Precise</span>                   
      1150 +                      <span>Creative</span>                  
      1151 +                    </div>                                   
      1152 +                  </div>                                     
      1153 +                </div>                                       
      1154 +              </div>                                         
      1155 +                                                             
      1156 +              <div>                                          
      1157 +                <label className="block text-sm font-medium t
           +ext-dark-300 mb-2">                                          
      1158 +                  System Prompt                              
      1159 +                </label>                                     
      1160 +                <textarea                                    
      1161 +                  value={chatSettings.system_prompt}         
      1162 +                  onChange={(e) => setChatSettings({ ...chatS
           +ettings, system_prompt: e.target.value })}                   
      1163 +                  className="w-full px-4 py-3 rounded-xl glas
           +s-input outline-none resize-none text-dark-100 placeholder-da
           +rk-500 text-sm font-mono"                                    
      1164 +                  rows="3"                                   
      1165 +                  placeholder="Set a custom system prompt for
           + this chat..."                                               
      1166 +                />                                           
      1167 +              </div>                                         
      1168 +                                                             
      1169 +              <div className="flex items-center justify-betwe
           +en pt-2">                                                    
      1170 +                <label className="flex items-center gap-3 cur
           +sor-pointer group">                                          
      1171 +                  <input                                     
      1172 +                    type="checkbox"                          
      1173 +                    checked={chatSettings.agent_mode}        
      1174 +                    onChange={(e) => setChatSettings({ ...cha
           +tSettings, agent_mode: e.target.checked })}                  
      1175 +                    className="w-5 h-5 rounded-md"           
      1176 +                  />                                         
      1177 +                  <span className="text-sm font-medium text-d
           +ark-300 flex items-center gap-2 group-hover:text-dark-200 tra
           +nsition-colors">                                             
      1178 +                    <Zap className="w-4 h-4 text-accent-400" 
           +/>                                                           
      1179 +                    Enable Agent Mode                        
      1180 +                    <span className="text-xs text-dark-500">(
           +with tools)</span>                                           
      1181 +                  </span>                                    
      1182 +                </label>                                     
      1183 +                                                             
      1184 +                <button                                      
      1185 +                  onClick={updateChatSettings}               
      1186 +                  className="px-5 py-2.5 bg-primary-500 hover
           +:bg-primary-600 text-white rounded-xl font-semibold transitio
           +n-all duration-200 active:scale-[0.98]"                      
      1187 +                >                                            
      1188 +                  Save Settings                              
      1189 +                </button>                                    
      1190 +              </div>                                         
      1191 +            </div>                                           
      1192 +          </div>                                             
      1193 +        )}                                                   
      1194 +                                                             
      1195 +        {/* Messages */}                                     
      1196 +        <div                                                 
      1197 +          ref={messagesContainerRef}                         
      1198 +          onScroll={handleMessagesScroll}                    
      1199 +          className="flex-1 overflow-y-auto p-6 relative z-0"
      1200 +        >                                                    
      1201 +          {currentChat && (                                  
      1202 +            <div className="max-w-2xl mx-auto space-y-6">    
      1203 +              {messages.length === 0 && !streaming && (      
      1204 +                <div className="text-center py-16 fade-in">  
      1205 +                  <div className="relative inline-block mb-6"
           +>                                                            
      1206 +                    <div className="w-16 h-16 rounded-2xl bg-
           +primary-500 flex items-center justify-center">               
      1207 +                      <Bot className="w-8 h-8 text-white" /> 
      1208 +                    </div>                                   
      1209 +                  </div>                                     
      1210 +                  <h3 className="text-2xl font-bold text-dark
           +-100 mb-3 tracking-tight">Start a conversation</h3>          
      1211 +                  <p className="text-dark-400 max-w-sm mx-aut
           +o">Type a message below to begin chatting with AI. I'm here t
           +o help with anything you need.</p>                           
      1212 +                </div>                                       
      1213 +              )}                                             
      1214 +                                                             
      1215 +              {messages.map((message, index) => (            
      1216 +                <div                                         
      1217 +                  key={message.id}                           
      1218 +                  className={`${message.role === 'user' ? 'pl
           +-8' : 'pr-8'}`}                                              
      1219 +                >                                            
      1220 +                  {message.role === 'assistant' && message.re
           +asoning_content && (                                         
      1221 +                    <ThinkingSection                         
      1222 +                      reasoning={message.reasoning_content}  
      1223 +                      isExpanded={expandedThinkingSections.ha
           +s(message.id)}                                               
      1224 +                      onToggle={() => toggleThinkingSection(m
           +essage.id)}                                                  
      1225 +                      isStreaming={false}                    
      1226 +                      elapsedTime={0}                        
      1227 +                      stats={null}                           
      1228 +                    />                                       
      1229 +                  )}                                         
      1230 +                  <div className={`${message.role === 'user' 
      1231 +                    ? 'bg-dark-800 border-l-2 border-primary-
           +500/50 rounded-lg px-4 py-3'                                 
      1232 +                    : 'bg-dark-850/50 rounded-lg px-4 py-3'  
      1233 +                    }`}>                                     
      1234 +                    <div className="flex items-center gap-2 m
           +b-2">                                                        
      1235 +                      {message.role === 'user' ? (           
      1236 +                        <>                                   
      1237 +                          <UserIcon className="w-4 h-4 text-p
           +rimary-400" />                                               
      1238 +                          <span className="text-xs font-mediu
           +m text-primary-400">You</span>                               
      1239 +                        </>                                  
      1240 +                      ) : (                                  
      1241 +                        <>                                   
      1242 +                          <Bot className="w-4 h-4 text-dark-4
           +00" />                                                       
      1243 +                          <span className="text-xs font-mediu
           +m text-dark-400">Assistant</span>                            
      1244 +                        </>                                  
      1245 +                      )}                                     
      1246 +                    </div>                                   
      1247 +                    {message.role === 'user' ? (             
      1248 +                      editingMessageId === message.id ? (    
      1249 +                        <div className="space-y-2">          
      1250 +                          <textarea                          
      1251 +                            value={editContent}              
      1252 +                            onChange={(e) => setEditContent(e
           +.target.value)}                                              
      1253 +                            className="w-full bg-dark-900 bor
           +der border-dark-700 rounded-lg p-2 text-white resize-none foc
           +us:outline-none focus:border-primary-500/50"                 
      1254 +                            rows={3}                         
      1255 +                            autoFocus                        
      1256 +                          />                                 
      1257 +                          <div className="flex gap-2 justify-
           +end">                                                        
      1258 +                            <button                          
      1259 +                              onClick={handleEditCancel}     
      1260 +                              className="px-3 py-1 text-xs ro
           +unded-lg bg-dark-700 hover:bg-dark-600 transition-colors"    
      1261 +                            >                                
      1262 +                              Cancel                         
      1263 +                            </button>                        
      1264 +                            <button                          
      1265 +                              onClick={() => handleEditSave(m
           +essage.id)}                                                  
      1266 +                              className="px-3 py-1 text-xs ro
           +unded-lg bg-primary-500 hover:bg-primary-600 transition-color
           +s"                                                           
      1267 +                            >                                
      1268 +                              Save & Regenerate              
      1269 +                            </button>                        
      1270 +                          </div>                             
      1271 +                        </div>                               
      1272 +                      ) : (                                  
      1273 +                        renderMessage(message.content)       
      1274 +                      )                                      
      1275 +                    ) : (                                    
      1276 +                      renderMessage(message.content)         
      1277 +                    )}                                       
      1278 +                  </div>                                     
      1279 +                                                             
      1280 +                  {message.role === 'user' && editingMessageI
           +d !== message.id && (                                        
      1281 +                    <div className="mt-2 flex gap-3 pl-4">   
      1282 +                      <button                                
      1283 +                        onClick={() => handleCopy(message.id,
           + message.content, 'raw')}                                    
      1284 +                        className="text-xs text-dark-500 hove
           +r:text-primary-400 flex items-center gap-1 transition-colors"
      1285 +                      >                                      
      1286 +                        {copiedMessageId === `${message.id}-r
           +aw` ? <Check className="w-3 h-3" /> : <Copy className="w-3 h-
           +3" />}                                                       
      1287 +                        {copiedMessageId === `${message.id}-r
           +aw` ? 'Copied' : 'Copy'}                                     
      1288 +                      </button>                              
      1289 +                      <button                                
      1290 +                        onClick={() => handleEditStart(messag
           +e)}                                                          
      1291 +                        className="text-xs text-dark-500 hove
           +r:text-primary-400 flex items-center gap-1 transition-colors"
      1292 +                      >                                      
      1293 +                        <Pencil className="w-3 h-3" />       
      1294 +                        Edit                                 
      1295 +                      </button>                              
      1296 +                    </div>                                   
      1297 +                  )}                                         
      1298 +                                                             
      1299 +                  {message.role === 'assistant' && (         
      1300 +                    <div className="mt-2 flex gap-3 pl-4 item
           +s-center">                                                   
      1301 +                      <button                                
      1302 +                        onClick={() => handleCopy(message.id,
           + message.content, 'raw')}                                    
      1303 +                        className="text-xs text-dark-500 hove
           +r:text-primary-400 flex items-center gap-1 transition-colors"
      1304 +                      >                                      
      1305 +                        {copiedMessageId === `${message.id}-r
           +aw` ? <Check className="w-3 h-3" /> : <Copy className="w-3 h-
           +3" />}                                                       
      1306 +                        {copiedMessageId === `${message.id}-r
           +aw` ? 'Copied' : 'Copy Raw'}                                 
      1307 +                      </button>                              
      1308 +                      <button                                
      1309 +                        onClick={() => handleCopy(message.id,
           + message.content, 'markdown')}                               
      1310 +                        className="text-xs text-dark-500 hove
           +r:text-primary-400 flex items-center gap-1 transition-colors"
      1311 +                      >                                      
      1312 +                        {copiedMessageId === `${message.id}-m
           +arkdown` ? <Check className="w-3 h-3" /> : <Copy className="w
           +-3 h-3" />}                                                  
      1313 +                        {copiedMessageId === `${message.id}-m
           +arkdown` ? 'Copied' : 'Copy MD'}                             
      1314 +                      </button>                              
      1315 +                      <button                                
      1316 +                        onClick={() => openForkModal(message.
           +id)}                                                         
      1317 +                        className="text-xs text-dark-500 hove
           +r:text-primary-400 flex items-center gap-1 transition-colors"
      1318 +                      >                                      
      1319 +                        <GitBranch className="w-3 h-3" />    
      1320 +                        Fork                                 
      1321 +                      </button>                              
      1322 +                                                             
      1323 +                      {/* Details hover - show if message has
           + stats */}                                                   
      1324 +                      {(message.prompt_tokens || message.resp
           +onse_time_ms || message.cost > 0) && (                       
      1325 +                        <div className="group relative">     
      1326 +                          <button className="text-xs text-dar
           +k-500 hover:text-primary-400 flex items-center gap-1 transiti
           +on-colors">                                                  
      1327 +                            <Info className="w-3 h-3" />     
      1328 +                          </button>                          
      1329 +                          <div className="absolute bottom-ful
           +l left-0 mb-1 hidden group-hover:block z-10">                
      1330 +                            <div className="bg-dark-800 borde
           +r border-dark-700 rounded-lg px-3 py-2 text-xs whitespace-now
           +rap shadow-xl">                                              
      1331 +                              <div className="space-y-1">    
      1332 +                                {message.response_time_ms > 0
           + && (                                                        
      1333 +                                  <div className="flex justif
           +y-between gap-4">                                            
      1334 +                                    <span className="text-dar
           +k-400">Time:</span>                                          
      1335 +                                    <span className="text-dar
           +k-200 font-mono">{formatThinkingTime(message.response_time_ms
           + / 1000)}</span>                                             
      1336 +                                  </div>                     
      1337 +                                )}                           
      1338 +                                {(message.prompt_tokens || me
           +ssage.completion_tokens) && (                                
      1339 +                                  <div className="flex justif
           +y-between gap-4">                                            
      1340 +                                    <span className="text-dar
           +k-400">Tokens:</span>                                        
      1341 +                                    <span className="text-dar
           +k-200 font-mono">{((message.prompt_tokens || 0) + (message.co
           +mpletion_tokens || 0)).toLocaleString()} tks</span>          
      1342 +                                  </div>                     
      1343 +                                )}                           
      1344 +                                {message.cost > 0 && (       
      1345 +                                  <div className="flex justif
           +y-between gap-4">                                            
      1346 +                                    <span className="text-dar
           +k-400">Cost:</span>                                          
      1347 +                                    <span className="text-pri
           +mary-400 font-mono">                                         
      1348 +                                      ${message.cost.toFixed(
           +2)}                                                          
      1349 +                                    </span>                  
      1350 +                                  </div>                     
      1351 +                                )}                           
      1352 +                              </div>                         
      1353 +                            </div>                           
      1354 +                          </div>                             
      1355 +                        </div>                               
      1356 +                      )}                                     
      1357 +                    </div>                                   
      1358 +                  )}                                         
      1359 +                </div>                                       
      1360 +              ))}                                            
      1361 +                                                             
      1362 +              {(streaming || streamingMessage || streamingRea
           +soning) && (                                                 
      1363 +                <div className="pr-8">                       
      1364 +                  {(streamingReasoning || (streaming && !stre
           +amingMessage)) && (                                          
      1365 +                    <ThinkingSection                         
      1366 +                      reasoning={streamingReasoning}         
      1367 +                      isExpanded={expandedThinkingSections.ha
           +s('streaming')}                                              
      1368 +                      onToggle={() => toggleThinkingSection('
           +streaming')}                                                 
      1369 +                      isStreaming={!streamingMessage || (stre
           +amingReasoning && streaming)}                                
      1370 +                      elapsedTime={thinkingElapsedTime}      
      1371 +                      stats={lastThinkingStats}              
      1372 +                    />                                       
      1373 +                  )}                                         
      1374 +                                                             
      1375 +                  {streamingMessage && (                     
      1376 +                    <div className="bg-dark-850/50 rounded-lg
           + px-4 py-3">                                                 
      1377 +                      <div className="flex items-center gap-2
           + mb-2">                                                      
      1378 +                        <Bot className="w-4 h-4 text-dark-400
           +" />                                                         
      1379 +                        <span className="text-xs font-medium 
           +text-dark-400">Assistant</span>                              
      1380 +                      </div>                                 
      1381 +                      {renderMessage(streamingMessage)}      
      1382 +                    </div>                                   
      1383 +                  )}                                         
      1384 +                                                             
      1385 +                  {streaming && !streamingMessage && !streami
           +ngReasoning && (                                             
      1386 +                    <div className="bg-dark-850/50 rounded-lg
           + px-4 py-3">                                                 
      1387 +                      <div className="flex items-center gap-2
           + mb-2">                                                      
      1388 +                        <Bot className="w-4 h-4 text-dark-400
           +" />                                                         
      1389 +                        <span className="text-xs font-medium 
           +text-dark-400">Assistant</span>                              
      1390 +                      </div>                                 
      1391 +                      <div className="flex gap-1">           
      1392 +                        <div className="w-2 h-2 bg-primary-40
           +0 rounded-full animate-bounce" style={{ animationDelay: '0ms'
           + }}></div>                                                   
      1393 +                        <div className="w-2 h-2 bg-primary-40
           +0 rounded-full animate-bounce" style={{ animationDelay: '150m
           +s' }}></div>                                                 
      1394 +                        <div className="w-2 h-2 bg-primary-40
           +0 rounded-full animate-bounce" style={{ animationDelay: '300m
           +s' }}></div>                                                 
      1395 +                      </div>                                 
      1396 +                    </div>                                   
      1397 +                  )}                                         
      1398 +                </div>                                       
      1399 +              )}                                             
      1400 +                                                             
      1401 +              <div ref={messagesEndRef} />                   
      1402 +            </div>                                           
      1403 +          )}                                                 
      1404 +        </div>                                               
      1405 +                                                             
      1406 +        {/* Input */}                                        
      1407 +        {currentChat && (                                    
      1408 +          <div className="border-t border-dark-700/50 bg-dark
           +-850 p-4">                                                   
      1409 +            <div className="max-w-2xl mx-auto">              
      1410 +              {streaming && (                                
      1411 +                <div className="flex justify-center mb-4">   
      1412 +                  <button                                    
      1413 +                    onClick={stopGeneration}                 
      1414 +                    className="flex items-center gap-2 px-5 p
           +y-2.5 bg-red-500/10 text-red-400 border border-red-500/20 rou
           +nded-xl text-sm font-semibold hover:bg-red-500/20 transition-
           +all duration-200 active:scale-[0.98]"                        
      1415 +                  >                                          
      1416 +                    <Square className="w-3 h-3 fill-current" 
           +/>                                                           
      1417 +                    Stop Generating                          
      1418 +                  </button>                                  
      1419 +                </div>                                       
      1420 +              )}                                             
      1421 +              <form onSubmit={sendMessage} className="flex ga
           +p-3">                                                        
      1422 +                <div className="flex-1 relative">            
      1423 +                  <textarea                                  
      1424 +                    ref={textareaRef}                        
      1425 +                    value={inputMessage}                     
      1426 +                    onChange={(e) => setInputMessage(e.target
           +.value)}                                                     
      1427 +                    onKeyDown={(e) => {                      
      1428 +                      if (e.key === 'Enter' && !e.shiftKey) {
      1429 +                        e.preventDefault();                  
      1430 +                        if (inputMessage.trim() && !streaming
           +) {                                                          
      1431 +                          sendMessage(e);                    
      1432 +                        }                                    
      1433 +                      }                                      
      1434 +                    }}                                       
      1435 +                    placeholder={streaming ? "AI is respondin
           +g..." : "Type your message... (Shift+Enter for new line)"}   
      1436 +                    className="w-full px-5 py-3.5 rounded-2xl
           + glass-input outline-none text-dark-100 placeholder-dark-500 
           +text-sm pr-4 resize-none overflow-y-auto"                    
      1437 +                    style={{ minHeight: '52px', maxHeight: '1
           +40px' }}                                                     
      1438 +                    rows={1}                                 
      1439 +                    disabled={streaming}                     
      1440 +                    onInput={(e) => {                        
      1441 +                      e.target.style.height = 'auto';        
      1442 +                      e.target.style.height = Math.min(e.targ
           +et.scrollHeight, 140) + 'px';                                
      1443 +                    }}                                       
      1444 +                  />                                         
      1445 +                </div>                                       
      1446 +                <button                                      
      1447 +                  type="submit"                              
      1448 +                  disabled={!inputMessage.trim() || streaming
           +}                                                            
      1449 +                  className="px-6 py-3.5 bg-primary-500 hover
           +:bg-primary-600 text-white rounded-2xl font-semibold transiti
           +on-all duration-200 disabled:opacity-40 disabled:cursor-not-a
           +llowed flex items-center gap-2 active:scale-[0.98]"          
      1450 +                >                                            
      1451 +                  <Send className="w-4 h-4" />               
      1452 +                  <span className="hidden sm:inline">Send</sp
           +an>                                                          
      1453 +                </button>                                    
      1454 +              </form>                                        
      1455 +            </div>                                           
      1456 +          </div>                                             
      1457 +        )}                                                   
      1458 +      </div>                                                 
      1459 +                                                             
      1460 +      {/* Fork Modal */}                                     
      1461 +      {showForkModal && (                                    
      1462 +        <div className="fixed inset-0 bg-dark-950/80 backdrop
           +-blur-md flex items-center justify-center z-50 scale-in">    
      1463 +          <div className="glass-modal rounded-2xl p-6 w-full 
           +max-w-md mx-4 shadow-2xl">                                   
      1464 +            <div className="flex items-center justify-between
           + mb-5">                                                      
      1465 +              <h3 className="text-lg font-bold text-dark-100 
           +flex items-center gap-2.5">                                  
      1466 +                <div className="w-8 h-8 rounded-lg bg-primary
           +-500 flex items-center justify-center">                      
      1467 +                  <GitBranch className="w-4 h-4 text-white" /
           +>                                                            
      1468 +                </div>                                       
      1469 +                Fork Chat                                    
      1470 +              </h3>                                          
      1471 +              <button                                        
      1472 +                onClick={() => setShowForkModal(false)}      
      1473 +                className="p-2 hover:bg-dark-700/50 rounded-x
           +l transition-all duration-200"                               
      1474 +              >                                              
      1475 +                <X className="w-5 h-5 text-dark-400" />      
      1476 +              </button>                                      
      1477 +            </div>                                           
      1478 +                                                             
      1479 +            <p className="text-dark-400 text-sm mb-5 leading-
           +relaxed">                                                    
      1480 +              Create a new chat branch from this point. You c
           +an choose a different model for the forked chat.             
      1481 +            </p>                                             
      1482 +                                                             
      1483 +            <div className="mb-6">                           
      1484 +              <label className="block text-sm font-medium tex
           +t-dark-300 mb-2">                                            
      1485 +                Model for forked chat                        
      1486 +              </label>                                       
      1487 +              <ModelSelector                                 
      1488 +                selectedModel={forkModel}                    
      1489 +                onModelChange={setForkModel}                 
      1490 +                isDropdown={true}                            
      1491 +              />                                             
      1492 +            </div>                                           
      1493 +                                                             
      1494 +            <div className="flex gap-3">                     
      1495 +              <button                                        
      1496 +                onClick={() => setShowForkModal(false)}      
      1497 +                className="flex-1 px-4 py-3 rounded-xl glass-
           +button text-dark-300 font-semibold transition-all duration-20
           +0 hover:text-dark-100"                                       
      1498 +              >                                              
      1499 +                Cancel                                       
      1500 +              </button>                                      
      1501 +              <button                                        
      1502 +                onClick={forkChat}                           
      1503 +                className="flex-1 px-4 py-3 rounded-xl bg-pri
           +mary-500 hover:bg-primary-600 text-white font-semibold transi
           +tion-all duration-200 flex items-center justify-center gap-2 
           +active:scale-[0.98]"                                         
      1504 +              >                                              
      1505 +                <GitBranch className="w-4 h-4" />            
      1506 +                Fork Chat                                    
      1507 +              </button>                                      
      1508 +            </div>                                           
      1509 +          </div>                                             
      1510 +        </div>                                               
      1511 +      )}                                                     
      1512 +                                                             
      1513 +    </div>                                                   
      1514 +  );                                                         
      1515 +}                                                            
      1516 +                                                             
      1517 +export default Chat;                                         
✔ Task #4 updated: status → completed
✔ Task #5 updated: status → in progress

● Write(client\src\components\ModelSelector.jsx)
  ⎿  Added 388 lines, removed 388 lines
        1 -import React, { useState, useEffect, useRef, useMemo } from 'r
          -eact';                                                       
        2 -import { Bot, ChevronDown, Check, Search, Clock, Loader2, X } 
          -from 'lucide-react';                                         
        3 -                                                             
        4 -const DEFAULT_MODEL = 'moonshotai/kimi-k2-thinking';         
        5 -const RECENT_MODELS_KEY = 'budi_chat_recent_models';         
        6 -const MODELS_CACHE_KEY = 'budi_chat_models_cache';           
        7 -const MODELS_CACHE_EXPIRY = 24 * 60 * 60 * 1000; // 24 hours 
        8 -const MAX_RECENT_MODELS = 5;                                 
        9 -                                                             
       10 -// Fallback models in case API fails                         
       11 -const FALLBACK_MODELS = [                                    
       12 -  { id: 'moonshotai/kimi-k2-thinking', name: 'Kimi K2 Thinking
          -', description: 'Moonshot AI reasoning model' },             
       13 -  { id: 'anthropic/claude-sonnet-4', name: 'Claude Sonnet 4', 
          -description: 'Anthropic Claude Sonnet 4' },                  
       14 -  { id: 'anthropic/claude-3.5-sonnet', name: 'Claude 3.5 Sonne
          -t', description: 'Anthropic Claude 3.5 Sonnet' },            
       15 -  { id: 'openai/gpt-4o', name: 'GPT-4o', description: 'OpenAI 
          -GPT-4o' },                                                   
       16 -  { id: 'openai/gpt-4-turbo', name: 'GPT-4 Turbo', description
          -: 'OpenAI GPT-4 Turbo' },                                    
       17 -  { id: 'google/gemini-2.5-pro-preview', name: 'Gemini 2.5 Pro
          -', description: 'Google Gemini 2.5 Pro' },                   
       18 -  { id: 'google/gemini-2.5-flash-preview', name: 'Gemini 2.5 F
          -lash', description: 'Google Gemini 2.5 Flash' },             
       19 -  { id: 'deepseek/deepseek-r1', name: 'DeepSeek R1', descripti
          -on: 'DeepSeek R1 reasoning model' },                         
       20 -  { id: 'deepseek/deepseek-chat', name: 'DeepSeek Chat', descr
          -iption: 'DeepSeek Chat model' },                             
       21 -  { id: 'meta-llama/llama-3.3-70b-instruct', name: 'Llama 3.3 
          -70B', description: 'Meta Llama 3.3 70B' },                   
       22 -  { id: 'qwen/qwen-2.5-72b-instruct', name: 'Qwen 2.5 72B', de
          -scription: 'Alibaba Qwen 2.5 72B' },                         
       23 -  { id: 'mistralai/mistral-large-2411', name: 'Mistral Large',
          - description: 'Mistral Large 2411' },                        
       24 -];                                                           
       25 -                                                             
       26 -function ModelSelector({ selectedModel, onModelChange, isDropd
          -own = true }) {                                              
       27 -  const [isOpen, setIsOpen] = useState(false);               
       28 -  const [models, setModels] = useState([]);                  
       29 -  const [loading, setLoading] = useState(true);              
       30 -  const [searchQuery, setSearchQuery] = useState('');        
       31 -  const [recentModels, setRecentModels] = useState([]);      
       32 -  const dropdownRef = useRef(null);                          
       33 -  const searchInputRef = useRef(null);                       
       34 -                                                             
       35 -  // Load recent models from localStorage                    
       36 -  useEffect(() => {                                          
       37 -    const stored = localStorage.getItem(RECENT_MODELS_KEY);  
       38 -    if (stored) {                                            
       39 -      try {                                                  
       40 -        setRecentModels(JSON.parse(stored));                 
       41 -      } catch (e) {                                          
       42 -        console.error('Failed to parse recent models:', e);  
       43 -      }                                                      
       44 -    }                                                        
       45 -  }, []);                                                    
       46 -                                                             
       47 -  // Fetch models from OpenRouter or cache                   
       48 -  useEffect(() => {                                          
       49 -    const fetchModels = async () => {                        
       50 -      // Check cache first                                   
       51 -      const cached = localStorage.getItem(MODELS_CACHE_KEY); 
       52 -      if (cached) {                                          
       53 -        try {                                                
       54 -          const { models: cachedModels, timestamp } = JSON.par
          -se(cached);                                                  
       55 -          if (Date.now() - timestamp < MODELS_CACHE_EXPIRY) {
       56 -            setModels(cachedModels);                         
       57 -            setLoading(false);                               
       58 -            return;                                          
       59 -          }                                                  
       60 -        } catch (e) {                                        
       61 -          console.error('Failed to parse cached models:', e);
       62 -        }                                                    
       63 -      }                                                      
       64 -                                                             
       65 -      // Fetch from OpenRouter                               
       66 -      try {                                                  
       67 -        const response = await fetch('https://openrouter.ai/ap
          -i/v1/models');                                               
       68 -        if (!response.ok) throw new Error('Failed to fetch mod
          -els');                                                       
       69 -                                                             
       70 -        const data = await response.json();                  
       71 -        const fetchedModels = data.data                      
       72 -          .filter(model => model.id && model.name)           
       73 -          .map(model => ({                                   
       74 -            id: model.id,                                    
       75 -            name: model.name,                                
       76 -            description: model.description || '',            
       77 -            contextLength: model.context_length,             
       78 -            pricing: model.pricing,                          
       79 -          }))                                                
       80 -          .sort((a, b) => a.name.localeCompare(b.name));     
       81 -                                                             
       82 -        setModels(fetchedModels);                            
       83 -                                                             
       84 -        // Cache the results                                 
       85 -        localStorage.setItem(MODELS_CACHE_KEY, JSON.stringify(
          -{                                                            
       86 -          models: fetchedModels,                             
       87 -          timestamp: Date.now()                              
       88 -        }));                                                 
       89 -      } catch (error) {                                      
       90 -        console.error('Failed to fetch models from OpenRouter:
          -', error);                                                   
       91 -        setModels(FALLBACK_MODELS);                          
       92 -      } finally {                                            
       93 -        setLoading(false);                                   
       94 -      }                                                      
       95 -    };                                                       
       96 -                                                             
       97 -    fetchModels();                                           
       98 -  }, []);                                                    
       99 -                                                             
      100 -  // Close dropdown when clicking outside                    
      101 -  useEffect(() => {                                          
      102 -    const handleClickOutside = (event) => {                  
      103 -      if (dropdownRef.current && !dropdownRef.current.contains
          -(event.target)) {                                            
      104 -        setIsOpen(false);                                    
      105 -        setSearchQuery('');                                  
      106 -      }                                                      
      107 -    };                                                       
      108 -    document.addEventListener('mousedown', handleClickOutside)
          -;                                                            
      109 -    return () => document.removeEventListener('mousedown', han
          -dleClickOutside);                                            
      110 -  }, []);                                                    
      111 -                                                             
      112 -  // Focus search input when dropdown opens                  
      113 -  useEffect(() => {                                          
      114 -    if (isOpen && searchInputRef.current) {                  
      115 -      setTimeout(() => searchInputRef.current?.focus(), 50); 
      116 -    }                                                        
      117 -  }, [isOpen]);                                              
      118 -                                                             
      119 -  // Add model to recent list                                
      120 -  const addToRecentModels = (modelId) => {                   
      121 -    const updated = [modelId, ...recentModels.filter(id => id 
          -!== modelId)].slice(0, MAX_RECENT_MODELS);                   
      122 -    setRecentModels(updated);                                
      123 -    localStorage.setItem(RECENT_MODELS_KEY, JSON.stringify(upd
          -ated));                                                      
      124 -  };                                                         
      125 -                                                             
      126 -  // Handle model selection                                  
      127 -  const handleSelect = (modelId) => {                        
      128 -    addToRecentModels(modelId);                              
      129 -    onModelChange(modelId);                                  
      130 -    setIsOpen(false);                                        
      131 -    setSearchQuery('');                                      
      132 -  };                                                         
      133 -                                                             
      134 -  // Filter and rank models based on search query            
      135 -  const filteredModels = useMemo(() => {                     
      136 -    if (!searchQuery.trim()) return models;                  
      137 -    const query = searchQuery.toLowerCase();                 
      138 -                                                             
      139 -    // Filter matching models                                
      140 -    const matches = models.filter(model =>                   
      141 -      model.id.toLowerCase().includes(query) ||              
      142 -      model.name.toLowerCase().includes(query) ||            
      143 -      (model.description && model.description.toLowerCase().in
          -cludes(query))                                               
      144 -    );                                                       
      145 -                                                             
      146 -    // Rank by relevance: name match > ID match > description 
          -match                                                        
      147 -    return matches.sort((a, b) => {                          
      148 -      const aName = a.name.toLowerCase();                    
      149 -      const bName = b.name.toLowerCase();                    
      150 -      const aId = a.id.toLowerCase();                        
      151 -      const bId = b.id.toLowerCase();                        
      152 -                                                             
      153 -      // Exact name starts with query                        
      154 -      const aNameStarts = aName.startsWith(query) ? 3 : (aName
          -.includes(query) ? 2 : 0);                                   
      155 -      const bNameStarts = bName.startsWith(query) ? 3 : (bName
          -.includes(query) ? 2 : 0);                                   
      156 -      if (aNameStarts !== bNameStarts) return bNameStarts - aN
          -ameStarts;                                                   
      157 -                                                             
      158 -      // ID contains query                                   
      159 -      const aIdMatch = aId.includes(query) ? 1 : 0;          
      160 -      const bIdMatch = bId.includes(query) ? 1 : 0;          
      161 -      if (aIdMatch !== bIdMatch) return bIdMatch - aIdMatch; 
      162 -                                                             
      163 -      // Alphabetical fallback                               
      164 -      return aName.localeCompare(bName);                     
      165 -    });                                                      
      166 -  }, [models, searchQuery]);                                 
      167 -                                                             
      168 -  // Get recent models data                                  
      169 -  const recentModelsData = useMemo(() => {                   
      170 -    return recentModels                                      
      171 -      .map(id => models.find(m => m.id === id))              
      172 -      .filter(Boolean);                                      
      173 -  }, [recentModels, models]);                                
      174 -                                                             
      175 -  // Get the display name for current model                  
      176 -  const getModelDisplayName = (modelId) => {                 
      177 -    const model = models.find(m => m.id === modelId);        
      178 -    if (model) return model.name;                            
      179 -    // Extract a readable name from the ID                   
      180 -    const parts = modelId.split('/');                        
      181 -    return parts[parts.length - 1].replace(/-/g, ' ').replace(
          -/\b\w/g, l => l.toUpperCase());                              
      182 -  };                                                         
      183 -                                                             
      184 -  // Get provider from model ID                              
      185 -  const getProvider = (modelId) => {                         
      186 -    const parts = modelId.split('/');                        
      187 -    if (parts.length > 1) {                                  
      188 -      return parts[0].replace(/-/g, ' ').replace(/\b\w/g, l =>
          - l.toUpperCase());                                           
      189 -    }                                                        
      190 -    return '';                                               
      191 -  };                                                         
      192 -                                                             
      193 -  if (!isDropdown) {                                         
      194 -    // Render as a regular select for settings panel         
      195 -    return (                                                 
      196 -      <select                                                
      197 -        value={selectedModel}                                
      198 -        onChange={(e) => {                                   
      199 -          addToRecentModels(e.target.value);                 
      200 -          onModelChange(e.target.value);                     
      201 -        }}                                                   
      202 -        className="w-full px-3 py-2 rounded-lg glass-input out
          -line-none text-dark-100 bg-dark-800"                         
      203 -        disabled={loading}                                   
      204 -      >                                                      
      205 -        {loading ? (                                         
      206 -          <option>Loading models...</option>                 
      207 -        ) : (                                                
      208 -          <>                                                 
      209 -            {recentModelsData.length > 0 && (                
      210 -              <optgroup label="Recently Used">               
      211 -                {recentModelsData.map(model => (             
      212 -                  <option key={`recent-${model.id}`} value={mo
          -del.id}>                                                     
      213 -                    {model.name}                             
      214 -                  </option>                                  
      215 -                ))}                                          
      216 -              </optgroup>                                    
      217 -            )}                                               
      218 -            <optgroup label="All Models">                    
      219 -              {models.map(model => (                         
      220 -                <option key={model.id} value={model.id}>     
      221 -                  {model.name} ({getProvider(model.id)})     
      222 -                </option>                                    
      223 -              ))}                                            
      224 -            </optgroup>                                      
      225 -          </>                                                
      226 -        )}                                                   
      227 -      </select>                                              
      228 -    );                                                       
      229 -  }                                                          
      230 -                                                             
      231 -  return (                                                   
      232 -    <div className="relative" ref={dropdownRef}>             
      233 -      <button                                                
      234 -        onClick={() => setIsOpen(!isOpen)}                   
      235 -        className={`flex items-center gap-2.5 px-4 py-2.5 roun
          -ded-xl transition-all duration-200 text-sm ${isOpen          
      236 -          ? 'bg-primary-500/10 border border-primary-500/20 sh
          -adow-lg'                                                     
      237 -          : 'glass-button'                                   
      238 -          }`}                                                
      239 -      >                                                      
      240 -        <div className="w-6 h-6 rounded-lg gradient-primary fl
          -ex items-center justify-center flex-shrink-0">               
      241 -          <Bot className="w-3.5 h-3.5 text-white" />         
      242 -        </div>                                               
      243 -        <span className="text-dark-200 font-medium max-w-[180p
          -x] truncate">                                                
      244 -          {getModelDisplayName(selectedModel)}               
      245 -        </span>                                              
      246 -        <ChevronDown className={`w-4 h-4 text-dark-400 transit
          -ion-transform duration-200 ${isOpen ? 'rotate-180' : ''}`} />
      247 -      </button>                                              
      248 -                                                             
      249 -      {isOpen && (                                           
      250 -        <div className="absolute top-full left-0 mt-2 w-[420px
          -] bg-dark-900 border border-dark-700 rounded-2xl z-[100] overf
          -low-hidden shadow-2xl scale-in">                             
      251 -          {/* Search Bar */}                                 
      252 -          <div className="p-3 border-b border-dark-700 bg-dark
          --800">                                                       
      253 -            <div className="relative">                       
      254 -              <Search className="absolute left-3.5 top-1/2 -tr
          -anslate-y-1/2 w-4 h-4 text-dark-400" />                      
      255 -              <input                                         
      256 -                ref={searchInputRef}                         
      257 -                type="text"                                  
      258 -                value={searchQuery}                          
      259 -                onChange={(e) => setSearchQuery(e.target.value
          -)}                                                           
      260 -                placeholder="Search models..."               
      261 -                className="w-full pl-10 pr-9 py-2.5 rounded-xl
          - bg-dark-800 border border-dark-600 outline-none text-dark-100
          - placeholder-dark-500 text-sm focus:border-primary-500/50"   
      262 -              />                                             
      263 -              {searchQuery && (                              
      264 -                <button                                      
      265 -                  onClick={() => setSearchQuery('')}         
      266 -                  className="absolute right-2.5 top-1/2 -trans
          -late-y-1/2 p-1 hover:bg-white/[0.05] rounded-lg transition-col
          -ors"                                                         
      267 -                >                                            
      268 -                  <X className="w-3.5 h-3.5 text-dark-400" />
      269 -                </button>                                    
      270 -              )}                                             
      271 -            </div>                                           
      272 -          </div>                                             
      273 -                                                             
      274 -          <div className="max-h-[400px] overflow-y-auto bg-dar
          -k-900">                                                      
      275 -            {loading ? (                                     
      276 -              <div className="flex items-center justify-center
          - py-12">                                                     
      277 -                <Loader2 className="w-6 h-6 text-primary-400 a
          -nimate-spin" />                                              
      278 -                <span className="ml-3 text-dark-400 text-sm">L
          -oading models...</span>                                      
      279 -              </div>                                         
      280 -            ) : (                                            
      281 -              <>                                             
      282 -                {/* Recently Used Section */}                
      283 -                {!searchQuery && recentModelsData.length > 0 &
          -& (                                                          
      284 -                  <div className="p-2 border-b border-dark-700
          - bg-dark-900">                                               
      285 -                    <div className="flex items-center gap-2 px
          --3 py-2 text-[11px] font-semibold text-dark-500 uppercase trac
          -king-wider">                                                 
      286 -                      <Clock className="w-3 h-3" />          
      287 -                      Recently Used                          
      288 -                    </div>                                   
      289 -                    {recentModelsData.map(model => (         
      290 -                      <button                                
      291 -                        key={`recent-${model.id}`}           
      292 -                        onClick={() => handleSelect(model.id)}
          -                                                              
      293 -                        className={`w-full flex items-center j
          -ustify-between px-3 py-2.5 rounded-xl transition-all duration-
          -150 text-left group ${selectedModel === model.id             
      294 -                          ? 'bg-primary-500/15 border border-p
          -rimary-500/25'                                               
      295 -                          : 'hover:bg-white/[0.03] border bord
          -er-transparent'                                              
      296 -                          }`}                                
      297 -                      >                                      
      298 -                        <div className="flex-1 min-w-0">     
      299 -                          <p className={`text-sm font-medium t
          -runcate ${selectedModel === model.id ? 'text-dark-50' : 'text-
          -dark-200 group-hover:text-dark-100'}`}>{model.name}</p>      
      300 -                          <p className="text-xs text-dark-500 
          -truncate">                                                   
      301 -                            {getProvider(model.id)}          
      302 -                            {model.contextLength && (        
      303 -                              <span className="ml-1.5 text-dar
          -k-600">• {Math.round(model.contextLength / 1000)}k</span>    
      304 -                            )}                               
      305 -                            {model.pricing && (              
      306 -                              <span className="ml-1.5 text-gre
          -en-500/80">                                                  
      307 -                                • ${(parseFloat(model.pricing.
          -prompt) * 1000000).toFixed(2)} / ${(parseFloat(model.pricing.c
          -ompletion) * 1000000).toFixed(2)}                            
      308 -                              </span>                        
      309 -                            )}                               
      310 -                          </p>                               
      311 -                        </div>                               
      312 -                        {selectedModel === model.id && (     
      313 -                          <div className="w-5 h-5 rounded-md g
          -radient-primary flex items-center justify-center flex-shrink-0
          - ml-2">                                                      
      314 -                            <Check className="w-3 h-3 text-whi
          -te" />                                                       
      315 -                          </div>                             
      316 -                        )}                                   
      317 -                      </button>                              
      318 -                    ))}                                      
      319 -                  </div>                                     
      320 -                )}                                           
      321 -                                                             
      322 -                {/* All Models Section */}                   
      323 -                <div className="p-2 bg-dark-900">            
      324 -                  {!searchQuery && (                         
      325 -                    <div className="px-3 py-2 text-[11px] font
          --semibold text-dark-500 uppercase tracking-wider">           
      326 -                      All Models <span className="text-dark-60
          -0">({filteredModels.length})</span>                          
      327 -                    </div>                                   
      328 -                  )}                                         
      329 -                  {searchQuery && (                          
      330 -                    <div className="px-3 py-2 text-xs text-dar
          -k-400">                                                      
      331 -                      {filteredModels.length} result{filteredM
          -odels.length !== 1 ? 's' : ''} for "<span className="text-prim
          -ary-400">{searchQuery}</span>"                               
      332 -                    </div>                                   
      333 -                  )}                                         
      334 -                                                             
      335 -                  {filteredModels.length === 0 ? (           
      336 -                    <div className="py-12 text-center">      
      337 -                      <div className="w-12 h-12 rounded-xl bg-
          -dark-800/50 flex items-center justify-center mx-auto mb-3">  
      338 -                        <Search className="w-6 h-6 text-dark-5
          -00" />                                                       
      339 -                      </div>                                 
      340 -                      <p className="text-dark-400 font-medium"
          ->No models found</p>                                         
      341 -                      <p className="text-xs text-dark-500 mt-1
          -">Try a different search term</p>                            
      342 -                    </div>                                   
      343 -                  ) : (                                      
      344 -                    <div className="space-y-0.5">            
      345 -                      {filteredModels.map(model => (         
      346 -                        <button                              
      347 -                          key={model.id}                     
      348 -                          onClick={() => handleSelect(model.id
          -)}                                                           
      349 -                          className={`w-full flex items-center
          - justify-between px-3 py-2.5 rounded-xl transition-all duratio
          -n-150 text-left group ${selectedModel === model.id           
      350 -                            ? 'bg-primary-500/15 border border
          --primary-500/25'                                             
      351 -                            : 'hover:bg-white/[0.03] border bo
          -rder-transparent'                                            
      352 -                            }`}                              
      353 -                        >                                    
      354 -                          <div className="flex-1 min-w-0">   
      355 -                            <p className={`text-sm font-medium
          - truncate ${selectedModel === model.id ? 'text-dark-50' : 'tex
          -t-dark-200 group-hover:text-dark-100'}`}>{model.name}</p>    
      356 -                            <p className="text-xs text-dark-50
          -0 truncate">                                                 
      357 -                              {getProvider(model.id)}        
      358 -                              {model.contextLength && (      
      359 -                                <span className="ml-1.5 text-d
          -ark-600">• {Math.round(model.contextLength / 1000)}k</span>  
      360 -                              )}                             
      361 -                              {model.pricing && (            
      362 -                                <span className="ml-1.5 text-g
          -reen-500/80">                                                
      363 -                                  • ${(parseFloat(model.pricin
          -g.prompt) * 1000000).toFixed(2)} / ${(parseFloat(model.pricing
          -.completion) * 1000000).toFixed(2)}                          
      364 -                                </span>                      
      365 -                              )}                             
      366 -                            </p>                             
      367 -                          </div>                             
      368 -                          {selectedModel === model.id && (   
      369 -                            <div className="w-5 h-5 rounded-md
          - gradient-primary flex items-center justify-center flex-shrink
          --0 ml-2">                                                    
      370 -                              <Check className="w-3 h-3 text-w
          -hite" />                                                     
      371 -                            </div>                           
      372 -                          )}                                 
      373 -                        </button>                            
      374 -                      ))}                                    
      375 -                    </div>                                   
      376 -                  )}                                         
      377 -                </div>                                       
      378 -              </>                                            
      379 -            )}                                               
      380 -          </div>                                             
      381 -        </div>                                               
      382 -      )}                                                     
      383 -    </div>                                                   
      384 -  );                                                         
      385 -}                                                            
      386 -                                                             
      387 -export default ModelSelector;                                
      388 -export { DEFAULT_MODEL, RECENT_MODELS_KEY, MODELS_CACHE_KEY };
          -                                                              
        1 +import React, { useState, useEffect, useRef, useMemo } from 'r
          +eact';                                                        
        2 +import { Bot, ChevronDown, Check, Search, Clock, Loader2, X } 
          +from 'lucide-react';                                          
        3 +                                                              
        4 +const DEFAULT_MODEL = 'moonshotai/kimi-k2-thinking';          
        5 +const RECENT_MODELS_KEY = 'budi_chat_recent_models';          
        6 +const MODELS_CACHE_KEY = 'budi_chat_models_cache';            
        7 +const MODELS_CACHE_EXPIRY = 24 * 60 * 60 * 1000; // 24 hours  
        8 +const MAX_RECENT_MODELS = 5;                                  
        9 +                                                              
       10 +// Fallback models in case API fails                          
       11 +const FALLBACK_MODELS = [                                     
       12 +  { id: 'moonshotai/kimi-k2-thinking', name: 'Kimi K2 Thinking
          +', description: 'Moonshot AI reasoning model' },              
       13 +  { id: 'anthropic/claude-sonnet-4', name: 'Claude Sonnet 4', 
          +description: 'Anthropic Claude Sonnet 4' },                   
       14 +  { id: 'anthropic/claude-3.5-sonnet', name: 'Claude 3.5 Sonne
          +t', description: 'Anthropic Claude 3.5 Sonnet' },             
       15 +  { id: 'openai/gpt-4o', name: 'GPT-4o', description: 'OpenAI 
          +GPT-4o' },                                                    
       16 +  { id: 'openai/gpt-4-turbo', name: 'GPT-4 Turbo', description
          +: 'OpenAI GPT-4 Turbo' },                                     
       17 +  { id: 'google/gemini-2.5-pro-preview', name: 'Gemini 2.5 Pro
          +', description: 'Google Gemini 2.5 Pro' },                    
       18 +  { id: 'google/gemini-2.5-flash-preview', name: 'Gemini 2.5 F
          +lash', description: 'Google Gemini 2.5 Flash' },              
       19 +  { id: 'deepseek/deepseek-r1', name: 'DeepSeek R1', descripti
          +on: 'DeepSeek R1 reasoning model' },                          
       20 +  { id: 'deepseek/deepseek-chat', name: 'DeepSeek Chat', descr
          +iption: 'DeepSeek Chat model' },                              
       21 +  { id: 'meta-llama/llama-3.3-70b-instruct', name: 'Llama 3.3 
          +70B', description: 'Meta Llama 3.3 70B' },                    
       22 +  { id: 'qwen/qwen-2.5-72b-instruct', name: 'Qwen 2.5 72B', de
          +scription: 'Alibaba Qwen 2.5 72B' },                          
       23 +  { id: 'mistralai/mistral-large-2411', name: 'Mistral Large',
          + description: 'Mistral Large 2411' },                         
       24 +];                                                            
       25 +                                                              
       26 +function ModelSelector({ selectedModel, onModelChange, isDropd
          +own = true }) {                                               
       27 +  const [isOpen, setIsOpen] = useState(false);                
       28 +  const [models, setModels] = useState([]);                   
       29 +  const [loading, setLoading] = useState(true);               
       30 +  const [searchQuery, setSearchQuery] = useState('');         
       31 +  const [recentModels, setRecentModels] = useState([]);       
       32 +  const dropdownRef = useRef(null);                           
       33 +  const searchInputRef = useRef(null);                        
       34 +                                                              
       35 +  // Load recent models from localStorage                     
       36 +  useEffect(() => {                                           
       37 +    const stored = localStorage.getItem(RECENT_MODELS_KEY);   
       38 +    if (stored) {                                             
       39 +      try {                                                   
       40 +        setRecentModels(JSON.parse(stored));                  
       41 +      } catch (e) {                                           
       42 +        console.error('Failed to parse recent models:', e);   
       43 +      }                                                       
       44 +    }                                                         
       45 +  }, []);                                                     
       46 +                                                              
       47 +  // Fetch models from OpenRouter or cache                    
       48 +  useEffect(() => {                                           
       49 +    const fetchModels = async () => {                         
       50 +      // Check cache first                                    
       51 +      const cached = localStorage.getItem(MODELS_CACHE_KEY);  
       52 +      if (cached) {                                           
       53 +        try {                                                 
       54 +          const { models: cachedModels, timestamp } = JSON.par
          +se(cached);                                                   
       55 +          if (Date.now() - timestamp < MODELS_CACHE_EXPIRY) { 
       56 +            setModels(cachedModels);                          
       57 +            setLoading(false);                                
       58 +            return;                                           
       59 +          }                                                   
       60 +        } catch (e) {                                         
       61 +          console.error('Failed to parse cached models:', e); 
       62 +        }                                                     
       63 +      }                                                       
       64 +                                                              
       65 +      // Fetch from OpenRouter                                
       66 +      try {                                                   
       67 +        const response = await fetch('https://openrouter.ai/ap
          +i/v1/models');                                                
       68 +        if (!response.ok) throw new Error('Failed to fetch mod
          +els');                                                        
       69 +                                                              
       70 +        const data = await response.json();                   
       71 +        const fetchedModels = data.data                       
       72 +          .filter(model => model.id && model.name)            
       73 +          .map(model => ({                                    
       74 +            id: model.id,                                     
       75 +            name: model.name,                                 
       76 +            description: model.description || '',             
       77 +            contextLength: model.context_length,              
       78 +            pricing: model.pricing,                           
       79 +          }))                                                 
       80 +          .sort((a, b) => a.name.localeCompare(b.name));      
       81 +                                                              
       82 +        setModels(fetchedModels);                             
       83 +                                                              
       84 +        // Cache the results                                  
       85 +        localStorage.setItem(MODELS_CACHE_KEY, JSON.stringify(
          +{                                                             
       86 +          models: fetchedModels,                              
       87 +          timestamp: Date.now()                               
       88 +        }));                                                  
       89 +      } catch (error) {                                       
       90 +        console.error('Failed to fetch models from OpenRouter:
          +', error);                                                    
       91 +        setModels(FALLBACK_MODELS);                           
       92 +      } finally {                                             
       93 +        setLoading(false);                                    
       94 +      }                                                       
       95 +    };                                                        
       96 +                                                              
       97 +    fetchModels();                                            
       98 +  }, []);                                                     
       99 +                                                              
      100 +  // Close dropdown when clicking outside                     
      101 +  useEffect(() => {                                           
      102 +    const handleClickOutside = (event) => {                   
      103 +      if (dropdownRef.current && !dropdownRef.current.contains
          +(event.target)) {                                             
      104 +        setIsOpen(false);                                     
      105 +        setSearchQuery('');                                   
      106 +      }                                                       
      107 +    };                                                        
      108 +    document.addEventListener('mousedown', handleClickOutside)
          +;                                                             
      109 +    return () => document.removeEventListener('mousedown', han
          +dleClickOutside);                                             
      110 +  }, []);                                                     
      111 +                                                              
      112 +  // Focus search input when dropdown opens                   
      113 +  useEffect(() => {                                           
      114 +    if (isOpen && searchInputRef.current) {                   
      115 +      setTimeout(() => searchInputRef.current?.focus(), 50);  
      116 +    }                                                         
      117 +  }, [isOpen]);                                               
      118 +                                                              
      119 +  // Add model to recent list                                 
      120 +  const addToRecentModels = (modelId) => {                    
      121 +    const updated = [modelId, ...recentModels.filter(id => id 
          +!== modelId)].slice(0, MAX_RECENT_MODELS);                    
      122 +    setRecentModels(updated);                                 
      123 +    localStorage.setItem(RECENT_MODELS_KEY, JSON.stringify(upd
          +ated));                                                       
      124 +  };                                                          
      125 +                                                              
      126 +  // Handle model selection                                   
      127 +  const handleSelect = (modelId) => {                         
      128 +    addToRecentModels(modelId);                               
      129 +    onModelChange(modelId);                                   
      130 +    setIsOpen(false);                                         
      131 +    setSearchQuery('');                                       
      132 +  };                                                          
      133 +                                                              
      134 +  // Filter and rank models based on search query             
      135 +  const filteredModels = useMemo(() => {                      
      136 +    if (!searchQuery.trim()) return models;                   
      137 +    const query = searchQuery.toLowerCase();                  
      138 +                                                              
      139 +    // Filter matching models                                 
      140 +    const matches = models.filter(model =>                    
      141 +      model.id.toLowerCase().includes(query) ||               
      142 +      model.name.toLowerCase().includes(query) ||             
      143 +      (model.description && model.description.toLowerCase().in
          +cludes(query))                                                
      144 +    );                                                        
      145 +                                                              
      146 +    // Rank by relevance: name match > ID match > description 
          +match                                                         
      147 +    return matches.sort((a, b) => {                           
      148 +      const aName = a.name.toLowerCase();                     
      149 +      const bName = b.name.toLowerCase();                     
      150 +      const aId = a.id.toLowerCase();                         
      151 +      const bId = b.id.toLowerCase();                         
      152 +                                                              
      153 +      // Exact name starts with query                         
      154 +      const aNameStarts = aName.startsWith(query) ? 3 : (aName
          +.includes(query) ? 2 : 0);                                    
      155 +      const bNameStarts = bName.startsWith(query) ? 3 : (bName
          +.includes(query) ? 2 : 0);                                    
      156 +      if (aNameStarts !== bNameStarts) return bNameStarts - aN
          +ameStarts;                                                    
      157 +                                                              
      158 +      // ID contains query                                    
      159 +      const aIdMatch = aId.includes(query) ? 1 : 0;           
      160 +      const bIdMatch = bId.includes(query) ? 1 : 0;           
      161 +      if (aIdMatch !== bIdMatch) return bIdMatch - aIdMatch;  
      162 +                                                              
      163 +      // Alphabetical fallback                                
      164 +      return aName.localeCompare(bName);                      
      165 +    });                                                       
      166 +  }, [models, searchQuery]);                                  
      167 +                                                              
      168 +  // Get recent models data                                   
      169 +  const recentModelsData = useMemo(() => {                    
      170 +    return recentModels                                       
      171 +      .map(id => models.find(m => m.id === id))               
      172 +      .filter(Boolean);                                       
      173 +  }, [recentModels, models]);                                 
      174 +                                                              
      175 +  // Get the display name for current model                   
      176 +  const getModelDisplayName = (modelId) => {                  
      177 +    const model = models.find(m => m.id === modelId);         
      178 +    if (model) return model.name;                             
      179 +    // Extract a readable name from the ID                    
      180 +    const parts = modelId.split('/');                         
      181 +    return parts[parts.length - 1].replace(/-/g, ' ').replace(
          +/\b\w/g, l => l.toUpperCase());                               
      182 +  };                                                          
      183 +                                                              
      184 +  // Get provider from model ID                               
      185 +  const getProvider = (modelId) => {                          
      186 +    const parts = modelId.split('/');                         
      187 +    if (parts.length > 1) {                                   
      188 +      return parts[0].replace(/-/g, ' ').replace(/\b\w/g, l =>
          + l.toUpperCase());                                            
      189 +    }                                                         
      190 +    return '';                                                
      191 +  };                                                          
      192 +                                                              
      193 +  if (!isDropdown) {                                          
      194 +    // Render as a regular select for settings panel          
      195 +    return (                                                  
      196 +      <select                                                 
      197 +        value={selectedModel}                                 
      198 +        onChange={(e) => {                                    
      199 +          addToRecentModels(e.target.value);                  
      200 +          onModelChange(e.target.value);                      
      201 +        }}                                                    
      202 +        className="w-full px-3 py-2 rounded-lg glass-input out
          +line-none text-dark-100 bg-dark-800"                          
      203 +        disabled={loading}                                    
      204 +      >                                                       
      205 +        {loading ? (                                          
      206 +          <option>Loading models...</option>                  
      207 +        ) : (                                                 
      208 +          <>                                                  
      209 +            {recentModelsData.length > 0 && (                 
      210 +              <optgroup label="Recently Used">                
      211 +                {recentModelsData.map(model => (              
      212 +                  <option key={`recent-${model.id}`} value={mo
          +del.id}>                                                      
      213 +                    {model.name}                              
      214 +                  </option>                                   
      215 +                ))}                                           
      216 +              </optgroup>                                     
      217 +            )}                                                
      218 +            <optgroup label="All Models">                     
      219 +              {models.map(model => (                          
      220 +                <option key={model.id} value={model.id}>      
      221 +                  {model.name} ({getProvider(model.id)})      
      222 +                </option>                                     
      223 +              ))}                                             
      224 +            </optgroup>                                       
      225 +          </>                                                 
      226 +        )}                                                    
      227 +      </select>                                               
      228 +    );                                                        
      229 +  }                                                           
      230 +                                                              
      231 +  return (                                                    
      232 +    <div className="relative" ref={dropdownRef}>              
      233 +      <button                                                 
      234 +        onClick={() => setIsOpen(!isOpen)}                    
      235 +        className={`flex items-center gap-2.5 px-4 py-2.5 roun
          +ded-xl transition-all duration-200 text-sm ${isOpen           
      236 +          ? 'bg-primary-500/10 border border-primary-500/20'  
      237 +          : 'glass-button'                                    
      238 +          }`}                                                 
      239 +      >                                                       
      240 +        <div className="w-6 h-6 rounded-lg bg-primary-500 flex
          + items-center justify-center flex-shrink-0">                  
      241 +          <Bot className="w-3.5 h-3.5 text-white" />          
      242 +        </div>                                                
      243 +        <span className="text-dark-200 font-medium max-w-[180p
          +x] truncate">                                                 
      244 +          {getModelDisplayName(selectedModel)}                
      245 +        </span>                                               
      246 +        <ChevronDown className={`w-4 h-4 text-dark-400 transit
          +ion-transform duration-200 ${isOpen ? 'rotate-180' : ''}`} /> 
      247 +      </button>                                               
      248 +                                                              
      249 +      {isOpen && (                                            
      250 +        <div className="absolute top-full left-0 mt-2 w-[380px
          +] glass-dropdown rounded-2xl z-[100] overflow-hidden shadow-2x
          +l scale-in">                                                  
      251 +          {/* Search Bar */}                                  
      252 +          <div className="p-3 border-b border-dark-700/50 bg-d
          +ark-850">                                                     
      253 +            <div className="relative">                        
      254 +              <Search className="absolute left-3.5 top-1/2 -tr
          +anslate-y-1/2 w-4 h-4 text-dark-400" />                       
      255 +              <input                                          
      256 +                ref={searchInputRef}                          
      257 +                type="text"                                   
      258 +                value={searchQuery}                           
      259 +                onChange={(e) => setSearchQuery(e.target.value
          +)}                                                            
      260 +                placeholder="Search models..."                
      261 +                className="w-full pl-10 pr-9 py-2.5 rounded-xl
          + bg-dark-800 border border-dark-700 outline-none text-dark-100
          + placeholder-dark-500 text-sm focus:border-primary-500/50"    
      262 +              />                                              
      263 +              {searchQuery && (                               
      264 +                <button                                       
      265 +                  onClick={() => setSearchQuery('')}          
      266 +                  className="absolute right-2.5 top-1/2 -trans
          +late-y-1/2 p-1 hover:bg-dark-700/50 rounded-lg transition-colo
          +rs"                                                           
      267 +                >                                             
      268 +                  <X className="w-3.5 h-3.5 text-dark-400" /> 
      269 +                </button>                                     
      270 +              )}                                              
      271 +            </div>                                            
      272 +          </div>                                              
      273 +                                                              
      274 +          <div className="max-h-[400px] overflow-y-auto">     
      275 +            {loading ? (                                      
      276 +              <div className="flex items-center justify-center
          + py-12">                                                      
      277 +                <Loader2 className="w-6 h-6 text-primary-400 a
          +nimate-spin" />                                               
      278 +                <span className="ml-3 text-dark-400 text-sm">L
          +oading models...</span>                                       
      279 +              </div>                                          
      280 +            ) : (                                             
      281 +              <>                                              
      282 +                {/* Recently Used Section */}                 
      283 +                {!searchQuery && recentModelsData.length > 0 &
          +& (                                                           
      284 +                  <div className="p-2 border-b border-dark-700
          +/50">                                                         
      285 +                    <div className="flex items-center gap-2 px
          +-3 py-2 text-[11px] font-semibold text-dark-500 uppercase trac
          +king-wider">                                                  
      286 +                      <Clock className="w-3 h-3" />           
      287 +                      Recently Used                           
      288 +                    </div>                                    
      289 +                    {recentModelsData.map(model => (          
      290 +                      <button                                 
      291 +                        key={`recent-${model.id}`}            
      292 +                        onClick={() => handleSelect(model.id)}
      293 +                        className={`w-full flex items-center j
          +ustify-between px-3 py-2.5 rounded-xl transition-all duration-
          +150 text-left group ${selectedModel === model.id              
      294 +                          ? 'bg-primary-500/10 border border-p
          +rimary-500/20'                                                
      295 +                          : 'hover:bg-dark-700/50 border borde
          +r-transparent'                                                
      296 +                          }`}                                 
      297 +                      >                                       
      298 +                        <div className="flex-1 min-w-0">      
      299 +                          <p className={`text-sm font-medium t
          +runcate ${selectedModel === model.id ? 'text-dark-50' : 'text-
          +dark-200 group-hover:text-dark-100'}`}>{model.name}</p>       
      300 +                          <p className="text-xs text-dark-500 
          +truncate">                                                    
      301 +                            {getProvider(model.id)}           
      302 +                            {model.contextLength && (         
      303 +                              <span className="ml-1.5 text-dar
          +k-600">• {Math.round(model.contextLength / 1000)}k</span>     
      304 +                            )}                                
      305 +                            {model.pricing && (               
      306 +                              <span className="ml-1.5 text-gre
          +en-500/80">                                                   
      307 +                                • ${(parseFloat(model.pricing.
          +prompt) * 1000000).toFixed(2)} / ${(parseFloat(model.pricing.c
          +ompletion) * 1000000).toFixed(2)}                             
      308 +                              </span>                         
      309 +                            )}                                
      310 +                          </p>                                
      311 +                        </div>                                
      312 +                        {selectedModel === model.id && (      
      313 +                          <div className="w-5 h-5 rounded-md b
          +g-primary-500 flex items-center justify-center flex-shrink-0 m
          +l-2">                                                         
      314 +                            <Check className="w-3 h-3 text-whi
          +te" />                                                        
      315 +                          </div>                              
      316 +                        )}                                    
      317 +                      </button>                               
      318 +                    ))}                                       
      319 +                  </div>                                      
      320 +                )}                                            
      321 +                                                              
      322 +                {/* All Models Section */}                    
      323 +                <div className="p-2">                         
      324 +                  {!searchQuery && (                          
      325 +                    <div className="px-3 py-2 text-[11px] font
          +-semibold text-dark-500 uppercase tracking-wider">            
      326 +                      All Models <span className="text-dark-60
          +0">({filteredModels.length})</span>                           
      327 +                    </div>                                    
      328 +                  )}                                          
      329 +                  {searchQuery && (                           
      330 +                    <div className="px-3 py-2 text-xs text-dar
          +k-400">                                                       
      331 +                      {filteredModels.length} result{filteredM
          +odels.length !== 1 ? 's' : ''} for "<span className="text-prim
          +ary-400">{searchQuery}</span>"                                
      332 +                    </div>                                    
      333 +                  )}                                          
      334 +                                                              
      335 +                  {filteredModels.length === 0 ? (            
      336 +                    <div className="py-12 text-center">       
      337 +                      <div className="w-12 h-12 rounded-xl bg-
          +dark-800 flex items-center justify-center mx-auto mb-3">      
      338 +                        <Search className="w-6 h-6 text-dark-5
          +00" />                                                        
      339 +                      </div>                                  
      340 +                      <p className="text-dark-400 font-medium"
          +>No models found</p>                                          
      341 +                      <p className="text-xs text-dark-500 mt-1
          +">Try a different search term</p>                             
      342 +                    </div>                                    
      343 +                  ) : (                                       
      344 +                    <div className="space-y-0.5">             
      345 +                      {filteredModels.map(model => (          
      346 +                        <button                               
      347 +                          key={model.id}                      
      348 +                          onClick={() => handleSelect(model.id
          +)}                                                            
      349 +                          className={`w-full flex items-center
          + justify-between px-3 py-2.5 rounded-xl transition-all duratio
          +n-150 text-left group ${selectedModel === model.id            
      350 +                            ? 'bg-primary-500/10 border border
          +-primary-500/20'                                              
      351 +                            : 'hover:bg-dark-700/50 border bor
          +der-transparent'                                              
      352 +                            }`}                               
      353 +                        >                                     
      354 +                          <div className="flex-1 min-w-0">    
      355 +                            <p className={`text-sm font-medium
          + truncate ${selectedModel === model.id ? 'text-dark-50' : 'tex
          +t-dark-200 group-hover:text-dark-100'}`}>{model.name}</p>     
      356 +                            <p className="text-xs text-dark-50
          +0 truncate">                                                  
      357 +                              {getProvider(model.id)}         
      358 +                              {model.contextLength && (       
      359 +                                <span className="ml-1.5 text-d
          +ark-600">• {Math.round(model.contextLength / 1000)}k</span>   
      360 +                              )}                              
      361 +                              {model.pricing && (             
      362 +                                <span className="ml-1.5 text-g
          +reen-500/80">                                                 
      363 +                                  • ${(parseFloat(model.pricin
          +g.prompt) * 1000000).toFixed(2)} / ${(parseFloat(model.pricing
          +.completion) * 1000000).toFixed(2)}                           
      364 +                                </span>                       
      365 +                              )}                              
      366 +                            </p>                              
      367 +                          </div>                              
      368 +                          {selectedModel === model.id && (    
      369 +                            <div className="w-5 h-5 rounded-md
          + bg-primary-500 flex items-center justify-center flex-shrink-0
          + ml-2">                                                       
      370 +                              <Check className="w-3 h-3 text-w
          +hite" />                                                      
      371 +                            </div>                            
      372 +                          )}                                  
      373 +                        </button>                             
      374 +                      ))}                                     
      375 +                    </div>                                    
      376 +                  )}                                          
      377 +                </div>                                        
      378 +              </>                                             
      379 +            )}                                                
      380 +          </div>                                              
      381 +        </div>                                                
      382 +      )}                                                      
      383 +    </div>                                                    
      384 +  );                                                          
      385 +}                                                             
      386 +                                                              
      387 +export default ModelSelector;                                 
      388 +export { DEFAULT_MODEL, RECENT_MODELS_KEY, MODELS_CACHE_KEY };
✔ Task #5 updated: status → completed
✔ Task #6 updated: status → in progress

● Now let me update the auth pages.

● Write(client\src\pages\Login.jsx)
  ⎿  Added 129 lines, removed 129 lines
        1 -import React, { useState, useContext } from 'react';         
        2 -import { Link } from 'react-router-dom';                     
        3 -import { MessageSquare, Lock, Mail, Sparkles } from 'lucide-re
          -act';                                                        
        4 -import { AuthContext } from '../contexts/AuthContext';       
        5 -                                                             
        6 -function Login() {                                           
        7 -  const [email, setEmail] = useState('');                    
        8 -  const [password, setPassword] = useState('');              
        9 -  const [error, setError] = useState('');                    
       10 -  const [loading, setLoading] = useState(false);             
       11 -  const { login } = useContext(AuthContext);                 
       12 -                                                             
       13 -  const handleSubmit = async (e) => {                        
       14 -    e.preventDefault();                                      
       15 -    setError('');                                            
       16 -    setLoading(true);                                        
       17 -                                                             
       18 -    try {                                                    
       19 -      const res = await fetch('/api/auth/login', {           
       20 -        method: 'POST',                                      
       21 -        headers: { 'Content-Type': 'application/json' },     
       22 -        body: JSON.stringify({ email, password })            
       23 -      });                                                    
       24 -                                                             
       25 -      const data = await res.json();                         
       26 -                                                             
       27 -      if (!res.ok) {                                         
       28 -        throw new Error(data.error || 'Login failed');       
       29 -      }                                                      
       30 -                                                             
       31 -      login(data.token, data.user);                          
       32 -    } catch (err) {                                          
       33 -      setError(err.message);                                 
       34 -    } finally {                                              
       35 -      setLoading(false);                                     
       36 -    }                                                        
       37 -  };                                                         
       38 -                                                             
       39 -  return (                                                   
       40 -    <div className="min-h-screen flex items-center justify-cen
          -ter bg-dark-950 bg-mesh p-4">                                
       41 -      <div className="max-w-md w-full">                      
       42 -        <div className="text-center mb-8">                   
       43 -          <div className="inline-flex items-center justify-cen
          -ter w-16 h-16 rounded-2xl gradient-primary mb-4 shadow-glow">
       44 -            <MessageSquare className="w-8 h-8 text-white" /> 
       45 -          </div>                                             
       46 -          <h1 className="text-4xl font-bold gradient-text mb-2
          -">Budi Chat</h1>                                             
       47 -          <p className="text-dark-400">Welcome back! Please si
          -gn in to continue.</p>                                       
       48 -        </div>                                               
       49 -                                                             
       50 -        <div className="glass-card rounded-2xl p-8">         
       51 -          <form onSubmit={handleSubmit} className="space-y-6">
          -                                                              
       52 -            {error && (                                      
       53 -              <div className="bg-red-500/20 border border-red-
          -500/30 text-red-300 px-4 py-3 rounded-lg text-sm">           
       54 -                {error}                                      
       55 -              </div>                                         
       56 -            )}                                               
       57 -                                                             
       58 -            <div>                                            
       59 -              <label className="block text-sm font-medium text
          --dark-200 mb-2">                                             
       60 -                Email Address                                
       61 -              </label>                                       
       62 -              <div className="relative">                     
       63 -                <Mail className="absolute left-3 top-1/2 -tran
          -slate-y-1/2 w-5 h-5 text-dark-400" />                        
       64 -                <input                                       
       65 -                  type="email"                               
       66 -                  value={email}                              
       67 -                  onChange={(e) => setEmail(e.target.value)} 
       68 -                  className="w-full pl-10 pr-4 py-3 rounded-lg
          - glass-input outline-none text-dark-100 bg-dark-800/50 transit
          -ion"                                                         
       69 -                  placeholder="you@example.com"              
       70 -                  required                                   
       71 -                />                                           
       72 -              </div>                                         
       73 -            </div>                                           
       74 -                                                             
       75 -            <div>                                            
       76 -              <label className="block text-sm font-medium text
          --dark-200 mb-2">                                             
       77 -                Password                                     
       78 -              </label>                                       
       79 -              <div className="relative">                     
       80 -                <Lock className="absolute left-3 top-1/2 -tran
          -slate-y-1/2 w-5 h-5 text-dark-400" />                        
       81 -                <input                                       
       82 -                  type="password"                            
       83 -                  value={password}                           
       84 -                  onChange={(e) => setPassword(e.target.value)
          -}                                                            
       85 -                  className="w-full pl-10 pr-4 py-3 rounded-lg
          - glass-input outline-none text-dark-100 bg-dark-800/50 transit
          -ion"                                                         
       86 -                  placeholder="••••••••"                     
       87 -                  required                                   
       88 -                />                                           
       89 -              </div>                                         
       90 -            </div>                                           
       91 -                                                             
       92 -            <button                                          
       93 -              type="submit"                                  
       94 -              disabled={loading}                             
       95 -              className="w-full gradient-primary text-white py
          --3 rounded-lg font-medium hover:shadow-glow transition-all dis
          -abled:opacity-50 disabled:cursor-not-allowed flex items-center
          - justify-center gap-2"                                       
       96 -            >                                                
       97 -              {loading ? (                                   
       98 -                <>                                           
       99 -                  <div className="animate-spin rounded-full h-
          -5 w-5 border-2 border-white border-t-transparent"></div>     
      100 -                  Signing in...                              
      101 -                </>                                          
      102 -              ) : (                                          
      103 -                <>                                           
      104 -                  <Sparkles className="w-5 h-5" />           
      105 -                  Sign In                                    
      106 -                </>                                          
      107 -              )}                                             
      108 -            </button>                                        
      109 -          </form>                                            
      110 -                                                             
      111 -          <div className="mt-6 text-center">                 
      112 -            <p className="text-sm text-dark-400">            
      113 -              Don't have an account?{' '}                    
      114 -              <Link to="/register" className="text-primary-400
          - hover:text-primary-300 font-medium">                        
      115 -                Sign up                                      
      116 -              </Link>                                        
      117 -            </p>                                             
      118 -          </div>                                             
      119 -        </div>                                               
      120 -                                                             
      121 -        <div className="mt-6 text-center text-sm text-dark-500
          -">                                                           
      122 -          <p>Multi-user AI chat with memories, tools & agent m
          -ode</p>                                                      
      123 -        </div>                                               
      124 -      </div>                                                 
      125 -    </div>                                                   
      126 -  );                                                         
      127 -}                                                            
      128 -                                                             
      129 -export default Login;                                        
        1 +import React, { useState, useContext } from 'react';          
        2 +import { Link } from 'react-router-dom';                      
        3 +import { MessageSquare, Lock, Mail, ArrowRight } from 'lucide-
          +react';                                                       
        4 +import { AuthContext } from '../contexts/AuthContext';        
        5 +                                                              
        6 +function Login() {                                            
        7 +  const [email, setEmail] = useState('');                     
        8 +  const [password, setPassword] = useState('');               
        9 +  const [error, setError] = useState('');                     
       10 +  const [loading, setLoading] = useState(false);              
       11 +  const { login } = useContext(AuthContext);                  
       12 +                                                              
       13 +  const handleSubmit = async (e) => {                         
       14 +    e.preventDefault();                                       
       15 +    setError('');                                             
       16 +    setLoading(true);                                         
       17 +                                                              
       18 +    try {                                                     
       19 +      const res = await fetch('/api/auth/login', {            
       20 +        method: 'POST',                                       
       21 +        headers: { 'Content-Type': 'application/json' },      
       22 +        body: JSON.stringify({ email, password })             
       23 +      });                                                     
       24 +                                                              
       25 +      const data = await res.json();                          
       26 +                                                              
       27 +      if (!res.ok) {                                          
       28 +        throw new Error(data.error || 'Login failed');        
       29 +      }                                                       
       30 +                                                              
       31 +      login(data.token, data.user);                           
       32 +    } catch (err) {                                           
       33 +      setError(err.message);                                  
       34 +    } finally {                                               
       35 +      setLoading(false);                                      
       36 +    }                                                         
       37 +  };                                                          
       38 +                                                              
       39 +  return (                                                    
       40 +    <div className="min-h-screen flex items-center justify-cen
          +ter bg-dark-950 bg-mesh p-4">                                 
       41 +      <div className="max-w-md w-full">                       
       42 +        <div className="text-center mb-8">                    
       43 +          <div className="inline-flex items-center justify-cen
          +ter w-16 h-16 rounded-2xl bg-primary-500 mb-4">               
       44 +            <MessageSquare className="w-8 h-8 text-white" />  
       45 +          </div>                                              
       46 +          <h1 className="text-4xl font-bold text-primary-400 m
          +b-2 tracking-tight">AI Chat Hub</h1>                          
       47 +          <p className="text-dark-400">Welcome back. Sign in t
          +o continue.</p>                                               
       48 +        </div>                                                
       49 +                                                              
       50 +        <div className="glass-card rounded-2xl p-8">          
       51 +          <form onSubmit={handleSubmit} className="space-y-6">
       52 +            {error && (                                       
       53 +              <div className="bg-red-500/10 border border-red-
          +500/20 text-red-400 px-4 py-3 rounded-xl text-sm">            
       54 +                {error}                                       
       55 +              </div>                                          
       56 +            )}                                                
       57 +                                                              
       58 +            <div>                                             
       59 +              <label className="block text-sm font-medium text
          +-dark-300 mb-2">                                              
       60 +                Email Address                                 
       61 +              </label>                                        
       62 +              <div className="relative">                      
       63 +                <Mail className="absolute left-3.5 top-1/2 -tr
          +anslate-y-1/2 w-5 h-5 text-dark-400" />                       
       64 +                <input                                        
       65 +                  type="email"                                
       66 +                  value={email}                               
       67 +                  onChange={(e) => setEmail(e.target.value)}  
       68 +                  className="w-full pl-11 pr-4 py-3 rounded-xl
          + glass-input outline-none text-dark-100 text-sm"              
       69 +                  placeholder="you@example.com"               
       70 +                  required                                    
       71 +                />                                            
       72 +              </div>                                          
       73 +            </div>                                            
       74 +                                                              
       75 +            <div>                                             
       76 +              <label className="block text-sm font-medium text
          +-dark-300 mb-2">                                              
       77 +                Password                                      
       78 +              </label>                                        
       79 +              <div className="relative">                      
       80 +                <Lock className="absolute left-3.5 top-1/2 -tr
          +anslate-y-1/2 w-5 h-5 text-dark-400" />                       
       81 +                <input                                        
       82 +                  type="password"                             
       83 +                  value={password}                            
       84 +                  onChange={(e) => setPassword(e.target.value)
          +}                                                             
       85 +                  className="w-full pl-11 pr-4 py-3 rounded-xl
          + glass-input outline-none text-dark-100 text-sm"              
       86 +                  placeholder="Enter your password"           
       87 +                  required                                    
       88 +                />                                            
       89 +              </div>                                          
       90 +            </div>                                            
       91 +                                                              
       92 +            <button                                           
       93 +              type="submit"                                   
       94 +              disabled={loading}                              
       95 +              className="w-full bg-primary-500 hover:bg-primar
          +y-600 text-white py-3 rounded-xl font-semibold transition-all 
          +duration-200 disabled:opacity-50 disabled:cursor-not-allowed f
          +lex items-center justify-center gap-2 active:scale-[0.98]"    
       96 +            >                                                 
       97 +              {loading ? (                                    
       98 +                <>                                            
       99 +                  <div className="animate-spin rounded-full h-
          +5 w-5 border-2 border-white border-t-transparent"></div>      
      100 +                  Signing in...                               
      101 +                </>                                           
      102 +              ) : (                                           
      103 +                <>                                            
      104 +                  Sign In                                     
      105 +                  <ArrowRight className="w-4 h-4" />          
      106 +                </>                                           
      107 +              )}                                              
      108 +            </button>                                         
      109 +          </form>                                             
      110 +                                                              
      111 +          <div className="mt-6 text-center">                  
      112 +            <p className="text-sm text-dark-400">             
      113 +              Don't have an account?{' '}                     
      114 +              <Link to="/register" className="text-primary-400
          + hover:text-primary-300 font-medium transition-colors">       
      115 +                Sign up                                       
      116 +              </Link>                                         
      117 +            </p>                                              
      118 +          </div>                                              
      119 +        </div>                                                
      120 +                                                              
      121 +        <div className="mt-6 text-center text-sm text-dark-500
          +">                                                            
      122 +          <p>Multi-user AI chat with memories, tools & agent m
          +ode</p>                                                       
      123 +        </div>                                                
      124 +      </div>                                                  
      125 +    </div>                                                    
      126 +  );                                                          
      127 +}                                                             
      128 +                                                              
      129 +export default Login;                                         

● Write(client\src\pages\Register.jsx)
  ⎿  Added 149 lines, removed 149 lines
        1 -import React, { useState, useContext } from 'react';         
        2 -import { Link } from 'react-router-dom';                     
        3 -import { MessageSquare, Lock, Mail, User, Sparkles } from 'luc
          -ide-react';                                                  
        4 -import { AuthContext } from '../contexts/AuthContext';       
        5 -                                                             
        6 -function Register() {                                        
        7 -  const [email, setEmail] = useState('');                    
        8 -  const [password, setPassword] = useState('');              
        9 -  const [name, setName] = useState('');                      
       10 -  const [error, setError] = useState('');                    
       11 -  const [loading, setLoading] = useState(false);             
       12 -  const { login } = useContext(AuthContext);                 
       13 -                                                             
       14 -  const handleSubmit = async (e) => {                        
       15 -    e.preventDefault();                                      
       16 -    setError('');                                            
       17 -    setLoading(true);                                        
       18 -                                                             
       19 -    try {                                                    
       20 -      const res = await fetch('/api/auth/register', {        
       21 -        method: 'POST',                                      
       22 -        headers: { 'Content-Type': 'application/json' },     
       23 -        body: JSON.stringify({ email, password, name })      
       24 -      });                                                    
       25 -                                                             
       26 -      const data = await res.json();                         
       27 -                                                             
       28 -      if (!res.ok) {                                         
       29 -        throw new Error(data.error || 'Registration failed');
       30 -      }                                                      
       31 -                                                             
       32 -      login(data.token, data.user);                          
       33 -    } catch (err) {                                          
       34 -      setError(err.message);                                 
       35 -    } finally {                                              
       36 -      setLoading(false);                                     
       37 -    }                                                        
       38 -  };                                                         
       39 -                                                             
       40 -  return (                                                   
       41 -    <div className="min-h-screen flex items-center justify-cen
          -ter bg-dark-950 bg-mesh p-4">                                
       42 -      <div className="max-w-md w-full">                      
       43 -        <div className="text-center mb-8">                   
       44 -          <div className="inline-flex items-center justify-cen
          -ter w-16 h-16 rounded-2xl gradient-primary mb-4 shadow-glow">
       45 -            <MessageSquare className="w-8 h-8 text-white" /> 
       46 -          </div>                                             
       47 -          <h1 className="text-4xl font-bold gradient-text mb-2
          -">Budi Chat</h1>                                             
       48 -          <p className="text-dark-400">Create your account to 
          -get started.</p>                                             
       49 -        </div>                                               
       50 -                                                             
       51 -        <div className="glass-card rounded-2xl p-8">         
       52 -          <form onSubmit={handleSubmit} className="space-y-6">
          -                                                              
       53 -            {error && (                                      
       54 -              <div className="bg-red-500/20 border border-red-
          -500/30 text-red-300 px-4 py-3 rounded-lg text-sm">           
       55 -                {error}                                      
       56 -              </div>                                         
       57 -            )}                                               
       58 -                                                             
       59 -            <div>                                            
       60 -              <label className="block text-sm font-medium text
          --dark-200 mb-2">                                             
       61 -                Full Name                                    
       62 -              </label>                                       
       63 -              <div className="relative">                     
       64 -                <User className="absolute left-3 top-1/2 -tran
          -slate-y-1/2 w-5 h-5 text-dark-400" />                        
       65 -                <input                                       
       66 -                  type="text"                                
       67 -                  value={name}                               
       68 -                  onChange={(e) => setName(e.target.value)}  
       69 -                  className="w-full pl-10 pr-4 py-3 rounded-lg
          - glass-input outline-none text-dark-100 bg-dark-800/50 transit
          -ion"                                                         
       70 -                  placeholder="John Doe"                     
       71 -                  required                                   
       72 -                />                                           
       73 -              </div>                                         
       74 -            </div>                                           
       75 -                                                             
       76 -            <div>                                            
       77 -              <label className="block text-sm font-medium text
          --dark-200 mb-2">                                             
       78 -                Email Address                                
       79 -              </label>                                       
       80 -              <div className="relative">                     
       81 -                <Mail className="absolute left-3 top-1/2 -tran
          -slate-y-1/2 w-5 h-5 text-dark-400" />                        
       82 -                <input                                       
       83 -                  type="email"                               
       84 -                  value={email}                              
       85 -                  onChange={(e) => setEmail(e.target.value)} 
       86 -                  className="w-full pl-10 pr-4 py-3 rounded-lg
          - glass-input outline-none text-dark-100 bg-dark-800/50 transit
          -ion"                                                         
       87 -                  placeholder="you@example.com"              
       88 -                  required                                   
       89 -                />                                           
       90 -              </div>                                         
       91 -            </div>                                           
       92 -                                                             
       93 -            <div>                                            
       94 -              <label className="block text-sm font-medium text
          --dark-200 mb-2">                                             
       95 -                Password                                     
       96 -              </label>                                       
       97 -              <div className="relative">                     
       98 -                <Lock className="absolute left-3 top-1/2 -tran
          -slate-y-1/2 w-5 h-5 text-dark-400" />                        
       99 -                <input                                       
      100 -                  type="password"                            
      101 -                  value={password}                           
      102 -                  onChange={(e) => setPassword(e.target.value)
          -}                                                            
      103 -                  className="w-full pl-10 pr-4 py-3 rounded-lg
          - glass-input outline-none text-dark-100 bg-dark-800/50 transit
          -ion"                                                         
      104 -                  placeholder="••••••••"                     
      105 -                  required                                   
      106 -                  minLength={6}                              
      107 -                />                                           
      108 -              </div>                                         
      109 -              <p className="mt-1 text-xs text-dark-500">At lea
          -st 6 characters</p>                                          
      110 -            </div>                                           
      111 -                                                             
      112 -            <button                                          
      113 -              type="submit"                                  
      114 -              disabled={loading}                             
      115 -              className="w-full gradient-primary text-white py
          --3 rounded-lg font-medium hover:shadow-glow transition-all dis
          -abled:opacity-50 disabled:cursor-not-allowed flex items-center
          - justify-center gap-2"                                       
      116 -            >                                                
      117 -              {loading ? (                                   
      118 -                <>                                           
      119 -                  <div className="animate-spin rounded-full h-
          -5 w-5 border-2 border-white border-t-transparent"></div>     
      120 -                  Creating account...                        
      121 -                </>                                          
      122 -              ) : (                                          
      123 -                <>                                           
      124 -                  <Sparkles className="w-5 h-5" />           
      125 -                  Create Account                             
      126 -                </>                                          
      127 -              )}                                             
      128 -            </button>                                        
      129 -          </form>                                            
      130 -                                                             
      131 -          <div className="mt-6 text-center">                 
      132 -            <p className="text-sm text-dark-400">            
      133 -              Already have an account?{' '}                  
      134 -              <Link to="/login" className="text-primary-400 ho
          -ver:text-primary-300 font-medium">                           
      135 -                Sign in                                      
      136 -              </Link>                                        
      137 -            </p>                                             
      138 -          </div>                                             
      139 -        </div>                                               
      140 -                                                             
      141 -        <div className="mt-6 text-center text-sm text-dark-500
          -">                                                           
      142 -          <p>Multi-user AI chat with memories, tools & agent m
          -ode</p>                                                      
      143 -        </div>                                               
      144 -      </div>                                                 
      145 -    </div>                                                   
      146 -  );                                                         
      147 -}                                                            
      148 -                                                             
      149 -export default Register;                                     
        1 +import React, { useState, useContext } from 'react';          
        2 +import { Link } from 'react-router-dom';                      
        3 +import { MessageSquare, Lock, Mail, User, ArrowRight } from 'l
          +ucide-react';                                                 
        4 +import { AuthContext } from '../contexts/AuthContext';        
        5 +                                                              
        6 +function Register() {                                         
        7 +  const [email, setEmail] = useState('');                     
        8 +  const [password, setPassword] = useState('');               
        9 +  const [name, setName] = useState('');                       
       10 +  const [error, setError] = useState('');                     
       11 +  const [loading, setLoading] = useState(false);              
       12 +  const { login } = useContext(AuthContext);                  
       13 +                                                              
       14 +  const handleSubmit = async (e) => {                         
       15 +    e.preventDefault();                                       
       16 +    setError('');                                             
       17 +    setLoading(true);                                         
       18 +                                                              
       19 +    try {                                                     
       20 +      const res = await fetch('/api/auth/register', {         
       21 +        method: 'POST',                                       
       22 +        headers: { 'Content-Type': 'application/json' },      
       23 +        body: JSON.stringify({ email, password, name })       
       24 +      });                                                     
       25 +                                                              
       26 +      const data = await res.json();                          
       27 +                                                              
       28 +      if (!res.ok) {                                          
       29 +        throw new Error(data.error || 'Registration failed'); 
       30 +      }                                                       
       31 +                                                              
       32 +      login(data.token, data.user);                           
       33 +    } catch (err) {                                           
       34 +      setError(err.message);                                  
       35 +    } finally {                                               
       36 +      setLoading(false);                                      
       37 +    }                                                         
       38 +  };                                                          
       39 +                                                              
       40 +  return (                                                    
       41 +    <div className="min-h-screen flex items-center justify-cen
          +ter bg-dark-950 bg-mesh p-4">                                 
       42 +      <div className="max-w-md w-full">                       
       43 +        <div className="text-center mb-8">                    
       44 +          <div className="inline-flex items-center justify-cen
          +ter w-16 h-16 rounded-2xl bg-primary-500 mb-4">               
       45 +            <MessageSquare className="w-8 h-8 text-white" />  
       46 +          </div>                                              
       47 +          <h1 className="text-4xl font-bold text-primary-400 m
          +b-2 tracking-tight">AI Chat Hub</h1>                          
       48 +          <p className="text-dark-400">Create your account to 
          +get started.</p>                                              
       49 +        </div>                                                
       50 +                                                              
       51 +        <div className="glass-card rounded-2xl p-8">          
       52 +          <form onSubmit={handleSubmit} className="space-y-6">
       53 +            {error && (                                       
       54 +              <div className="bg-red-500/10 border border-red-
          +500/20 text-red-400 px-4 py-3 rounded-xl text-sm">            
       55 +                {error}                                       
       56 +              </div>                                          
       57 +            )}                                                
       58 +                                                              
       59 +            <div>                                             
       60 +              <label className="block text-sm font-medium text
          +-dark-300 mb-2">                                              
       61 +                Full Name                                     
       62 +              </label>                                        
       63 +              <div className="relative">                      
       64 +                <User className="absolute left-3.5 top-1/2 -tr
          +anslate-y-1/2 w-5 h-5 text-dark-400" />                       
       65 +                <input                                        
       66 +                  type="text"                                 
       67 +                  value={name}                                
       68 +                  onChange={(e) => setName(e.target.value)}   
       69 +                  className="w-full pl-11 pr-4 py-3 rounded-xl
          + glass-input outline-none text-dark-100 text-sm"              
       70 +                  placeholder="John Doe"                      
       71 +                  required                                    
       72 +                />                                            
       73 +              </div>                                          
       74 +            </div>                                            
       75 +                                                              
       76 +            <div>                                             
       77 +              <label className="block text-sm font-medium text
          +-dark-300 mb-2">                                              
       78 +                Email Address                                 
       79 +              </label>                                        
       80 +              <div className="relative">                      
       81 +                <Mail className="absolute left-3.5 top-1/2 -tr
          +anslate-y-1/2 w-5 h-5 text-dark-400" />                       
       82 +                <input                                        
       83 +                  type="email"                                
       84 +                  value={email}                               
       85 +                  onChange={(e) => setEmail(e.target.value)}  
       86 +                  className="w-full pl-11 pr-4 py-3 rounded-xl
          + glass-input outline-none text-dark-100 text-sm"              
       87 +                  placeholder="you@example.com"               
       88 +                  required                                    
       89 +                />                                            
       90 +              </div>                                          
       91 +            </div>                                            
       92 +                                                              
       93 +            <div>                                             
       94 +              <label className="block text-sm font-medium text
          +-dark-300 mb-2">                                              
       95 +                Password                                      
       96 +              </label>                                        
       97 +              <div className="relative">                      
       98 +                <Lock className="absolute left-3.5 top-1/2 -tr
          +anslate-y-1/2 w-5 h-5 text-dark-400" />                       
       99 +                <input                                        
      100 +                  type="password"                             
      101 +                  value={password}                            
      102 +                  onChange={(e) => setPassword(e.target.value)
          +}                                                             
      103 +                  className="w-full pl-11 pr-4 py-3 rounded-xl
          + glass-input outline-none text-dark-100 text-sm"              
      104 +                  placeholder="Create a password"             
      105 +                  required                                    
      106 +                  minLength={6}                               
      107 +                />                                            
      108 +              </div>                                          
      109 +              <p className="mt-1.5 text-xs text-dark-500">At l
          +east 6 characters</p>                                         
      110 +            </div>                                            
      111 +                                                              
      112 +            <button                                           
      113 +              type="submit"                                   
      114 +              disabled={loading}                              
      115 +              className="w-full bg-primary-500 hover:bg-primar
          +y-600 text-white py-3 rounded-xl font-semibold transition-all 
          +duration-200 disabled:opacity-50 disabled:cursor-not-allowed f
          +lex items-center justify-center gap-2 active:scale-[0.98]"    
      116 +            >                                                 
      117 +              {loading ? (                                    
      118 +                <>                                            
      119 +                  <div className="animate-spin rounded-full h-
          +5 w-5 border-2 border-white border-t-transparent"></div>      
      120 +                  Creating account...                         
      121 +                </>                                           
      122 +              ) : (                                           
      123 +                <>                                            
      124 +                  Create Account                              
      125 +                  <ArrowRight className="w-4 h-4" />          
      126 +                </>                                           
      127 +              )}                                              
      128 +            </button>                                         
      129 +          </form>                                             
      130 +                                                              
      131 +          <div className="mt-6 text-center">                  
      132 +            <p className="text-sm text-dark-400">             
      133 +              Already have an account?{' '}                   
      134 +              <Link to="/login" className="text-primary-400 ho
          +ver:text-primary-300 font-medium transition-colors">          
      135 +                Sign in                                       
      136 +              </Link>                                         
      137 +            </p>                                              
      138 +          </div>                                              
      139 +        </div>                                                
      140 +                                                              
      141 +        <div className="mt-6 text-center text-sm text-dark-500
          +">                                                            
      142 +          <p>Multi-user AI chat with memories, tools & agent m
          +ode</p>                                                       
      143 +        </div>                                                
      144 +      </div>                                                  
      145 +    </div>                                                    
      146 +  );                                                          
      147 +}                                                             
      148 +                                                              
      149 +export default Register;                                      
✔ Task #6 updated: status → completed
✔ Task #7 updated: status → in progress

● Now let me update the Profile, StatsTab, and Memories pages.

● Write(client\src\pages\Profile.jsx)
  ⎿  Added 72 lines, removed 72 lines
       1 -import React, { useState, useContext } from 'react';          
       2 -import { useNavigate } from 'react-router-dom';               
       3 -import { ArrowLeft, User, BarChart2, Settings } from 'lucide-re
         -act';                                                         
       4 -import { AuthContext } from '../contexts/AuthContext';        
       5 -import ProfileTab from '../components/ProfileTab';            
       6 -import StatsTab from '../components/StatsTab';                
       7 -import SettingsTab from '../components/SettingsTab';          
       8 -                                                              
       9 -function Profile() {                                          
      10 -  const { user, logout } = useContext(AuthContext);           
      11 -  const navigate = useNavigate();                             
      12 -  const [activeTab, setActiveTab] = useState('profile');      
      13 -                                                              
      14 -  const tabs = [                                              
      15 -    { id: 'profile', label: 'Profile', icon: User },          
      16 -    { id: 'stats', label: 'Stats', icon: BarChart2 },         
      17 -    { id: 'settings', label: 'Settings', icon: Settings },    
      18 -  ];                                                          
      19 -                                                              
      20 -  return (                                                    
      21 -    <div className="min-h-screen bg-dark-950 bg-mesh">        
      22 -      <div className="max-w-6xl mx-auto p-6">                 
      23 -        <button                                               
      24 -          onClick={() => navigate('/')}                       
      25 -          className="mb-6 flex items-center gap-2 text-dark-400
         - hover:text-dark-200 transition-colors"                       
      26 -        >                                                     
      27 -          <ArrowLeft className="w-4 h-4" />                   
      28 -          Back to Chat                                        
      29 -        </button>                                             
      30 -                                                              
      31 -        <div className="flex gap-6">                          
      32 -          {/* Sidebar */}                                     
      33 -          <div className="w-56 shrink-0">                     
      34 -            <div className="glass-card rounded-2xl p-4 sticky t
         -op-6">                                                        
      35 -              <h1 className="text-xl font-bold gradient-text mb
         --4 px-2">Account</h1>                                         
      36 -              <nav className="space-y-1">                     
      37 -                {tabs.map((tab) => {                          
      38 -                  const Icon = tab.icon;                      
      39 -                  return (                                    
      40 -                    <button                                   
      41 -                      key={tab.id}                            
      42 -                      onClick={() => setActiveTab(tab.id)}    
      43 -                      className={`w-full flex items-center gap-
         -3 px-4 py-3 rounded-xl transition-all ${                      
      44 -                        activeTab === tab.id                  
      45 -                          ? 'gradient-primary text-white shadow
         --glow'                                                        
      46 -                          : 'text-dark-300 hover:text-dark-100 
         -hover:bg-dark-800/50'                                         
      47 -                      }`}                                     
      48 -                    >                                         
      49 -                      <Icon className="w-5 h-5" />            
      50 -                      <span className="font-medium">{tab.label}
         -</span>                                                       
      51 -                    </button>                                 
      52 -                  );                                          
      53 -                })}                                           
      54 -              </nav>                                          
      55 -            </div>                                            
      56 -          </div>                                              
      57 -                                                              
      58 -          {/* Content Area */}                                
      59 -          <div className="flex-1 min-w-0">                    
      60 -            <div className="glass-card rounded-2xl p-8">      
      61 -              {activeTab === 'profile' && <ProfileTab user={use
         -r} />}                                                        
      62 -              {activeTab === 'stats' && <StatsTab />}         
      63 -              {activeTab === 'settings' && <SettingsTab user={u
         -ser} logout={logout} />}                                      
      64 -            </div>                                            
      65 -          </div>                                              
      66 -        </div>                                                
      67 -      </div>                                                  
      68 -    </div>                                                    
      69 -  );                                                          
      70 -}                                                             
      71 -                                                              
      72 -export default Profile;                                       
       1 +import React, { useState, useContext } from 'react';           
       2 +import { useNavigate } from 'react-router-dom';                
       3 +import { ArrowLeft, User, BarChart2, Settings } from 'lucide-re
         +act';                                                          
       4 +import { AuthContext } from '../contexts/AuthContext';         
       5 +import ProfileTab from '../components/ProfileTab';             
       6 +import StatsTab from '../components/StatsTab';                 
       7 +import SettingsTab from '../components/SettingsTab';           
       8 +                                                               
       9 +function Profile() {                                           
      10 +  const { user, logout } = useContext(AuthContext);            
      11 +  const navigate = useNavigate();                              
      12 +  const [activeTab, setActiveTab] = useState('profile');       
      13 +                                                               
      14 +  const tabs = [                                               
      15 +    { id: 'profile', label: 'Profile', icon: User },           
      16 +    { id: 'stats', label: 'Stats', icon: BarChart2 },          
      17 +    { id: 'settings', label: 'Settings', icon: Settings },     
      18 +  ];                                                           
      19 +                                                               
      20 +  return (                                                     
      21 +    <div className="min-h-screen bg-dark-950 bg-mesh">         
      22 +      <div className="max-w-6xl mx-auto p-6">                  
      23 +        <button                                                
      24 +          onClick={() => navigate('/')}                        
      25 +          className="mb-6 flex items-center gap-2 text-dark-400
         + hover:text-dark-200 transition-colors"                        
      26 +        >                                                      
      27 +          <ArrowLeft className="w-4 h-4" />                    
      28 +          Back to Chat                                         
      29 +        </button>                                              
      30 +                                                               
      31 +        <div className="flex gap-6">                           
      32 +          {/* Sidebar */}                                      
      33 +          <div className="w-56 shrink-0">                      
      34 +            <div className="glass-card rounded-2xl p-4 sticky t
         +op-6">                                                         
      35 +              <h1 className="text-xl font-bold text-primary-400
         + mb-4 px-2 tracking-tight">Account</h1>                        
      36 +              <nav className="space-y-1">                      
      37 +                {tabs.map((tab) => {                           
      38 +                  const Icon = tab.icon;                       
      39 +                  return (                                     
      40 +                    <button                                    
      41 +                      key={tab.id}                             
      42 +                      onClick={() => setActiveTab(tab.id)}     
      43 +                      className={`w-full flex items-center gap-
         +3 px-4 py-3 rounded-xl transition-all duration-200 ${          
      44 +                        activeTab === tab.id                   
      45 +                          ? 'bg-primary-500 text-white'        
      46 +                          : 'text-dark-300 hover:text-dark-100 
         +hover:bg-dark-700/50'                                          
      47 +                      }`}                                      
      48 +                    >                                          
      49 +                      <Icon className="w-5 h-5" />             
      50 +                      <span className="font-medium">{tab.label}
         +</span>                                                        
      51 +                    </button>                                  
      52 +                  );                                           
      53 +                })}                                            
      54 +              </nav>                                           
      55 +            </div>                                             
      56 +          </div>                                               
      57 +                                                               
      58 +          {/* Content Area */}                                 
      59 +          <div className="flex-1 min-w-0">                     
      60 +            <div className="glass-card rounded-2xl p-8">       
      61 +              {activeTab === 'profile' && <ProfileTab user={use
         +r} />}                                                         
      62 +              {activeTab === 'stats' && <StatsTab />}          
      63 +              {activeTab === 'settings' && <SettingsTab user={u
         +ser} logout={logout} />}                                       
      64 +            </div>                                             
      65 +          </div>                                               
      66 +        </div>                                                 
      67 +      </div>                                                   
      68 +    </div>                                                     
      69 +  );                                                           
      70 +}                                                              
      71 +                                                               
      72 +export default Profile;                                        

● Write(client\src\components\StatsTab.jsx)
  ⎿  Added 13 lines, removed 15 lines
      129    const activeDays = weekData.filter(
      130      (d) => d.hasActivity && !d.isFuture,
      131    ).length;
      132 -  const progressPercent =                                     
      133 -    daysUpToToday > 0 ? (activeDays / daysUpToToday) * 100 : 0
          -;                                                             
      132  
      133    return (
      134      <div>
      137 -      <h2 className="text-2xl font-bold text-dark-100 mb-2">  
      135 +      <h2 className="text-2xl font-bold text-dark-100 mb-2 tra
          +cking-tight">                                                 
      136          Usage Statistics
      137        </h2>
      138        <p className="text-dark-400 mb-6">
     ...
      140        </p>
      141  
      142        {/* Weekly Activity Calendar */}
      145 -      <div className="bg-dark-800/30 rounded-xl p-6 border bor
          -der-dark-700/30 mb-8">                                        
      143 +      <div className="bg-dark-800/50 rounded-xl p-6 border bor
          +der-dark-700/50 mb-8">                                        
      144          <h3 className="text-lg font-semibold text-dark-100 mb-
           4 flex items-center gap-2">
      145            <Calendar className="w-5 h-5 text-accent-400" />
      146            Weekly Activity
     ...
      159                      transition-all duration-300 cursor-default
      160                      ${
      161                        day.hasActivity
      164 -                        ? "bg-gradient-to-br from-primary-500 
          -to-accent-500 text-white shadow-lg shadow-primary-500/30"     
      162 +                        ? "bg-primary-500 text-white"         
      163                          : day.isToday
      164                            ? "bg-dark-700 border-2 border-prima
           ry-500/50 text-dark-300"
      165                            : day.isFuture
     ...
      196  
      197                  {/* Hover tooltip */}
      198                  <div className="absolute -top-14 left-1/2 -tra
           nslate-x-1/2 opacity-0 group-hover:opacity-100 transition-opac
           ity pointer-events-none z-20">
      201 -                  <div className="bg-dark-800 border border-da
          -rk-600 rounded-lg px-3 py-2 text-xs whitespace-nowrap shadow-x
          -l">                                                           
      199 +                  <div className="bg-dark-800 border border-da
          +rk-700 rounded-lg px-3 py-2 text-xs whitespace-nowrap shadow-x
          +l">                                                           
      200                      <div className="text-dark-300 font-medium"
           >
      201                        {new Date(day.date).toLocaleDateString("
           en-US", {
      202                          weekday: "long",
     ...
      212                      </div>
      213                    </div>
      214                    {/* Tooltip arrow */}
      217 -                  <div className="absolute left-1/2 -translate
          --x-1/2 -bottom-1 w-2 h-2 bg-dark-800 border-r border-b border-
          -dark-600 rotate-45" />                                        
      215 +                  <div className="absolute left-1/2 -translate
          +-x-1/2 -bottom-1 w-2 h-2 bg-dark-800 border-r border-b border-
          +dark-700 rotate-45" />                                        
      216                  </div>
      217                </div>
      218  
     ...
      221                  <div
      222                    className={`flex-1 h-1 mx-1 rounded-full sel
           f-start mt-[22px] min-w-[40px] ${
      223                      day.hasActivity && weekData[index + 1].has
           Activity
      226 -                      ? "bg-gradient-to-r from-primary-500 to-
          -accent-500"                                                   
      224 +                      ? "bg-primary-500"                      
      225                        : day.hasActivity || weekData[index + 1]
           .hasActivity
      228 -                        ? "bg-gradient-to-r from-primary-500/3
          -0 to-accent-500/30"                                           
      226 +                        ? "bg-primary-500/30"                 
      227                          : "bg-dark-700"
      228                    }`}
      229                  />
     ...
      280        </div>
      281  
      282        {/* Top 3 Models */}
      285 -      <div className="bg-dark-800/30 rounded-xl p-6 border bor
          -der-dark-700/30">                                             
      283 +      <div className="bg-dark-800/50 rounded-xl p-6 border bor
          +der-dark-700/50">                                             
      284          <h3 className="text-lg font-semibold text-dark-100 mb-
           4 flex items-center gap-2">
      285            <BarChart2 className="w-5 h-5 text-primary-400" />
      286            Top 3 Models by Token Usage
     ...
      298                    <div
      299                      className={`text-2xl font-bold w-8 shrink-
           0 ${
      300                        idx === 0
      303 -                        ? "text-yellow-400"                   
      301 +                        ? "text-primary-400"                  
      302                          : idx === 1
      303                            ? "text-dark-400"
      306 -                          : "text-amber-700"                  
      304 +                          : "text-accent-500"                 
      305                      }`}
      306                    >
      307                      {idx + 1}
     ...
      331  
      332                      <div className="h-2 bg-dark-700 rounded-fu
           ll overflow-hidden">
      333                        <div
      336 -                        className="h-full bg-gradient-to-r fro
          -m-primary-500 to-accent-500 rounded-full transition-all durati
          -on-500"                                                       
      334 +                        className="h-full bg-primary-500 round
          +ed-full transition-all duration-500"                          
      335                          style={{
      336                            width: `${(model.total_tokens / maxT
           okens) * 100}%`,
      337                          }}
     ...
      347  
      348        {/* Additional Stats */}
      349        <div className="mt-6 grid grid-cols-2 gap-4">
      352 -        <div className="bg-dark-800/30 p-4 rounded-lg border b
          -order-dark-700/30">                                           
      350 +        <div className="bg-dark-800/50 p-4 rounded-xl border b
          +order-dark-700/50">                                           
      351            <div className="flex items-center gap-2 text-dark-40
           0 text-sm mb-1">
      352              <Hash className="w-4 h-4" />
      353              Total Messages
     ...
      357            </div>
      358          </div>
      359  
      362 -        <div className="bg-dark-800/30 p-4 rounded-lg border b
          -order-dark-700/30">                                           
      360 +        <div className="bg-dark-800/50 p-4 rounded-xl border b
          +order-dark-700/50">                                           
      361            <div className="text-dark-400 text-sm mb-1">Avg Resp
           onse Time</div>
      362            <div className="text-xl font-bold text-dark-200">
      363              {totals.avg_response_time_ms}ms

● Write(client\src\pages\Memories.jsx)
  ⎿  Added 299 lines, removed 297 lines
        1 -import React, { useState, useEffect } from 'react';          
        2 -import { useNavigate } from 'react-router-dom';              
        3 -import { ArrowLeft, Brain, Plus, Trash2, Edit2, Save, X, Star 
          -} from 'lucide-react';                                       
        4 -                                                             
        5 -function Memories() {                                        
        6 -  const navigate = useNavigate();                            
        7 -  const [memories, setMemories] = useState([]);              
        8 -  const [loading, setLoading] = useState(false);             
        9 -  const [editingId, setEditingId] = useState(null);          
       10 -  const [showNewMemory, setShowNewMemory] = useState(false); 
       11 -  const [formData, setFormData] = useState({                 
       12 -    content: '',                                             
       13 -    category: 'general',                                     
       14 -    importance: 1                                            
       15 -  });                                                        
       16 -                                                             
       17 -  useEffect(() => {                                          
       18 -    loadMemories();                                          
       19 -  }, []);                                                    
       20 -                                                             
       21 -  const loadMemories = async () => {                         
       22 -    try {                                                    
       23 -      const res = await fetch('/api/memories', {             
       24 -        headers: { 'Authorization': `Bearer ${localStorage.get
          -Item('token')}` }                                            
       25 -      });                                                    
       26 -      const data = await res.json();                         
       27 -      setMemories(data);                                     
       28 -    } catch (error) {                                        
       29 -      console.error('Failed to load memories:', error);      
       30 -    }                                                        
       31 -  };                                                         
       32 -                                                             
       33 -  const handleSubmit = async (e) => {                        
       34 -    e.preventDefault();                                      
       35 -    setLoading(true);                                        
       36 -                                                             
       37 -    try {                                                    
       38 -      if (editingId) {                                       
       39 -        await fetch(`/api/memories/${editingId}`, {          
       40 -          method: 'PUT',                                     
       41 -          headers: {                                         
       42 -            'Content-Type': 'application/json',              
       43 -            'Authorization': `Bearer ${localStorage.getItem('t
          -oken')}`                                                     
       44 -          },                                                 
       45 -          body: JSON.stringify(formData)                     
       46 -        });                                                  
       47 -      } else {                                               
       48 -        await fetch('/api/memories', {                       
       49 -          method: 'POST',                                    
       50 -          headers: {                                         
       51 -            'Content-Type': 'application/json',              
       52 -            'Authorization': `Bearer ${localStorage.getItem('t
          -oken')}`                                                     
       53 -          },                                                 
       54 -          body: JSON.stringify(formData)                     
       55 -        });                                                  
       56 -      }                                                      
       57 -                                                             
       58 -      setFormData({ content: '', category: 'general', importan
          -ce: 1 });                                                    
       59 -      setEditingId(null);                                    
       60 -      setShowNewMemory(false);                               
       61 -      loadMemories();                                        
       62 -    } catch (error) {                                        
       63 -      console.error('Failed to save memory:', error);        
       64 -      alert('Failed to save memory');                        
       65 -    } finally {                                              
       66 -      setLoading(false);                                     
       67 -    }                                                        
       68 -  };                                                         
       69 -                                                             
       70 -  const handleEdit = (memory) => {                           
       71 -    setFormData({                                            
       72 -      content: memory.content,                               
       73 -      category: memory.category,                             
       74 -      importance: memory.importance                          
       75 -    });                                                      
       76 -    setEditingId(memory.id);                                 
       77 -    setShowNewMemory(true);                                  
       78 -  };                                                         
       79 -                                                             
       80 -  const handleDelete = async (id) => {                       
       81 -    if (!confirm('Are you sure you want to delete this memory?
          -')) return;                                                  
       82 -                                                             
       83 -    try {                                                    
       84 -      await fetch(`/api/memories/${id}`, {                   
       85 -        method: 'DELETE',                                    
       86 -        headers: { 'Authorization': `Bearer ${localStorage.get
          -Item('token')}` }                                            
       87 -      });                                                    
       88 -      loadMemories();                                        
       89 -    } catch (error) {                                        
       90 -      console.error('Failed to delete memory:', error);      
       91 -    }                                                        
       92 -  };                                                         
       93 -                                                             
       94 -  const cancelEdit = () => {                                 
       95 -    setFormData({ content: '', category: 'general', importance
          -: 1 });                                                      
       96 -    setEditingId(null);                                      
       97 -    setShowNewMemory(false);                                 
       98 -  };                                                         
       99 -                                                             
      100 -  const getCategoryColor = (category) => {                   
      101 -    const colors = {                                         
      102 -      general: 'bg-dark-600/50 text-dark-200 border-dark-500/5
          -0',                                                          
      103 -      personal: 'bg-primary-500/20 text-primary-300 border-pri
          -mary-500/30',                                                
      104 -      work: 'bg-accent-500/20 text-accent-300 border-accent-50
          -0/30',                                                       
      105 -      preferences: 'bg-purple-500/20 text-purple-300 border-pu
          -rple-500/30'                                                 
      106 -    };                                                       
      107 -    return colors[category] || colors.general;               
      108 -  };                                                         
      109 -                                                             
      110 -  return (                                                   
      111 -    <div className="min-h-screen bg-dark-950 bg-mesh">       
      112 -      <div className="max-w-4xl mx-auto p-6">                
      113 -        <button                                              
      114 -          onClick={() => navigate('/')}                      
      115 -          className="mb-6 flex items-center gap-2 text-dark-40
          -0 hover:text-dark-200 transition-colors"                     
      116 -        >                                                    
      117 -          <ArrowLeft className="w-4 h-4" />                  
      118 -          Back to Chat                                       
      119 -        </button>                                            
      120 -                                                             
      121 -        <div className="glass-card rounded-2xl p-8">         
      122 -          <div className="flex items-center justify-between mb
          --8">                                                         
      123 -            <div>                                            
      124 -              <h1 className="text-3xl font-bold gradient-text 
          -mb-2 flex items-center gap-3">                               
      125 -                <Brain className="w-8 h-8" />                
      126 -                Memories                                     
      127 -              </h1>                                          
      128 -              <p className="text-dark-400">                  
      129 -                Store important context that the AI can refere
          -nce in conversations                                         
      130 -              </p>                                           
      131 -            </div>                                           
      132 -                                                             
      133 -            {!showNewMemory && (                             
      134 -              <button                                        
      135 -                onClick={() => setShowNewMemory(true)}       
      136 -                className="px-4 py-2 gradient-primary text-whi
          -te rounded-lg font-medium hover:shadow-glow transition-all fle
          -x items-center gap-2"                                        
      137 -              >                                              
      138 -                <Plus className="w-4 h-4" />                 
      139 -                Add Memory                                   
      140 -              </button>                                      
      141 -            )}                                               
      142 -          </div>                                             
      143 -                                                             
      144 -          {/* New/Edit Memory Form */}                       
      145 -          {showNewMemory && (                                
      146 -            <form onSubmit={handleSubmit} className="mb-8 p-6 
          -glass rounded-xl border border-primary-500/30">              
      147 -              <div className="flex items-center justify-betwee
          -n mb-4">                                                     
      148 -                <h3 className="font-semibold text-lg text-dark
          --100">                                                       
      149 -                  {editingId ? 'Edit Memory' : 'New Memory'} 
      150 -                </h3>                                        
      151 -                <button                                      
      152 -                  type="button"                              
      153 -                  onClick={cancelEdit}                       
      154 -                  className="p-1 hover:bg-dark-700/50 rounded 
          -transition-colors"                                           
      155 -                >                                            
      156 -                  <X className="w-5 h-5 text-dark-400" />    
      157 -                </button>                                    
      158 -              </div>                                         
      159 -                                                             
      160 -              <div className="space-y-4">                    
      161 -                <div>                                        
      162 -                  <label className="block text-sm font-medium 
          -text-dark-200 mb-2">                                         
      163 -                    Content                                  
      164 -                  </label>                                   
      165 -                  <textarea                                  
      166 -                    value={formData.content}                 
      167 -                    onChange={(e) => setFormData({ ...formData
          -, content: e.target.value })}                                
      168 -                    className="w-full px-4 py-3 rounded-lg gla
          -ss-input outline-none resize-none text-dark-100 bg-dark-800/50
          -"                                                            
      169 -                    rows="4"                                 
      170 -                    placeholder="What should the AI remember a
          -bout you?"                                                   
      171 -                    required                                 
      172 -                  />                                         
      173 -                </div>                                       
      174 -                                                             
      175 -                <div className="grid grid-cols-2 gap-4">     
      176 -                  <div>                                      
      177 -                    <label className="block text-sm font-mediu
          -m text-dark-200 mb-2">                                       
      178 -                      Category                               
      179 -                    </label>                                 
      180 -                    <select                                  
      181 -                      value={formData.category}              
      182 -                      onChange={(e) => setFormData({ ...formDa
          -ta, category: e.target.value })}                             
      183 -                      className="w-full px-4 py-3 rounded-lg g
          -lass-input outline-none text-dark-100 bg-dark-800"           
      184 -                    >                                        
      185 -                      <option value="general">General</option>
          -                                                              
      186 -                      <option value="personal">Personal</optio
          -n>                                                           
      187 -                      <option value="work">Work</option>     
      188 -                      <option value="preferences">Preferences<
          -/option>                                                     
      189 -                    </select>                                
      190 -                  </div>                                     
      191 -                                                             
      192 -                  <div>                                      
      193 -                    <label className="block text-sm font-mediu
          -m text-dark-200 mb-2">                                       
      194 -                      Importance: {formData.importance}      
      195 -                    </label>                                 
      196 -                    <input                                   
      197 -                      type="range"                           
      198 -                      min="1"                                
      199 -                      max="5"                                
      200 -                      value={formData.importance}            
      201 -                      onChange={(e) => setFormData({ ...formDa
          -ta, importance: parseInt(e.target.value) })}                 
      202 -                      className="w-full"                     
      203 -                    />                                       
      204 -                    <div className="flex justify-between text-
          -xs text-dark-500 mt-1">                                      
      205 -                      <span>Low</span>                       
      206 -                      <span>High</span>                      
      207 -                    </div>                                   
      208 -                  </div>                                     
      209 -                </div>                                       
      210 -                                                             
      211 -                <button                                      
      212 -                  type="submit"                              
      213 -                  disabled={loading}                         
      214 -                  className="w-full gradient-primary text-whit
          -e py-3 rounded-lg font-medium hover:shadow-glow transition-all
          - disabled:opacity-50 flex items-center justify-center gap-2" 
      215 -                >                                            
      216 -                  {loading ? (                               
      217 -                    <>                                       
      218 -                      <div className="animate-spin rounded-ful
          -l h-5 w-5 border-2 border-white border-t-transparent"></div> 
      219 -                      Saving...                              
      220 -                    </>                                      
      221 -                  ) : (                                      
      222 -                    <>                                       
      223 -                      <Save className="w-4 h-4" />           
      224 -                      {editingId ? 'Update Memory' : 'Save Mem
          -ory'}                                                        
      225 -                    </>                                      
      226 -                  )}                                         
      227 -                </button>                                    
      228 -              </div>                                         
      229 -            </form>                                          
      230 -          )}                                                 
      231 -                                                             
      232 -          {/* Memories List */}                              
      233 -          <div className="space-y-4">                        
      234 -            {memories.length === 0 ? (                       
      235 -              <div className="text-center py-12">            
      236 -                <Brain className="w-16 h-16 text-dark-600 mx-a
          -uto mb-4" />                                                 
      237 -                <p className="text-dark-400">No memories yet. 
          -Add your first memory to help the AI remember important contex
          -t.</p>                                                       
      238 -              </div>                                         
      239 -            ) : (                                            
      240 -              memories.map(memory => (                       
      241 -                <div                                         
      242 -                  key={memory.id}                            
      243 -                  className="p-5 glass rounded-xl hover:border
          --primary-500/30 transition-all"                              
      244 -                >                                            
      245 -                  <div className="flex items-start justify-bet
          -ween gap-4">                                                 
      246 -                    <div className="flex-1">                 
      247 -                      <div className="flex items-center gap-2 
          -mb-2">                                                       
      248 -                        <span className={`px-2.5 py-1 rounded-
          -full text-xs font-medium border ${getCategoryColor(memory.cate
          -gory)}`}>                                                    
      249 -                          {memory.category}                  
      250 -                        </span>                              
      251 -                        <div className="flex items-center gap-
          -0.5">                                                        
      252 -                          {[...Array(5)].map((_, i) => (     
      253 -                            <Star                            
      254 -                              key={i}                        
      255 -                              className={`w-3 h-3 ${         
      256 -                                i < memory.importance        
      257 -                                  ? 'text-yellow-400 fill-yell
          -ow-400'                                                      
      258 -                                  : 'text-dark-600'          
      259 -                              }`}                            
      260 -                            />                               
      261 -                          ))}                                
      262 -                        </div>                               
      263 -                      </div>                                 
      264 -                      <p className="text-dark-200 whitespace-p
          -re-wrap">{memory.content}</p>                                
      265 -                      <p className="text-xs text-dark-500 mt-2
          -">                                                           
      266 -                        Created {new Date(memory.created_at).t
          -oLocaleDateString()}                                         
      267 -                      </p>                                   
      268 -                    </div>                                   
      269 -                                                             
      270 -                    <div className="flex gap-2">             
      271 -                      <button                                
      272 -                        onClick={() => handleEdit(memory)}   
      273 -                        className="p-2 hover:bg-primary-500/20
          - rounded-lg transition-colors"                               
      274 -                        title="Edit"                         
      275 -                      >                                      
      276 -                        <Edit2 className="w-4 h-4 text-primary
          --400" />                                                     
      277 -                      </button>                              
      278 -                      <button                                
      279 -                        onClick={() => handleDelete(memory.id)
          -}                                                            
      280 -                        className="p-2 hover:bg-red-500/20 rou
          -nded-lg transition-colors"                                   
      281 -                        title="Delete"                       
      282 -                      >                                      
      283 -                        <Trash2 className="w-4 h-4 text-red-40
          -0" />                                                        
      284 -                      </button>                              
      285 -                    </div>                                   
      286 -                  </div>                                     
      287 -                </div>                                       
      288 -              ))                                             
      289 -            )}                                               
      290 -          </div>                                             
      291 -        </div>                                               
      292 -      </div>                                                 
      293 -    </div>                                                   
      294 -  );                                                         
      295 -}                                                            
      296 -                                                             
      297 -export default Memories;                                     
        1 +import React, { useState, useEffect } from 'react';           
        2 +import { useNavigate } from 'react-router-dom';               
        3 +import { ArrowLeft, Brain, Plus, Trash2, Edit2, Save, X, Star 
          +} from 'lucide-react';                                        
        4 +                                                              
        5 +function Memories() {                                         
        6 +  const navigate = useNavigate();                             
        7 +  const [memories, setMemories] = useState([]);               
        8 +  const [loading, setLoading] = useState(false);              
        9 +  const [editingId, setEditingId] = useState(null);           
       10 +  const [showNewMemory, setShowNewMemory] = useState(false);  
       11 +  const [formData, setFormData] = useState({                  
       12 +    content: '',                                              
       13 +    category: 'general',                                      
       14 +    importance: 1                                             
       15 +  });                                                         
       16 +                                                              
       17 +  useEffect(() => {                                           
       18 +    loadMemories();                                           
       19 +  }, []);                                                     
       20 +                                                              
       21 +  const loadMemories = async () => {                          
       22 +    try {                                                     
       23 +      const res = await fetch('/api/memories', {              
       24 +        headers: { 'Authorization': `Bearer ${localStorage.get
          +Item('token')}` }                                             
       25 +      });                                                     
       26 +      const data = await res.json();                          
       27 +      setMemories(data);                                      
       28 +    } catch (error) {                                         
       29 +      console.error('Failed to load memories:', error);       
       30 +    }                                                         
       31 +  };                                                          
       32 +                                                              
       33 +  const handleSubmit = async (e) => {                         
       34 +    e.preventDefault();                                       
       35 +    setLoading(true);                                         
       36 +                                                              
       37 +    try {                                                     
       38 +      if (editingId) {                                        
       39 +        await fetch(`/api/memories/${editingId}`, {           
       40 +          method: 'PUT',                                      
       41 +          headers: {                                          
       42 +            'Content-Type': 'application/json',               
       43 +            'Authorization': `Bearer ${localStorage.getItem('t
          +oken')}`                                                      
       44 +          },                                                  
       45 +          body: JSON.stringify(formData)                      
       46 +        });                                                   
       47 +      } else {                                                
       48 +        await fetch('/api/memories', {                        
       49 +          method: 'POST',                                     
       50 +          headers: {                                          
       51 +            'Content-Type': 'application/json',               
       52 +            'Authorization': `Bearer ${localStorage.getItem('t
          +oken')}`                                                      
       53 +          },                                                  
       54 +          body: JSON.stringify(formData)                      
       55 +        });                                                   
       56 +      }                                                       
       57 +                                                              
       58 +      setFormData({ content: '', category: 'general', importan
          +ce: 1 });                                                     
       59 +      setEditingId(null);                                     
       60 +      setShowNewMemory(false);                                
       61 +      loadMemories();                                         
       62 +    } catch (error) {                                         
       63 +      console.error('Failed to save memory:', error);         
       64 +      alert('Failed to save memory');                         
       65 +    } finally {                                               
       66 +      setLoading(false);                                      
       67 +    }                                                         
       68 +  };                                                          
       69 +                                                              
       70 +  const handleEdit = (memory) => {                            
       71 +    setFormData({                                             
       72 +      content: memory.content,                                
       73 +      category: memory.category,                              
       74 +      importance: memory.importance                           
       75 +    });                                                       
       76 +    setEditingId(memory.id);                                  
       77 +    setShowNewMemory(true);                                   
       78 +  };                                                          
       79 +                                                              
       80 +  const handleDelete = async (id) => {                        
       81 +    if (!confirm('Are you sure you want to delete this memory?
          +')) return;                                                   
       82 +                                                              
       83 +    try {                                                     
       84 +      await fetch(`/api/memories/${id}`, {                    
       85 +        method: 'DELETE',                                     
       86 +        headers: { 'Authorization': `Bearer ${localStorage.get
          +Item('token')}` }                                             
       87 +      });                                                     
       88 +      loadMemories();                                         
       89 +    } catch (error) {                                         
       90 +      console.error('Failed to delete memory:', error);       
       91 +    }                                                         
       92 +  };                                                          
       93 +                                                              
       94 +  const cancelEdit = () => {                                  
       95 +    setFormData({ content: '', category: 'general', importance
          +: 1 });                                                       
       96 +    setEditingId(null);                                       
       97 +    setShowNewMemory(false);                                  
       98 +  };                                                          
       99 +                                                              
      100 +  const getCategoryColor = (category) => {                    
      101 +    const colors = {                                          
      102 +      general: 'bg-dark-700/50 text-dark-300 border-dark-600',
      103 +      personal: 'bg-primary-500/10 text-primary-400 border-pri
          +mary-500/20',                                                 
      104 +      work: 'bg-accent-500/10 text-accent-400 border-accent-50
          +0/20',                                                        
      105 +      preferences: 'bg-purple-500/10 text-purple-400 border-pu
          +rple-500/20'                                                  
      106 +    };                                                        
      107 +    return colors[category] || colors.general;                
      108 +  };                                                          
      109 +                                                              
      110 +  return (                                                    
      111 +    <div className="min-h-screen bg-dark-950 bg-mesh">        
      112 +      <div className="max-w-4xl mx-auto p-6">                 
      113 +        <button                                               
      114 +          onClick={() => navigate('/')}                       
      115 +          className="mb-6 flex items-center gap-2 text-dark-40
          +0 hover:text-dark-200 transition-colors"                      
      116 +        >                                                     
      117 +          <ArrowLeft className="w-4 h-4" />                   
      118 +          Back to Chat                                        
      119 +        </button>                                             
      120 +                                                              
      121 +        <div className="glass-card rounded-2xl p-8">          
      122 +          <div className="flex items-center justify-between mb
          +-8">                                                          
      123 +            <div>                                             
      124 +              <h1 className="text-3xl font-bold text-primary-4
          +00 mb-2 flex items-center gap-3 tracking-tight">              
      125 +                <Brain className="w-8 h-8" />                 
      126 +                Memories                                      
      127 +              </h1>                                           
      128 +              <p className="text-dark-400">                   
      129 +                Store important context that the AI can refere
          +nce in conversations                                          
      130 +              </p>                                            
      131 +            </div>                                            
      132 +                                                              
      133 +            {!showNewMemory && (                              
      134 +              <button                                         
      135 +                onClick={() => setShowNewMemory(true)}        
      136 +                className="px-4 py-2.5 bg-primary-500 hover:bg
          +-primary-600 text-white rounded-xl font-semibold transition-al
          +l duration-200 flex items-center gap-2 active:scale-[0.98]"   
      137 +              >                                               
      138 +                <Plus className="w-4 h-4" />                  
      139 +                Add Memory                                    
      140 +              </button>                                       
      141 +            )}                                                
      142 +          </div>                                              
      143 +                                                              
      144 +          {/* New/Edit Memory Form */}                        
      145 +          {showNewMemory && (                                 
      146 +            <form onSubmit={handleSubmit} className="mb-8 p-6 
          +bg-dark-800/50 rounded-xl border border-primary-500/20">      
      147 +              <div className="flex items-center justify-betwee
          +n mb-4">                                                      
      148 +                <h3 className="font-semibold text-lg text-dark
          +-100">                                                        
      149 +                  {editingId ? 'Edit Memory' : 'New Memory'}  
      150 +                </h3>                                         
      151 +                <button                                       
      152 +                  type="button"                               
      153 +                  onClick={cancelEdit}                        
      154 +                  className="p-1.5 hover:bg-dark-700/50 rounde
          +d-lg transition-colors"                                       
      155 +                >                                             
      156 +                  <X className="w-5 h-5 text-dark-400" />     
      157 +                </button>                                     
      158 +              </div>                                          
      159 +                                                              
      160 +              <div className="space-y-4">                     
      161 +                <div>                                         
      162 +                  <label className="block text-sm font-medium 
          +text-dark-300 mb-2">                                          
      163 +                    Content                                   
      164 +                  </label>                                    
      165 +                  <textarea                                   
      166 +                    value={formData.content}                  
      167 +                    onChange={(e) => setFormData({ ...formData
          +, content: e.target.value })}                                 
      168 +                    className="w-full px-4 py-3 rounded-xl gla
          +ss-input outline-none resize-none text-dark-100 text-sm"      
      169 +                    rows="4"                                  
      170 +                    placeholder="What should the AI remember a
          +bout you?"                                                    
      171 +                    required                                  
      172 +                  />                                          
      173 +                </div>                                        
      174 +                                                              
      175 +                <div className="grid grid-cols-2 gap-4">      
      176 +                  <div>                                       
      177 +                    <label className="block text-sm font-mediu
          +m text-dark-300 mb-2">                                        
      178 +                      Category                                
      179 +                    </label>                                  
      180 +                    <select                                   
      181 +                      value={formData.category}               
      182 +                      onChange={(e) => setFormData({ ...formDa
          +ta, category: e.target.value })}                              
      183 +                      className="w-full px-4 py-3 rounded-xl g
          +lass-input outline-none text-dark-100 bg-dark-800 text-sm"    
      184 +                    >                                         
      185 +                      <option value="general">General</option>
      186 +                      <option value="personal">Personal</optio
          +n>                                                            
      187 +                      <option value="work">Work</option>      
      188 +                      <option value="preferences">Preferences<
          +/option>                                                      
      189 +                    </select>                                 
      190 +                  </div>                                      
      191 +                                                              
      192 +                  <div>                                       
      193 +                    <label className="block text-sm font-mediu
          +m text-dark-300 mb-2">                                        
      194 +                      Importance: {formData.importance}       
      195 +                    </label>                                  
      196 +                    <input                                    
      197 +                      type="range"                            
      198 +                      min="1"                                 
      199 +                      max="5"                                 
      200 +                      value={formData.importance}             
      201 +                      onChange={(e) => setFormData({ ...formDa
          +ta, importance: parseInt(e.target.value) })}                  
      202 +                      className="w-full mt-2"                 
      203 +                    />                                        
      204 +                    <div className="flex justify-between text-
          +xs text-dark-500 mt-1">                                       
      205 +                      <span>Low</span>                        
      206 +                      <span>High</span>                       
      207 +                    </div>                                    
      208 +                  </div>                                      
      209 +                </div>                                        
      210 +                                                              
      211 +                <button                                       
      212 +                  type="submit"                               
      213 +                  disabled={loading}                          
      214 +                  className="w-full bg-primary-500 hover:bg-pr
          +imary-600 text-white py-3 rounded-xl font-semibold transition-
          +all duration-200 disabled:opacity-50 flex items-center justify
          +-center gap-2 active:scale-[0.98]"                            
      215 +                >                                             
      216 +                  {loading ? (                                
      217 +                    <>                                        
      218 +                      <div className="animate-spin rounded-ful
          +l h-5 w-5 border-2 border-white border-t-transparent"></div>  
      219 +                      Saving...                               
      220 +                    </>                                       
      221 +                  ) : (                                       
      222 +                    <>                                        
      223 +                      <Save className="w-4 h-4" />            
      224 +                      {editingId ? 'Update Memory' : 'Save Mem
          +ory'}                                                         
      225 +                    </>                                       
      226 +                  )}                                          
      227 +                </button>                                     
      228 +              </div>                                          
      229 +            </form>                                           
      230 +          )}                                                  
      231 +                                                              
      232 +          {/* Memories List */}                               
      233 +          <div className="space-y-4">                         
      234 +            {memories.length === 0 ? (                        
      235 +              <div className="text-center py-12">             
      236 +                <div className="w-16 h-16 rounded-2xl bg-dark-
          +800 flex items-center justify-center mx-auto mb-4">           
      237 +                  <Brain className="w-8 h-8 text-dark-500" /> 
      238 +                </div>                                        
      239 +                <p className="text-dark-400">No memories yet. 
          +Add your first memory to help the AI remember important contex
          +t.</p>                                                        
      240 +              </div>                                          
      241 +            ) : (                                             
      242 +              memories.map(memory => (                        
      243 +                <div                                          
      244 +                  key={memory.id}                             
      245 +                  className="p-5 bg-dark-800/50 border border-
          +dark-700/50 rounded-xl hover:border-dark-600 transition-all du
          +ration-200"                                                   
      246 +                >                                             
      247 +                  <div className="flex items-start justify-bet
          +ween gap-4">                                                  
      248 +                    <div className="flex-1">                  
      249 +                      <div className="flex items-center gap-2 
          +mb-2">                                                        
      250 +                        <span className={`px-2.5 py-1 rounded-
          +lg text-xs font-medium border ${getCategoryColor(memory.catego
          +ry)}`}>                                                       
      251 +                          {memory.category}                   
      252 +                        </span>                               
      253 +                        <div className="flex items-center gap-
          +0.5">                                                         
      254 +                          {[...Array(5)].map((_, i) => (      
      255 +                            <Star                             
      256 +                              key={i}                         
      257 +                              className={`w-3 h-3 ${          
      258 +                                i < memory.importance         
      259 +                                  ? 'text-primary-400 fill-pri
          +mary-400'                                                     
      260 +                                  : 'text-dark-600'           
      261 +                              }`}                             
      262 +                            />                                
      263 +                          ))}                                 
      264 +                        </div>                                
      265 +                      </div>                                  
      266 +                      <p className="text-dark-200 whitespace-p
          +re-wrap text-sm">{memory.content}</p>                         
      267 +                      <p className="text-xs text-dark-500 mt-2
          +">                                                            
      268 +                        Created {new Date(memory.created_at).t
          +oLocaleDateString()}                                          
      269 +                      </p>                                    
      270 +                    </div>                                    
      271 +                                                              
      272 +                    <div className="flex gap-2">              
      273 +                      <button                                 
      274 +                        onClick={() => handleEdit(memory)}    
      275 +                        className="p-2 hover:bg-primary-500/10
          + rounded-lg transition-colors"                                
      276 +                        title="Edit"                          
      277 +                      >                                       
      278 +                        <Edit2 className="w-4 h-4 text-primary
          +-400" />                                                      
      279 +                      </button>                               
      280 +                      <button                                 
      281 +                        onClick={() => handleDelete(memory.id)
          +}                                                             
      282 +                        className="p-2 hover:bg-red-500/10 rou
          +nded-lg transition-colors"                                    
      283 +                        title="Delete"                        
      284 +                      >                                       
      285 +                        <Trash2 className="w-4 h-4 text-red-40
          +0" />                                                         
      286 +                      </button>                               
      287 +                    </div>                                    
      288 +                  </div>                                      
      289 +                </div>                                        
      290 +              ))                                              
      291 +            )}                                                
      292 +          </div>                                              
      293 +        </div>                                                
      294 +      </div>                                                  
      295 +    </div>                                                    
      296 +  );                                                          
      297 +}                                                             
      298 +                                                              
      299 +export default Memories;                                      
✔ Task #7 updated: status → completed

● Let me also check and update the SettingsTab and ProfileTab components.

● Read(client\src\components\SettingsTab.jsx)
  ⎿  Read 326 lines

● Read(client\src\components\ProfileTab.jsx)
  ⎿  Read 179 lines

● I need to update these components to use the new design system.

● Write(client\src\components\SettingsTab.jsx)
  ⎿  Added 325 lines, removed 325 lines
        1 -import React, { useState, useEffect } from 'react';          
        2 -import { useNavigate } from 'react-router-dom';              
        3 -import { Key, Eye, EyeOff, Trash2, AlertTriangle, Shield, Save
          -, ExternalLink } from 'lucide-react';                        
        4 -                                                             
        5 -function SettingsTab({ user, logout }) {                     
        6 -  const navigate = useNavigate();                            
        7 -  const [apiKey, setApiKey] = useState('');                  
        8 -  const [showApiKey, setShowApiKey] = useState(false);       
        9 -  const [hasApiKey, setHasApiKey] = useState(false);         
       10 -  const [loading, setLoading] = useState(false);             
       11 -  const [success, setSuccess] = useState('');                
       12 -  const [error, setError] = useState('');                    
       13 -  const [showDeleteConfirm, setShowDeleteConfirm] = useState(f
          -alse);                                                       
       14 -  const [deletePassword, setDeletePassword] = useState('');  
       15 -  const [deleteLoading, setDeleteLoading] = useState(false); 
       16 -  const [deleteError, setDeleteError] = useState('');        
       17 -                                                             
       18 -  useEffect(() => {                                          
       19 -    loadUserData();                                          
       20 -  }, []);                                                    
       21 -                                                             
       22 -  const loadUserData = async () => {                         
       23 -    try {                                                    
       24 -      const res = await fetch('/api/auth/me', {              
       25 -        headers: { 'Authorization': `Bearer ${localStorage.get
          -Item('token')}` }                                            
       26 -      });                                                    
       27 -      const data = await res.json();                         
       28 -      setHasApiKey(!!data.has_api_key);                      
       29 -    } catch (error) {                                        
       30 -      console.error('Failed to load user data:', error);     
       31 -    }                                                        
       32 -  };                                                         
       33 -                                                             
       34 -  const handleSaveApiKey = async (e) => {                    
       35 -    e.preventDefault();                                      
       36 -    if (!apiKey.trim()) return;                              
       37 -                                                             
       38 -    setError('');                                            
       39 -    setSuccess('');                                          
       40 -    setLoading(true);                                        
       41 -                                                             
       42 -    try {                                                    
       43 -      const res = await fetch('/api/auth/profile', {         
       44 -        method: 'PUT',                                       
       45 -        headers: {                                           
       46 -          'Content-Type': 'application/json',                
       47 -          'Authorization': `Bearer ${localStorage.getItem('tok
          -en')}`                                                       
       48 -        },                                                   
       49 -        body: JSON.stringify({ openai_api_key: apiKey })     
       50 -      });                                                    
       51 -                                                             
       52 -      if (!res.ok) {                                         
       53 -        throw new Error('Failed to save API key');           
       54 -      }                                                      
       55 -                                                             
       56 -      setSuccess('API key saved successfully!');             
       57 -      setApiKey('');                                         
       58 -      setHasApiKey(true);                                    
       59 -    } catch (err) {                                          
       60 -      setError(err.message);                                 
       61 -    } finally {                                              
       62 -      setLoading(false);                                     
       63 -    }                                                        
       64 -  };                                                         
       65 -                                                             
       66 -  const removeApiKey = async () => {                         
       67 -    if (!confirm('Are you sure you want to remove your API key
          -?')) return;                                                 
       68 -                                                             
       69 -    try {                                                    
       70 -      await fetch('/api/auth/profile', {                     
       71 -        method: 'PUT',                                       
       72 -        headers: {                                           
       73 -          'Content-Type': 'application/json',                
       74 -          'Authorization': `Bearer ${localStorage.getItem('tok
          -en')}`                                                       
       75 -        },                                                   
       76 -        body: JSON.stringify({ openai_api_key: null })       
       77 -      });                                                    
       78 -      setHasApiKey(false);                                   
       79 -      setSuccess('API key removed successfully');            
       80 -    } catch (error) {                                        
       81 -      setError('Failed to remove API key');                  
       82 -    }                                                        
       83 -  };                                                         
       84 -                                                             
       85 -  const handleDeleteAccount = async () => {                  
       86 -    if (!deletePassword) {                                   
       87 -      setDeleteError('Please enter your password');          
       88 -      return;                                                
       89 -    }                                                        
       90 -                                                             
       91 -    setDeleteLoading(true);                                  
       92 -    setDeleteError('');                                      
       93 -                                                             
       94 -    try {                                                    
       95 -      const res = await fetch('/api/auth/profile', {         
       96 -        method: 'DELETE',                                    
       97 -        headers: {                                           
       98 -          'Content-Type': 'application/json',                
       99 -          'Authorization': `Bearer ${localStorage.getItem('tok
          -en')}`                                                       
      100 -        },                                                   
      101 -        body: JSON.stringify({ password: deletePassword })   
      102 -      });                                                    
      103 -                                                             
      104 -      const data = await res.json();                         
      105 -                                                             
      106 -      if (!res.ok) {                                         
      107 -        throw new Error(data.error || 'Failed to delete accoun
          -t');                                                         
      108 -      }                                                      
      109 -                                                             
      110 -      logout();                                              
      111 -      navigate('/login');                                    
      112 -    } catch (err) {                                          
      113 -      setDeleteError(err.message);                           
      114 -    } finally {                                              
      115 -      setDeleteLoading(false);                               
      116 -    }                                                        
      117 -  };                                                         
      118 -                                                             
      119 -  return (                                                   
      120 -    <div className="space-y-8">                              
      121 -      <div>                                                  
      122 -        <h2 className="text-2xl font-bold text-dark-100 mb-2">
          -Settings</h2>                                                
      123 -        <p className="text-dark-400 mb-6">Manage your API key 
          -and account</p>                                              
      124 -      </div>                                                 
      125 -                                                             
      126 -      {error && (                                            
      127 -        <div className="bg-red-500/20 border border-red-500/30
          - text-red-300 px-4 py-3 rounded-lg">                         
      128 -          {error}                                            
      129 -        </div>                                               
      130 -      )}                                                     
      131 -                                                             
      132 -      {success && (                                          
      133 -        <div className="bg-green-500/20 border border-green-50
          -0/30 text-green-300 px-4 py-3 rounded-lg">                   
      134 -          {success}                                          
      135 -        </div>                                               
      136 -      )}                                                     
      137 -                                                             
      138 -      {/* API Key Section */}                                
      139 -      <section className="border-b border-dark-700/50 pb-8"> 
      140 -        <h3 className="text-xl font-semibold mb-4 flex items-c
          -enter gap-2 text-dark-100">                                  
      141 -          <Key className="w-5 h-5 text-accent-400" />        
      142 -          OpenRouter API Key                                 
      143 -        </h3>                                                
      144 -                                                             
      145 -        {user?.use_default_key ? (                           
      146 -          <div className="bg-primary-500/20 border border-prim
          -ary-500/30 rounded-lg p-4 mb-4">                             
      147 -            <p className="text-primary-300 text-sm">         
      148 -              You are currently using the default API key set 
          -by the administrator.                                        
      149 -              You can still set your own API key to override t
          -his.                                                         
      150 -            </p>                                             
      151 -          </div>                                             
      152 -        ) : (                                                
      153 -          <div className="bg-amber-500/20 border border-amber-
          -500/30 rounded-lg p-4 mb-4">                                 
      154 -            <p className="text-amber-300 text-sm">           
      155 -              You need to set your own API key or ask an admin
          -istrator to enable the default key for you.                  
      156 -            </p>                                             
      157 -          </div>                                             
      158 -        )}                                                   
      159 -                                                             
      160 -        {hasApiKey && (                                      
      161 -          <div className="bg-green-500/20 border border-green-
          -500/30 rounded-lg p-4 mb-4">                                 
      162 -            <div className="flex items-center justify-between"
          ->                                                            
      163 -              <p className="text-green-300 text-sm">         
      164 -                You have configured your personal API key    
      165 -              </p>                                           
      166 -              <button                                        
      167 -                type="button"                                
      168 -                onClick={removeApiKey}                       
      169 -                className="text-sm text-red-400 hover:text-red
          --300 font-medium"                                            
      170 -              >                                              
      171 -                Remove Key                                   
      172 -              </button>                                      
      173 -            </div>                                           
      174 -          </div>                                             
      175 -        )}                                                   
      176 -                                                             
      177 -        <form onSubmit={handleSaveApiKey} className="space-y-4
          -">                                                           
      178 -          <div>                                              
      179 -            <label className="block text-sm font-medium text-d
          -ark-200 mb-2">                                               
      180 -              {hasApiKey ? 'Update API Key' : 'Set API Key'} 
      181 -            </label>                                         
      182 -            <div className="relative">                       
      183 -              <input                                         
      184 -                type={showApiKey ? 'text' : 'password'}      
      185 -                value={apiKey}                               
      186 -                onChange={(e) => setApiKey(e.target.value)}  
      187 -                className="w-full px-4 py-3 pr-12 rounded-lg g
          -lass-input outline-none font-mono text-sm text-dark-100 bg-dar
          -k-800/50"                                                    
      188 -                placeholder="sk-..."                         
      189 -              />                                             
      190 -              <button                                        
      191 -                type="button"                                
      192 -                onClick={() => setShowApiKey(!showApiKey)}   
      193 -                className="absolute right-3 top-1/2 -translate
          --y-1/2 text-dark-400 hover:text-dark-200"                    
      194 -              >                                              
      195 -                {showApiKey ? <EyeOff className="w-5 h-5" /> :
          - <Eye className="w-5 h-5" />}                                
      196 -              </button>                                      
      197 -            </div>                                           
      198 -            <p className="text-xs text-dark-500 mt-2 flex item
          -s-center gap-1">                                             
      199 -              Get your API key at{' '}                       
      200 -              <a                                             
      201 -                href="https://openrouter.ai/keys"            
      202 -                target="_blank"                              
      203 -                rel="noopener noreferrer"                    
      204 -                className="text-primary-400 hover:underline in
          -line-flex items-center gap-1"                                
      205 -              >                                              
      206 -                OpenRouter                                   
      207 -                <ExternalLink className="w-3 h-3" />         
      208 -              </a>                                           
      209 -            </p>                                             
      210 -          </div>                                             
      211 -                                                             
      212 -          <button                                            
      213 -            type="submit"                                    
      214 -            disabled={loading || !apiKey.trim()}             
      215 -            className="gradient-primary text-white px-6 py-3 r
          -ounded-lg font-medium hover:shadow-glow transition-all disable
          -d:opacity-50 disabled:cursor-not-allowed flex items-center gap
          --2"                                                          
      216 -          >                                                  
      217 -            {loading ? (                                     
      218 -              <>                                             
      219 -                <div className="animate-spin rounded-full h-5 
          -w-5 border-2 border-white border-t-transparent"></div>       
      220 -                Saving...                                    
      221 -              </>                                            
      222 -            ) : (                                            
      223 -              <>                                             
      224 -                <Save className="w-5 h-5" />                 
      225 -                Save API Key                                 
      226 -              </>                                            
      227 -            )}                                               
      228 -          </button>                                          
      229 -        </form>                                              
      230 -      </section>                                             
      231 -                                                             
      232 -      {/* Danger Zone */}                                    
      233 -      <section>                                              
      234 -        <h3 className="text-xl font-semibold mb-4 flex items-c
          -enter gap-2 text-red-400">                                   
      235 -          <AlertTriangle className="w-5 h-5" />              
      236 -          Danger Zone                                        
      237 -        </h3>                                                
      238 -                                                             
      239 -        <div className="bg-red-500/10 border border-red-500/30
          - rounded-xl p-6">                                            
      240 -          <h4 className="font-semibold text-red-300 mb-2">Dele
          -te Account</h4>                                              
      241 -          <p className="text-sm text-dark-400 mb-4">         
      242 -            This action cannot be undone. All your chats, mess
          -ages, and memories will be permanently deleted.              
      243 -          </p>                                               
      244 -                                                             
      245 -          {user?.is_admin ? (                                
      246 -            <div className="flex items-center gap-2 text-sm te
          -xt-dark-400 bg-dark-800/50 p-3 rounded-lg">                  
      247 -              <Shield className="w-4 h-4" />                 
      248 -              Admin accounts cannot be deleted               
      249 -            </div>                                           
      250 -          ) : (                                              
      251 -            <button                                          
      252 -              onClick={() => setShowDeleteConfirm(true)}     
      253 -              className="px-4 py-2 bg-red-500/20 hover:bg-red-
          -500/30 text-red-300 rounded-lg font-medium transition-colors f
          -lex items-center gap-2"                                      
      254 -            >                                                
      255 -              <Trash2 className="w-4 h-4" />                 
      256 -              Delete Account                                 
      257 -            </button>                                        
      258 -          )}                                                 
      259 -        </div>                                               
      260 -      </section>                                             
      261 -                                                             
      262 -      {/* Delete Confirmation Modal */}                      
      263 -      {showDeleteConfirm && (                                
      264 -        <div className="fixed inset-0 bg-dark-950/80 backdrop-
          -blur-md flex items-center justify-center z-50 scale-in">     
      265 -          <div className="glass-card rounded-2xl p-6 w-full ma
          -x-w-md mx-4 shadow-2xl">                                     
      266 -            <h3 className="text-xl font-bold text-red-400 mb-2
          - flex items-center gap-2">                                   
      267 -              <AlertTriangle className="w-6 h-6" />          
      268 -              Confirm Account Deletion                       
      269 -            </h3>                                            
      270 -            <p className="text-dark-300 mb-6">               
      271 -              Please enter your password to confirm. This acti
          -on is irreversible and will delete all your data.            
      272 -            </p>                                             
      273 -                                                             
      274 -            {deleteError && (                                
      275 -              <div className="bg-red-500/20 border border-red-
          -500/30 text-red-300 px-4 py-3 rounded-lg mb-4 text-sm">      
      276 -                {deleteError}                                
      277 -              </div>                                         
      278 -            )}                                               
      279 -                                                             
      280 -            <input                                           
      281 -              type="password"                                
      282 -              value={deletePassword}                         
      283 -              onChange={(e) => setDeletePassword(e.target.valu
          -e)}                                                          
      284 -              placeholder="Enter your password"              
      285 -              className="w-full px-4 py-3 rounded-lg glass-inp
          -ut outline-none text-dark-100 bg-dark-800/50 mb-4"           
      286 -              autoFocus                                      
      287 -            />                                               
      288 -                                                             
      289 -            <div className="flex gap-3">                     
      290 -              <button                                        
      291 -                onClick={() => {                             
      292 -                  setShowDeleteConfirm(false);               
      293 -                  setDeletePassword('');                     
      294 -                  setDeleteError('');                        
      295 -                }}                                           
      296 -                className="flex-1 px-4 py-3 glass-button round
          -ed-lg text-dark-300 hover:text-dark-100 font-medium transition
          --colors"                                                     
      297 -              >                                              
      298 -                Cancel                                       
      299 -              </button>                                      
      300 -              <button                                        
      301 -                onClick={handleDeleteAccount}                
      302 -                disabled={!deletePassword || deleteLoading}  
      303 -                className="flex-1 px-4 py-3 bg-red-500 hover:b
          -g-red-600 text-white rounded-lg font-medium transition-colors 
          -disabled:opacity-50 disabled:cursor-not-allowed flex items-cen
          -ter justify-center gap-2"                                    
      304 -              >                                              
      305 -                {deleteLoading ? (                           
      306 -                  <>                                         
      307 -                    <div className="animate-spin rounded-full 
          -h-5 w-5 border-2 border-white border-t-transparent"></div>   
      308 -                    Deleting...                              
      309 -                  </>                                        
      310 -                ) : (                                        
      311 -                  <>                                         
      312 -                    <Trash2 className="w-4 h-4" />           
      313 -                    Delete Forever                           
      314 -                  </>                                        
      315 -                )}                                           
      316 -              </button>                                      
      317 -            </div>                                           
      318 -          </div>                                             
      319 -        </div>                                               
      320 -      )}                                                     
      321 -    </div>                                                   
      322 -  );                                                         
      323 -}                                                            
      324 -                                                             
      325 -export default SettingsTab;                                  
        1 +import React, { useState, useEffect } from 'react';           
        2 +import { useNavigate } from 'react-router-dom';               
        3 +import { Key, Eye, EyeOff, Trash2, AlertTriangle, Shield, Save
          +, ExternalLink } from 'lucide-react';                         
        4 +                                                              
        5 +function SettingsTab({ user, logout }) {                      
        6 +  const navigate = useNavigate();                             
        7 +  const [apiKey, setApiKey] = useState('');                   
        8 +  const [showApiKey, setShowApiKey] = useState(false);        
        9 +  const [hasApiKey, setHasApiKey] = useState(false);          
       10 +  const [loading, setLoading] = useState(false);              
       11 +  const [success, setSuccess] = useState('');                 
       12 +  const [error, setError] = useState('');                     
       13 +  const [showDeleteConfirm, setShowDeleteConfirm] = useState(f
          +alse);                                                        
       14 +  const [deletePassword, setDeletePassword] = useState('');   
       15 +  const [deleteLoading, setDeleteLoading] = useState(false);  
       16 +  const [deleteError, setDeleteError] = useState('');         
       17 +                                                              
       18 +  useEffect(() => {                                           
       19 +    loadUserData();                                           
       20 +  }, []);                                                     
       21 +                                                              
       22 +  const loadUserData = async () => {                          
       23 +    try {                                                     
       24 +      const res = await fetch('/api/auth/me', {               
       25 +        headers: { 'Authorization': `Bearer ${localStorage.get
          +Item('token')}` }                                             
       26 +      });                                                     
       27 +      const data = await res.json();                          
       28 +      setHasApiKey(!!data.has_api_key);                       
       29 +    } catch (error) {                                         
       30 +      console.error('Failed to load user data:', error);      
       31 +    }                                                         
       32 +  };                                                          
       33 +                                                              
       34 +  const handleSaveApiKey = async (e) => {                     
       35 +    e.preventDefault();                                       
       36 +    if (!apiKey.trim()) return;                               
       37 +                                                              
       38 +    setError('');                                             
       39 +    setSuccess('');                                           
       40 +    setLoading(true);                                         
       41 +                                                              
       42 +    try {                                                     
       43 +      const res = await fetch('/api/auth/profile', {          
       44 +        method: 'PUT',                                        
       45 +        headers: {                                            
       46 +          'Content-Type': 'application/json',                 
       47 +          'Authorization': `Bearer ${localStorage.getItem('tok
          +en')}`                                                        
       48 +        },                                                    
       49 +        body: JSON.stringify({ openai_api_key: apiKey })      
       50 +      });                                                     
       51 +                                                              
       52 +      if (!res.ok) {                                          
       53 +        throw new Error('Failed to save API key');            
       54 +      }                                                       
       55 +                                                              
       56 +      setSuccess('API key saved successfully!');              
       57 +      setApiKey('');                                          
       58 +      setHasApiKey(true);                                     
       59 +    } catch (err) {                                           
       60 +      setError(err.message);                                  
       61 +    } finally {                                               
       62 +      setLoading(false);                                      
       63 +    }                                                         
       64 +  };                                                          
       65 +                                                              
       66 +  const removeApiKey = async () => {                          
       67 +    if (!confirm('Are you sure you want to remove your API key
          +?')) return;                                                  
       68 +                                                              
       69 +    try {                                                     
       70 +      await fetch('/api/auth/profile', {                      
       71 +        method: 'PUT',                                        
       72 +        headers: {                                            
       73 +          'Content-Type': 'application/json',                 
       74 +          'Authorization': `Bearer ${localStorage.getItem('tok
          +en')}`                                                        
       75 +        },                                                    
       76 +        body: JSON.stringify({ openai_api_key: null })        
       77 +      });                                                     
       78 +      setHasApiKey(false);                                    
       79 +      setSuccess('API key removed successfully');             
       80 +    } catch (error) {                                         
       81 +      setError('Failed to remove API key');                   
       82 +    }                                                         
       83 +  };                                                          
       84 +                                                              
       85 +  const handleDeleteAccount = async () => {                   
       86 +    if (!deletePassword) {                                    
       87 +      setDeleteError('Please enter your password');           
       88 +      return;                                                 
       89 +    }                                                         
       90 +                                                              
       91 +    setDeleteLoading(true);                                   
       92 +    setDeleteError('');                                       
       93 +                                                              
       94 +    try {                                                     
       95 +      const res = await fetch('/api/auth/profile', {          
       96 +        method: 'DELETE',                                     
       97 +        headers: {                                            
       98 +          'Content-Type': 'application/json',                 
       99 +          'Authorization': `Bearer ${localStorage.getItem('tok
          +en')}`                                                        
      100 +        },                                                    
      101 +        body: JSON.stringify({ password: deletePassword })    
      102 +      });                                                     
      103 +                                                              
      104 +      const data = await res.json();                          
      105 +                                                              
      106 +      if (!res.ok) {                                          
      107 +        throw new Error(data.error || 'Failed to delete accoun
          +t');                                                          
      108 +      }                                                       
      109 +                                                              
      110 +      logout();                                               
      111 +      navigate('/login');                                     
      112 +    } catch (err) {                                           
      113 +      setDeleteError(err.message);                            
      114 +    } finally {                                               
      115 +      setDeleteLoading(false);                                
      116 +    }                                                         
      117 +  };                                                          
      118 +                                                              
      119 +  return (                                                    
      120 +    <div className="space-y-8">                               
      121 +      <div>                                                   
      122 +        <h2 className="text-2xl font-bold text-dark-100 mb-2 t
          +racking-tight">Settings</h2>                                  
      123 +        <p className="text-dark-400 mb-6">Manage your API key 
          +and account</p>                                               
      124 +      </div>                                                  
      125 +                                                              
      126 +      {error && (                                             
      127 +        <div className="bg-red-500/10 border border-red-500/20
          + text-red-400 px-4 py-3 rounded-xl text-sm">                  
      128 +          {error}                                             
      129 +        </div>                                                
      130 +      )}                                                      
      131 +                                                              
      132 +      {success && (                                           
      133 +        <div className="bg-green-500/10 border border-green-50
          +0/20 text-green-400 px-4 py-3 rounded-xl text-sm">            
      134 +          {success}                                           
      135 +        </div>                                                
      136 +      )}                                                      
      137 +                                                              
      138 +      {/* API Key Section */}                                 
      139 +      <section className="border-b border-dark-700/50 pb-8">  
      140 +        <h3 className="text-xl font-semibold mb-4 flex items-c
          +enter gap-2 text-dark-100">                                   
      141 +          <Key className="w-5 h-5 text-accent-400" />         
      142 +          OpenRouter API Key                                  
      143 +        </h3>                                                 
      144 +                                                              
      145 +        {user?.use_default_key ? (                            
      146 +          <div className="bg-primary-500/10 border border-prim
          +ary-500/20 rounded-xl p-4 mb-4">                              
      147 +            <p className="text-primary-400 text-sm">          
      148 +              You are currently using the default API key set 
          +by the administrator.                                         
      149 +              You can still set your own API key to override t
          +his.                                                          
      150 +            </p>                                              
      151 +          </div>                                              
      152 +        ) : (                                                 
      153 +          <div className="bg-accent-500/10 border border-accen
          +t-500/20 rounded-xl p-4 mb-4">                                
      154 +            <p className="text-accent-400 text-sm">           
      155 +              You need to set your own API key or ask an admin
          +istrator to enable the default key for you.                   
      156 +            </p>                                              
      157 +          </div>                                              
      158 +        )}                                                    
      159 +                                                              
      160 +        {hasApiKey && (                                       
      161 +          <div className="bg-green-500/10 border border-green-
          +500/20 rounded-xl p-4 mb-4">                                  
      162 +            <div className="flex items-center justify-between"
          +>                                                             
      163 +              <p className="text-green-400 text-sm">          
      164 +                You have configured your personal API key     
      165 +              </p>                                            
      166 +              <button                                         
      167 +                type="button"                                 
      168 +                onClick={removeApiKey}                        
      169 +                className="text-sm text-red-400 hover:text-red
          +-300 font-medium"                                             
      170 +              >                                               
      171 +                Remove Key                                    
      172 +              </button>                                       
      173 +            </div>                                            
      174 +          </div>                                              
      175 +        )}                                                    
      176 +                                                              
      177 +        <form onSubmit={handleSaveApiKey} className="space-y-4
          +">                                                            
      178 +          <div>                                               
      179 +            <label className="block text-sm font-medium text-d
          +ark-300 mb-2">                                                
      180 +              {hasApiKey ? 'Update API Key' : 'Set API Key'}  
      181 +            </label>                                          
      182 +            <div className="relative">                        
      183 +              <input                                          
      184 +                type={showApiKey ? 'text' : 'password'}       
      185 +                value={apiKey}                                
      186 +                onChange={(e) => setApiKey(e.target.value)}   
      187 +                className="w-full px-4 py-3 pr-12 rounded-xl g
          +lass-input outline-none font-mono text-sm text-dark-100"      
      188 +                placeholder="sk-..."                          
      189 +              />                                              
      190 +              <button                                         
      191 +                type="button"                                 
      192 +                onClick={() => setShowApiKey(!showApiKey)}    
      193 +                className="absolute right-3 top-1/2 -translate
          +-y-1/2 text-dark-400 hover:text-dark-200"                     
      194 +              >                                               
      195 +                {showApiKey ? <EyeOff className="w-5 h-5" /> :
          + <Eye className="w-5 h-5" />}                                 
      196 +              </button>                                       
      197 +            </div>                                            
      198 +            <p className="text-xs text-dark-500 mt-2 flex item
          +s-center gap-1">                                              
      199 +              Get your API key at{' '}                        
      200 +              <a                                              
      201 +                href="https://openrouter.ai/keys"             
      202 +                target="_blank"                               
      203 +                rel="noopener noreferrer"                     
      204 +                className="text-primary-400 hover:underline in
          +line-flex items-center gap-1"                                 
      205 +              >                                               
      206 +                OpenRouter                                    
      207 +                <ExternalLink className="w-3 h-3" />          
      208 +              </a>                                            
      209 +            </p>                                              
      210 +          </div>                                              
      211 +                                                              
      212 +          <button                                             
      213 +            type="submit"                                     
      214 +            disabled={loading || !apiKey.trim()}              
      215 +            className="bg-primary-500 hover:bg-primary-600 tex
          +t-white px-6 py-3 rounded-xl font-semibold transition-all dura
          +tion-200 disabled:opacity-50 disabled:cursor-not-allowed flex 
          +items-center gap-2 active:scale-[0.98]"                       
      216 +          >                                                   
      217 +            {loading ? (                                      
      218 +              <>                                              
      219 +                <div className="animate-spin rounded-full h-5 
          +w-5 border-2 border-white border-t-transparent"></div>        
      220 +                Saving...                                     
      221 +              </>                                             
      222 +            ) : (                                             
      223 +              <>                                              
      224 +                <Save className="w-5 h-5" />                  
      225 +                Save API Key                                  
      226 +              </>                                             
      227 +            )}                                                
      228 +          </button>                                           
      229 +        </form>                                               
      230 +      </section>                                              
      231 +                                                              
      232 +      {/* Danger Zone */}                                     
      233 +      <section>                                               
      234 +        <h3 className="text-xl font-semibold mb-4 flex items-c
          +enter gap-2 text-red-400">                                    
      235 +          <AlertTriangle className="w-5 h-5" />               
      236 +          Danger Zone                                         
      237 +        </h3>                                                 
      238 +                                                              
      239 +        <div className="bg-red-500/10 border border-red-500/20
          + rounded-xl p-6">                                             
      240 +          <h4 className="font-semibold text-red-400 mb-2">Dele
          +te Account</h4>                                               
      241 +          <p className="text-sm text-dark-400 mb-4">          
      242 +            This action cannot be undone. All your chats, mess
          +ages, and memories will be permanently deleted.               
      243 +          </p>                                                
      244 +                                                              
      245 +          {user?.is_admin ? (                                 
      246 +            <div className="flex items-center gap-2 text-sm te
          +xt-dark-400 bg-dark-800/50 p-3 rounded-lg">                   
      247 +              <Shield className="w-4 h-4" />                  
      248 +              Admin accounts cannot be deleted                
      249 +            </div>                                            
      250 +          ) : (                                               
      251 +            <button                                           
      252 +              onClick={() => setShowDeleteConfirm(true)}      
      253 +              className="px-4 py-2.5 bg-red-500/10 hover:bg-re
          +d-500/20 text-red-400 rounded-xl font-medium transition-colors
          + flex items-center gap-2"                                     
      254 +            >                                                 
      255 +              <Trash2 className="w-4 h-4" />                  
      256 +              Delete Account                                  
      257 +            </button>                                         
      258 +          )}                                                  
      259 +        </div>                                                
      260 +      </section>                                              
      261 +                                                              
      262 +      {/* Delete Confirmation Modal */}                       
      263 +      {showDeleteConfirm && (                                 
      264 +        <div className="fixed inset-0 bg-dark-950/80 backdrop-
          +blur-md flex items-center justify-center z-50 scale-in">      
      265 +          <div className="glass-modal rounded-2xl p-6 w-full m
          +ax-w-md mx-4 shadow-2xl">                                     
      266 +            <h3 className="text-xl font-bold text-red-400 mb-2
          + flex items-center gap-2">                                    
      267 +              <AlertTriangle className="w-6 h-6" />           
      268 +              Confirm Account Deletion                        
      269 +            </h3>                                             
      270 +            <p className="text-dark-400 mb-6">                
      271 +              Please enter your password to confirm. This acti
          +on is irreversible and will delete all your data.             
      272 +            </p>                                              
      273 +                                                              
      274 +            {deleteError && (                                 
      275 +              <div className="bg-red-500/10 border border-red-
          +500/20 text-red-400 px-4 py-3 rounded-xl mb-4 text-sm">       
      276 +                {deleteError}                                 
      277 +              </div>                                          
      278 +            )}                                                
      279 +                                                              
      280 +            <input                                            
      281 +              type="password"                                 
      282 +              value={deletePassword}                          
      283 +              onChange={(e) => setDeletePassword(e.target.valu
          +e)}                                                           
      284 +              placeholder="Enter your password"               
      285 +              className="w-full px-4 py-3 rounded-xl glass-inp
          +ut outline-none text-dark-100 mb-4"                           
      286 +              autoFocus                                       
      287 +            />                                                
      288 +                                                              
      289 +            <div className="flex gap-3">                      
      290 +              <button                                         
      291 +                onClick={() => {                              
      292 +                  setShowDeleteConfirm(false);                
      293 +                  setDeletePassword('');                      
      294 +                  setDeleteError('');                         
      295 +                }}                                            
      296 +                className="flex-1 px-4 py-3 glass-button round
          +ed-xl text-dark-300 hover:text-dark-100 font-semibold transiti
          +on-colors"                                                    
      297 +              >                                               
      298 +                Cancel                                        
      299 +              </button>                                       
      300 +              <button                                         
      301 +                onClick={handleDeleteAccount}                 
      302 +                disabled={!deletePassword || deleteLoading}   
      303 +                className="flex-1 px-4 py-3 bg-red-500 hover:b
          +g-red-600 text-white rounded-xl font-semibold transition-color
          +s disabled:opacity-50 disabled:cursor-not-allowed flex items-c
          +enter justify-center gap-2"                                   
      304 +              >                                               
      305 +                {deleteLoading ? (                            
      306 +                  <>                                          
      307 +                    <div className="animate-spin rounded-full 
          +h-5 w-5 border-2 border-white border-t-transparent"></div>    
      308 +                    Deleting...                               
      309 +                  </>                                         
      310 +                ) : (                                         
      311 +                  <>                                          
      312 +                    <Trash2 className="w-4 h-4" />            
      313 +                    Delete Forever                            
      314 +                  </>                                         
      315 +                )}                                            
      316 +              </button>                                       
      317 +            </div>                                            
      318 +          </div>                                              
      319 +        </div>                                                
      320 +      )}                                                      
      321 +    </div>                                                    
      322 +  );                                                          
      323 +}                                                             
      324 +                                                              
      325 +export default SettingsTab;                                   

● Write(client\src\components\ProfileTab.jsx)
  ⎿  Added 178 lines, removed 178 lines
        1 -import React, { useState, useEffect } from 'react';          
        2 -import { User, Mail, Lock, Save } from 'lucide-react';       
        3 -                                                             
        4 -function ProfileTab({ user }) {                              
        5 -  const [name, setName] = useState(user?.name || '');        
        6 -  const [password, setPassword] = useState('');              
        7 -  const [confirmPassword, setConfirmPassword] = useState('');
        8 -  const [loading, setLoading] = useState(false);             
        9 -  const [success, setSuccess] = useState('');                
       10 -  const [error, setError] = useState('');                    
       11 -                                                             
       12 -  useEffect(() => {                                          
       13 -    loadUserData();                                          
       14 -  }, []);                                                    
       15 -                                                             
       16 -  const loadUserData = async () => {                         
       17 -    try {                                                    
       18 -      const res = await fetch('/api/auth/me', {              
       19 -        headers: { 'Authorization': `Bearer ${localStorage.get
          -Item('token')}` }                                            
       20 -      });                                                    
       21 -      const data = await res.json();                         
       22 -      setName(data.name);                                    
       23 -    } catch (error) {                                        
       24 -      console.error('Failed to load user data:', error);     
       25 -    }                                                        
       26 -  };                                                         
       27 -                                                             
       28 -  const handleSave = async (e) => {                          
       29 -    e.preventDefault();                                      
       30 -    setError('');                                            
       31 -    setSuccess('');                                          
       32 -                                                             
       33 -    if (password && password !== confirmPassword) {          
       34 -      setError('Passwords do not match');                    
       35 -      return;                                                
       36 -    }                                                        
       37 -                                                             
       38 -    if (password && password.length < 6) {                   
       39 -      setError('Password must be at least 6 characters');    
       40 -      return;                                                
       41 -    }                                                        
       42 -                                                             
       43 -    setLoading(true);                                        
       44 -                                                             
       45 -    try {                                                    
       46 -      const updates = { name };                              
       47 -                                                             
       48 -      if (password) {                                        
       49 -        updates.password = password;                         
       50 -      }                                                      
       51 -                                                             
       52 -      const res = await fetch('/api/auth/profile', {         
       53 -        method: 'PUT',                                       
       54 -        headers: {                                           
       55 -          'Content-Type': 'application/json',                
       56 -          'Authorization': `Bearer ${localStorage.getItem('tok
          -en')}`                                                       
       57 -        },                                                   
       58 -        body: JSON.stringify(updates)                        
       59 -      });                                                    
       60 -                                                             
       61 -      if (!res.ok) {                                         
       62 -        throw new Error('Failed to update profile');         
       63 -      }                                                      
       64 -                                                             
       65 -      setSuccess('Profile updated successfully!');           
       66 -      setPassword('');                                       
       67 -      setConfirmPassword('');                                
       68 -    } catch (err) {                                          
       69 -      setError(err.message);                                 
       70 -    } finally {                                              
       71 -      setLoading(false);                                     
       72 -    }                                                        
       73 -  };                                                         
       74 -                                                             
       75 -  return (                                                   
       76 -    <div>                                                    
       77 -      <h2 className="text-2xl font-bold text-dark-100 mb-2">Pr
          -ofile Information</h2>                                       
       78 -      <p className="text-dark-400 mb-6">Update your personal i
          -nformation and password</p>                                  
       79 -                                                             
       80 -      {error && (                                            
       81 -        <div className="bg-red-500/20 border border-red-500/30
          - text-red-300 px-4 py-3 rounded-lg mb-6">                    
       82 -          {error}                                            
       83 -        </div>                                               
       84 -      )}                                                     
       85 -                                                             
       86 -      {success && (                                          
       87 -        <div className="bg-green-500/20 border border-green-50
          -0/30 text-green-300 px-4 py-3 rounded-lg mb-6">              
       88 -          {success}                                          
       89 -        </div>                                               
       90 -      )}                                                     
       91 -                                                             
       92 -      <form onSubmit={handleSave} className="space-y-6">     
       93 -        <div>                                                
       94 -          <label className="block text-sm font-medium text-dar
          -k-200 mb-2 flex items-center gap-2">                         
       95 -            <User className="w-4 h-4 text-primary-400" />    
       96 -            Name                                             
       97 -          </label>                                           
       98 -          <input                                             
       99 -            type="text"                                      
      100 -            value={name}                                     
      101 -            onChange={(e) => setName(e.target.value)}        
      102 -            className="w-full px-4 py-3 rounded-lg glass-input
          - outline-none text-dark-100 bg-dark-800/50"                  
      103 -            required                                         
      104 -          />                                                 
      105 -        </div>                                               
      106 -                                                             
      107 -        <div>                                                
      108 -          <label className="block text-sm font-medium text-dar
          -k-200 mb-2 flex items-center gap-2">                         
      109 -            <Mail className="w-4 h-4 text-primary-400" />    
      110 -            Email                                            
      111 -          </label>                                           
      112 -          <input                                             
      113 -            type="email"                                     
      114 -            value={user?.email || ''}                        
      115 -            disabled                                         
      116 -            className="w-full px-4 py-3 rounded-lg bg-dark-800
          -/30 border border-dark-700/50 text-dark-500"                 
      117 -          />                                                 
      118 -          <p className="mt-1 text-xs text-dark-500">Email cann
          -ot be changed</p>                                            
      119 -        </div>                                               
      120 -                                                             
      121 -        <div className="border-t border-dark-700/50 pt-6">   
      122 -          <h3 className="text-lg font-semibold text-dark-100 m
          -b-4 flex items-center gap-2">                                
      123 -            <Lock className="w-4 h-4 text-accent-400" />     
      124 -            Change Password                                  
      125 -          </h3>                                              
      126 -                                                             
      127 -          <div className="space-y-4">                        
      128 -            <div>                                            
      129 -              <label className="block text-sm font-medium text
          --dark-200 mb-2">                                             
      130 -                New Password                                 
      131 -              </label>                                       
      132 -              <input                                         
      133 -                type="password"                              
      134 -                value={password}                             
      135 -                onChange={(e) => setPassword(e.target.value)}
      136 -                className="w-full px-4 py-3 rounded-lg glass-i
          -nput outline-none text-dark-100 bg-dark-800/50"              
      137 -                placeholder="Leave blank to keep current passw
          -ord"                                                         
      138 -              />                                             
      139 -            </div>                                           
      140 -                                                             
      141 -            <div>                                            
      142 -              <label className="block text-sm font-medium text
          --dark-200 mb-2">                                             
      143 -                Confirm New Password                         
      144 -              </label>                                       
      145 -              <input                                         
      146 -                type="password"                              
      147 -                value={confirmPassword}                      
      148 -                onChange={(e) => setConfirmPassword(e.target.v
          -alue)}                                                       
      149 -                className="w-full px-4 py-3 rounded-lg glass-i
          -nput outline-none text-dark-100 bg-dark-800/50"              
      150 -                placeholder="Confirm new password"           
      151 -              />                                             
      152 -            </div>                                           
      153 -          </div>                                             
      154 -        </div>                                               
      155 -                                                             
      156 -        <button                                              
      157 -          type="submit"                                      
      158 -          disabled={loading}                                 
      159 -          className="w-full gradient-primary text-white py-3 r
          -ounded-lg font-medium hover:shadow-glow transition-all disable
          -d:opacity-50 disabled:cursor-not-allowed flex items-center jus
          -tify-center gap-2"                                           
      160 -        >                                                    
      161 -          {loading ? (                                       
      162 -            <>                                               
      163 -              <div className="animate-spin rounded-full h-5 w-
          -5 border-2 border-white border-t-transparent"></div>         
      164 -              Saving...                                      
      165 -            </>                                              
      166 -          ) : (                                              
      167 -            <>                                               
      168 -              <Save className="w-5 h-5" />                   
      169 -              Save Changes                                   
      170 -            </>                                              
      171 -          )}                                                 
      172 -        </button>                                            
      173 -      </form>                                                
      174 -    </div>                                                   
      175 -  );                                                         
      176 -}                                                            
      177 -                                                             
      178 -export default ProfileTab;                                   
        1 +import React, { useState, useEffect } from 'react';           
        2 +import { User, Mail, Lock, Save } from 'lucide-react';        
        3 +                                                              
        4 +function ProfileTab({ user }) {                               
        5 +  const [name, setName] = useState(user?.name || '');         
        6 +  const [password, setPassword] = useState('');               
        7 +  const [confirmPassword, setConfirmPassword] = useState(''); 
        8 +  const [loading, setLoading] = useState(false);              
        9 +  const [success, setSuccess] = useState('');                 
       10 +  const [error, setError] = useState('');                     
       11 +                                                              
       12 +  useEffect(() => {                                           
       13 +    loadUserData();                                           
       14 +  }, []);                                                     
       15 +                                                              
       16 +  const loadUserData = async () => {                          
       17 +    try {                                                     
       18 +      const res = await fetch('/api/auth/me', {               
       19 +        headers: { 'Authorization': `Bearer ${localStorage.get
          +Item('token')}` }                                             
       20 +      });                                                     
       21 +      const data = await res.json();                          
       22 +      setName(data.name);                                     
       23 +    } catch (error) {                                         
       24 +      console.error('Failed to load user data:', error);      
       25 +    }                                                         
       26 +  };                                                          
       27 +                                                              
       28 +  const handleSave = async (e) => {                           
       29 +    e.preventDefault();                                       
       30 +    setError('');                                             
       31 +    setSuccess('');                                           
       32 +                                                              
       33 +    if (password && password !== confirmPassword) {           
       34 +      setError('Passwords do not match');                     
       35 +      return;                                                 
       36 +    }                                                         
       37 +                                                              
       38 +    if (password && password.length < 6) {                    
       39 +      setError('Password must be at least 6 characters');     
       40 +      return;                                                 
       41 +    }                                                         
       42 +                                                              
       43 +    setLoading(true);                                         
       44 +                                                              
       45 +    try {                                                     
       46 +      const updates = { name };                               
       47 +                                                              
       48 +      if (password) {                                         
       49 +        updates.password = password;                          
       50 +      }                                                       
       51 +                                                              
       52 +      const res = await fetch('/api/auth/profile', {          
       53 +        method: 'PUT',                                        
       54 +        headers: {                                            
       55 +          'Content-Type': 'application/json',                 
       56 +          'Authorization': `Bearer ${localStorage.getItem('tok
          +en')}`                                                        
       57 +        },                                                    
       58 +        body: JSON.stringify(updates)                         
       59 +      });                                                     
       60 +                                                              
       61 +      if (!res.ok) {                                          
       62 +        throw new Error('Failed to update profile');          
       63 +      }                                                       
       64 +                                                              
       65 +      setSuccess('Profile updated successfully!');            
       66 +      setPassword('');                                        
       67 +      setConfirmPassword('');                                 
       68 +    } catch (err) {                                           
       69 +      setError(err.message);                                  
       70 +    } finally {                                               
       71 +      setLoading(false);                                      
       72 +    }                                                         
       73 +  };                                                          
       74 +                                                              
       75 +  return (                                                    
       76 +    <div>                                                     
       77 +      <h2 className="text-2xl font-bold text-dark-100 mb-2 tra
          +cking-tight">Profile Information</h2>                         
       78 +      <p className="text-dark-400 mb-6">Update your personal i
          +nformation and password</p>                                   
       79 +                                                              
       80 +      {error && (                                             
       81 +        <div className="bg-red-500/10 border border-red-500/20
          + text-red-400 px-4 py-3 rounded-xl mb-6 text-sm">             
       82 +          {error}                                             
       83 +        </div>                                                
       84 +      )}                                                      
       85 +                                                              
       86 +      {success && (                                           
       87 +        <div className="bg-green-500/10 border border-green-50
          +0/20 text-green-400 px-4 py-3 rounded-xl mb-6 text-sm">       
       88 +          {success}                                           
       89 +        </div>                                                
       90 +      )}                                                      
       91 +                                                              
       92 +      <form onSubmit={handleSave} className="space-y-6">      
       93 +        <div>                                                 
       94 +          <label className="block text-sm font-medium text-dar
          +k-300 mb-2 flex items-center gap-2">                          
       95 +            <User className="w-4 h-4 text-primary-400" />     
       96 +            Name                                              
       97 +          </label>                                            
       98 +          <input                                              
       99 +            type="text"                                       
      100 +            value={name}                                      
      101 +            onChange={(e) => setName(e.target.value)}         
      102 +            className="w-full px-4 py-3 rounded-xl glass-input
          + outline-none text-dark-100"                                  
      103 +            required                                          
      104 +          />                                                  
      105 +        </div>                                                
      106 +                                                              
      107 +        <div>                                                 
      108 +          <label className="block text-sm font-medium text-dar
          +k-300 mb-2 flex items-center gap-2">                          
      109 +            <Mail className="w-4 h-4 text-primary-400" />     
      110 +            Email                                             
      111 +          </label>                                            
      112 +          <input                                              
      113 +            type="email"                                      
      114 +            value={user?.email || ''}                         
      115 +            disabled                                          
      116 +            className="w-full px-4 py-3 rounded-xl bg-dark-800
          +/30 border border-dark-700/50 text-dark-500"                  
      117 +          />                                                  
      118 +          <p className="mt-1.5 text-xs text-dark-500">Email ca
          +nnot be changed</p>                                           
      119 +        </div>                                                
      120 +                                                              
      121 +        <div className="border-t border-dark-700/50 pt-6">    
      122 +          <h3 className="text-lg font-semibold text-dark-100 m
          +b-4 flex items-center gap-2">                                 
      123 +            <Lock className="w-4 h-4 text-accent-400" />      
      124 +            Change Password                                   
      125 +          </h3>                                               
      126 +                                                              
      127 +          <div className="space-y-4">                         
      128 +            <div>                                             
      129 +              <label className="block text-sm font-medium text
          +-dark-300 mb-2">                                              
      130 +                New Password                                  
      131 +              </label>                                        
      132 +              <input                                          
      133 +                type="password"                               
      134 +                value={password}                              
      135 +                onChange={(e) => setPassword(e.target.value)} 
      136 +                className="w-full px-4 py-3 rounded-xl glass-i
          +nput outline-none text-dark-100"                              
      137 +                placeholder="Leave blank to keep current passw
          +ord"                                                          
      138 +              />                                              
      139 +            </div>                                            
      140 +                                                              
      141 +            <div>                                             
      142 +              <label className="block text-sm font-medium text
          +-dark-300 mb-2">                                              
      143 +                Confirm New Password                          
      144 +              </label>                                        
      145 +              <input                                          
      146 +                type="password"                               
      147 +                value={confirmPassword}                       
      148 +                onChange={(e) => setConfirmPassword(e.target.v
          +alue)}                                                        
      149 +                className="w-full px-4 py-3 rounded-xl glass-i
          +nput outline-none text-dark-100"                              
      150 +                placeholder="Confirm new password"            
      151 +              />                                              
      152 +            </div>                                            
      153 +          </div>                                              
      154 +        </div>                                                
      155 +                                                              
      156 +        <button                                               
      157 +          type="submit"                                       
      158 +          disabled={loading}                                  
      159 +          className="w-full bg-primary-500 hover:bg-primary-60
          +0 text-white py-3 rounded-xl font-semibold transition-all dura
          +tion-200 disabled:opacity-50 disabled:cursor-not-allowed flex 
          +items-center justify-center gap-2 active:scale-[0.98]"        
      160 +        >                                                     
      161 +          {loading ? (                                        
      162 +            <>                                                
      163 +              <div className="animate-spin rounded-full h-5 w-
          +5 border-2 border-white border-t-transparent"></div>          
      164 +              Saving...                                       
      165 +            </>                                               
      166 +          ) : (                                               
      167 +            <>                                                
      168 +              <Save className="w-5 h-5" />                    
      169 +              Save Changes                                    
      170 +            </>                                               
      171 +          )}                                                  
      172 +        </button>                                             
      173 +      </form>                                                 
      174 +    </div>                                                    
      175 +  );                                                          
      176 +}                                                             
      177 +                                                              
      178 +export default ProfileTab;                                    

● Let me check if there's an Admin page that also needs updating.

● Search(pattern: "client/src/pages/*.jsx")
  ⎿  Found 6 files (ctrl+o to expand)
  ⎿  You've hit your limit · resets 6am (Europe/London)
     /upgrade to increase your usage limit.

✻ Cooked for 11m 40s
